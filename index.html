<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Barry Wittman, Aditya Mathur, Tim Korb">
<title>Start Concurrent: A Gentle Introduction to Concurrent Programming</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Start Concurrent: A Gentle Introduction to Concurrent Programming</h1>
<div class="details">
<span id="author" class="author">Barry Wittman</span><br>
<span id="email" class="email"><a href="mailto:bwittman@gmail.com">bwittman@gmail.com</a></span><br>
<span id="author2" class="author">Aditya Mathur</span><br>
<span id="email2" class="email"><a href="mailto:apm@purdue.edu">apm@purdue.edu</a></span><br>
<span id="author3" class="author">Tim Korb</span><br>
<span id="email3" class="email"><a href="mailto:jtk@purdue.edu">jtk@purdue.edu</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_computer_basics">1. Computer Basics</a>
<ul class="sectlevel2">
<li><a href="#_problem_buying_a_computer">1.1. Problem: Buying a computer</a></li>
<li><a href="#_concepts_hardware_and_software">1.2. Concepts: Hardware and software</a></li>
<li><a href="#_syntax_data_representation">1.3. Syntax: Data representation</a></li>
<li><a href="#_solution_buying_a_computer">1.4. Solution: Buying a computer</a></li>
<li><a href="#_summary">1.5. Summary</a></li>
<li><a href="#_exercises">1.6. Exercises</a></li>
</ul>
</li>
<li><a href="#_problem_solving_and_programming">2. Problem Solving and Programming</a>
<ul class="sectlevel2">
<li><a href="#_problem_how_to_solve_problems">2.1. Problem: How to solve problems</a></li>
<li><a href="#_concepts_developing_software">2.2. Concepts: Developing software</a></li>
<li><a href="#_syntax_java_basics">2.3. Syntax: Java basics</a></li>
<li><a href="#_solution_how_to_solve_problems">2.4. Solution: How to solve problems</a></li>
<li><a href="#_concurrency_solving_problems_in_parallel">2.5. Concurrency: Solving problems in parallel</a></li>
<li><a href="#_summary_2">2.6. Summary</a></li>
<li><a href="#_exercises_2">2.7. Exercises</a></li>
</ul>
</li>
<li><a href="#_primitive_types_and_strings">3. Primitive Types and Strings</a>
<ul class="sectlevel2">
<li><a href="#_problem_college_cost_calculator">3.1. Problem: College cost calculator</a></li>
<li><a href="#_concepts_types">3.2. Concepts: Types</a></li>
<li><a href="#_syntax_types_in_java">3.3. Syntax: Types in Java</a></li>
<li><a href="#_syntax_useful_libraries">3.4. Syntax: Useful libraries</a></li>
<li><a href="#_solution_college_cost_calculator">3.5. Solution: College cost calculator</a></li>
<li><a href="#_concurrency_expressions">3.6. Concurrency: Expressions</a></li>
<li><a href="#_summary_3">3.7. Summary</a></li>
<li><a href="#_exercises_3">3.8. Exercises</a></li>
</ul>
</li>
<li><a href="#_selection">4. Selection</a>
<ul class="sectlevel2">
<li><a href="#_problem_monty_hall_simulation">4.1. Problem: Monty Hall simulation</a></li>
<li><a href="#_concepts_choosing_between_options">4.2. Concepts: Choosing between options</a></li>
<li><a href="#_syntax_selection_in_java">4.3. Syntax: Selection in Java</a></li>
<li><a href="#_solution_monty_hall">4.4. Solution: Monty Hall</a></li>
<li><a href="#_concurrency_selection">4.5. Concurrency: Selection</a></li>
<li><a href="#_exercises_4">4.6. Exercises</a></li>
</ul>
</li>
<li><a href="#_repetition">5. Repetition</a>
<ul class="sectlevel2">
<li><a href="#_problem_dna_searching">5.1. Problem: DNA searching</a></li>
<li><a href="#_concepts_repetition">5.2. Concepts: Repetition</a></li>
<li><a href="#_syntax_loops_in_java">5.3. Syntax: Loops in Java</a></li>
<li><a href="#_solution_dna_searching">5.4. Solution: DNA searching</a></li>
<li><a href="#_concurrency_loops">5.5. Concurrency: Loops</a></li>
<li><a href="#_exercises_5">5.6. Exercises</a></li>
</ul>
</li>
<li><a href="#_arrays">6. Arrays</a>
<ul class="sectlevel2">
<li><a href="#_introduction">6.1. Introduction</a></li>
<li><a href="#_problem_game_of_life">6.2. Problem: Game of Life</a></li>
<li><a href="#_concepts_lists_of_data">6.3. Concepts: Lists of data</a></li>
<li><a href="#_syntax_arrays_in_java">6.4. Syntax: Arrays in Java</a></li>
<li><a href="#_examples_array_usage">6.5. Examples: Array usage</a></li>
<li><a href="#_concepts_multidimensional_lists">6.6. Concepts: Multidimensional lists</a></li>
<li><a href="#_syntax_advanced_arrays_in_java">6.7. Syntax: Advanced arrays in Java</a></li>
<li><a href="#_examples_two_dimensional_arrays">6.8. Examples: Two-dimensional arrays</a></li>
<li><a href="#_advanced_special_array_tools_in_java">6.9. Advanced: Special array tools in Java</a></li>
<li><a href="#_solution_game_of_life">6.10. Solution: Game of Life</a></li>
<li><a href="#_concurrency_arrays">6.11. Concurrency: Arrays</a></li>
<li><a href="#_exercises_6">6.12. Exercises</a></li>
</ul>
</li>
<li><a href="#_simple_graphical_user_interfaces">7. Simple Graphical User Interfaces</a>
<ul class="sectlevel2">
<li><a href="#_problem_codon_extractor">7.1. Problem: Codon extractor</a></li>
<li><a href="#GUIBasicsIntroductionSection">7.2. Concepts: User interaction</a></li>
<li><a href="#syntax:Dialogs_and_the_JOptionPane_class">7.3. Syntax: Dialogs and the <code>JOptionPane</code> class</a></li>
<li><a href="#_solution_codon_extractor">7.4. Solution: Codon extractor</a></li>
<li><a href="#_concurrency_simple_guis">7.5. Concurrency: Simple GUIs</a></li>
<li><a href="#_summary_4">7.6. Summary</a></li>
<li><a href="#_exercises_7">7.7. Exercises</a></li>
</ul>
</li>
<li><a href="#_methods">8. Methods</a>
<ul class="sectlevel2">
<li><a href="#_problem_three_card_poker">8.1. Problem: Three card poker</a></li>
<li><a href="#_concepts_dividing_work_into_segments">8.2. Concepts: Dividing work into segments</a></li>
<li><a href="#_syntax_methods">8.3. Syntax: Methods</a></li>
<li><a href="#_examples_defining_methods">8.4. Examples: Defining methods</a></li>
<li><a href="#_solution_three_card_poker">8.5. Solution: Three card poker</a></li>
<li><a href="#_concurrency_methods">8.6. Concurrency: Methods</a></li>
<li><a href="#_exercises_8">8.7. Exercises</a></li>
</ul>
</li>
<li><a href="#_classes">9. Classes</a>
<ul class="sectlevel2">
<li><a href="#_problem_nested_expressions">9.1. Problem: Nested expressions</a></li>
<li><a href="#_concepts_object_oriented_programming">9.2. Concepts: Object-oriented programming</a></li>
<li><a href="#_syntax_classes_in_java">9.3. Syntax: Classes in Java</a></li>
<li><a href="#_examples_classes">9.4. Examples: Classes</a></li>
<li><a href="#_advanced_nested_classes">9.5. Advanced: Nested classes</a></li>
<li><a href="#_solution_nested_expressions">9.6. Solution: Nested expressions</a></li>
<li><a href="#_concurrency_objects">9.7. Concurrency: Objects</a></li>
<li><a href="#_exercises_9">9.8. Exercises</a></li>
</ul>
</li>
<li><a href="#_interfaces">10. Interfaces</a>
<ul class="sectlevel2">
<li><a href="#_problem_sort_it_out">10.1. Problem: Sort it out</a></li>
<li><a href="#_concepts_making_a_promise">10.2. Concepts: Making a promise</a></li>
<li><a href="#_syntax_interfaces">10.3. Syntax: Interfaces</a></li>
<li><a href="#_advanced_local_and_anonymous_classes">10.4. Advanced: Local and anonymous classes</a></li>
<li><a href="#_solution_sort_it_out">10.5. Solution: Sort it out</a></li>
<li><a href="#_concurrency_interfaces">10.6. Concurrency: Interfaces</a></li>
<li><a href="#_exercises_10">10.7. Exercises</a></li>
</ul>
</li>
<li><a href="#_inheritance">11. Inheritance</a>
<ul class="sectlevel2">
<li><a href="#_problem_boolean_circuits">11.1. Problem: Boolean circuits</a></li>
<li><a href="#_concepts_refining_classes">11.2. Concepts: Refining classes</a></li>
<li><a href="#_syntax_inheritance_in_java">11.3. Syntax: Inheritance in Java</a></li>
<li><a href="#_examples_problem_solving_with_inheritance">11.4. Examples: Problem solving with inheritance</a></li>
<li><a href="#_solution_boolean_circuits">11.5. Solution: Boolean circuits</a></li>
<li><a href="#_concurrency_inheritance">11.6. Concurrency: Inheritance</a></li>
<li><a href="#_exercises_11">11.7. Exercises</a></li>
</ul>
</li>
<li><a href="#_exceptions">12. Exceptions</a>
<ul class="sectlevel2">
<li><a href="#_problem_bank_burglary">12.1. Problem: Bank burglary</a></li>
<li><a href="#_concepts_error_handling">12.2. Concepts: Error handling</a></li>
<li><a href="#_syntax_exceptions_in_java">12.3. Syntax: Exceptions in Java</a></li>
<li><a href="#_solution_bank_burglary">12.4. Solution: Bank burglary</a></li>
<li><a href="#_concurrency_exceptions">12.5. Concurrency: Exceptions</a></li>
<li><a href="#_exercises_12">12.6. Exercises</a></li>
</ul>
</li>
<li><a href="#_concurrent_programming">13. Concurrent Programming</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">13.1. Introduction</a></li>
<li><a href="#_problem_deadly_virus">13.2. Problem: Deadly virus</a></li>
<li><a href="#_concepts_splitting_up_work">13.3. Concepts: Splitting up work</a></li>
<li><a href="#_syntax_threads_in_java">13.4. Syntax: Threads in Java</a></li>
<li><a href="#_examples_concurrency_and_speedup">13.5. Examples: Concurrency and speedup</a></li>
<li><a href="#_concepts_thread_scheduling">13.6. Concepts: Thread scheduling</a></li>
<li><a href="#_syntax_thread_states">13.7. Syntax: Thread states</a></li>
<li><a href="#_solution_deadly_virus">13.8. Solution: Deadly virus</a></li>
<li><a href="#_summary_5">13.9. Summary</a></li>
<li><a href="#_exercises_13">13.10. Exercises</a></li>
</ul>
</li>
<li><a href="#_synchronization">14. Synchronization</a>
<ul class="sectlevel2">
<li><a href="#_introduction_3">14.1. Introduction</a></li>
<li><a href="#_problem_dining_philosophers">14.2. Problem: Dining philosophers</a></li>
<li><a href="#_concepts_thread_interaction">14.3. Concepts: Thread interaction</a></li>
<li><a href="#_syntax_thread_synchronization">14.4. Syntax: Thread synchronization</a></li>
<li><a href="#_pitfalls_synchronization_challenges">14.5. Pitfalls: Synchronization challenges</a></li>
<li><a href="#_solution_dining_philosophers">14.6. Solution: Dining philosophers</a></li>
<li><a href="#_exercises_14">14.7. Exercises</a></li>
</ul>
</li>
<li><a href="#_constructing_graphical_user_interfaces">15. Constructing Graphical User Interfaces</a>
<ul class="sectlevel2">
<li><a href="#_problem_math_applet">15.1. Problem: Math applet</a></li>
<li><a href="#_concepts_graphical_user_interfaces">15.2. Concepts: Graphical user interfaces</a></li>
<li><a href="#_syntax_guis_in_java">15.3. Syntax: GUIs in Java</a></li>
<li><a href="#_solution_math_applet">15.4. Solution: Math applet</a></li>
<li><a href="#_concurrency_guis">15.5. Concurrency: GUIs</a></li>
<li><a href="#_summary_6">15.6. Summary</a></li>
<li><a href="#_exercises_15">15.7. Exercises</a></li>
</ul>
</li>
<li><a href="#_testing_and_debugging">16. Testing and Debugging</a>
<ul class="sectlevel2">
<li><a href="#_fixing_bugs">16.1. Fixing bugs</a></li>
<li><a href="#_concepts_approaches_to_debugging">16.2. Concepts: Approaches to debugging</a></li>
<li><a href="#_syntax_java_debugging_tools">16.3. Syntax: Java debugging tools</a></li>
<li><a href="#_concurrency_parallel_bugs">16.4. Concurrency: Parallel bugs</a></li>
<li><a href="#_finding_and_avoiding_bugs">16.5. Finding and avoiding bugs</a></li>
<li><a href="#_concepts_design_implementation_and_testing">16.6. Concepts: Design, implementation, and testing</a></li>
<li><a href="#_syntax_java_testing_tools">16.7. Syntax: Java testing tools</a></li>
<li><a href="#_concurrency_testing_tools">16.8. Concurrency: Testing tools</a></li>
<li><a href="#_examples_testing_a_class">16.9. Examples: Testing a class</a></li>
<li><a href="#_exercises_16">16.10. Exercises</a></li>
</ul>
</li>
<li><a href="#_polymorphism">17. Polymorphism</a>
<ul class="sectlevel2">
<li><a href="#_problem_banking_account_with_a_vengeance">17.1. Problem: Banking account with a vengeance</a></li>
<li><a href="#_concepts_polymorphism">17.2. Concepts: Polymorphism</a></li>
<li><a href="#_syntax_inheritance_tools_in_java">17.3. Syntax: Inheritance tools in Java</a></li>
<li><a href="#_solution_banking_account_with_a_vengeance">17.4. Solution: Banking account with a vengeance</a></li>
<li><a href="#_concurrency_atomic_libraries">17.5. Concurrency: Atomic libraries</a></li>
<li><a href="#_exercises_17">17.6. Exercises</a></li>
</ul>
</li>
<li><a href="#_dynamic_data_structures">18. Dynamic Data Structures</a>
<ul class="sectlevel2">
<li><a href="#_problem_infix_conversion">18.1. Problem: Infix conversion</a></li>
<li><a href="#_concepts_dynamic_data_structures">18.2. Concepts: Dynamic data structures</a></li>
<li><a href="#_syntax_dynamic_arrays_and_linked_lists">18.3. Syntax: Dynamic arrays and linked lists</a></li>
<li><a href="#_syntax_abstract_data_types_adt">18.4. Syntax: Abstract data types (ADT)</a></li>
<li><a href="#_advanced_generic_data_structures">18.5. Advanced: Generic data structures</a></li>
<li><a href="#_solution_infix_conversion">18.6. Solution: Infix conversion</a></li>
<li><a href="#_concurrency_linked_lists_and_thread_safety">18.7. Concurrency: Linked lists and thread safety</a></li>
<li><a href="#_concurrency_thread_safe_libraries">18.8. Concurrency: Thread-safe libraries</a></li>
<li><a href="#_exercises_18">18.9. Exercises</a></li>
</ul>
</li>
<li><a href="#_recursion">19. Recursion</a>
<ul class="sectlevel2">
<li><a href="#_problem_maze_of_doom">19.1. Problem: Maze of doom</a></li>
<li><a href="#_concepts_recursive_problem_solving">19.2. Concepts: Recursive problem solving</a></li>
<li><a href="#_syntax_recursive_methods">19.3. Syntax: Recursive methods</a></li>
<li><a href="#_syntax_recursive_data_structures">19.4. Syntax: Recursive data structures</a></li>
<li><a href="#_solution_maze_of_doom">19.5. Solution: Maze of doom</a></li>
<li><a href="#_concurrency_futures">19.6. Concurrency: Futures</a></li>
<li><a href="#_exercises_19">19.7. Exercises</a></li>
</ul>
</li>
<li><a href="#_file_i_o">20. File I/O</a>
<ul class="sectlevel2">
<li><a href="#_problem_a_picture_is_worth_1_000_bytes">20.1. Problem: A picture is worth 1,000 bytes</a></li>
<li><a href="#_concepts_file_i_o">20.2. Concepts: File I/O</a></li>
<li><a href="#_syntax_file_operations_in_java">20.3. Syntax: File operations in Java</a></li>
<li><a href="#_examples_file_examples">20.4. Examples: File examples</a></li>
<li><a href="#_solution_a_picture_is_worth_1_000_bytes">20.5. Solution: A picture is worth 1,000 bytes</a></li>
<li><a href="#_concurrency_file_i_o">20.6. Concurrency: File I/O</a></li>
<li><a href="#_exercises_20">20.7. Exercises</a></li>
</ul>
</li>
<li><a href="#_network_communication">21. Network Communication</a>
<ul class="sectlevel2">
<li><a href="#_problem_web_server">21.1. Problem: Web server</a></li>
<li><a href="#_concepts_tcp_ip_communication">21.2. Concepts: TCP/IP communication</a></li>
<li><a href="#_syntax_networking_in_java">21.3. Syntax: Networking in Java</a></li>
<li><a href="#_solution_web_server">21.4. Solution: Web server</a></li>
<li><a href="#_concurrency_networking">21.5. Concurrency: Networking</a></li>
<li><a href="#_exercises_21">21.6. Exercises</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_computer_basics">1. Computer Basics</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Computers are useless. They can only give you answers.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Pablo Picasso
</div>
</div>
<div class="sect2">
<h3 id="_problem_buying_a_computer">1.1. Problem: Buying a computer</h3>
<div class="paragraph">
<p>We begin almost every chapter of this book with a motivating problem.
Why? Sometimes it helps to see how tools can be applied in order to see
why they&#8217;re useful. As we move through each chapter, we cover background
concepts needed to solve the problem in the <strong>Concepts</strong> section, the
specific technical details (usually in the form of Java syntax) required
in the <strong>Syntax and Semantics</strong> section, and eventually the solution to
the problem in the <strong>Solution</strong> sections. If you&#8217;re not interested in the
problem, that&#8217;s fine! Feel free to skip ahead to <a href="#_concepts_hardware_and_software">Section 1.2</a> on hardware and software
or to <a href="#_syntax_data_representation">Section 1.3</a> on data representation, especially if you
already have some programming experience. Then, if you&#8217;d like to see
another detailed example, the solution to this problem is available in <a href="#_solution_buying_a_computer">Section 1.4</a> as a reference.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll start with a problem that is not about programming and may be
familiar to you. Imagine you are just about to start college and need a
computer. Should you buy a Mac or PC? What kind of computer is going to
run programs faster? Do some kinds of computers crash more than others?
Which features are worth paying more for? Why are there so many
buzzwords and so much impenetrable jargon associated with buying a
computer?</p>
</div>
<div class="paragraph">
<p>When many people hear &#8220;computer science,&#8221; these are often the first
questions that come to mind. Most of this book is about programming
computers in a language called Java and not about the computers
themselves. We try to present all the material so that almost any kind
of computer can be used when programming the problems and examples.
Nevertheless, both the hardware that makes up your computer and the
other software running on it affect the way the programs you write work.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_hardware_and_software">1.2. Concepts: Hardware and software</h3>
<div class="paragraph">
<p>Computers are ubiquitous. We see them nearly everywhere. They are found
in most homes, shops, cars, aircraft, phones, and inside many other
devices. Sometimes they are obvious, like a laptop sitting on a desk.
But, most computers are hidden inside other devices such as a watch or a
flat panel television. Computers can be complex or relatively simple
machines. Despite their diversity, we can think of all computers in
terms of their <em>hardware</em> and the <em>software</em> that runs on it.</p>
</div>
<div class="sect3">
<h4 id="_hardware">1.2.1. Hardware</h4>
<div class="paragraph">
<p>Hardware consists of the physical components that make up a computer but
not the programs or data stored on it. Hardware components can be seen
and touched, if you are willing to open the computer case. One way to
organize hardware is to break it down into three categories: the
processor, the memory, and input and output (I/O) devices.</p>
</div>
<div class="paragraph">
<p>This view of a computer is a simplified version of what is called the
von Neumann architecture or a stored-program computer. It is a good (but
imperfect) model of most modern computers. In this model, a program (a
list of instructions) is stored in memory. The processor loads the
program and performs the instructions, some of which require the
processor to do a lot of number-crunching. Sometimes the processor reads
data out of memory or writes new data into it. Periodically, the
processor may send output to one of the output devices or receive input
from one of the input devices.</p>
</div>
<div class="paragraph">
<p>In other words, the processor thinks, the memory stores, and the I/O
devices interact with the outside world. The processor sits between the
memory and the I/O devices. Let&#8217;s examine these categories further.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/01-computer-basics/images/vonNeumann.svg" alt="vonNeumann" width="100%">
</div>
<div class="title">Figure 1. Hardware components in a typical desktop computer categorized into CPU, memory, and I/O devices.</div>
</div>
<div class="sect4">
<h5 id="_cpu">CPU</h5>
<div class="paragraph">
<p>The processor, or central processing unit (CPU), is the &#8220;brain&#8221; of a
computer. It fetches instructions, decodes them, and executes them. It
may send data to or from memory or I/O devices. The CPU on virtually all
modern computers is a <em>microprocessor</em>, meaning that all the computation
is done by a single integrated circuit fabricated out of silicon. What
are the important features of CPUs? How do we measure their speed and
power?</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Frequency
</td>
<td class="hdlist2">
<p>The speed of a CPU (and indeed a computer as a whole) is often quoted
in gigahertz (GHz). Hertz (Hz) is a measurement of frequency. If
something happens once per second, it has a frequency of exactly 1 Hz.
Perhaps the second hand on your watch moves with a frequency of 1 Hz.
In North America, the current in electrical outlets alternates with a
frequency of approximately 60 Hz. Sound can also be measured by
frequency. The lowest-pitched sound the human ear can hear is around
20 Hz. The highest-pitched sound is around 20,000 Hz. Such a sound
pulses against your eardrum 20,000 times per second. That sounds like
a lot, but many modern computers operate at a frequency of 1 to 4
gigahertz. The prefix &#8220;giga&#8221; means &#8220;billion.&#8221; So, we are talking
about computers doing <strong>something</strong> more than a billion (1,000,000,000)
times per second.</p>
<div class="paragraph">
<p>But <strong>what</strong> are they doing? This frequency is the <em>clock rate</em>, which
marks how often a regular electrical signal passes through the CPU. On
each tick, the CPU does some computation. How much? It depends. On
some systems, simple instructions (like adding two numbers) can be
computed in a single clock cycle. Other instructions can take ten or
more clock cycles. Different processor designs can take different
numbers of cycles to execute the same instructions. Instructions are
also <em>pipelined</em>, meaning that one instruction is being executed while
another one is being fetched or decoded. Different processors can have
different ways of optimizing this process. Because of these
differences, the frequency of a processor as measured in gigahertz is
not a good way to compare the effective speed of one processor to
another, unless the two processors are very closely related. Even
though it doesn&#8217;t really make sense, clock rate is commonly advertised
as the speed of a computer.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Word size
</td>
<td class="hdlist2">
<p>Perhaps you have heard of a 32-bit or 64-bit computer. As we discuss
in the subsection about memory, a bit is a 0 or a 1, the smallest
amount of information you can record. Most new laptop and desktop
computers are 64-bit machines, meaning that they operate on 64 bits at
a time and can use 64-bit values as memory addresses. The instructions
that it executes work on 64-bit quantities, i.e., numbers made up of
64 0s and 1s. The size of data that a computer can operate on with a
single instruction is known as its <em>word size</em>.</p>
<div class="paragraph">
<p>In day to day operations, word size is not important to most users.
Certain programs that interact directly with the hardware, such as the
operating system, may be affected by the word size. For example, most
modern 32-bit operating systems are designed to run on a 64-bit
processor, but most 64-bit operating systems do not run on a 32-bit
processor.</p>
</div>
<div class="paragraph">
<p>Programs often run faster on machines with a larger word size, but
they typically take up more memory. A 32-bit processor (or operating
system) cannot use more than 4 gigabytes (defined below) of memory.
Thus, a 64-bit computer is needed to take advantage of the larger
amounts of memory that are now available.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Cache
</td>
<td class="hdlist2">
<p>Human brains both perform computations and store information. A
computer CPU performs computations, but, for the most part, does not
store information. The CPU cache is the exception. Most modern CPUs
have a small, very fast section of memory built right onto the chip.
By guessing about what information the CPU is going to use next, it
can preload it into the cache and avoid waiting around for the slower
regular memory.</p>
<div class="paragraph">
<p>Over time, caches have become more complicated and often have multiple
levels. The first level is very small but incredibly fast. The second
level is larger and slower. And so on. It would be preferable to have
a large, first-level cache, but fast memory is expensive memory. Each
level is larger, slower, and cheaper than the last.</p>
</div>
<div class="paragraph">
<p>Cache size is not a heavily advertised CPU feature, but it makes a
huge difference in performance. A processor with a larger cache can
often outperform a processor that is faster in terms of clock rate.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Cores
</td>
<td class="hdlist2">
<p>Most laptops and desktops available today have <em>multicore</em> processors.
These processors contain two, four, six, or even more cores. Each core
is a processor capable of independently executing instructions, and
they can all communicate with the same memory.</p>
<div class="paragraph">
<p>In theory, having six cores could allow your computer to run six times
as fast. In practice, this speedup is rarely the case. Learning how to
get more performance out of multicore systems is one of the major
themes of this book. <a href="#_concurrent_programming">Chapter 13</a> and <a href="#_synchronization">Chapter 14</a> as well as
sections marked <strong>Concurrency</strong> in other chapters are specifically
tailored for students interested in programming these multicore
systems to work effectively. If you aren&#8217;t interested in concurrent
programming, you can skip these chapters and sections and use this
book as a traditional introductory Java programming textbook. On the
other hand, if you are interested in the increasingly important area
of concurrent programming, <a href="#_concurrency_multicore_processors">Section 1.4.1</a>
near the end of this chapter is the first <strong>Concurrency</strong> section of the
book and discusses multicore processors more deeply.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_memory">Memory</h5>
<div class="paragraph">
<p>Memory is where all the programs and data on a computer are stored. The
memory in a computer is usually not a single piece of hardware. Instead,
the storage requirements of a computer are met by many different
technologies.</p>
</div>
<div class="paragraph">
<p>At the top of the pyramid of memory is primary storage, memory that the
CPU can access and control directly. On desktop and laptop computers,
primary storage usually takes the form of random access memory (RAM). It
is called random access memory because it takes the same amount of time
to access any part of RAM. Traditional RAM is volatile, meaning that its
contents are lost when it&#8217;s unpowered. All programs and data must be
loaded into RAM to be used by the CPU.</p>
</div>
<div class="paragraph">
<p>After primary storage comes secondary storage, which is dominated by
hard drives that store data on spinning magnetic platters. Optical
drives (such as CD, DVD, and Blu-ray), flash drives, and the now
virtually obsolete floppy drives fall into the category of secondary
storage as well. Secondary storage is slower than primary storage, but
it is non-volatile. Some forms of secondary storage such as CD-ROM and
DVD-ROM are read only, but most are capable of reading and writing.</p>
</div>
<div class="paragraph">
<p>Before we can compare these kinds of storage effectively, we need to
have a system for measuring how much they store. In modern digital
computers, all data is stored as a sequence of 0s and 1s. In memory, the
space that can hold either a single 0 or a single 1 is called a <em>bit</em>,
which is short for &#8220;binary digit.&#8221;</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/01-computer-basics/images/bitsBytesFigure.svg" alt="bitsBytesFigure" width="100%">
</div>
<div class="title">Figure 2. Computer memory contains bits organized as bytes and words. One bit contains either a 0 or a 1.  A byte contains eight bits. A word may contain two or more bytes. Shown here is a word containing four bytes, or 32 bits. Computer scientists often number items starting at zero, as we discuss in <a href="#_arrays">Chapter 6</a>.</div>
</div>
<div class="paragraph">
<p>A bit is a tiny amount of information. For organizational purposes, we
call a sequence of eight bits a <em>byte</em>. The word size of a CPU is two or
more bytes, but memory capacity is usually listed in bytes not words.
Both primary and secondary storage capacities have become so large that
it is inconvenient to describe them in bytes. Computer scientists have
borrowed prefixes from physical scientists to create suitable units.</p>
</div>
<div class="paragraph">
<p>Common units for measuring memory are bytes, kilobytes, megabytes,
gigabytes, and terabytes. Each unit is 1,024 times the size of the
previous unit. Notice that 2<sup>10</sup> (1,024) is almost the
same as 10<sup>3</sup> (1,000). Sometimes it is not clear which
value is meant. Disk drive manufacturers always use powers of 10 when
they quote the size of their disks. Thus, a 1 TB hard disk can hold
10<sup>12</sup> (1,000,000,000,000) bytes, not
2<sup>40</sup> (1,099,511,627,776) bytes. Standards organizations
have advocated that the terms kibibyte (KiB), mebibyte (MiB), gibibyte
(GiB), and tebibyte (TiB) be used to refer to the units based on powers
of 2, while the traditional names be used to refer only to the units
based on powers of 10, but the new terms have not yet become popular.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Unit</th>
<th class="tableblock halign-left valign-top">Size</th>
<th class="tableblock halign-left valign-top">Bytes</th>
<th class="tableblock halign-left valign-top">Practical Measure</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bits</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2<sup>0</sup> = 10<sup>0</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a single character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kilobyte (KB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,024 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2<sup>10</sup> &#x2248; 10<sup>3</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a
paragraph of text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">megabyte (MB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,024 kilobytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2<sup>20</sup> &#x2248; 10<sup>6</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a
minute of MP3 music</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gigabyte (GB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,024 megabytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2<sup>30</sup> &#x2248; 10<sup>9</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">half
an hour of DVD video</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">terabyte (TB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,024 gigabytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2<sup>40</sup> &#x2248; 10<sup>12</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80% of a human&#8217;s memory capacity,<br>
estimated by Raymond Kurzweil</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We called memory a pyramid earlier in this section. At the top there is
a small but very fast amount of memory. As we work down the pyramid, the
storage capacity grows but the speed slows down. Of course, the pyramid
for every computer is different. Below is a table that shows many kinds
of memory moving from the fastest and smallest to the slowest and
largest. Effective speed is hard to measure (and is changing as
technology progresses), but note that each layer in the pyramid tends to
be 10-100 times slower than the previous layer.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 25%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Memory</th>
<th class="tableblock halign-left valign-top">Typical Capacity</th>
<th class="tableblock halign-left valign-top">Use</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kilobytes or megabytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache is fast, temporary storage for the
CPU itself. Modern CPUs have two or three levels of cache that get
progressively bigger and slower.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gigabytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bulk of primary memory is RAM. RAM comes on sticks
that can be swapped out to upgrade a computer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flash drives</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gigabytes or tens of gigabytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flash drives mark the
beginning of secondary storage. Flash drives come as USB keychain drives
but also as drives that sit inside the computer (sometimes called <em>solid
state drives</em> or SSDs). As the price of flash drives drops, they are
expected to replace hard drives entirely. (Some expensive SSDs already
have capacities in the terabyte range.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hard drives</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hundreds of gigabytes or terabytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hard drives are still
the most common secondary storage for desktops, laptops, and servers.
They are limited in speed partly because of their moving parts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tape backup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">terabytes and beyond</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some large companies still store
huge quantities of information on magnetic tape. Tape performs well for
long sequential accesses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">terabytes and beyond</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage that is accessed through
a network is limited by the speed of the network. Many companies use
networked computers for backup and redundancy as well as distributed
computation. Microsoft, Amazon, Google, and others rent their network
storage systems at rates based on storage size and total data
throughput. These services are part of what is called <em>cloud computing</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_i_o_devices">I/O devices</h5>
<div class="paragraph">
<p>I/O devices have much more variety than CPUs or memory. Some I/O
devices, such as USB ports, are permanently connected by a printed
circuit board to the CPU. Other devices called <em>peripherals</em> are
connected to a computer as needed. Their types and features are many and
varied, and in this book, we do not go deeply into how to interact with
I/O devices.</p>
</div>
<div class="paragraph">
<p>Common input devices include mice, keyboards, touch pads, microphones,
game pads, and drawing tablets. Common output devices include monitors,
speakers, and printers. Some devices perform both input and output, such
as a network card.</p>
</div>
<div class="paragraph">
<p>Remember that our view of computer hardware as CPU, memory, and I/O
devices is only a model. A PCI Express socket can be considered an I/O
device, but the graphics card that fits into the socket can be
considered one as well. And the monitor that connects to the graphics
card is yet another one. Although the graphics card is an I/O device, it
has its own processor and memory, too. It&#8217;s pointless to get bogged down
in too many details. One of the most important skills in computer
science is finding the right level of detail and abstraction to view a
given problem.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_software">1.2.2. Software</h4>
<div class="paragraph">
<p>Without hardware computers would not exist, but software is equally
important. Software is the programs and data that are executed and
stored by the computer. The focus of this book is learning to write
software.</p>
</div>
<div class="paragraph">
<p>Software includes the infinite variety of computer programs. With the
right tools (many of which are free), anyone can write a program that
runs on a Windows, Mac, or Linux machine. Although it would be nearly
impossible to list all the different kinds of software, a few categories
are worth mentioning.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Operating Systems
</td>
<td class="hdlist2">
<p>The <em>operating system</em> (OS) is the software that manages the
interaction between the hardware and the rest of the software.
Programs called <em>drivers</em> are added to the OS for each hardware
device. For example, when an application wants to print a document, it
communicates with the printer via a printer driver that is customized
for the specific printer, the OS, and the computer hardware. The OS
also schedules, runs, and manages memory for all other programs. The
three most common OSes for desktop machines are Microsoft Windows, Mac
OS, and Linux. At the present time, all three run on similar hardware
based on the Intel x86 and x64 architectures.</p>
<div class="paragraph">
<p>Microsoft does not sell desktop computers, but many desktop and laptop
computers come bundled with Windows. For individuals and businesses
who assemble their own computer hardware, it is also possible to
purchase Windows separately. In contrast, most computers running Mac
OS are sold by Apple, and Mac OS is usually bundled with the computer.
Linux is <em>open-source software</em>, meaning that all the source code used
to create it is freely available. In spite of Linux being free, many
consumers prefer Windows or Mac OS because of ease of use,
compatibility with specific software, and technical support. Many
consumers are also unaware that hardware can be purchased separately
from an OS or that Linux is a free alternative to the other two.</p>
</div>
<div class="paragraph">
<p>Other computers have OSes as well. The Motorola Xoom and many kinds of
mobile telephones use the Google Android OS. The Apple iPad and iPhone
use the competing Apple iOS. Phones, microwave ovens, automobiles, and
countless other devices have computers in them that use some kind of
embedded OS.</p>
</div>
<div class="paragraph">
<p>Consider two applications running on a mobile phone with a single core
CPU. One application is a web browser and the other is a music player.
The user may start listening to music and then start the browser. In
order to function, both applications need to access the CPU at the
same time. Since the CPU only has a single core, it can execute only
one instruction at a time.</p>
</div>
<div class="paragraph">
<p>Rather than forcing the user to finish listening to the song before
using the web browser, the OS switches the CPU between the two
applications very quickly. This switching allows the user to continue
browsing while the music plays in the background. The user perceives
an illusion that both applications are using the CPU at the same time.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Compilers
</td>
<td class="hdlist2">
<p>A <em>compiler</em> is a kind of program that is particularly important to
programmers. Computer programs are written in special languages, such
as Java, that are human readable. A compiler takes this human-readable
program and turns it into instructions (often machine code) that a
computer can understand.</p>
<div class="paragraph">
<p>To compile the programs in this book, you use the Java compiler
<code>javac</code>, either directly by typing its name as a command or indirectly
as Eclipse, DrJava, or some other tool that runs the compiler for you.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Business Applications
</td>
<td class="hdlist2">
<p>Many different kinds of programs fall under the umbrella of business
or productivity software. Perhaps the most famous is the Microsoft
Office suite of tools, which includes the word-processing software
Word, the spreadsheet software Excel, and the presentation software
PowerPoint.</p>
<div class="paragraph">
<p>Programs in this category are often the first to come to mind when
people think of software, and this category has had tremendous
historical impact. The popularity of Microsoft Office led to the
widespread adoption of Microsoft Windows in the 1990s. A single
application that is so desirable that a consumer is willing to buy the
hardware and the OS just to be able to run it is sometimes called a
<em>killer app</em>.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Video Games
</td>
<td class="hdlist2">
<p>Video games are software like other programs, but they deserve special
attention because they represent an enormous, multi-billion dollar
industry. They are usually challenging to program, and the video game
development industry is highly competitive.</p>
<div class="paragraph">
<p>The intense 3D graphics required by modern video games have pushed
hardware manufacturers such as Nvidia, AMD, and Intel to develop
high-performance graphics cards for desktop and laptop computers. At
the same time, companies like Nintendo, Sony, and Microsoft have
developed computers such as the Wii, PS3, and Xbox 360 that specialize
in video games but are not designed for general computing tasks.</p>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
Web Browsers
</td>
<td class="hdlist2">
<p>Web browsers are programs that can connect to the Internet and
download and display web pages and other files. Early web browsers
could only display relatively simple pages containing text and images.
Because of the growing importance of communication over the Internet,
web browsers have evolved to include plug-ins that can play sounds,
display video, and allow for sophisticated real-time communication.</p>
<div class="paragraph">
<p>Popular web browsers include Microsoft Internet Explorer, Mozilla
Firefox, Apple Safari, and Google Chrome. Each has advantages and
disadvantages in terms of compatibility, standards compliance,
security, speed, and customer support. The Opera web browser is not
well known on desktop computers, but it is commonly used on mobile
telephones.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_examples">1.2.3. Examples</h4>
<div class="paragraph">
<p>Here are a few examples of modern computers with a brief description of
their hardware and some of the software that runs on them.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Desktop computer</div>
<div class="content">
<div class="paragraph">
<p>The Inspiron 560 Desktop is a modestly priced computer manufactured and
sold by Dell, Inc. It can be configured with different hardware options,
but one choice uses a 64-bit Intel Pentium E6700 CPU that runs at a
clock rate of 3.2 GHz with a 2 MB cache and two cores. In terms of
memory, you can choose between 4 and 6 GB worth of RAM. You can also
choose to have a 500 GB or 1 TB hard drive. The computer comes with a
DVD-RW optical drive.</p>
</div>
<div class="paragraph">
<p>For I/O, the computer has various ports for connecting USB devices,
monitors, speakers, microphones, and network cables. By default, it
includes a keyboard, a mouse, a network card, a graphics card, and an
audio card. For an additional charge, a monitor, speakers, and other
peripherals can be purchased.</p>
</div>
<div class="paragraph">
<p>A 64-bit edition of Microsoft Windows 7 is included. (Software often
uses version numbers to mark changes in features and support, but
Microsoft has adopted some very confusing numbering schemes. Windows 7
is the successor to Windows Vista, which is the successor to Windows XP.
Windows 7 is <strong>not</strong> the seventh version of the Windows OS, but Windows 8
is the successor to Windows 7. ) Depending on the price, different
configurations of Microsoft Office 2010 with more or fewer features can
be included.
<a href="#computerPictures">Figure 3</a> (a) shows a picture of the Dell Inspiron 560.</p>
</div>
</div>
</div>
<div id="computerPictures" class="imageblock">
<div class="content">
<img src="chapters/01-computer-basics/images/computerPictures.svg" alt="computerPictures" width="100%">
</div>
<div class="title">Figure 3. (a) Dell Inspiron 560. (b) Apple iPhone 4. (c) Motorola Xoom.</div>
</div>
<div class="exampleblock">
<div class="title">Example 2. Smartphone</div>
<div class="content">
<div class="paragraph">
<p>All mobile phones contain a computer, but a phone that has features like
a media player, calendar, GPS, or camera is often called a <em>smartphone</em>.
Such phones often have sophisticated software that is comparable to a
desktop computer. One example is the Apple iPhone 4.</p>
</div>
<div class="paragraph">
<p>This phone uses a CPU called the A4, which has a single core, a cache of
512 KB, and a maximum clock rate of 1 GHz, though the clock rate used in
the iPhone 4 is not publicly known. The phone has 512 MB of RAM and uses
either a 16 GB or 32 GB flash drive for secondary storage.</p>
</div>
<div class="paragraph">
<p>In terms of I/O, the iPhone 4 has a built-in liquid crystal display
(LCD) that is also a touch screen for input. It has two cameras, an LED
flash, a microphone, a speaker, a headphone jack, a docking connector,
buttons, gyroscopes, accelerometers, and the capability to communicate
on several kinds of wireless networks.</p>
</div>
<div class="paragraph">
<p>In addition to the Apple iOS 4 operating system, the iPhone runs a
variety of applications just like a desktop computer. These applications
are available from the iTunes App Store.
<a href="#computerPictures">Figure 3</a> (b) shows a picture of the iPhone 4.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 3. Tablet</div>
<div class="content">
<div class="paragraph">
<p>The Motorola Xoom is a <em>tablet computer</em>. A tablet computer has a touch
screen and is generally lighter than a laptop. Some tablets have
keyboards, but many newer models use the touch screen instead.</p>
</div>
<div class="paragraph">
<p>The Xoom uses the Nvidia Tegra 2 CPU, which runs at 1 GHz and has 1 MB
of cache and two cores. It has 1 GB of RAM and a 32 GB flash drive for
storage. It has a built-in LCD that is also a touch screen for input,
with a connector for a monitor. It has two cameras, an LED flash, a
microphone, a speaker, a headset jack, buttons, gyroscopes,
accelerometers, a barometer, and the capability to communicate on
several kinds of wireless networks.</p>
</div>
<div class="paragraph">
<p>It uses the Google Android 3 operating system, which can run
applications available from the Android Market.
<a href="#computerPictures">Figure 3</a> (c) shows a picture of the Motorola Xoom.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_data_representation">1.3. Syntax: Data representation</h3>
<div class="paragraph">
<p>After each <strong>Concepts</strong> section, this book usually has a <strong>Syntax</strong> section.
Syntax is the rules for a language. These <strong>Syntax</strong> sections generally
focus on concrete Java language features and technical specifics that
are related to the concepts described in the chapter.</p>
</div>
<div class="paragraph">
<p>In this chapter, we are still trying to describe computers at a general
level. Consequently, the technical details we cover in this section will
not be Java syntax. Although everything we say applies to Java, it also
applies to many other programming languages.</p>
</div>
<div class="sect3">
<h4 id="_compilers_and_interpreters">1.3.1. Compilers and interpreters</h4>
<div class="paragraph">
<p>This book is primarily about solving problems with computer programs.
From now on, we only mention hardware when it has an impact on
programming. The first step to writing a computer program is deciding
what language to use.</p>
</div>
<div class="paragraph">
<p>Most humans communicate via natural languages such as Chinese, English,
French, Russian, or Tamil. However, computers are poor at understanding
natural languages. As a compromise, programmers write programs
(instructions for a computer to follow) in a language more similar to a
natural language than it is to the language understood by the CPU. These
languages are called <em>high-level languages</em>, because they are closer to
natural language (the highest level) than they are to <em>machine language</em>
(the lowest level). We may also refer to machine language as <em>machine
code</em> or <em>native code</em>.</p>
</div>
<div class="paragraph">
<p>Thousands of programming languages have been created over the years, but
some of the most popular high level-languages of all time include
Fortran, Cobol, Visual Basic, C, C++, Python, Java, and C#.</p>
</div>
<div class="paragraph">
<p>As we mentioned in the previous section, a compiler is a program that
translates one language into another. In many cases, a compiler
translates a high-level language into a low level language that the CPU
can understand and execute. Because all the work is done ahead of time,
this kind of compilation is known as static or ahead-of-time
compilation. In other cases, the output of the compiler is an
intermediate language that is easier for the computer to understand than
the high-level language but still takes some translation before the
computer can follow the instructions.</p>
</div>
<div class="paragraph">
<p>An <em>interpreter</em> is a program that is similar to a compiler. However, an
interpreter takes code in one language as input and, on the fly, runs
each instruction on the CPU as it translates it. Interpreters generally
execute the code more slowly than if it had been translated to machine
language before execution.</p>
</div>
<div class="paragraph">
<p>Note that both compilers and interpreters are normal programs. They are
usually written in high-level languages and compiled into machine
language before execution. This raises a philosophical question: If you
need a compiler to create a program, where did the first compiler come
from?</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/01-computer-basics/images/compilerFigure.svg" alt="compilerFigure" width="100%">
</div>
<div class="title">Figure 4. (a) Static compilation. (b) Interpreted execution. (c) Compilation into bytecode with later just-in-time compilation.</div>
</div>
<div class="exampleblock">
<div class="title">Example 4. Java compilation</div>
<div class="content">
<div class="paragraph">
<p>Java is the popular high-level programming language we will focus on in
this book. The standard way to run a Java program has an extra step that
most compiled languages do not. Most compilers for Java, though not all,
translate a program written in Java to an intermediate language known as
<em>bytecode</em>. This intermediate version of the high-level program is used
as input for another program called the Java Virtual Machine (JVM). Most
popular JVMs translate the bytecode into machine code that is executed
directly by the CPU. This conversion from bytecode into machine code is
done with a just-in-time (JIT) compiler. It&#8217;s called &#8220;just-in-time&#8221;
because sections of bytecode are not compiled until the moment they are
needed. Because the output is going to be used for this specific
execution of the program, the JIT can do optimizations to make the final
machine code run particularly well in the current environment.</p>
</div>
<div class="paragraph">
<p>Why does Java use the intermediate step of bytecode? One of Java&#8217;s
design goals is to be platform independent, meaning that it can be
executed on any kind of computer. This is a difficult goal because every
combination of OS and CPU will need different low level instructions.
Java attacks the problem by keeping its bytecode platform independent.
You can compile a program into bytecode on a Windows machine and then
run the bytecode on a JVM in a Mac OS X environment. Part of the work is
platform independent, and part is not. Each JVM must be tailored to the
combination of OS and hardware that it runs on.</p>
</div>
<div class="paragraph">
<p>The Java language and original JVM were developed by Sun Microsystems,
Inc., which was bought by Oracle Corporation in 2009. Oracle continues
to produce HotSpot, the standard JVM, but many other JVMs exist,
including Apache Harmony and Dalvik, the Google Android JVM.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_numbers">1.3.2. Numbers</h4>
<div class="paragraph">
<p>All data inside of a computer is represented with numbers. Although
we humans use numbers in our daily lives, the representation and
manipulation of numbers by computers work differently. In this
subsection we introduce the notions of number systems, bases, conversion
from one base to another, and arithmetic in number systems.</p>
</div>
<div class="sect4">
<h5 id="_a_few_number_systems">A few number systems</h5>
<div class="paragraph">
<p>A number system is a way to represent numbers. It is easy to confuse the
<em>numeral</em> that represents the <em>number</em> with the number itself. You might
think of the number ten as &#8220;10&#8221;, a numeral made of two symbols, but
the number itself is the concept of <strong>ten-ness</strong>. You could express that
quantity by holding up all your fingers, with the symbol &#8220;X&#8221;, or by
knocking ten times.</p>
</div>
<div class="paragraph">
<p>Representing ten with &#8220;10&#8221; is an example of a <em>positional number
system</em>, namely base 10. In a positional number system, the position of
the digits determines the magnitude they represent. For example, the
numeral 3,432 contains the digit 3 twice. The first time, it represents
three groups of one thousand. The second time, it represents three
groups of ten. (The Roman numeral system is an example of a number
system that is <strong>not</strong> positional.)</p>
</div>
<div class="paragraph">
<p>The numeral 3,432 and possibly every other normally written number you
have seen is expressed in the base 10 or <em>decimal</em> system. It is called
base 10 because, as you move from the rightmost digit leftward, the
value of each position goes up by a factor of 10. Also, in base 10, ten
is the smallest positive integer that requires two digits for
representation. Each smaller number has its own digit: 0, 1, 2, 3, 4, 5,
6, 7, 8, and 9. Representing ten requires two existing digits to be
combined. Every base has the property that the number it is named after
takes two digits to write, namely &#8220;1&#8221; and &#8220;0.&#8221; (An exception is base
1, which does not behave like the other bases and is not a normal
positional number system.)</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Decimal numbers</div>
<div class="content">
<div class="paragraph">
<p>The number 723 can be written as
723=7 × 10<sup>2</sup> + 2 × 10<sup>1</sup> + 3 × 10<sup>0</sup>.</p>
</div>
<div class="paragraph">
<p>Note that the rightmost digit is the ones place, which is equivalent to
10<sup>0</sup>. Be sure to start with \(b^0\) and not
\(b^1\) when considering the value of a number written in base
\(b\), no matter what \(b\) is. The second digit
from the right is multiplied by 10<sup>1</sup>, and so on. The
product of a digit and the corresponding power of 10 tells us how much a
digit contributes to the number. In the above expansion, digit 7
contributes 700 to the number 723. Similarly, digits 2 and 3 contribute,
respectively, 20 and 3 to 723.</p>
</div>
<div class="paragraph">
<p>As we move to the right, the power of 10 goes down by one, and this
pattern works even for negative powers of 10. If we expand the
fractional value 0.324, we get
0.324 = 3 × 10<sup>-1</sup> + 2 × 10<sup>-2</sup> + 4 × 10<sup>-3</sup>.</p>
</div>
<div class="paragraph">
<p>We can combine the above two numbers to get
723.324 = 7 × 10<sup>2</sup> + 2 × 10<sup>1</sup> + 3 × 10<sup>0</sup> + 3 × 10<sup>-1</sup> + 2 × 10<sup>-2</sup> + 4 × 10<sup>-3</sup>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>We can expand these ideas to any base, checking our logic against the
familiar base 10. Suppose that a numeral consists of \(n\)
symbols \(s_{n-1},
s_{n-2}, \ldots, s_1, s_0\). Furthermore, suppose that this numeral
belongs to the base \(b\) number system. We can expand the
value of this numeral to:</p>
</div>
<div class="stemblock">
<div class="content">
\[s_{n-1} s_{n-2} \ldots s_1 s_0=s_{n-1}\times b^{n-1}+ s_{n-2}\times b^{n-2}+
\ldots +s_1\times b^1+ s_0\times b^0\]
</div>
</div>
<div class="paragraph">
<p>The leftmost symbol in the numeral is the <em>highest order digit</em> and the
rightmost symbol is the <em>lowest order digit</em>. For example, in the
decimal numeral 492, 4 is the highest order digit and 2 the lowest order
digit.</p>
</div>
<div class="paragraph">
<p>Fractions can also be expanded in a similar manner. For example, a
fraction with \(n\) symbols
\(s_{1}, s_{2}, \ldots, s_{n-1}, s_{n}\) in a number system
with base \(b\), can be expanded to:</p>
</div>
<div class="stemblock">
<div class="content">
\[0.s_{1} s_{2} \ldots s_{n-2} s_{n-1}=s_{1}\times b^{-1}+ s_{2}\times b^{-2}+
\ldots s_{n-1}\times b^{n-1}+s_{n}\times b^{-n}\]
</div>
</div>
<div class="paragraph">
<p>To avoid confusion, the base number is always written in base 10. As
computer scientists, we are interested in base 2 because that&#8217;s the base
used to express numbers inside of a computer. Base 2 is also called
<em>binary</em>. The only symbols allowed to represent numbers in binary are
&#8220;0&#8221; and &#8220;1&#8221;, the binary digits or <em>bits</em>.</p>
</div>
<div class="paragraph">
<p>In the binary numeral 100110, the leftmost 1 is the highest order bit
and the rightmost 0 is the lowest order bit. By the rules of positional
number systems, the highest order bit represents
1 × 2<sup>5</sup> = 32.</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Binary numbers</div>
<div class="content">
<div class="paragraph">
<p>Examples of numbers written in binary are 100<sub>2</sub>, 111<sub>2</sub>, 0111<sub>2</sub>, and 10101<sub>2</sub>.
Recall that the base of the binary number system is 2. Thus, we can
write a number in binary as the sum of products of powers of 2. For
example, the numeral 10011<sub>2</sub> can be expanded to:</p>
</div>
<div class="stemblock">
<div class="content">
\[10011_2 = 1 \times 2^4+0 \times 2^3+0 \times 2^2+1 \times 2^1+1 \times
2^0=16+0+0+2+1 = 19\]
</div>
</div>
<div class="paragraph">
<p>By expanding the number, we have also shown how to convert a binary
numeral into a decimal numeral. Remember that both 10011 and 19
represent the same value, namely nineteen. The conversion between bases
changes only the way the number is written. As before, the rightmost bit
is multiplied by 2<sup>0</sup> to determine its contribution to the
binary number. The bit to its left is multiplied by 2<sup>1</sup> to
determine its contribution, and so on. In this case, the leftmost 1
contributes 1 × 2<sup>4</sup> = 16 to the value.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.4">Exercise 1.4</a><br>
<a href="#exercise1.5">Exercise 1.5</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Another useful number system is <em>base 16</em>, also known as <em>hexadecimal</em>.
Hexadecimal is surprising because it requires more than the familiar 10
digits. Numerals in this system are written with 16 hexadecimal digits
that include the ten digits 0 through 9 and the six letters A, B, C, D,
E, and F. The six letters, starting from A, correspond to the values 10,
11, 12, 13, 14, and 15.</p>
</div>
<div class="paragraph">
<p>Hexadecimal is used as a compact representation of binary. Binary
numbers can get very long, but four binary digits can be represented
with a single hexadecimal digit.</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Hexadecimal numbers</div>
<div class="content">
<div class="paragraph">
<p>39A<sub>16</sub>, 32<sub>16</sub>, and AFBC12<sub>16</sub> are examples of numbers written in hexadecimal. A
hexadecimal numeral can be expressed as the sum of products of powers of
16. For example, the hexadecimal numeral A0BF<sub>16</sub> can be expanded to:</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathrm{A} \times 16^3+0 \times 16^2+ \mathrm{B} \times 16^1+ \mathrm{F} \times
16^0\]
</div>
</div>
<div class="paragraph">
<p>To convert a hexadecimal numeral to decimal, we must substitute the
values 10 through 15 for the digits A through F. Now we can rewrite the
sum of products from above as:</p>
</div>
<div class="stemblock">
<div class="content">
\[10 \times 16^3+0 \times 16^2+11 \times 16^1+15 \times 16^0=40960+0+176+15=41151\]
</div>
</div>
<div class="paragraph">
<p>Thus, we get A0BF<sub>16</sub> = 41151<sub>10</sub>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The base 8 number system is also called <em>octal</em>. Like hexadecimal, octal
is used as a shorthand for binary. A numeral in octal uses the octal
digits 0, 1, 2, 3, 4, 5, 6, and 7. Otherwise the same rules apply. For
example, the octal numeral 377 can be expanded to:</p>
</div>
<div class="stemblock">
<div class="content">
\[377=3 \times 8^2+7 \times 8^1+7 \times 8^0=255\]
</div>
</div>
<div class="paragraph">
<p>You may have noticed that it is not always clear which base a numeral is
written in. The digit sequence 337 is a legal numeral in octal, decimal,
and hexadecimal, but it represents different numbers in each system.
Mathematicians use a subscript to denote the base in which a numeral is
written.</p>
</div>
<div class="paragraph">
<p>Thus, 337<sub>8</sub> = 255<sub>10</sub>, 377<sub>10</sub> = 377<sub>10</sub>,
and 377<sub>16</sub> = 887<sub>10</sub>. Base numbers are always written
in base 10. A number without a subscript is assumed to be in base 10. In
Java, there is no way to mark subscripts, and so prefixes are used. A
prefix of <code>0</code> is used for octal, no prefix is used for decimal, and a prefix
of <code>0x</code> is used for hexadecimal. A numeral cannot be marked as binary in
Java. The corresponding numerals in Java code would thus be written <code>0377</code>, <code>377</code>,
and <code>0x377</code>. Be careful not to pad numbers with zeroes in Java since they might be interpreted as base 8! Remember that
the value <code>056</code> is <strong>not</strong> the same as the value <code>56</code> in Java.</p>
</div>
<div class="paragraph">
<p>The following table lists a few characteristics of the four number
systems we have discussed with representations of the numbers 7 and
29.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Number System</th>
<th class="tableblock halign-center valign-middle">Base</th>
<th class="tableblock halign-left valign-middle">Digits</th>
<th class="tableblock halign-left valign-middle">Math<br>
Numerals</th>
<th class="tableblock halign-left valign-middle">Java<br>
Numerals</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Binary</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">0, 1</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">111<sub>2</sub>, 11101<sub>2</sub></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Octal</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">0, 1, 2, 3, 4, 5, 6, 7</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">7<sub>8</sub>, 35<sub>8</sub></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>07</code>, <code>035</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Decimal</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">0, 1, 2, 3, 4, 5, 6, 7, 8, 9</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">7, 29</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>7</code>, <code>29</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Hexadecimal</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">0, 1, 2, 3, 4, 5, 6, 7, 8, 9, A, B, C, D, E, F</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">7<sub>16</sub>, 1D<sub>16</sub></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>0x7</code>,<code>0x1D</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_conversion_across_number_systems">Conversion across number systems</h5>
<div class="paragraph">
<p>It is often useful to know how to convert a number represented in one
base to the equivalent representation in another base. The examples have
shown how to convert a numeral in any base to decimal by expanding the
numeral in the sum-of-product form and then adding the different terms
together. But how do you convert a decimal numeral to another base?</p>
</div>
</div>
<div class="sect4">
<h5 id="_decimal_to_binary_conversion">Decimal to binary conversion</h5>
<div class="paragraph">
<p>There are at least two different ways to convert a decimal numeral to
binary. One way is to write the decimal number as a sum of powers of two
as in the following conversion of the number 23.</p>
</div>
<div class="stemblock">
<div class="content">
\[23=16+0+4+2+1=1\times 2^4+0\times 2+3+1\times 2+2+1\times 2+1+1\times 2^0= 10111_2\]
</div>
</div>
<div class="paragraph">
<p>First, find the largest power of two that is greater than or equal to
the number. In this case, 16 fits the bill because 32 is too large.
Subtract that value from the number, leaving 7 in this case. Then repeat
the process. The last step is to collect the coefficients of the powers
of two into a sequence to get the binary equivalent. We used 16, 4, 2,
and 1 but skipped 8. If we write a 1 for every place we used and a 0 for
every place we skipped, we get 23 = 10111<sub>2</sub>. While this is a
straightforward procedure for decimal to binary conversion, it can be
cumbersome for larger numbers.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.6">Exercise 1.6</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>An alternate way to convert a decimal numeral to an equivalent binary
numeral is to divide the given number by 2 until the quotient is 0
(keeping only the integer part of the quotient). At each step, record
the remainder found when dividing by 2. Collect these remainders (which
will always be either 0 or 1) to form the binary equivalent. The least
significant bit is the remainder obtained after the first division, and
the most significant bit is the remainder obtained after the last
division.  In other words, this approach finds the digits of the binary number in the opposite order.</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Decimal to binary with remainders</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s use this method to convert 23 to its binary equivalent. The
following table shows the steps need for the conversion. The leftmost
column lists the step number. The second column contains the number to
be divided by 2 at each step. The third column contains the quotient for
each step, and the last column contains the current remainder.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong>Step</strong></th>
<th class="tableblock halign-right valign-top"><strong>Number</strong></th>
<th class="tableblock halign-right valign-top"><strong>Quotient</strong></th>
<th class="tableblock halign-right valign-top"><strong>Remainder</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We begin by dividing 23 by 2, yielding 11 as the quotient and 1 as the
remainder. The quotient 11 is then divided by 2, yielding 5 as the
quotient and 1 as the remainder. This process continues until we get a
quotient of 0 and a remainder of 1 in Step 5. We now write the
remainders from the most recent to the least recent and get the same result as before,
23 = 10111<sub>2</sub>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_conversions">Other conversions</h5>
<div class="paragraph">
<p>A decimal number can be converted to its hexadecimal equivalent by using
either of the two procedures described above. Instead of writing a
decimal number as a sum of powers of 2, one writes it as a sum of powers
of 16. Similarly, when using the division method, instead of dividing by
2, one divides by 16. Octal conversion is similar.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.9">Exercise 1.9</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>We use hexadecimal because it is straightforward to convert from it to
binary or back. The following table lists binary equivalents for the 16
hexadecimal digits.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-bottom">Hexadecimal<br>
digit</th>
<th class="tableblock halign-center valign-bottom">Binary</th>
<th class="tableblock halign-center valign-bottom">Hexadecimal<br>
digit</th>
<th class="tableblock halign-center valign-bottom">Binary</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0000</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0001</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1001</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0010</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">A</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1010</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0011</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">B</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1011</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0100</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">C</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1100</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0101</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">D</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1101</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0110</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">E</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1110</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0111</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1111</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With the help of the table above, let&#8217;s convert
3FA<sub>16</sub> to binary. By simple substitution,
3FA<sub>16</sub> = 0011 1111 1010<sub>2</sub>.
Note that we have grouped the binary digits into clusters of
4 bits each. Of course, the leftmost zeroes in the binary equivalent are
useless as they do not contribute to the value of the number.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.10">Exercise 1.10</a><br>
<a href="#exercise1.11">Exercise 1.11</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_integer_representation_in_a_computer">Integer representation in a computer</h5>
<div class="paragraph">
<p>In mathematics, binary numerals can represent arbitrarily big numbers.
Inside of a computer, the size of a number is constrained by the number
of bits used to represent it. For general purpose computation, 32- and
64-bit integers are the most commonly used. The largest integer that
Java represents with 32 bits is 2,147,483,647, which is good enough for
most tasks. For larger numbers, Java can represent up to
9,223,372,036,854,775,807 with 64 bits. Java also provides
representations for integers using 8 and 16 bits.</p>
</div>
<div class="paragraph">
<p>These representations are easy to determine for positive numbers: Find
the binary equivalent of the number and then pad the left side with
zeroes to fill the remaining space. For example,
19 = 10011<sub>2</sub>. If stored using 8 bits, 19 would be
represented as <code>0001 0011</code>. If stored using 16 bits, 19 would be
represented as <code>0000 0000 0001 0011</code>. (We separate groups of 4 bits for
easier reading.)</p>
</div>
</div>
<div class="sect4">
<h5 id="_binary_arithmetic">Binary arithmetic</h5>
<div class="paragraph">
<p>Recall that computers deal with numbers in their binary representation,
meaning that all arithmetic is done on binary numbers. Sometimes it is
useful to understand how this process works and how it is similar and
different from decimal arithmetic. The table below lists rules for
binary addition.<br></p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>+</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>1</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">10</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As indicated above, the addition of two 1s leads to a 0 with a carry of
1 into the next position to the left. Addition for numbers composed of
more than one bit use the same rules as any addition, carrying values
that are too large into the next position. In decimal addition, values
over 9 must to be carried. In binary addition, values over 1 must be
carried. The next example shows a sample binary addition. To simplify
its presentation, we assume that integers are represented with 8 bits.</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Binary addition</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s add the numbers 60 and 6 in binary. Using the conversion
techniques described above, we can find that 60 = 111100<sub>2</sub>
and 6 = 110<sub>2</sub>. Inside the computer, these numbers would
already be in binary and padded to fill 8 bits.<br></p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-right valign-top">Binary</th>
<th class="tableblock halign-right valign-top">Decimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0011 1100</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">60</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0110</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0100 0010</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">66</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The result is no surprise, but note that the addition can proceed in
binary without conversion to decimal at any point.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Subtraction in binary is also similar to subtraction in decimal. The
rules are given in the following table.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>-</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>1</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">(1)1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When subtracting a 1 from a 0, a 1 is borrowed from the next left
position. The next example illustrates binary subtraction.</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. Binary subtraction</div>
<div class="content">
<div class="paragraph">
<p>Again, we&#8217;ll use 60 and 6 and their binary equivalents given above.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-right valign-top">Binary</th>
<th class="tableblock halign-right valign-top">Decimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0011 1100</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">60</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0110</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0011 0110</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">54</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.17">Exercise 1.17</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_negative_integers_in_a_computer">Negative integers in a computer</h5>
<div class="paragraph">
<p>Negative integers are also represented in computer memory as binary
numbers, using a system called <em>two&#8217;s complement</em>. When looking at the
binary representation of a signed integer in a computer, the leftmost
(most significant) bit will be 1 if the number is negative and 0 if it
is positive. Unfortunately, there&#8217;s more to finding the representation
of a negative number than flipping this bit.</p>
</div>
<div class="paragraph">
<p>Suppose that we need to find the binary equivalent of the decimal number
-12 using 8-bits in two&#8217;s complement form. The first step
is to convert 12 to its 8-bit binary equivalent. Doing so we get 12 =
<code>0000 1100</code>. Note that the leftmost bit of the representation is a 0,
indicating that the number is positive. Next we take the two&#8217;s
complement of the 8-bit representation in two steps. In the first step,
we flip every bit, i.e., change every 0 to 1 and every 1 to 0. This
gives us the <em>one&#8217;s complement</em> of the number, <code>1111 0011</code>. In the
second step, we add 1 to the one&#8217;s complement to get the two&#8217;s
complement. The result is <code>1111 0011</code> + <code>1</code> = <code>1111 0100</code>.</p>
</div>
<div class="paragraph">
<p>Thus, the 8-bit, two&#8217;s complement binary equivalent of -12 is
<code>1111 0100</code>. Note that the leftmost bit is a 1, indicating that this is
a negative number.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.7">Exercise 1.7</a><br>
<a href="#exercise1.8">Exercise 1.8</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 11. Decimal to two&#8217;s complement</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s convert -29 to its binary equivalent assuming that the number is
to be stored in 8-bit, two&#8217;s complement form. First we convert positive
29 to its 8-bit binary equivalent, 29 = <code>0001 1101</code>.</p>
</div>
<div class="paragraph">
<p>Next we obtain the one&#8217;s complement of the binary representation by
flipping 0s to 1s and 1s to 0s. This gives us <code>1110 0010</code>. Finally, we
add 1 to the one&#8217;s complement representation to get <code>1110 0010</code> + <code>1</code> =
<code>1110 0011</code>, which is the desired binary equivalent of -29.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.14">Exercise 1.14</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 12. Two&#8217;s complement to decimal</div>
<div class="content">
<div class="paragraph">
<p>Let us now convert the 8-bit, two&#8217;s complement value <code>1000 1100</code> to
decimal. We note that the leftmost bit of this number is 1, making it a
negative number. Therefore, we reverse the process of making a two&#8217;s
complement. First, we subtract 1 from the representation, yielding
<code>1000 1100</code> - <code>1</code> = <code>1000 1011</code>. Next, we flip all the bits in this
one&#8217;s complement form, yielding <code>0111 0100</code>.</p>
</div>
<div class="paragraph">
<p>Now we convert this binary representation to its decimal equivalent,
yielding 116. Thus, the decimal equivalent of <code>1000 1100</code> is -116.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.15">Exercise 1.15</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Why do we use two&#8217;s complement? First of all, we needed a system that
could represent both positive and negative numbers. We could have simply
used the leftmost bit as a sign bit and represented the rest of the
number as a positive binary number. Doing so would require a check on
the bit and some conversion for negative numbers every time a computer
wanted to perform an addition or subtraction.</p>
</div>
<div class="paragraph">
<p>Because of the way it&#8217;s designed, positive and negative integers stored
in two&#8217;s complement can be added or subtracted <strong>without</strong> any special
conversions. The leftmost bit is added or subtracted just like any other
bit, and values that carry past the leftmost bit are ignored. Two&#8217;s
complement has an advantage over one&#8217;s complement in that there is only
one representation for zero. The next example shows two&#8217;s complement in
action.</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. Two&#8217;s complement arithmetic</div>
<div class="content">
<div class="paragraph">
<p>We&#8217;ll add -126 and 126. If you perform the needed conversions, their
8-bit, two&#8217;s complement representations are <code>1000 0010</code> and <code>0111 1110</code>.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-right valign-top">Binary</th>
<th class="tableblock halign-right valign-top">Decimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>1000 0010</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-126</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0111 1110</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">126</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As expected, the sum is 0.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s add the two negative integers -126 and -2, whose 8-bit, two&#8217;s
complement representations are <code>1000 0010</code> and <code>1111 1110</code>.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-right valign-top">Binary</th>
<th class="tableblock halign-right valign-top">Decimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>1000 0010</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-126</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>1111 1110</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-2</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>1000 0000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-128</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The result is -128, which is the smallest negative integer that can be
represented in 8-bit two&#8217;s complement.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.16">Exercise 1.16</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_overflow_and_underflow">Overflow and underflow</h5>
<div class="paragraph">
<p>When performing an arithmetic or other operation on numbers, an overflow
is said occur when the result of the operation is larger than the
largest value that can be stored in that representation. An underflow is
said to occur when the result of the operation is smaller than the
smallest possible value.</p>
</div>
<div class="paragraph">
<p>Both overflows and underflows lead to wrapped around values. For
example, adding two positive numbers together can result in a negative
number or adding two negative numbers together can result in a positive
number.</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. Binary addition with overflow</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s add the numbers 124 and 6. Their 8-bit, two&#8217;s complement
representations are <code>0111 1100</code> and <code>0000 0110</code>.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Binary</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Decimal</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0111 1100</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">124</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0110</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>1000 0010</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-126</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This surprising result happens because the largest 8-bit two&#8217;s
complement integer is 127. Adding 124 and 6 yields 130, a value larger
than this maximum, resulting in overflow with a negative answer.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The smallest (most negative) number that can be represented in 8-bit
two&#8217;s complement is -128. A result smaller than this will result in
underflow. For example, -115 - 31 = 110. Try out the conversions needed
to test this result.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bitwise_operators">Bitwise operators</h5>
<div class="paragraph">
<p>Although we will most commonly manipulate numbers using traditional
mathematical operations such as addition, subtraction, multiplication,
and division, there are also operations that work directly on the binary
representations of the numbers. Some of these operators are equivalent
to mathematical operations, and some are not.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines two binary representations into a new
representation which has 1s in every position that both the original
representations have a 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines two binary representations into a new
representation which has 1s in every position that either of the
original representations have a 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise XOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines two binary representations into a new
representation which has 1s in every position that the original
representations have different values</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>~</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise complement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a representation and creates a new
representation in which every bit is flipped from 0 to 1 and 1 to 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&lt;&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed left shift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moves all the bits the specified number of
positions to the left, leaving the sign bit unchanged</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed right shift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moves all the bits the specified number of
positions to the right, padding the left with copies of the sign bit</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&gt;&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned right shift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moves all the bits the specified number of
positions to the right, padding with 0s</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Bitwise AND, bitwise OR, and bitwise XOR take two integer
representations and combine them to make a new representation. In
bitwise AND, each bit in the result will be a 1 if <strong>both</strong> of the
original integer representations in that position are 1 and 0 otherwise.
In bitwise OR, each bit in the result will be a 1 if <strong>either</strong> of the
original integer representations in that position are 1 and 0 otherwise.
In bitwise XOR, each bit in the result will be a 1 if the two bits of
the original integer representations in that position are not the same
and 0 otherwise.</p>
</div>
<div class="paragraph">
<p>Bitwise complement is a unary operator like the negation operator ().
Instead of just changing the sign of a value (which it will also do),
its result has every 1 in the original representation changed to 0 and
every 0 to 1.</p>
</div>
<div class="paragraph">
<p>The signed left shift, signed right shift, and unsigned right shift
operators all create a new binary representation by shifting the bits in
the original representation a certain number of places to the left or
the right. The signed left shift moves the bits to the left, padding
with 0s, but does not change the sign bit. If you do a signed left shift
by \(n\) positions, it is equivalent to multiplying the number
by \(2^n\). The signed right shift moves the bits to the
right, padding with whatever the sign bit is. If you do a signed right
shift by \(n\) positions, it is equivalent to dividing the
number by \(2^n\) (with integer division). The unsigned right
shift moves the bits to the right, including the sign bit, filling the
left side with 0s. And unsigned right shift will always make a value
positive but is otherwise similar to a signed right shift. A few
examples follow.</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Bitwise operators</div>
<div class="content">
<div class="paragraph">
<p>Here are a few examples of the result of bitwise operations. We will
assume that the values are represented using 32-bit two&#8217;s complement,
instead of using 8-bit values as before. In Java, bitwise operators
automatically convert smaller values to 32-bit representations before
proceeding.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the result of <code>21 &amp; 27</code>.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-right valign-top">Binary</th>
<th class="tableblock halign-right valign-top">Decimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0000 0000 0000 0000 0000 0001 0101</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0000 0000 0000 0000 0000 0001 1011</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">27</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0000 0000 0000 0000 0000 0001 0001</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">17</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note how this result is different from <code>21 | 27</code>.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-right valign-top">Binary</th>
<th class="tableblock halign-right valign-top">Decimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0000 0000 0000 0000 0000 0001 0101</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0000 0000 0000 0000 0000 0001 1011</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">27</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0001 1111</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">31</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>And also from <code>21 ^ 27</code>.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-right valign-top">Binary</th>
<th class="tableblock halign-right valign-top">Decimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0000 0000 0000 0000 0000 0001 0101</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">21</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 0000 0000 0000 0000 0000 0001 1011</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">27</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0000 1110</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">14</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Ignoring overflows, signed left shifting is equivalent to repeated
multiplications by 2. Consider <code>11 &lt;&lt; 3</code>. The representation
<code>0000 0000 0000 0000 0000 0000 0000 1011</code> is shifted to the left to make
<code>0000 0000 0000 0000 0000 0000 0101 1000</code> = 88 = 11 × 2<sup>3</sup>.</p>
</div>
<div class="paragraph">
<p>Signed right shifting is equivalent to repeated integer divisions by 2.
Consider <code>-104 &gt;&gt; 2</code>. The representation
<code>1111 1111 1111 1111 1111 1111 1001 1000</code> is shifted to the right to
make <code>1111 1111 1111 1111 1111 1111 1110 0110</code> = -26 = -104 ÷ 2<sup>2</sup>.</p>
</div>
<div class="paragraph">
<p>Unsigned right shifting is the same as signed right shifting except when
it is done on negative numbers. Since their sign bit is replaced by <code>0</code>,
an unsigned right shift produces a (generally large) positive number.
Consider <code>-104 &gt;&gt;&gt; 2</code>. The representation
<code>1111 1111 1111 1111 1111 1111 1001 1000</code> is shifted to the right to
make <code>0011 1111 1111 1111 1111 1111 1110 0110</code> = 1,073,741,798.</p>
</div>
<div class="paragraph">
<p>Because of the way two&#8217;s complement is designed, bitwise complement is
equivalent to negating the sign of the number and then subtracting
1. Consider <code>~(-104)</code>. The
representation <code>1111 1111 1111 1111 1111 1111 1001 1000</code> is complemented
to <code>0000 0000 0000 0000 0000 0000 0110 0111</code> = 103.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rational_numbers">Rational numbers</h5>
<div class="paragraph">
<p>We have seen how to represent positive and negative integers in computer
memory. In this section we see how rational numbers, such as 12.33,
-149.89, and 3.14159, can be converted into binary and represented.</p>
</div>
</div>
<div class="sect4">
<h5 id="_scientific_notation">Scientific notation</h5>
<div class="paragraph">
<p><em>Scientific notation</em> is closely related to the way a computer
represents a rational number in memory. Scientific notation is a tool
for representing very large or very small numbers without writing a lot
of zeroes. A decimal number in scientific notation is written
\(a\times 10^b\) where \(a\) is called the
<em>mantissa</em> and \(b\) is called the <em>exponent</em>.</p>
</div>
<div class="paragraph">
<p>For example, the number 3.14159 can be written in scientific notation as
0.314159 × 10<sup>1</sup>. In this case, 0.314159
is the mantissa, and 1 is the exponent. Here a few more
examples of writing numbers in scientific notation.<br>
\(\begin{array}{ l c l}
3.14159&amp;=&amp;3.14159\times 10^0\\
3.14159&amp;=&amp;314159\times 10^{-5}\\
-141.324&amp;=&amp;-0.141324\times10^2\\
30,000&amp;=&amp; .3\times10^5\\
\end{array}\)<br>
There are many ways of writing a number in scientific notation. A more
standardized way of writing real numbers is <em>normalized scientific
notation</em>. In this notation, the mantissa is always written as a number
whose absolute value is less than 10 but greater than or equal to 1.
Following are a few examples of decimal numbers in normalized scientific
notation.<br>
\(\begin{array}{ l c l}
3.14159&amp;=&amp;3.14159\times 10^0\\
-141.324&amp;=&amp;-1.41324\times10^3\\
30,000&amp;=&amp; 3.0\times10^4\\
\end{array}\)<br>
A shorthand for scientific notation is E notation, which is written with
the mantissa followed by the letter &#8216;E&#8217; followed by the exponent. For
example, 39.2 in E notation can be written 3.92E1 or 0.392E2. The letter &#8216;E&#8217; should be read
&#8220;multiplied by 10 to the power.&#8221; E notation can be used to represent
numbers in scientific notation in Java. Instead of writing the number in
Java code, or could be used instead.</p>
</div>
</div>
<div class="sect4">
<h5 id="_fractions">Fractions</h5>
<div class="paragraph">
<p>A rational number can be broken into an integer part and a fractional
part. In the number 3.14, 3 is the integer part, and .14 is the
fractional part. We have already seen how to convert the integer part to
binary. Now we will see how to convert the fractional part into binary.
We can then combine the binary equivalents of the integer and fractional
parts to find the binary equivalent of a decimal real number.</p>
</div>
<div class="paragraph">
<p>A decimal fraction \(f\) is converted to its binary equivalent
by successively multiplying it by 2. At the end of each multiplication
step, either a 0 or a 1 is obtained as an integer part and is recorded
separately. The remaining fraction is again multiplied by 2 and the
resulting integer part recorded. This process continues until the
fraction reduces to zero or enough binary digits for the desired
precision have been found. The binary equivalent of \(f\) then
consists of the bits in the order they have been recorded, as shown in
the next example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. Fraction conversion to binary</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s convert 0.8125 to binary. The table below shows the steps to do
so.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Step</th>
<th class="tableblock halign-right valign-top">\(f\)</th>
<th class="tableblock halign-right valign-top">\(f \times 2\)</th>
<th class="tableblock halign-right valign-top">Integer part</th>
<th class="tableblock halign-right valign-top">Remainder</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.8125</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.625</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.625</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.625</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.25</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.25</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.25</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.5</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We then collect all the integer parts and get 0.1101<sub>2</sub> as the binary
equivalent of 0.8125. We can convert this binary fraction back into
decimal to verify that it is correct.</p>
</div>
<div class="stemblock">
<div class="content">
\[0.1101_2=1\times 2^{-1}+1\times2^{-2}+0\times 2^{-3}+1\times
2^{-4}=0.5+0.25+0+0.0625=0.8125\]
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In some cases, the process described above will never have a remainder
of 0. In such cases we can only find an approximate representation of
the given fraction as demonstrated in the next example.</p>
</div>
<div id="Non-terminating_fraction" class="exampleblock">
<div class="title">Example 17. Non-terminating fraction</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s convert 0.3 to binary assuming that we have only five bits in
which to represent the fraction. The following table shows the five
steps in the conversion process.<br></p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Step</th>
<th class="tableblock halign-right valign-top">\(f\)</th>
<th class="tableblock halign-right valign-top">\(f \times 2\)</th>
<th class="tableblock halign-right valign-top">Integer part</th>
<th class="tableblock halign-right valign-top">Remainder</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.6</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.6</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.2</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.4</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.8</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.8</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.8</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.6</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0.6</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Collecting the integer parts we get 0.01001<sub>2</sub> as the binary representation
of 0.3. Let&#8217;s convert this back to decimal to see how accurate it is.</p>
</div>
<div class="stemblock">
<div class="content">
\[0.01001_2=0\times2^{-1}+1\times 2^{-2}+ 0\times2^{-3}+ 0\times 2^{-4}+ 1\times
2^{-5}= 0.25+0.03125=0.28125\]
</div>
</div>
<div class="paragraph">
<p>Five bits are not enough to represent 0.3 fully. In this case, we have
an error of 0.3 - 0.28125 = 0.01875. Most computers use many
more bits to represent fractions and obtain much better accuracy in
their representation.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.18">Exercise 1.18</a><br>
<a href="#exercise1.19">Exercise 1.19</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Now that we understand how integers as well as fractions can be
converted from one number base to another, we can convert any rational
number from one base to another. The next example demonstrates one such
conversion.</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. Rational number converted to binary</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s convert 14.3 to binary assuming that we will only use six bits to
represent the fractional part. First we convert 14 to binary using the
technique described earlier. This gives us 14 = 1110<sub>2</sub>.
Taking the method outlined in Example  one step further, our six bit
representation of 0.3 is 0.010011<sub>2</sub>. Combining the two representations
gives 14.3 = 1110.010011<sub>2</sub>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_floating_point_notation">Floating point notation</h5>
<div class="paragraph">
<p><em>Floating point notation</em> is a system used to represent rational numbers
in computer memory. In this notation a number is represented as
\(a\times b^{e}\), where \(a\) gives the
<em>significant digits</em> (mantissa) of the number and \(e\) is the
exponent. The system is very similar to scientific notation, but
computers usually have base \(b = 2\) instead of
\(10\).</p>
</div>
<div class="paragraph">
<p>For example, we could write the binary number 1010.1<sub>2</sub> in floating point
notation as 10.101<sub>2</sub> × 2<sup>2</sup> or as
101.01<sub>2</sub> × 2<sup>1</sup>. In any case, this number is equivalent to
10.5 in decimal.</p>
</div>
<div class="paragraph">
<p>In standardized floating point notation, \(a\) is written so
that only the most significant non-zero digit is to the left of the
decimal point. Most computers use the IEEE 754 floating point notation
to represent rational numbers. In this notation, the memory to store the
number is divided into three segments: one bit used to mark the sign of
the number, \(m\) bits to represent the mantissa (also known
as the <em>significand</em>), and \(e\) bits to represent the
exponent.</p>
</div>
<div class="paragraph">
<p>In IEEE floating point notation, numbers are commonly represented using
32 bits (known as <em>single precision</em>) or using 64 bits (known as <em>double
precision</em>). In single precision, \(m = 23\) and
\(e = 8\). In double precision, \(m = 52\) and
\(e = 11\). To represent positive and negative exponents, the
exponent has a <em>bias</em> added to it so that the result is never negative.
This bias is 127 for single precision and 1,023 for double precision.
The packing of the sign bit, the exponent, and the mantissa is shown in
<a href="#numberRepresentationFigure">Figure 5</a> (a) and (b).</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. Single precision IEEE format</div>
<div class="content">
<div class="paragraph">
<p>The following is a step-by-step demonstration of how to construct the
single precision binary representation in IEEE format of the number
10.5.</p>
</div>
<div class="olist start">
<ol class="start">
<li>
<p>Convert 10.5 to its binary equivalent using methods described
earlier, yielding 10.5<sub>10</sub> = 1010.1<sub>2</sub>. Unlike the case
of integers, the sign of the number is taken care of separately for
floating point. Thus, we would use 1010.1<sub>2</sub> for
-10.5 as well.</p>
</li>
<li>
<p>Write this binary number in standardized floating point notation,
yielding 1.0101<sub>2</sub> × 2<sup>3</sup>.</p>
</li>
<li>
<p>Remove the leading bit (always a 1 for non-zero numbers), leaving <code>0101</code>.</p>
</li>
<li>
<p>Pad the fraction with zeroes on the right to fill the 23-bit
mantissa, yielding <code>0101 0000 0000 0000 0000 000</code>. Note that the decimal
point is ignored in this step.</p>
</li>
<li>
<p>Add 127 to the exponent. This gives us an exponent of
3 + 127 = 130.</p>
</li>
<li>
<p>Convert the exponent to its 8-bit unsigned binary equivalent. Doing
so gives us 130<sub>10</sub> = 10000011<sub>2</sub>.</p>
</li>
<li>
<p>Set the sign bit to 0 if the number is positive and to 1 otherwise.
Since 10.5 is positive, we set the sign bit to 0.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We now have the three components of 10.5 in binary. The memory
representation of 10.5 is shown in <a href="#numberRepresentationFigure">Figure 5</a> (c).
Note in the figure how the sign bit, the exponent, and the mantissa are
packed into 32 bits.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.20">Exercise 1.20</a></p>
</div>
</div>
</div>
<div id="numberRepresentationFigure" class="imageblock">
<div class="content">
<img src="chapters/01-computer-basics/images/numberRepresentationFigure.svg" alt="numberRepresentationFigure" width="100%">
</div>
<div class="title">Figure 5. Layouts for floating point representation (a) in single precision, (b) in double precision, and (c) of 10.5<sub>10</sub> in single precision.</div>
</div>
</div>
<div class="sect4">
<h5 id="_largest_and_smallest_numbers">Largest and smallest numbers</h5>
<div class="paragraph">
<p>Fixing the number of bits used for representing a real number limits the
numbers that can be represented in computer memory using the floating
point notation. The largest rational number that can be represented in
single precision has an exponent of 127 (254 after bias) with a mantissa
consisting of all 1s:<br>
<code>0 1111 1110 1111 1111 1111 1111 1111 111</code><br>
This number is approximately 3.402 × 10<sup>38</sup>. To
represent the smallest (closest to zero) non-zero number, we need to
examine one more complication in the IEEE format. An exponent of 0
implies that the number is unnormalized. In this case, we no longer
assume that there is a 1 bit to the left of the mantissa. Thus, the
smallest non-zero single precision number has its exponent set to 0 and
its mantissa set to all zeros with a 1 in its
23<sup>rd</sup> bit:<br>
<code>0 0000 0000 0000 0000 0000 0000 0000 001</code><br>
Unnormalized single precision values are considered to have an exponent
of -126. Thus, the value of this number is
2<sup>-23</sup> × 2<sup>-126</sup> =
2<sup>-149</sup> ≈ 1.4 × 10<sup>-45</sup>. Now that we know the rules for
storing both integers and floating point numbers, we can list the
largest and smallest values possible in 32- and 64-bit representations
in Java as shown in the following table. Note that <strong>largest</strong> means the
largest positive number for both integers and floating point values, but
<strong>smallest</strong> means the most negative number for integers and the smallest
positive non-zero value for floating point values.<br></p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Largest number</th>
<th class="tableblock halign-left valign-top">Smallest number</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,147,483,647</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-2,147,483,648</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9,223,372,036,854,775,807</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-9,223,372,036,854,775,808</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.4028235 × 10<sup>38</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.4 × 10<sup>-45</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit floating point</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.7976931348623157 × 10<sup>308</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.9<sup>-324</sup></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Using the same number of bits, floating point representation can store
much larger numbers than integer representation. However, floating point
numbers are not always exact, resulting in approximate results when
performing arithmetic. Always use integer formats when fractional parts
are not needed.</p>
</div>
</div>
<div class="sect4">
<h5 id="_special_numbers">Special numbers</h5>
<div class="paragraph">
<p>Several binary representations in the floating point notation correspond
to special numbers. These numbers are set aside and not used for results
in normal computation.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">0.0 and -0.0</dt>
<dd>
<p>When the exponent as well as the mantissa is 0, the number is
interpreted as a 0.0 or -0.0 depending on the sign bit. For example,
in a Java program, dividing 0.0 by -1.0 results in -0.0. Similarly,
-0.0 divided by -1.0 is 0.0. Positive and negative zeroes only exist
for floating point values. -0 is the same as 0 for integers. Dividing
the integer 0 by -1 in Java results in 0 and not in -0.</p>
</dd>
<dt class="hdlist1">Positive and negative infinity</dt>
<dd>
<p>An overflow or an underflow might occur while performing arithmetic on
floating point values. In the case of an overflow, the resulting
number is the special value that Java recognizes as infinity. In the
case of an underflow, it is a special negative infinity value. For
example, dividing 1.0 by 0.0 in Java results in infinity and dividing
-1.0 by 0.0 results in negative infinity. These values have well
defined behavior. For example, adding 1.0 to infinity yields infinity.<br>
Note that floating point values and integers do not behave in the same
way. Dividing the integer 1 by the integer 0 creates an error that can
crash a Java program.</p>
</dd>
<dt class="hdlist1">Not-a-number (<code>NaN</code>)</dt>
<dd>
<p>Some mathematical operations may result in an undefined number. For
example, \(\sqrt{-2}\) is an imaginary number. Java has a
value set aside for results that are not rational numbers. When we
discuss how to find the square root of a value in Java, this
not-a-number value will be the answer for the square root of a
negative number.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_errors_in_floating_point_arithmetic">Errors in floating point arithmetic</h5>
<div class="paragraph">
<p>As we have seen, many rational numbers can only be approximately
represented in computer memory. Thus, arithmetic done on the approximate
values yields approximate answers. For example, 1.3 cannot be
represented exactly using a 32-bit value. In this case, the product
1.3 × 3.0 will be 3.8999999 instead of 3.9. This error will propagate as
additional operations are performed on previous results. The next
example illustrates this propagation of errors when a sequence of
floating point operations are performed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. Error propagation</div>
<div class="content">
<div class="paragraph">
<p>Suppose that the price of several products is to be added to determine
the total price of a purchase at a cash register that uses floating-point arithmetic with a 32-bit variable (the equivalent of a <code>float</code> in Java).
For simplicity, let&#8217;s assume that all items have a
price of $1.99. We don&#8217;t know how many items will be purchased ahead of
time and simply add the price of each item until all items have been
scanned at the register. The table below shows the value of the total
cost for different number of items purchased.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Items</th>
<th class="tableblock halign-right valign-top">Correct Cost</th>
<th class="tableblock halign-right valign-top">Calculated Cost</th>
<th class="tableblock halign-right valign-top">Absolute Error</th>
<th class="tableblock halign-right valign-top">Relative Error</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">199.0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.9900015E02</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.5258789E-04</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7.6677333E-07</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">995.0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9.9499670E02</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3.2958984E-03</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3.3124606E-06</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1990.0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.9899918E03</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8.1787109E-03</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4.1099051E-06</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">19900.0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.9901842E04</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1.8417969E00</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9.2552604E-05</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first column in the table above is the number of items. The second
column is the correct cost of all items purchased. The third column is
the cost calculated by adding each item using single precision floating
point addition. The fourth and fifth columns give the absolute and
relative errors, respectively, of the calculated value. Note how the
error increases as the number of additions goes up. In the last row, the
absolute error is almost two dollars.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>While the above example may seem unrealistic, it does expose the
inherent dangers of floating-point calculations. Although the errors are
much less when using double precision representations, they still exist.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_buying_a_computer">1.4. Solution: Buying a computer</h3>
<div class="paragraph">
<p>We pose a motivating problem in the <strong>Problem</strong> section near the beginning
of most chapters. Whenever there is a <strong>Problem</strong> section, there is a
<strong>Solution</strong> section near the end in which we give a solution to the
problem given earlier.</p>
</div>
<div class="paragraph">
<p>After all the discussion of the hardware, software, and data
representation inside of a computer, you might feel more confused about
which computer to buy than before. As a programmer, it is important to
understand how data is represented, but this information plays virtually
no role in deciding which computer to buy. Unlike most problems in this
book, there is no concrete answer we can give here. Because the
development of technology progresses so rapidly, any advice about
computer hardware or software has a short shelf-life.</p>
</div>
<div class="paragraph">
<p>Software is a huge consideration, beginning with the OS. Because the
choice of OS usually affects choice of hardware, we&#8217;ll start there. The
three major choices for a desktop or laptop OS are Microsoft Windows,
Mac OS X, and Linux.</p>
</div>
<div class="paragraph">
<p>Windows is the most commonly used and is also heavily marketed for
business use. Windows suffered from many stability and security issues,
but Microsoft has worked hard to address these. Mac OS (and the
computers it is installed on) are marketed to an artistic and
counter-culture population. Linux is popular among tech savvy users.
Putting marketing biases aside, the three operating systems have become
more similar to each other over time, and most people could be
productive using any of the three. The following table lists some pros
and cons for each OS.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OS</th>
<th class="tableblock halign-left valign-top">Pros</th>
<th class="tableblock halign-left valign-top">Cons</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Windows</p></th>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Compatible with the largest number of programs</p>
</li>
<li>
<p>Can be purchased separately from hardware</p>
</li>
<li>
<p>Can run on Mac hardware</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Expensive</p>
</li>
<li>
<p>Security concerns</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Mac OS</p></th>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Polished user interface</p>
</li>
<li>
<p>Bundled with many useful programs</p>
</li>
<li>
<p>Tested for use on the hardware it comes with</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Most expensive</p>
</li>
<li>
<p>Many business applications and games are released late or not at all for OS X</p>
</li>
<li>
<p>Difficult to run on non-Mac hardware</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></th>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Free</p>
</li>
<li>
<p>Runs on almost any hardware</p>
</li>
<li>
<p>Highly customizable</p>
</li>
<li>
<p>Serviced by a community that develops many free applications for it</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>Can be difficult to install or configure</p>
</li>
<li>
<p>Few commercial applications are available for it</p>
</li>
<li>
<p>Limited customer support</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once you have decided on an OS, you can pick hardware and other software
that is compatible with it. For Mac OS X, most of your hardware choices
will be computers sold by Apple. For Windows and Linux, you can either
have a computer built for you or build your own. Although computer
hardware changes quickly, let&#8217;s examine some general guidelines.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CPU</dt>
<dd>
<p>Remember that the speed of a CPU is measured in GHz (billions of clock
cycles per second). Higher GHz is generally better, but it&#8217;s hard to
compare performance across different designs of CPU. There is also a
diminishing returns effect: The very fastest, very newest CPUs are
often considerably more expensive even if they only provide slightly
better performance. It&#8217;s usually more cost effective to select a CPU
in the middle of the performance spectrum.</p>
<div class="paragraph">
<p>Cache size also has a huge effect on performance. The larger the
cache, the less often the CPU has to read data from much slower
memory. Since most new CPUs available today are 64-bit, the question
of word size is not significant.</p>
</div>
<div class="paragraph">
<p>Although some specialists may prefer one or the other, both Intel and
AMD make powerful, competitive consumer CPUs.</p>
</div>
</dd>
<dt class="hdlist1">Memory</dt>
<dd>
<p>Memory includes RAM, hard drives, optical drives, and any other
storage. RAM is usually easy to upgrade for desktop machines and less
easy (though often possible) for laptops. The price of RAM per
gigabyte goes down over time. It may be reasonable to start with a
modest amount of RAM and then upgrade after a year or two when it
becomes cheaper to do so. It takes a little bit of research to get
exactly the right kind of RAM for your CPU and motherboard. The amount
of RAM is dependent on what you want to do with your system. The
minimum amount of RAM to run Microsoft Windows 7 is 1 GB for 32-bit
versions and 2 GB for 64-bit versions. The minimum amount of RAM to
run Apple Mac OS X 10.7 &#8220;Lion&#8221; is 2 GB. One rule of thumb is to have
at least twice the minimum required RAM.</p>
<div class="paragraph">
<p>Hard drive storage is heavily dependent on how you expect to use your
computer. 500 GB and 1 TB drives are not very expensive, and this
represents a huge amount of storage. Only if you plan to have enormous
libraries of video or uncompressed audio data will you likely need
more. Corporate level databases and web servers and some other
business systems can also require huge amounts of space. Hard drive
speed is greatly affected by the hard drive&#8217;s cache size. As always, a
bigger cache means better performance. Using a solid state drive (SSD)
instead of a traditional hard drive has much better performance but
higher cost.</p>
</div>
<div class="paragraph">
<p>Installing optical drives and other storage devices depends on
individual needs. Note that a DVD-RW drive is an
inexpensive solution for backing up data or reinstalling an operating
system.</p>
</div>
</dd>
<dt class="hdlist1">I/O Devices</dt>
<dd>
<p>The subject of I/O devices is very personal. It is difficult to say
what anyone should buy without considering his or her specific needs.
A monitor is the essential visual output device while a keyboard and
mouse are the essential input devices. Speakers are very important as
well. Most laptops have all of these things integrated in some form or
another.</p>
<div class="paragraph">
<p>Someone interested in video games might want to invest in a powerful
graphics card. Newer cards with more video RAM are generally better
than older cards with less, but which card is best at a given price
point is the subject of continual discussion at sites like AnandTech
(<a href="http://www.anandtech.com/" class="bare">http://www.anandtech.com/</a>) and Tom&#8217;s Hardware
(<a href="http://www.tomshardware.com/" class="bare">http://www.tomshardware.com/</a>).</p>
</div>
<div class="paragraph">
<p>Printers are still useful output devices. Graphics tablets can make it
easier to create digital art on a computer. The number of potentially
worthwhile I/O devices is limitless.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This section is just a jumping off point for purchasing a computer. As
you learn more about computer hardware and software, it will become
easier to know what combination of the two will serve your needs. Of
course, there is always more to know, and technology changes quickly.</p>
</div>
<div class="sect3">
<h4 id="_concurrency_multicore_processors">1.4.1. Concurrency: Multicore processors</h4>
<div class="paragraph">
<p>In the last decade, the word &#8220;core&#8221; has been splattered all over CPU
packaging. Intel in particular has marketed the idea heavily with its
Core, Core 2, i3 Core, i5 Core, and i7 Core chips. What are all these
cores?</p>
</div>
<div class="paragraph">
<p>Looking back into the past, most consumer processors had a single
<em>core</em>, or brain. They could only execute one instruction at a time.
(Even this definition is a little hazy, because pipelining kept more
than one instruction in the process of being executed, but overall
execution proceeded sequentially.)</p>
</div>
<div class="paragraph">
<p>The advent of multicore processors has changed this design
significantly. Each processor has several independent cores, each of
which can execute different instructions at the same time. Before the
arrival of multicore processors, a few desktop computers and many
supercomputers had multiple separate processors that could achieve a
similar effect. However, since multicore processors have more than one
effective processor on the same silicon die, the communication time
between processors is much faster and the overall cost of a
multi-processor system is cheaper.</p>
</div>
<div class="sect4">
<h5 id="_the_good">The Good</h5>
<div class="paragraph">
<p>Multicore systems have impressive performance. The first multicore
processors had two cores, but current designs have four, six, or eight,
and much greater numbers are expected. A processor with eight cores can
execute eight different programs at the same time. Or, when faced with a
computationally intense problem like matrix math, code breaking, or
scientific simulation, a processor with eight cores could solve the
problem eight times as fast. A desktop processor with 100 cores that can
solve a problem 100 times faster is not out of reach.</p>
</div>
<div class="paragraph">
<p>In fact, modern graphics cards are already blazing this trail. Consider
the 1080p standard for high definition video, which has a resolution of
1,920 × 1,080 <em>pixels</em>. Each pixel (short for picture
element) is a dot on the screen. A screen whose resolution is 1080p has
2,073,600 dots. To maintain the illusion of smooth movement, these dots
should be updated around 30 times per second. Computing the color for
more than 2 million dots based on 3D geometry, lighting, and physics
effects 30 times a second is no easy feat. Some of the cards used to
render computer games have hundreds or thousands of cores. These cores
are not general purpose or completely independent. Instead, they&#8217;re
specialized to do certain kinds of matrix transformations and floating
point computations.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise1.23">Exercise 1.23</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_bad">The Bad</h5>
<div class="paragraph">
<p>Although chip-makers have spent a lot of money marketing multicore
technology, they have not spent much money explaining that one of the
driving forces behind the ``multicore revolution'' is a simple failure
to make processors faster in other ways. In 1965, Gordon Moore, one of
the founders of Intel, remarked that the density of silicon
microprocessors had been doubling every year (though he later revised
this to every two years), meaning that twice as many transistors
(computational building blocks) could fit in the same physical space.
This trend, often called Moore&#8217;s Law, has held up reasonably well. For
years, clever designs relying on shorter communication times,
pipelining, and other schemes succeeded in doubling the effective
performance of processors every two years.</p>
</div>
<div class="paragraph">
<p>At some point, the tricks became less effective and exponential gains in
processor clock rate could no longer be maintained. As clock frequency
increases, the signal becomes more chaotic, and it becomes more
difficult to tell the difference between the voltages that represent 0s
and 1s. Another problem is heat. The energy that a processor uses is
related to the <strong>square</strong> of the clock rate. This relationship means that
increasing the clock rate of a processor by a factor of 4 will increase
its energy consumption (and heat generation) by a factor of 16.</p>
</div>
<div class="paragraph">
<p>The legacy of Moore&#8217;s Law lives on. We are still able to fit more and
more transistors into tinier and tinier spaces. After decades of
increasing clock rate, chip-makers began using the additional silicon
density to make processors with more than one core instead. Since 2005
or so, increases in clock rate have stagnated.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_ugly">The Ugly</h5>
<div class="paragraph">
<p>Does a processor with eight cores solve problems eight times as fast as
its single core equivalent? Unfortunately, the answer is, &#8220;Almost
never.&#8221; Most problems are not easy to break into eight independent
pieces.</p>
</div>
<div class="paragraph">
<p>For example, if you want to build eight houses and you have eight
construction teams, then you probably can get pretty close to completing
all eight houses in the time it would have taken for one team to build a
single house. But what if you have eight teams and only one house to
build? You might be able to finish the house a little early, but some
steps necessarily come after others: The concrete foundation must be
poured and solid before framing can begin. Framing must be finished
before the roof can be put on. And so on.</p>
</div>
<div class="paragraph">
<p>Like building a house, most problems you can solve on a computer are
difficult to break into concurrent tasks. A few problems are like
painting a house and can be completed much faster with lots of
concurrent workers. Other tasks simply cannot be done faster with more
than one team on the job. Worse, some jobs can actually interfere with
each other. If a team is trying to frame the walls while another team is
trying to put the roof onto unfinished walls, neither will succeed, the
house might be ruined, and people could get hurt.</p>
</div>
<div class="paragraph">
<p>On a desktop computer, individual cores generally have their own level 1
cache but share level 2 cache and RAM. If the programmer isn&#8217;t careful,
he or she can give instructions to the cores that will make them fight
with each other, overwriting the memory that other cores are using and
potentially crashing the program or giving an incorrect answer. Imagine
if different parts of your brain were completely independent and fought
with one another. The words that came out of your mouth might be random
and chaotic and make no sense to your listener.</p>
</div>
<div class="paragraph">
<p>To recap, the first problem with concurrent programming is finding ways
to break down problems so that they can be solved faster with multiple
cores. The second problem is making sure that the different cores
cooperate so that the answer is correct and makes sense. These are not
easy problems, and many researchers are still working on finding better
ways to do both.</p>
</div>
<div class="paragraph">
<p>Some educators believe that beginners will be confused by concurrency
and should wait until later courses to confront these problems. We
disagree: Forewarned is forearmed. Concurrency is an integral part of
modern computation, and the earlier you get introduced to it, the more
familiar it will be.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary">1.5. Summary</h3>
<div class="paragraph">
<p>This introductory chapter focused on the fundamentals of a computer. We
began with a description of computer hardware, including the CPU,
memory, and I/O devices. We also described the software of a computer,
highlighting key programs such as the operating system and compilers as
well as other useful programs like business applications, video games,
and web browsers.</p>
</div>
<div class="paragraph">
<p>Then, we introduced the topic of how numbers are represented inside the
computer. Various number systems and conversion from one system to
another were explained. We discussed how floating point notation is used
to represent rational numbers. A sound knowledge of data representation
helps a programmer decide what kind of data to use (integer or floating
point and how much precision) as well as what kind of errors to expect
(overflow, underflow, and floating point precision errors).</p>
</div>
<div class="paragraph">
<p>The next chapter extends the idea of data representation into the
specific types of data that Java uses and introduces representation
systems for individual characters and text.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises">1.6. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Name a few programming languages other than Java.</p>
</li>
<li>
<p>What is the difference between machine code and bytecode?</p>
</li>
<li>
<p>What are some advantages of JIT compilation over traditional,
ahead-of-time compilation?</p>
</li>
<li>
<p><a id="exercise1.4"></a> Without converting to decimal, how can one find out whether a given
binary number is odd or even?</p>
</li>
<li>
<p><a id="exercise1.5"></a> Convert the following positive binary numbers into decimal.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>100<sub>2</sub></p>
</li>
<li>
<p>111<sub>2</sub></p>
</li>
<li>
<p>100000<sub>2</sub></p>
</li>
<li>
<p>111101<sub>2</sub></p>
</li>
<li>
<p>10101<sub>2</sub></p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise1.6"></a> Convert the following positive decimal numbers into binary.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>1</p>
</li>
<li>
<p>15</p>
</li>
<li>
<p>100</p>
</li>
<li>
<p>1,025</p>
</li>
<li>
<p>567,899</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise1.7"></a> What is the process for converting the representation of a binary
integer given in one&#8217;s complement into two&#8217;s complement?</p>
</li>
<li>
<p><a id="exercise1.8"></a> Perform the conversion from one&#8217;s complement to two&#8217;s complement on the
representation <code>1011 0111</code>, which uses 8 bits for storage.</p>
</li>
<li>
<p><a id="exercise1.9"></a> Convert the following decimal numbers to their hexadecimal and octal
equivalents.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>29</p>
</li>
<li>
<p>100</p>
</li>
<li>
<p>255</p>
</li>
<li>
<p>382</p>
</li>
<li>
<p>4,096</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise1.10"></a> Create a table that lists the binary equivalents of octal digits, similar to the one in <a href="#_other_conversions">Section 1.3.2.4</a>. Hint: Each octal digit can be represented as a sequence of three binary digits.</p>
</li>
<li>
<p><a id="exercise1.11"></a> Use this table to convert the following octal numbers to binary.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>337<sub>8</sub></p>
</li>
<li>
<p>24<sub>8</sub></p>
</li>
<li>
<p>777<sub>8</sub></p>
</li>
</ol>
</div>
</li>
<li>
<p>The ternary number system has a base of 3 and uses symbols 0, 1, and 2
to construct numbers.</p>
</li>
<li>
<p>Convert the following decimal numbers to their ternary equivalents.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>23</p>
</li>
<li>
<p>333</p>
</li>
<li>
<p>729</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise1.14"></a> Convert the following decimal numbers to 8-bit, two&#8217;s complement binary
representations.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>-15</p>
</li>
<li>
<p>-101</p>
</li>
<li>
<p>-120</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise1.15"></a> Given the following 8-bit binary representations in two&#8217;s complement,
find their decimal equivalents.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>1100 0000</code></p>
</li>
<li>
<p><code>1111 1111</code></p>
</li>
<li>
<p><code>1000 0001</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise1.16"></a> Perform the following arithmetic operation on the following 8-bit, two&#8217;s
complement binary representations of integers. Check your answers by
performing arithmetic on equivalent decimal numbers.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>0000 0011</code> + <code>0111 1110</code> =</p>
</li>
<li>
<p><code>1000 1110</code> + <code>0000 1111</code> =</p>
</li>
<li>
<p><code>1111 1111</code> + <code>1000 0000</code> =</p>
</li>
<li>
<p><code>0000 1111</code> - <code>0001 1110</code> =</p>
</li>
<li>
<p><code>1000 0001</code> - <code>1111 1100</code> =</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise1.17"></a> Extrapolate the rules for decimal and binary addition to rules for the
hexadecimal system. Then, use these rules to perform the following
additions in hexadecimal. Check your answers by converting the values
and their sums to decimal.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A2F<sub>16</sub> + BB<sub>16</sub> =</p>
</li>
<li>
<p>32C<sub>16</sub> + D11F<sub>16</sub> =</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise1.18"></a> Expand <a href="#Non-terminating_fraction">Example 17</a> assuming that you have ten bits to represent the
fraction. Convert the representation back to base 10. How far off is
this value from 0.3?</p>
</li>
<li>
<p><a id="exercise1.19"></a> Will the process in <a href="#Non-terminating_fraction">Example 17</a> ever terminate assuming that we can use as
many bits as needed to represent 0.3 in binary?</p>
</li>
<li>
<p><a id="exercise1.20"></a> Derive the binary representation of the following decimal numbers
assuming 32-bit (single) precision representation using the IEEE
floating point format.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>0.0125</p>
</li>
<li>
<p>7.7</p>
</li>
<li>
<p>-10.3</p>
</li>
</ol>
</div>
</li>
<li>
<p>The IEEE 754 standard also defines a 16-bit (half) precision format. In
this format, there is one sign bit, five bits for the exponent, and ten
bits for the mantissa. This format is the same as single and double
precision in that it assumes that a bit with a value of 1 precedes the
ten bits in the mantissa. It also uses a bias of 15 for the exponent.
What is the largest decimal number that can be stored in this format?</p>
</li>
<li>
<p>Let \(a\), \(b\), and \(c\) denote three real numbers.
With real numbers, each of the equations below is true. Now suppose that
all arithmetic operations are performed using floating point
representations of these numbers. Indicate which of the following
expressions are still always true and which are sometimes false.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>\(( a + b )+ c = a + ( b + c )\)</p>
</li>
<li>
<p>\(a+b=b+a\)</p>
</li>
<li>
<p>\(a \times b=b \times a\)</p>
</li>
<li>
<p>\(a+0=a\)</p>
</li>
<li>
<p>\((a\times b)\times c=a\times (b\times c)\)</p>
</li>
<li>
<p>\(a\times (b+c)=(a\times b)+(a\times c)\)</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise1.23"></a> What is a multicore microprocessor? Why do you think a multicore chip
might be better than a single core chip? Search on the Internet to find
the names of a few common multicore chips. Which chip does your computer
use?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_problem_solving_and_programming">2. Problem Solving and Programming</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If you can&#8217;t solve a problem, then there is an easier problem you can solve: find it.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; George Pólya
</div>
</div>
<div class="sect2">
<h3 id="_problem_how_to_solve_problems">2.1. Problem: How to solve problems</h3>
<div class="paragraph">
<p>How do we solve problems in general? This question is the motivating
problem (or meta-problem, even) for this chapter. In fact, this question
is the motivating problem for this book. We want to understand the
process of solving problems with computers.</p>
</div>
<div class="paragraph">
<p>As we mentioned in the previous chapter, many <em>computer programs</em> such
as business applications and web browsers have already been created to
help people solve problems, but we want to solve new problems by writing
our own programs. The art of writing these programs is called <em>computer
programming</em> or just programming.</p>
</div>
<div class="paragraph">
<p>Many people reading this book will be computer science students, and
that&#8217;s great. However, computers have found their way into every segment
of commercial enterprise and personal life. Consequently, programming
has become a general-purpose skill that can aid almost anyone in their
career, whether it is in transportation, medicine, the military,
commerce, or innumerable other areas.</p>
</div>
<div class="sect3">
<h4 id="_what_is_a_program">2.1.1. What is a program?</h4>
<div class="paragraph">
<p>If you don&#8217;t have a lot of experience with computer science, writing a
computer program may seem daunting. The programs that run on your
computer are complex and varied. Where would you start if you wanted to
create something like Microsoft Word or Adobe Photoshop?</p>
</div>
<div class="paragraph">
<p>A computer program is a sequence of instructions that a computer
follows. Even the most complex program is just a list of instructions.
The list can get very long, and sometimes the computer will jump around
the list when it makes decisions about what to do next.</p>
</div>
<div class="paragraph">
<p>Some people talk about how smart computers are becoming. A computer is
neither smart nor stupid because a computer has no intelligence to
measure. A computer is a machine like a sewing machine or an internal
combustion engine. It follows the instructions we give it blindly. It
doesn&#8217;t have feelings or opinions about the instructions it receives.
Computers do exactly what we tell them to and rarely make mistakes.</p>
</div>
<div class="paragraph">
<p>Once in a while, a computer will make a mistake due to faulty
construction, a bad power source, or cosmic rays, but well over 99.999%
of the things that go wrong with computers are because some human
somewhere gave a bad instruction. This point is one of the most
challenging aspects of programming a computer. How do you organize your
thoughts so that you express to the computer exactly what you want it to
do? If you give a person directions to a drug store, you might say,
&#8220;Walk east for two blocks and then go into the third door on the
right.&#8221; The human will fill in all the necessary details: Stopping for
traffic, watching out for construction, and so on. Given a robot body, a
computer would do exactly what you say. The instructions never mentioned
<strong>opening</strong> the door, and so a computer might walk right through the
closed door, shattering glass in the process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_is_a_programming_language">2.1.2. What is a programming language?</h4>
<div class="paragraph">
<p>What&#8217;s the right level of detail for instructions for a computer? It
depends on the computer and the application. But how do we give these
instructions? Programs are composed of instructions written in a
<em>programming language</em>. In this book, we will use the Java programming
language.</p>
</div>
<div class="paragraph">
<p>Why can&#8217;t the instructions be given in English or some other natural
language? If the previous example of a robot walking through a glass
door didn&#8217;t convince you, consider the quote from Groucho Marx, &#8220;One
morning I shot an elephant in my pajamas. How he got into my pajamas,
I&#8217;ll never know.&#8221;</p>
</div>
<div class="paragraph">
<p>Natural languages are filled with idioms, metaphors, puns, and other
ambiguities. Good writers use these to improve their poetry and prose,
but our goal in this book is not to write poetry or prose. We want to
write instructions for a computer that are crystal clear.</p>
</div>
<div class="paragraph">
<p>Learning Java is not like learning Spanish or Swahili. Like most
programming languages, Java is highly structured. It has fewer than 100
reserved words and special symbols. There are no exceptions to its
grammatical rules. Don&#8217;t confuse the process of designing a solution to
a problem with the process of implementing that solution in a
programming language. Learning to organize your thoughts into a
sequential list of instructions is different from learning how to
translate that list into Java or another programming language, but
there&#8217;s a tight connection between the two.</p>
</div>
<div class="paragraph">
<p>Learning to program is patterning your mind to think like a machine, to
break everything down into the simplest logical steps. At first, Java
code will look like gobbledygook. Eventually, it will become so familiar
that a glance will tell you volumes about how a program works. Learning
to program is not easy, but the kind of logical analysis involved is
valuable even if you never program afterward. If you do need to learn
other programming languages in the future, it will be easy once you&#8217;ve
mastered Java.</p>
</div>
</div>
<div class="sect3">
<h4 id="_an_example_problem">2.1.3. An example problem</h4>
<div class="paragraph">
<p>This chapter takes a broad approach to solving problems with a computer,
but we need an example to make some of the steps concrete. We will use
the following problem from physics as an example throughout this
chapter.</p>
</div>
<div class="paragraph">
<p>A rubber ball is dropped on a flat, hard surface from height
\(h\). What is the maximum height the ball will reach after
the \(k^{\mathrm{th}}\) bounce? We will discuss the steps
needed to create a program to solve this problem in the next section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_developing_software">2.2. Concepts: Developing software</h3>
<div class="sect3">
<h4 id="_software_development_lifecycle">2.2.1. Software development lifecycle</h4>
<div class="paragraph">
<p>The engineers who built the first digital computers also wrote the
programs for them. In those days, programming was closely tied to the
hardware, and the programs were not very long. As the capabilities of
computers have increased and programming languages have evolved,
computer programs have grown more and more complicated. Hundreds of
developers, testers, and managers are needed to write a set of programs
as complex as Microsoft Windows 10.</p>
</div>
<div class="paragraph">
<p>Organizing the creation of such complicated programs is challenging, but
the industry uses a process called the <em>software development lifecycle</em>
to help. This process makes large projects possible, but we can apply it
to the simpler programs we will write in this book as well. There are
many variations on the process, but we will use a straightforward
version with the following five steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Understand the problem:</strong> It seems obvious, but, when you go to
write a program, all kinds of details crop up. Consider a program that
stores medical records. Should the program give an error if a patient&#8217;s
age is over 150 years? What if advances in long life or cryogenic
storage make such a thing possible? What about negative ages? An unborn
child could be considered to have a negative age (or more outlandishly,
someone who had traveled back into the past using a time machine).</p>
<div class="paragraph">
<p>Even small details like these must be carefully considered to understand
a problem fully. In industry, understanding the problem is often tied to
a <em>requirements document</em>, in which a client lays out the features and
functionality that the final program should have. The &#8220;client&#8221; could
also be a manager or executive officer of the company you work for who
wants your development team to create a certain kind of program.
Sometimes the client does not have a strong technical background and
creates requirements that are difficult to fulfill or vaguely specified.
The creation of the requirements document can be a negotiation process
in which the software development team and their client decide together
what features are desirable and reasonable.</p>
</div>
<div class="paragraph">
<p>If you are taking a programming class, you can think of your instructor
as your client. Then, you can view a programming assignment as a
requirements document and your grade as your payment awarded based on
how well the requirements were fulfilled.</p>
</div>
</li>
<li>
<p><strong>Design a solution:</strong> Once you have a good grasp on the problem, you
can begin to design a solution. For large scale projects, this may
include decisions about the kinds of hardware and software packages that
will be needed to solve the problem. For this book, we will only talk
about problems that can be solved on standard desktop or laptop
computers with Java installed.</p>
<div class="paragraph">
<p>We will be interested only in the steps that the computer will have to
take to solve the problem. A finite list of steps taken to solve a
problem is called an <em>algorithm</em>. If you have ever done long division
(or any other kind of arithmetic by hand), you have executed an
algorithm. The steps for long division will work for any real numbers,
and most human beings can follow the algorithm without difficulty.</p>
</div>
<div class="paragraph">
<p>An algorithm is often expressed in <em>pseudocode</em>, a high level, generic,
code-like system of notation. Pseudocode is similar to a programming
language, but it doesn&#8217;t have the same detail. Algorithms are often
designed in pseudocode so that they aren&#8217;t tied to any one programming
language.</p>
</div>
<div class="paragraph">
<p>When attacking a problem, it is typical to break it into several smaller
subproblems and then create algorithms for the subproblems. This
approach is called <em>top-down</em> programming.</p>
</div>
</li>
<li>
<p><strong>Implement the solution:</strong> Once you have your solution planned, you
can <em>implement</em> it in a programming language. This step entails taking
all the pseudocode, diagrams, and any other plans for your solution and
translating them into code in a programming language. We will always use
Java for our language in this book, but real developers use whichever
language they feel is appropriate.</p>
<div class="paragraph">
<p>If you have designed your solution with several parts, you can implement
each one separately and then integrate the solutions together.
Professional developers often assign different parts of the solution to
different programmers or even different teams of programmers.</p>
</div>
<div class="paragraph">
<p>Students are often tempted to jump into the implementation step, but
never forget that this is the third step of the process. If you don&#8217;t
fully understand the problem and have a plan to attack it, the
implementation process can become bogged down and riddled with mistakes.
At first, the problems we introduce and the programs needed to solve
them will be simple. As you move into more complicated problems in this
book and in your career as a programmer, a good understanding of the
problem and a good plan for a solution will become more and more
important.</p>
</div>
</li>
<li>
<p><strong>Test the solution:</strong> Expressing your algorithm in a programming
language is difficult. If your algorithm was wrong, your program will
not always give the right answer. If your algorithm was right, but you
made a mistake implementing it in code, your program will still be
wrong. Programming is a very detail-oriented activity. Even experienced
developers make mistakes constantly.</p>
<div class="paragraph">
<p>Good design practices help, but all code must be thoroughly tested after
it has been implemented. It should be tested exhaustively with expected
and unexpected input. Tiny mistakes in software called <em>bugs</em> can lie
hidden for months or even years before they are discovered. Sometimes a
software bug is a source of annoyance to the user, but other times, as
in aviation, automotive, or medical software, people die because of
bugs.</p>
</div>
<div class="paragraph">
<p>Most of this book is dedicated to designing solutions to problems and
implementing them in Java, but <a href="#_testing_and_debugging">Chapter 16</a>
is all about testing and debugging.</p>
</div>
</li>
<li>
<p><strong>Maintenance:</strong> Imagine that you have gone through the previous four
steps: You understood all the details of a problem, planned a solution
to it, implemented that solution in a programming language, and tested
it until it was perfect. What happens next?</p>
<div class="paragraph">
<p>Presumably your program was shipped to your customers and they happily
use it. But what if a bug is discovered that slipped past your testing?
What if new hardware comes out that is not compatible with your program?
What if your customers demand that you change one little feature?</p>
</div>
<div class="paragraph">
<p>Particularly with complex programs that have a large number of
consumers, a software development company must spend time on customer
support. Responsible software developers are expected to fix bugs, close
security vulnerabilities, and polish rough features. This process is
called <em>maintenance</em>. Developers are often working on the next version
of the product, which could be considered maintenance or a new project
entirely.</p>
</div>
<div class="paragraph">
<p>Although we cannot stress the importance of the first four steps of the
software development lifecycle enough, maintenance is not something we
talk about in depth.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The software development lifecycle we presented above is a good guide,
but it does not go into details. Different projects require different
amounts of time and energy for each step. It is also useful to focus on
the steps because it is less expensive to fix a problem at an earlier
stage in development. It is impossible to set the exact numbers, but
some developers assume that it takes ten times as much effort to fix a
problem at the current step than it would at the previous step.</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. Rising costs of fixing an error</div>
<div class="content">
<div class="paragraph">
<p>Imagine that your company works on computer-aided design (CAD) software.
The requirements document for a new program lists the formula for the
area of a triangle as \(base \times height\) when the real
formula is \(\frac{1}{2} base
\times height\). If that mistake were caught while understanding the
problem, it would mean changing one line of text. Once the solution to
the problem has been designed, there may be more references to the
incorrect formula. Once the solution has been implemented, those
references will have turned into code that is scattered throughout the
program. If the project were poorly designed, several different pieces
of code might independently calculate the area of a triangle
incorrectly. Once the implementation has been tested, a change to the
code will mean that everything has to be tested from the very beginning,
since fixing one bug can cause other bugs to surface. Finally, once the
maintenance stage has been reached, the requirements, plan,
implementation, and testing would all need to be updated to fix the bug.
Moreover, customers would already have the faulty program. Your company
would have to create a patch to fix the bug and distribute it over the
Internet or by mailing out CD-ROMs.</p>
</div>
<div class="paragraph">
<p>Most bugs are more complicated and harder to fix, but even this simple
one causes greater and greater repercussions as it goes uncaught. A
factor of ten for each level implies that it takes 10,000 times more
effort to fix it in the maintenance phase than at the first phase. Since
fixing it at the first phase would have required a few keystrokes and
fixing it in the last phase would require additional development and
testing with web servers distributing patches and e-mails and
traditional letters apologizing for the mistake, a factor of 10,000
could be a reasonable estimate.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Now that we have a sense of the software development lifecycle, let&#8217;s
look at an example using the sample ball bouncing problem to walk
through a few steps.</p>
</div>
<div id="example-Ball_bouncing_problem" class="exampleblock">
<div class="title">Example 22. Ball bouncing problem and plan</div>
<div class="content">
<div class="paragraph">
<p>Recall the statement of the problem from the <strong>Problem</strong> section:</p>
</div>
<div class="paragraph">
<p>A rubber ball is dropped on a flat, hard surface from height
\(h\). What is the maximum height the ball will reach after
the \(k^{\mathrm{th}}\) bounce?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Understand the problem:</strong> This problem requires an understanding of
some physics principles. When a ball is dropped, the height of its first
bounce depends on a factor known as the <em>coefficient of restitution</em>.</p>
<div class="paragraph">
<p>If \(c\) is the coefficient of restitution, then the ball will
bounce back the first time to a height of \(h\times c\). Then,
we can act as if the ball were being dropped from this new height when
calculating the next bounce. Thus, it will bounce to a height of
\(h\times c^2\) the second time. By examining this pattern for
the third and fourth bounce, it becomes clear that the ball will bounce
to a height of \(h\times c^k\) on the
\(k^{\mathrm{th}}\) time. See <a href="#bouncingBallFigure">Figure 6</a>
for a graphic description of this process.</p>
</div>
<div class="paragraph">
<p>We are assuming that \(k &gt; 0\) and that \(c &lt; 1\).
Note that \(c\) depends on many factors, such as the
elasticity of the ball and the properties of the floor on which the ball
is dropped. However, if we know that we will be given \(c\),
we don&#8217;t need to worry about any other details.</p>
</div>
<div id="bouncingBallFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/02-intro/images/bouncingBall.svg" alt="bouncingBall" width="75%">
</div>
<div class="title">Figure 6. A ball is dropped from height \(h\). The ball rises to height \(h c\) after the first bounce and to \(hc^2\) after the second.</div>
</div>
</li>
<li>
<p><strong>Design a solution:</strong> This problem is straightforward, but it&#8217;s
always useful to practice good design. Remember that you&#8217;ve got to plan
your input and output as well as the computation in a program. As
practice for more complicated problems, let&#8217;s break this problem down
into smaller subproblems.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Subproblem 1</dt>
<dd>
<p>Get the values of \(h\), \(c\), and
\(k\) from the user.</p>
</dd>
<dt class="hdlist1">Subproblem 2</dt>
<dd>
<p>Compute the height of the ball after the \(k^{\mathrm{th}}\)
bounce.</p>
</dd>
<dt class="hdlist1">Subproblem 3</dt>
<dd>
<p>Display the calculated height.</p>
<div class="paragraph">
<p>The solution to each of the three subproblems requires input and
generates an output. <a href="#subProblemRelationFigure">Figure 7</a> shows how these
solutions are connected. The first box in this figure represents the
solution to subproblem 1. It asks a user to input values of parameters
\(h\), \(c\), and \(k\). It sends these
values to the next box, which represents a solution to subproblem 2.
This second box computes the height of the ball after \(k\)
bounces and makes it available to the third box, which represents a
solution to subproblem 3. This third box displays the calculated height.</p>
</div>
<div id="subProblemRelationFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/02-intro/images/subProblemRelation.svg" alt="subProblemRelation" width="75%">
</div>
<div class="title">Figure 7. Connections between solutions to the three subproblems in the bouncing ball problem.</div>
</div>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before we can continue on to Step 3, we need to learn some Java.
<a href="#_syntax_java_basics">Section 2.3</a> introduces you to the Java you&#8217;ll need to
solve this problem.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_acquiring_a_java_compiler">2.2.2. Acquiring a Java compiler</h4>
<div class="paragraph">
<p>Before we introduce any Java syntax, you should make sure that you have
a Java compiler set up so that you can follow along and test your
solution. Programming is a hands-on skill. It is impossible to improve
your programming abilities without practice. No amount of reading about
programming is a substitute for the real thing.</p>
</div>
<div class="paragraph">
<p>Where can you get a Java compiler? Fortunately, there are free options
for almost every platform. Non-Windows computers may already have the
Java Runtime Environment (JRE) installed, allowing you to run Java
programs; however, most Java development options require you to have the
Java Development Kit (JDK). Oracle may change the website, but at the
time of writing you can download the JDK from
<a href="http://www.oracle.com/technetwork/java/javase/downloads/" class="bare">http://www.oracle.com/technetwork/java/javase/downloads/</a>. Download the
latest version (Jave SE 7 at the time of writing) of the Java Platform,
Standard Edition JDK and install it.</p>
</div>
<div class="paragraph">
<p>After having done so, you should be able to compile programs using the
<code>javac</code> command, whose name is short for &#8220;Java compiler.&#8221; To do so,
open a terminal window, also known as a command line interface or the
console. To open the terminal in Windows, choose the Command Prompt
option from the Start Menu or press Windows+R and type <code>cmd</code> into the
Run box (or the Search box in the Start Menu in Windows 7). To open the
terminal in Mac OS X, select Terminal from the Utilities folder. Linux
users are usually familiar with their terminal.</p>
</div>
<div class="paragraph">
<p>Provided that you have your path set correctly, you should be able to
open the terminal, navigate to a directory containing files that end in
<code>.java</code>, and compile them using the <code>javac</code> command. For example, to
compile a program called <code>Example.java</code> to bytecode, you would type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">javac</span> <span class="tok-n">Example</span><span class="tok-o">.</span><span class="tok-na">java</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Compiling the program creates a <code>.class</code> file, in this case,
<code>Example.class</code>. To run the program contained in <code>Example.class</code>, you
would type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">java</span> <span class="tok-n">Example</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing so fires up the JVM, which uses the JIT compiler to compile the
bytecode inside <code>Example.class</code> into machine code and run it. Note that
you would only type <code>Example</code> not <code>Example.class</code> when specifying the
program to run. Using just these commands from the terminal, you can
compile and run Java programs. The command line interface used to be the
only way to interact with a computer, and, though it seems primitive at
first, the command line has amazing power and versatility.</p>
</div>
<div class="paragraph">
<p>To use the command line interface to compile your own Java program, you
must first create a text file with your Java code in it. The world of
programming is filled with many text editor applications whose only
purpose is to make writing code easier. These editors are not like
Microsoft Word: They are not used to format the text into paragraphs or
apply bold or italics. Their output is a raw (&#8220;plain&#8221;) text file,
containing only unformatted characters, similar to the files created by
Notepad. Many text editors, however, have advanced features useful for
programmers, such as syntax highlighting (marking special words and
symbols in the language with corresponding colors or fonts),
language-appropriate auto-completion, and powerful find and replace
tools. Two of the most popular text editors for command line use are
vi-based editors, particularly Vim, and Emacs-based editors,
particularly GNU Emacs.</p>
</div>
<div class="paragraph">
<p>Many computer users, however, are used to a <em>graphical user interface</em>
(GUI), where a mouse can be used to interact with windows, buttons, text
boxes, and other elements of a modern user interface. There are many
Java programming environments that provide a GUI from which a user can
write Java code, compile it, execute it, and even test and debug it.
Because these tools are integrated into a single program, these
applications are called <em>integrated development environments</em> (IDEs).</p>
</div>
<div class="paragraph">
<p>Two of the most popular Java IDEs are Eclipse and the NetBeans IDE,
which are both open-source, free, and available at
<a href="http://www.eclipse.org/" class="bare">http://www.eclipse.org/</a> and <a href="http://netbeans.org/" class="bare">http://netbeans.org/</a>, respectively. At the
time of writing, Eclipse is the most popular Java IDE for professional
developers. Both Eclipse and NetBeans are powerful and complex tools.
DrJava is a much simpler (and highly recommended) IDE, designed for
students and Java beginners. It is also free and is available from
<a href="http://www.drjava.org/" class="bare">http://www.drjava.org/</a>.</p>
</div>
<div class="paragraph">
<p>Which command line text editor or graphical IDE you use is up to you.
Programming is a craft, and every craftsman has his or her favorite
tools. Most of the content of this book is completely independent from
the tools you use to write and compile your code. One exception is
<a href="#_testing_and_debugging">Chapter 16</a>, in which we briefly discuss
the debugging tools in Eclipse and DrJava.</p>
</div>
<div class="paragraph">
<p>If you choose Eclipse, NetBeans, or another complex IDE, you may wish to
read some online tutorials to get started. These IDEs often require the
user to create a project and then put Java files inside. The idea of a
project that contains many related source code documents is a useful one
and is very common in software engineering, but it is not a part of Java
itself.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_java_basics">2.3. Syntax: Java basics</h3>
<div class="paragraph">
<p>In this section, we start with the simplest Java programs and work up to
the solution to the bouncing ball problem. Java was first released in
1995, a long time ago in the history of computer science. However, Java
was based on many previous languages. Its <em>syntax</em> (the rules for
constructing legal Java programs, just as English grammar is the rules
for constructing legal English sentences) inherits ideas from C, C++,
and other languages.</p>
</div>
<div class="paragraph">
<p>Some critics have complained about elements of the syntax or semantics
of Java. <em>Semantics</em> are rules for what code means. Remember that Java
is an arbitrary system, designed by fallible human beings. The rules for
building Java programs are generally logical, but they are artificial.
Learning a new programming language is a process of accepting a set of
rules and coming up with ways to use those rules to achieve your own
ends.</p>
</div>
<div class="paragraph">
<p>There are reasons behind the rules, but we will not always be able to
explain those reasons in this book. As you begin to learn Java, you will
have to take it on faith that such-and-such a rule is necessary, even
though it seems useless or mysterious. In time, these rules will become
familiar and perhaps sensible. The mystery will fade away, and the rules
will begin to look like an organic and logical (though perhaps
imperfect) system.</p>
</div>
<div class="sect3">
<h4 id="_java_program_structure">2.3.1. Java program structure</h4>
<div class="paragraph">
<p>The first rule of Java is that all code goes inside of a <em>class</em>. A
class is a container for blocks of code called <em>methods</em> and it can also
be used as a template to create <em>objects</em>. We&#8217;ll talk a bit more about
classes in this chapter and then focus on them heavily in
<a href="#_classes">Chapter 9</a>.</p>
</div>
<div class="paragraph">
<p>For now, you only need to remember that every Java program has at least
one class. It is possible to put more than one class in a file, but you
can only have one top-level <em>public</em> class per file. A public class is
one that can be used by other classes. Almost every class in this book
is public, and they should be clearly marked as such. To create a public
class called <code>Example</code>, you would type the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A few words in Java have a special meaning and cannot be used for
anything else (like naming a class). These are called <em>keywords</em> or
<em>reserved words</em>. The keyword <code>public</code> marks the class as public. The
keyword <code>class</code> states that you are declaring a class. The name
<code>Example</code> gives the name of the class. By convention, all class names
start with a capital letter. The braces (<code>\{</code> and <code>\}</code>) mark the start
and end of the contents of the class. Right now, our class contains
nothing.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise2.7">Exercise 2.7</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This text should be saved in a file called <code>Example.java</code>. It is
required that the name of the public class matches the file that it&#8217;s
in, including capitalization. Once <code>Example.java</code> has been saved, you
can compile it into bytecode. However, since there&#8217;s nothing in class
<code>Example</code>, you can&#8217;t run it as a program.</p>
</div>
<div class="paragraph">
<p>A program is a list of instructions, and that list has to start
somewhere. For a normal Java application, that place is the <code>main()</code>
method. (Throughout this book, we always append parentheses <code>()</code> to mark
the name of a method.) If we want to do something inside of <code>Example</code>,
we&#8217;ll have to add a <code>main()</code> method like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several new items now. As before, <code>public</code> means that other
classes can use the <code>main()</code> method. The <code>static</code> keyword means that the
method is associated with the class as a whole and not a particular
object. The <code>void</code> keyword means that the method does not give back an
answer. The word <code>main</code> is obviously the name of the method, but it has
to be spelled exactly that way (including capitalization) to work.
Perhaps the most confusing part is the expression <code>String[] args</code>, which
is a list of text (strings) given as input to the <code>main()</code> method from
the command line. As with the class, the braces mark the start and end
of the contents of the <code>main()</code> method, which is currently empty.</p>
</div>
<div class="paragraph">
<p>Right now, you don&#8217;t need to understand any of this. All you need to
know is that, to start a program, you need a <code>main()</code> method and its
syntax is always the same as the code listed above. If you save this
code, you can compile <code>Example.java</code> and then run it, and…nothing
happens! It is a perfectly legal Java program, but the list of
instructions is empty.</p>
</div>
</div>
<div class="sect3">
<h4 id="_command_line_input_and_output">2.3.2. Command line input and output</h4>
<div class="paragraph">
<p>An important thing for a Java program to do is to communicate with the
outside world (where we live). First, let&#8217;s look at printing data to the
command line and reading data in from the command line.</p>
</div>
<div class="sect4">
<h5 id="_the_code_system_out_print_code_method">The <code>System.out.print()</code> method</h5>
<div class="paragraph">
<p>Methods allow us to perform actions in Java. They are blocks of code
packaged up with a name so that we can run the same piece of code
repeatedly but with different inputs. We discuss them in much greater
depth in <a href="#_methods">Chapter 8</a>.</p>
</div>
<div class="paragraph">
<p>A common method for output is <code>System.out.print()</code>. The input (usually
called <em>arguments</em>) to a method are given between its parentheses. Thus,
if we want to print <code>42</code> to the terminal, we type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">42</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the use of the method has a semicolon (<code>;</code>) after it. An
executable line of code in Java generally ends with a semicolon to
separate it from the next instruction. We can add this code to our
<code>Example</code> class, yielding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">42</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to print out text, we give it as the argument to
<code>System.out.print()</code>, surrounded by double quotes (<code>"</code>). It is necessary
to surround text with quotes so that Java knows it is text and not the
name of a class, method, or variable. Text surrounded by double quotes
is called a <em>string</em>. The following program prints <code>Forty two</code> onto the
terminal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Forty two&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Printing out one thing is great, but programs are usually composed of
many instructions. Consider the following program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">);</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">);</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">);</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">8</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, each executable line ends with a semicolon, and they are
executed in sequence. This code prints 2, 4, 6, and 8 onto the screen.
However, we did not tell the program to move the cursor to a new line at
any point. So, the output on the screen is <code>2468</code>, which looks like a
single number. If we want them to be on separate lines, we can achieve
this with the <code>System.out.println()</code> method, which moves to a new line
after it finishes output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">);</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">);</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-mi">6</span><span class="tok-o">);</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-mi">8</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This change makes the output into the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-mi">2</span>
<span class="tok-mi">4</span>
<span class="tok-mi">6</span>
<span class="tok-mi">8</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, it is possible to insert some math almost anywhere. Consider
the following program, which uses the <code>+</code> operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">35</span> <span class="tok-o">+</span> <span class="tok-mi">7</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code prints out <code>42</code> to the terminal just like our earlier example,
because it does the addition before giving the result to
<code>System.out.print()</code> for output.</p>
</div>
</div>
<div class="sect4">
<h5 id="_the_code_scanner_code_class">The <code>Scanner</code> class</h5>
<div class="paragraph">
<p>We want to be able to read input from the user as well. For command line
input, we need to create a <code>Scanner</code> object. This object is used to read
data from the keyboard. The following program asks the user for an
integer, reads in an integer from the keyboard, and then prints out the
value multiplied by 2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Scanner</span> <span class="tok-n">in</span><span class="tok-o">;</span>
        <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter an integer: &quot;</span><span class="tok-o">);</span>
        <span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">;</span>
        <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;That number doubled is: &quot;</span><span class="tok-o">);</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">*</span> <span class="tok-mi">2</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program introduces several new elements. First, note that it begins
with<br>
<code>import java.util.Scanner;</code>. This line of code tells the compiler to use
the <code>Scanner</code> class that is in the <code>java.util</code> <em>package</em>. A package is a
way of organizing a group of related classes. Someone else wrote the
<code>Scanner</code> class and all the other classes in the <code>java.util</code> package,
but, by importing the package, we are able to use their code in our
program.</p>
</div>
<div class="paragraph">
<p>Then, skip down to the first line in the <code>main()</code> method. The code
<code>Scanner in;</code> <em>declares</em> a <em>variable</em> called <code>in</code> with <em>type</em> <code>Scanner</code>.
A variable can hold a value. The variable has a specific type, meaning
the kind of data that the value can be. In this case, the type is
<code>Scanner</code>, meaning that the variable <code>in</code> holds a <code>Scanner</code> object.
Declaring a variable creates a box that can hold things of the specified
type. To declare a variable, first put the type you want it to have,
then put its <em>identifier</em> or name, and then put a semicolon. We chose to
call the variable <code>in</code>, but we could have called it <code>input</code> or even
<code>marmalade</code> if we wanted. It is always good practice to name your
variable so that it is clear what it contains.</p>
</div>
<div class="paragraph">
<p>The next line <em>assigns</em> a value to <code>in</code>. The assignment operator (<code>=</code>)
looks like an equal sign from math, but think of it as an arrow that
points left. Whatever is on the right side of the assignment operator
will be stored into the variable on the left. So, the variable <code>in</code> was
an initially empty box that could hold a <code>Scanner</code> object. The code
<code>new Scanner(System.in)</code> creates a brand new <code>Scanner</code> object based on
<code>System.in</code>, which means that the input will be from the keyboard. The
assignment stored this object into the variable <code>in</code>. The fact that
<code>System.in</code> was used has <strong>nothing</strong> to do with the fact that our variable
was named <code>in</code>. Again, don&#8217;t expect to understand all the details at
first. Any time you need to read data from the keyboard, you&#8217;ll need
these two lines of code, which you should be able to copy verbatim. It
is possible to both declare a variable and assign its value in one line.
Instead of the two line version, most programmers would type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, the line <code>int value;</code> declares a variable for holding integer
types. The next line uses the object <code>in</code> to read an integer from the
user by calling the <code>nextInt()</code> method. If we wanted to read a floating
point value, we would have called the <code>nextDouble()</code> method. If we
wanted to read some text, we would have called the <code>next()</code> method.
Unfortunately, these differences means that we have to know what type of
data the user is going to enter. If the user enters an unexpected type,
our program could have an error. As before, we could combine the
declaration and the assignment into a single line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The final two lines give output for our program. The former prints
<code>That number doubled is: ` to the terminal. The latter prints out a
value that is twice whatever the user entered. The next two examples
illustrate how `Scanner</code> can be used to read input while solving
problems. The first example shows how these elements can be applied to
subproblem 1 of the bouncing ball problem, and the second example
introduces and solves a new problem.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise2.13">Exercise 2.13</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 23. Command line input</div>
<div class="content">
<div class="paragraph">
<p>Subproblem 1 requires us to get the height, coefficient of restitution,
and number of bounces from the user. <a href="#GetInputCLIProgram">Program 1</a>
shows a Java program to solve this subproblem.</p>
</div>
<div id="GetInputCLIProgram" class="listingblock">
<div class="title">Program 1. A Java program to get the height, coefficient of restitution, and number of bounces from the command line.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">GetInputCLI</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>    	<span class="tok-c1">// Create an object named in for input</span>
<span class="lineno"> 6 </span>        <span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{createScannerGetInputDataObject}@*/</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>        <span class="tok-c1">// Declare variables to hold input data</span>
<span class="lineno"> 9 </span>        <span class="tok-kt">double</span> <span class="tok-n">height</span><span class="tok-o">,</span> <span class="tok-n">coefficient</span><span class="tok-o">;</span>
<span class="lineno">10 </span>        <span class="tok-kt">int</span> <span class="tok-n">bounces</span><span class="tok-o">;</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>        <span class="tok-c1">// Declare user prompt strings</span>
<span class="lineno">13 </span>        <span class="tok-n">String</span> <span class="tok-n">enterHeight</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Enter the height: &quot;</span><span class="tok-o">;</span>
<span class="lineno">14 </span>        <span class="tok-n">String</span> <span class="tok-n">enterCoefficient</span> <span class="tok-o">=</span>
<span class="lineno">15 </span>        	<span class="tok-s">&quot;Enter restitution coefficient: &quot;</span><span class="tok-o">;</span>
<span class="lineno">16 </span>        <span class="tok-n">String</span> <span class="tok-n">enterBounces</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Enter the number of bounces: &quot;</span><span class="tok-o">;</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>        <span class="tok-c1">// Prompt the user and read data from the keyboard</span>
<span class="lineno">19 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Bouncing Ball: Subproblem 1&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">enterHeight</span><span class="tok-o">);</span>
<span class="lineno">21 </span>        <span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">22 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">enterCoefficient</span><span class="tok-o">);</span>
<span class="lineno">23 </span>        <span class="tok-n">coefficient</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">24 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">enterBounces</span><span class="tok-o">);</span>
<span class="lineno">25 </span>        <span class="tok-n">bounces</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">26 </span>    <span class="tok-o">}</span>
<span class="lineno">27 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike our earlier example, the first line of <code>GetInputCLI.java</code> is
<code>import java.util.*;</code>. Instead of just importing the <code>Scanner</code> class,
this line imports all the classes in the <code>java.util</code> package. The
asterisk (<code>*</code>) is known as a <em>wildcard</em>. The wildcard notation is
convenient if you need to import several classes from a package or if
you don&#8217;t know in advance the names of all the classes you&#8217;ll need.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise2.8">Exercise 2.8</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>After the import comes the class declaration, creating a class called
<code>GetInputCLI</code>. We put a <code>CLI</code> at the end of this class name to mark that
it uses the command line interface, contrasting with the GUI version
that we&#8217;re going to show next. Inside the class declaration is the
definition of the <code>main()</code> method, showing where the program starts. The
text that comes after double slashes (<code>//</code>) are called <em>comments</em>.
Comments allow us to make our code more readable to humans, but the
compiler ignores them.</p>
</div>
<div class="paragraph">
<p>If you follow the comments, you&#8217;ll see that we declare two <code>double</code>
variables (for holding double precision floating-point numbers) and an
<code>int</code> variable (for holding an integer value). Next we declare three
<code>String</code> variables and assign them three strings (segments of text).</p>
</div>
<div class="paragraph">
<p>The last section of code first prints out the name of the problem. Then,
it prints out the value stored into <code>enterHeight</code>, which is
<code>"Enter the height: "</code>. After this prompt, the line
<code>height = in.nextDouble();</code> tries to read in the height from the user.
It waits until the user hits enter before reading the value and moving
on to the next line. The last four lines of the program prompt and read
in the coefficient of restitution and then the number of bounces. If you
compile and run this program, the execution should match the steps
described. Note that it only reads in the values needed to solve the
problem. We have not added the code to compute the answer or display it.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 24. Input for distance computation</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s write a program that takes as input the speed of a moving object
and the time it has been moving. The goal is to compute and display the
total distance it travels. We can divide this problem into the following
three subproblems.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Subproblem 1</dt>
<dd>
<p>Input speed and duration.</p>
</dd>
<dt class="hdlist1">Subproblem 2</dt>
<dd>
<p>Compute distance traveled.</p>
</dd>
<dt class="hdlist1">Subproblem 3</dt>
<dd>
<p>Display the computed distance.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="#DistanceProgram">Program 2</a> solves each of these subproblems in order,
using the command-line input and output tools we have just discussed.</p>
</div>
<div id="DistanceProgram" class="listingblock">
<div class="title">Program 2. Computes the distance a moving object travels.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Distance</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	    <span class="tok-c1">// Create an object named in for input</span>
<span class="lineno"> 6 </span>	    <span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>        <span class="tok-kt">double</span> <span class="tok-n">speed</span><span class="tok-o">,</span> <span class="tok-n">time</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>        <span class="tok-kt">double</span> <span class="tok-n">distance</span><span class="tok-o">;</span> <span class="tok-c1">// Distance to be computed</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>        <span class="tok-c1">// Solution to subproblem 1: Read input</span>
<span class="lineno">11 </span>        <span class="tok-c1">// Prompt the user and get speed and time</span>
<span class="lineno">12 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter the speed: &quot;</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{solutionSubProblemOneScanner}@*/</span>
<span class="lineno">13 </span>        <span class="tok-n">speed</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{getSpeed}@*/</span>
<span class="lineno">14 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter the time: &quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>        <span class="tok-n">time</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{getDuration}@*/</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>        <span class="tok-c1">// Solution to subproblem 2: Compute distance</span>
<span class="lineno">18 </span>        <span class="tok-n">distance</span> <span class="tok-o">=</span> <span class="tok-n">speed</span><span class="tok-o">*</span><span class="tok-n">time</span><span class="tok-o">;</span><span class="tok-cm">/*@\label{solutionSubProblemTwoScanner}@*/</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span>        <span class="tok-c1">// Solution to subproblem 3: Display output</span>
<span class="lineno">21 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Distance traveled: &quot;</span><span class="tok-o">);</span>
<span class="lineno">22 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-n">distance</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot; miles.&quot;</span><span class="tok-o">);</span>
<span class="lineno">24 </span>    <span class="tok-o">}</span>
<span class="lineno">25 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The program starts with import statements, the class definition, and the
definition of the <code>main()</code> method. At the beginning of the <code>main()</code>
method, we have code to declare and initialize a variable of type
<code>Scanner</code> named <code>in</code>. We also declare variables of type <code>double</code> to hold
the input speed and time and the resulting distance.</p>
</div>
<div class="paragraph">
<p>Starting at line <a href="#solutionSubProblemOneScanner">[solutionSubProblemOneScanner]</a>, we solve subproblem
1, prompting the user for the speed and the time and using our <code>Scanner</code>
object to read them in. Because they are both floating-point values with
type <code>double</code>, we use the <code>nextDouble()</code> method for input.</p>
</div>
<div class="paragraph">
<p>At line <a href="#solutionSubProblemTwoScanner">[solutionSubProblemTwoScanner]</a>, we compute the distance
traveled by multiplying <code>speed</code> by <code>time</code> and storing the result in
<code>distance</code>. The last three lines of the <code>main()</code> method solve subproblem
3 by outputting <code>"Distance traveled: "</code>, the computed distance, and
<code>" miles."</code>. If you run the program, all three items are printed on the
same line on the terminal.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gui_input_and_output">2.3.3. GUI input and output</h4>
<div class="paragraph">
<p>If you are used to GUI-based programs, you might wonder how to do input
and output with a GUI instead of on the command line. GUIs can become
very complex, but in this chapter we introduce a relatively simple way
to do GUI input and output and expand on it further in
<a href="#_simple_graphical_user_interfaces">Chapter 7</a>. Then, we go into
GUIs in much more depth in <a href="#_constructing_graphical_user_interfaces">Chapter 15</a>.</p>
</div>
<div class="paragraph">
<p>A limited tool for displaying output and reading input with a GUI is the
<code>JOptionPane</code> class. This class has a complicated method called
<code>showMessageDialog()</code> that opens a small <em>dialog box</em> to display a
message to the user. If we want to create the equivalent of the
command-line program that displays the number 42, the code would be as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.JOptionPane</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-s">&quot;42&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Output Example&quot;</span><span class="tok-o">,</span>
            <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like <code>Scanner</code>, we need to import <code>JOptionPane</code> as shown above in order
to use it. The <code>showMessageDialog()</code> method takes several arguments to
tell it what to do. For our purposes, the first one is always the
special Java literal <code>null</code>, which represents an empty value. The next
is the message you want to display, but it has to be text. That&#8217;s why
<code>"42"</code> appears with quotation marks. The third argument is the title
that appears at the top of the dialog. The final argument gives
information about how the dialog should be presented.
<code>JOptionPane.INFORMATION_MESSAGE</code> is a flag values that specifies that
the dialog is giving information (instead of a warning or a question),
causing an appropriate, system-specific icon to be displayed on the
dialog.</p>
</div>
<div class="paragraph">
<p>If we wanted to make the call to <code>showMessageDialog()</code> a little easier
to read, we could store the arguments into variables with short, easy to
understand names. The following program does so and should behave
exactly like the previous program. <a href="#showMessageDialogFigure">Figure 8</a>
shows what the resulting GUI might look like.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.JOptionPane</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;42&quot;</span><span class="tok-o">;</span>
        <span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Output Example&quot;</span><span class="tok-o">;</span>
        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
            <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="showMessageDialogFigure" class="imageblock text-center" style="text-align: text-center">
<div class="content">
<img src="chapters/02-intro/images/showMessageDialog.png" alt="showMessageDialog" width="45%">
</div>
<div class="title">Figure 8. Example of <code>showMessageDialog()</code> used for output.</div>
</div>
<div class="paragraph">
<p>One way to do input with a GUI uses the <code>showInputDialog()</code> method,
which is also inside the <code>JOptionPane</code> class. The <code>showInputDialog()</code>
method <em>returns</em> a value. This means that it gives back an answer, which
you can store into a variable by putting the method call on the right
hand side of an assignment statement. Otherwise, it is nearly the same
as <code>showMessageDialog()</code>. The following program prompts the user for his
or her favorite word with a <code>showInputDialog()</code> method and then displays
it again using a <code>showMessageDialog()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.JOptionPane</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;What is your favorite word?&quot;</span><span class="tok-o">;</span>
        <span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Input Example&quot;</span><span class="tok-o">;</span>
        <span class="tok-n">String</span> <span class="tok-n">word</span> <span class="tok-o">=</span>
        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
            <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span>
        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">word</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
            <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that whatever the user typed in will be stored in <code>word</code>. Finally,
the last line of the program displays whatever word was entered with
<code>showMessageDialog()</code>. <a href="#showInputDialogFigure">Figure 9</a> shows the
resulting GUI as the user is entering input.</p>
</div>
<div id="showInputDialogFigure" class="imageblock text-center" style="text-align: text-center">
<div class="content">
<img src="chapters/02-intro/images/showInputDialog.png" alt="showInputDialog" width="45%">
</div>
<div class="title">Figure 9. Example of <code>showInputDialog()</code> used for input.</div>
</div>
<div class="paragraph">
<p>Remember that the value returned from the <code>showInputDialog()</code> method is
always text, that is, it always has type <code>String</code>. Although there are
lots of great things you can do with a <code>String</code> value, you cannot do
normal arithmetic like you can with an integer or a floating-point
number. However, there are ways to convert a <code>String</code> representation of
a number to the number itself. If you have a <code>String</code> that represents an
integer, you use the <code>Integer.parseInt()</code> method to convert it. If you
have a <code>String</code> that represents a floating-point number, you use the
<code>Double.parseDouble()</code> method to convert it. The following segment of
code shows a few illustrations of the issues involved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-s">&quot;41&quot;</span> <span class="tok-o">*</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="tok-c1">// Text cannot be multiplied by an integer</span>

<span class="tok-kt">int</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-s">&quot;23&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">// Correctly converts the text &quot;23&quot; to the integer 23</span>

<span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">parseDouble</span><span class="tok-o">(</span><span class="tok-s">&quot;3.14159&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">// Correctly converts the text &quot;3.14159&quot; to 3.14159</span>

<span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-s">&quot;Twenty three&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">// Causes the program to crash</span>

<span class="tok-kt">double</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">parseDouble</span><span class="tok-o">(</span><span class="tok-s">&quot;pi&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">// Causes the program to crash</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You might wonder why the computer isn&#8217;t smart enough to know that <code>"23"</code>
means <code>23</code>. Remember, the computer has no intelligence. If something is
marked as text, it doesn&#8217;t know that it can interpret it as a number.
What kind of data something is depends on its type, which doesn&#8217;t
change. We&#8217;ll discuss types more deeply in <a href="#_primitive_types_and_strings">Chapter 3</a>.</p>
</div>
<div class="paragraph">
<p>The next example uses these two type conversion methods with methods
from <code>JOptionPane</code> in a GUI-based solution to subproblem 1 of the
bouncing ball problem.</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. GUI input</div>
<div class="content">
<div class="paragraph">
<p>We can change the solution given in <a href="#GetInputCLIProgram">Program 1</a> to
use the GUI-based input tools in <code>JOptionPane</code>.
<a href="#GetInputCLIProgram">Program 1</a> this equivalent GUI-based Java program.</p>
</div>
<div id="GetInputGUIProgram" class="listingblock">
<div class="title">Program 3. Gets the height, coefficient of restitution, and number of bounces using a GUI.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">GetInputGUI</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>        <span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Bouncing Ball: Subproblem 1&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>        <span class="tok-c1">// Declare variables to hold input data</span>
<span class="lineno"> 8 </span>        <span class="tok-kt">double</span> <span class="tok-n">height</span><span class="tok-o">,</span> <span class="tok-n">coefficient</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>        <span class="tok-kt">int</span> <span class="tok-n">bounces</span><span class="tok-o">;</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>        <span class="tok-c1">// Declare user prompt strings</span>
<span class="lineno">12 </span>        <span class="tok-n">String</span> <span class="tok-n">enterHeight</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Enter the height: &quot;</span><span class="tok-o">;</span>
<span class="lineno">13 </span>        <span class="tok-n">String</span> <span class="tok-n">enterCoefficient</span> <span class="tok-o">=</span>
<span class="lineno">14 </span>        	<span class="tok-s">&quot;Enter restitution coefficient: &quot;</span><span class="tok-o">;</span>
<span class="lineno">15 </span>        <span class="tok-n">String</span> <span class="tok-n">enterBounces</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Enter the number of bounces: &quot;</span><span class="tok-o">;</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>        <span class="tok-c1">// Prompt the user, get data, and convert it</span>
<span class="lineno">18 </span>        <span class="tok-n">String</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span><span class="tok-cm">/*@\label{inputDialogLineOne}@*/</span>
<span class="lineno">19 </span>        	<span class="tok-n">enterHeight</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">20 </span>        <span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">parseDouble</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{convertToDoubleLineOne}@*/</span>
<span class="lineno">21 </span>        <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span><span class="tok-cm">/*@\label{inputDialogLineTwo}@*/</span>
<span class="lineno">22 </span>        	<span class="tok-n">enterCoefficient</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">23 </span>        <span class="tok-n">coefficient</span> <span class="tok-o">=</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">parseDouble</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{convertToDoubleLineTwo}@*/</span>
<span class="lineno">24 </span>        <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span><span class="tok-cm">/*@\label{inputDialogLineThree}@*/</span>
<span class="lineno">25 </span>        	<span class="tok-n">enterBounces</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">26 </span>        <span class="tok-n">bounces</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{convertToDoubleLineThree}@*/</span>
<span class="lineno">27 </span>    <span class="tok-o">}</span>
<span class="lineno">28 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code in this program is very similar to
<a href="#GetInputCLIProgram">Program 1</a> until line <a href="#inputDialogLineOne">[inputDialogLineOne]</a>. At
that point, we use the <code>showInputDialog()</code> method to read a <code>String</code>
version of the height from the user. On the next line, we have to
convert this <code>String</code> version into the <code>double</code> version that we store in
the <code>height</code> variable. The next four lines read in the coefficient of
restitution and the number of bounces and convert them to their
appropriate numerical types.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_a_few_operations">2.3.4. A few operations</h4>
<div class="sect4">
<h5 id="_basic_math">Basic math</h5>
<div class="paragraph">
<p>To make our code useful, we can perform operations on values and
variables. For example, we used the expression <code>35 + 7</code> as an argument
to the <code>System.out.print()</code> method to print <code>42</code> to the screen. We can
use the add (<code>+</code>), subtract (<code>-</code>), multiply (<code>*</code>), and divide(<code>/</code>)
operators on numbers to solve arithmetic problems. These operators work
the way you expect them to (except that division has a few surprises).
We&#8217;ll go into these operators and others more deeply in
<a href="#_primitive_types_and_strings">Chapter 3</a>. Here are examples of
these four operators used with integer and floating-point numbers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">2</span> <span class="tok-o">+</span> <span class="tok-mi">3</span><span class="tok-o">;</span>         <span class="tok-c1">// a will hold 5</span>
<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-mi">2</span> <span class="tok-o">-</span> <span class="tok-mi">3</span><span class="tok-o">;</span>         <span class="tok-c1">// b will hold -1</span>
<span class="tok-kt">int</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-mi">2</span> <span class="tok-o">*</span> <span class="tok-mi">3</span><span class="tok-o">;</span>         <span class="tok-c1">// c will hold 6</span>
<span class="tok-kt">int</span> <span class="tok-n">d</span> <span class="tok-o">=</span> <span class="tok-mi">2</span> <span class="tok-o">/</span> <span class="tok-mi">3</span><span class="tok-o">;</span>         <span class="tok-c1">// d will hold 0 (explained later)</span>

<span class="tok-kt">double</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mf">1.6</span> <span class="tok-o">+</span> <span class="tok-mf">3.2</span><span class="tok-o">;</span>  <span class="tok-c1">// x will hold 4.8</span>
<span class="tok-kt">double</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mf">1.6</span> <span class="tok-o">-</span> <span class="tok-mf">3.2</span><span class="tok-o">;</span>  <span class="tok-c1">// y will hold -1.6</span>
<span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-mf">1.6</span> <span class="tok-o">*</span> <span class="tok-mf">3.2</span><span class="tok-o">;</span>  <span class="tok-c1">// z will hold 5.12</span>
<span class="tok-kt">double</span> <span class="tok-n">w</span> <span class="tok-o">=</span> <span class="tok-mf">1.6</span> <span class="tok-o">/</span> <span class="tok-mf">3.2</span><span class="tok-o">;</span>  <span class="tok-c1">// w will hold 0.5</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_operations">Other operations</h5>
<div class="paragraph">
<p>These basic operations can mix values and variables together. As we will
discuss later, they can be arbitrarily complicated with order of
operations determining the final answer. Nevertheless, we also need ways
to accomplish other mathematical operations such as raising a number to
a power or finding its square root. The <code>Math</code> class has methods that
perform these and other functions. To raise a number to a power, we call
<code>Math.pow()</code> with two arguments: first the base and then the exponent.
To find the square root, we pass the number to the <code>Math.sqrt()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">p</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">pow</span><span class="tok-o">(</span><span class="tok-mf">3.0</span><span class="tok-o">,</span> <span class="tok-mf">2.5</span><span class="tok-o">);</span>
<span class="tok-c1">// Raises 3 to the power 2.5, approximately 15.588457</span>
<span class="tok-kt">double</span> <span class="tok-n">q</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-mf">2.0</span><span class="tok-o">);</span>
<span class="tok-c1">// Finds the square root of 2.0, approximately 1.4142136</span></code></pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 26. Compute height</div>
<div class="content">
<div class="paragraph">
<p>We compute the final height of the ball in subproblem 2 of the bouncing
ball problem. To do so, we have to multiply the height by the
coefficient of restitution raised to the power of the number of bounces.
The following program does so, using the <code>Math.pow()</code> method.</p>
</div>
<div id="ComputeHeightProgram" class="listingblock">
<div class="title">Program 4. Computes height of a ball after bounces.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ComputeHeight</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-c1">// Use dummy values to test subproblem 2</span>
<span class="lineno"> 4 </span>        <span class="tok-kt">double</span> <span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-mi">15</span><span class="tok-o">,</span> <span class="tok-n">coefficient</span> <span class="tok-o">=</span> <span class="tok-mf">0.3</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>        <span class="tok-kt">int</span> <span class="tok-n">bounces</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>        <span class="tok-c1">// Compute height after bounces</span>
<span class="lineno"> 7 </span>        <span class="tok-kt">double</span> <span class="tok-n">bounceHeight</span> <span class="tok-o">=</span> <span class="tok-n">height</span><span class="tok-o">*</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">pow</span><span class="tok-o">(</span><span class="tok-n">coefficient</span><span class="tok-o">,</span><span class="tok-n">bounces</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{computeHeight}@*/</span>
<span class="lineno"> 8 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">bounceHeight</span><span class="tok-o">);</span> <span class="tok-c1">// For testing</span>
<span class="lineno"> 9 </span>    <span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#ComputeHeightProgram">Program 4</a> is only focusing on subproblem 2, but,
if we want to test it, we need to supply some dummy values for <code>height</code>,
<code>coefficient</code>, and <code>bounces</code>, since these are read in by the solution to
subproblem 1. Likewise, the output statement on the last line of the
<code>main()</code> method is just for testing purposes. The complete solution has
more complex output.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_string_code_concatenation"><code>String</code> concatenation</h5>
<div class="paragraph">
<p>Just as we can add numbers together, we can also &#8220;add&#8221; pieces of text
together. In Java, text has the type <code>String</code>. If you use the <code>+</code>
operator between two values or variables of type <code>String</code>, the result is
a new <code>String</code> that is the <em>concatenation</em> of the two previous <code>String</code>
values, meaning that the result is the two pieces of text pasted
together, one after the other. Concatenation doesn&#8217;t change the <code>String</code>
values you are concatenating.</p>
</div>
<div class="paragraph">
<p>At this point, it becomes confusing if you mix types (<code>String</code>, <code>int</code>,
<code>double</code>) together when doing mathematical operations. However, feel
free to concatenate <code>String</code> values with any other type using the <code>+</code>
operator. When you do so, the other type is automatically converted into
a <code>String</code>. This behavior is useful since any <code>String</code> is easy to
output. Here are a few examples of <code>String</code> concatenation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">word1</span> <span class="tok-o">=</span> <span class="tok-s">&quot;tomato&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">word2</span> <span class="tok-o">=</span> <span class="tok-s">&quot;sauce&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">text1</span> <span class="tok-o">=</span> <span class="tok-n">word1</span> <span class="tok-o">+</span> <span class="tok-n">word2</span><span class="tok-o">;</span>
<span class="tok-c1">// text1 will contain &quot;tomatosauce&quot;</span>
<span class="tok-n">String</span> <span class="tok-n">text2</span> <span class="tok-o">=</span> <span class="tok-n">word1</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">word2</span><span class="tok-o">;</span>
<span class="tok-c1">// text2 will contain &quot;tomato sauce&quot;</span>
<span class="tok-n">String</span> <span class="tok-n">text3</span> <span class="tok-o">=</span> <span class="tok-s">&quot;potato &quot;</span> <span class="tok-o">+</span> <span class="tok-n">word1</span><span class="tok-o">;</span>
<span class="tok-c1">// text3 will contain &quot;potato tomato&quot;</span>
<span class="tok-n">String</span> <span class="tok-n">text4</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">word1</span> <span class="tok-o">+</span> <span class="tok-s">&quot;es&quot;</span><span class="tok-o">;</span>
<span class="tok-c1">// text4 will contain &quot;5 tomatoes&quot;</span></code></pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 27. Display height</div>
<div class="content">
<div class="paragraph">
<p>With <code>String</code> concatenation, subproblem 3 becomes a bit easier. We
concatenate the results together with an appropriate message and then
use the <code>System.out.println()</code> method for output. The following program
does so.</p>
</div>
<div id="DisplayHeightCLIProgram" class="listingblock">
<div class="title">Program 5. Displays height of a ball using the command line.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DisplayHeightCLI</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-c1">// Use dummy values to test subproblem 3</span>
<span class="lineno"> 4 </span>        <span class="tok-kt">int</span> <span class="tok-n">bounces</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>        <span class="tok-kt">double</span> <span class="tok-n">bounceHeight</span> <span class="tok-o">=</span> <span class="tok-mf">2.0</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>        <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;After &quot;</span> <span class="tok-o">+</span> <span class="tok-n">bounces</span> <span class="tok-o">+</span>
<span class="lineno"> 7 </span>        	<span class="tok-s">&quot; bounces the height of the ball is: &quot;</span> <span class="tok-o">+</span>
<span class="lineno"> 8 </span>        	<span class="tok-n">bounceHeight</span> <span class="tok-o">+</span> <span class="tok-s">&quot; feet&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
<span class="lineno">10 </span>    <span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#DisplayHeightCLIProgram">Program 5</a> is only focusing on subproblem 3,
but, if we want to test it, we need to supply dummy values for <code>bounces</code>
and <code>bounceHeight</code>, since these are generated by the solution to earlier
subproblems.</p>
</div>
<div class="paragraph">
<p>The same concatenation can be used for GUI output as well. The only
difference is the use of<br>
<code>JOptionPane.showMessageDialog()</code> instead of <code>System.out.println()</code>.</p>
</div>
<div id="DisplayHeightGUIProgram" class="listingblock">
<div class="title">Program 6. Displays height of a ball using a GUI.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DisplayHeightGUI</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>        <span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Bouncing Ball: Subproblem 3&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>        <span class="tok-c1">// Use dummy values to test subproblem 3</span>
<span class="lineno"> 7 </span>        <span class="tok-kt">int</span> <span class="tok-n">bounces</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>        <span class="tok-kt">double</span> <span class="tok-n">bounceHeight</span> <span class="tok-o">=</span> <span class="tok-mf">2.0</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>        <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;After &quot;</span> <span class="tok-o">+</span> <span class="tok-n">bounces</span> <span class="tok-o">+</span>
<span class="lineno">10 </span>    		<span class="tok-s">&quot; bounces the height of the ball is: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">11 </span>    		<span class="tok-n">bounceHeight</span> <span class="tok-o">+</span> <span class="tok-s">&quot; feet&quot;</span><span class="tok-o">;</span>
<span class="lineno">12 </span>        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
<span class="lineno">13 </span>        	<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">14 </span>    <span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_java_formatting">2.3.5. Java formatting</h4>
<div class="paragraph">
<p>Writing good Java code has some similarities to writing effectively in
English. There are rules you have to follow in order to make sense, but
there are also guidelines that you should follow in order to make your
code easier to read for yourself and everyone else.</p>
</div>
<div class="sect4">
<h5 id="_variable_and_class_naming">Variable and class naming</h5>
<div class="paragraph">
<p>Java programs are filled with variables, and each variable should be
named to reflect its contents. Variable names are essentially unlimited
in length (although the JVM you use may limit this length to thousands
of characters). A tremendously long variable name can be hard to read,
but abbreviations can be worse. You want the meaning of your code to be
obvious to others and to yourself when you come back days or weeks
later.</p>
</div>
<div class="paragraph">
<p>Imagine you are writing a program that sells fruit. Consider the
following names for a variable that keeps track of the number of apples.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Too short, gives no useful information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Too short, vague, could mean applications or appetizers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cntr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Too short, vague, could mean center</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>counter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not bad, but counting what?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>theVariableUsedToCountApples</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Too long for no good reason</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>appleCounter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Very clear</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apples</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concise and clear, unless there are multiple apple quantities
such as <code>applesSold</code> and <code>applesBought</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Mathematics is filled with one letter variables, partly because there is
a history of writing mathematics on chalkboards and paper. Clarity is
more important than brevity with variables in computer programs. Some
variables need more than one word to be descriptive. In that case,
programmers of Java are encouraged to follow <em>camel case</em>. In camel
case, multi-word variables and methods start with a lowercase letter and
then use an uppercase letter to mark the beginning of each new word. It
is called camel case because the uppercase letters are reminiscent of
the humps of a camel. Examples include <code>lastValue</code>, <code>symbolTable</code>, and
<code>makeHamSandwich()</code>.</p>
</div>
<div class="paragraph">
<p>By convention, class names should always begin with a capital letter,
but they also use camel case with a capital letter for the beginning of
each new word. Examples include <code>LinkedList</code>, <code>JazzPiano</code>, and
<code>GlobalNuclearWarfare</code>.</p>
</div>
<div class="paragraph">
<p>Another convention is that constants, variables whose value never
changes, have names in all uppercase, separated by underscores. Examples
include <code>PI</code>, <code>TRIANGLE_SIDES</code>, and
<code>UNIVERSAL_GRAVITATIONAL_CONSTANT</code>.</p>
</div>
<div class="paragraph">
<p>Spaces are not allowed in variable, method, or class names. Recall that
a name in Java is called an identifier. The rules for identifiers
specify that they must start with an uppercase or lowercase letter (or
an underscore) and that the remaining characters must be letters,
underscores, or numerical digits. Thus, <code>mötleyCrüe</code>, <code>Tupac</code>, and even
the absurd <code><em>_</em>5</code> are legal identifiers, but <code>Motley Crue</code> and
<code>2Pac</code> are not. Java has support for many of the world&#8217;s languages,
allowing identifiers to contain characters from Chinese, Thai,
Devanagari, Cyrillic, and other scripts.</p>
</div>
<div class="paragraph">
<p>Remember that keywords cannot be used as identifiers. For example,
<code>public</code>, <code>static</code>, and <code>class</code> are all keywords in Java and can never
be the names of classes, variables, or methods.</p>
</div>
</div>
<div class="sect4">
<h5 id="_white_space">White space</h5>
<div class="paragraph">
<p>Although you are not allowed to have spaces in a Java identifier, you
can usually use white space (spaces, tabs, and new lines) wherever you
want. Java ignores extra space. Thus, this line of code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">y</span> <span class="tok-o">+</span> <span class="tok-mi">5</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-o">=</span><span class="tok-n">y</span><span class="tok-o">+</span><span class="tok-mi">5</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We chose to type our earlier example of a program performing output as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">42</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, we could have been more chaotic with our use of whitespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>        <span class="tok-kd">public</span>
<span class="tok-kd">class</span>          <span class="tok-nc">Example</span> <span class="tok-o">{</span>
<span class="tok-kd">public</span>
    <span class="tok-kd">static</span> <span class="tok-kt">void</span>
    <span class="tok-nf">main</span> <span class="tok-o">(</span><span class="tok-n">String</span>     <span class="tok-o">[</span>
        <span class="tok-o">]</span> <span class="tok-n">args</span>
        <span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">System</span><span class="tok-o">.</span>
    <span class="tok-n">out</span>
        <span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">42</span>

<span class="tok-o">)</span> <span class="tok-o">;</span> <span class="tok-o">}</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or used almost none at all:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span><span class="tok-o">{</span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-n">args</span><span class="tok-o">){</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">42</span><span class="tok-o">);}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These three programs are identical in the eyes of the Java compiler, but
the first one is easier for a human to read. You should use whitespace
to increase readability. Don&#8217;t add too much whitespace with lots of
blank lines between sections of code. On the other hand, don&#8217;t use too
little and cramp the code together. Whenever code is nested inside of a
set of braces, indent the contents so that it is easy to see the
hierarchical relationship.</p>
</div>
<div class="paragraph">
<p>The style we present in this book puts the left brace (<code>\{</code>) on the line
starting a block of code. Another popular style puts the left brace on
the next line. Here is the same example program formatted in this style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span>
<span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span>
    <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">42</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are people (including some authors of this book) who prefer this
style because it is easier to see where blocks of code begin and end.
However, the other style uses less space, and so we use it throughout
the book. You can make your own choices about style, but be consistent.
If you work for a software development company, they may have strict
standards for code formatting.</p>
</div>
</div>
<div class="sect4">
<h5 id="_comments">Comments</h5>
<div class="paragraph">
<p>As we mentioned before, you can leave comments in your code whenever you
want someone reading the code to have extra information. Java has three
different kinds of comments. We described single-line comments, which
start with a <code>//</code> and continue until the end of the line.</p>
</div>
<div class="paragraph">
<p>If you have a large block of text you want as a comment, you can create
a block comment, which starts with a <code>/*</code> and continues until it reaches
a <code>*/</code>.</p>
</div>
<div class="paragraph">
<p>Beyond leaving messages for other programmers, you can also &#8220;comment
out&#8221; existing code. By making Java code a comment, it no longer affects
the program execution. This practice is very common when programmers
want to remove or change some code but are reluctant to delete it until
the new version of the code has been tested.</p>
</div>
<div class="paragraph">
<p>The third kind of comment is called a documentation comment and
superficially looks a lot like a block comment. A documentation comment
starts with a <code>/**</code> and ends with a <code>*/</code>. These comments are supposed to
come at the beginning of classes and methods and explain what they are
used for and how to use them. A tool called <code>javadoc</code> is used to run
through documentation comments and generate an HTML file that users can
read to understand how to use the code. This tool is one of the features
that has contributed greatly to the popularity of Java, since its
libraries are well-documented and easy to use. However, we do not
discuss documentation comments deeply in this book.</p>
</div>
<div class="paragraph">
<p>Here is our example output program heavily commented.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> *  Class Example prints the number 42 to the screen.</span>
<span class="tok-cm"> *  It contains an executable main() method.</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Example</span> <span class="tok-o">{</span>
    <span class="tok-cm">/*</span>
<span class="tok-cm">     * The main() method was last updated by Barry Wittman.</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">42</span><span class="tok-o">);</span>  <span class="tok-c1">// answer to everything</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Comments are a wonderful tool, but clean code with meaningful variable
names and careful use of whitespace doesn&#8217;t require too much commenting.
Never hesitate to comment, but always ask yourself if there is a way to
write the code so clearly that a comment is unnecessary.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_how_to_solve_problems">2.4. Solution: How to solve problems</h3>
<div class="paragraph">
<p>The problem solving steps given in <a href="#_concepts_developing_software">Section 2.2</a> are sound, but they depend on being able to implement your
planned solution in Java. In this chapter we have introduced far too little Java
to expect to solve <strong>all</strong> the problems that can be solved with a computer. However, we can show the solution to the bouncing ball
problem and explain how our solution works through the software
development lifecycle.</p>
</div>
<div class="sect3">
<h4 id="_bouncing_ball_solution_command_line_version">2.4.1. Bouncing ball solution (command line version)</h4>
<div class="paragraph">
<p>In <a href="#example-Ball_bouncing_problem">Example 22</a> we made sure that
we understood the problem and then formed a three-part plan to read in
the input, compute the height of the bounce, and then output it.</p>
</div>
<div class="paragraph">
<p>In <a href="#GetInputCLIProgram">Program 1</a>, we implemented subproblem 1, reading
the input from the command line. In <a href="#ComputeHeightProgram">Program 4</a>,
we implemented subproblem 2, computing the height of the final bounce.
In <a href="#DisplayHeightCLIProgram">Program 5</a>, we implemented subproblem 3,
displaying the height that was computed. In the final, integrated
program, the portion of the code that corresponds to solving subproblem
1 is below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BouncingBallCLI</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>    	<span class="tok-c1">// Solution to subproblem 1</span>
<span class="lineno"> 6 </span>    	<span class="tok-c1">// Create an object named in for input</span>
<span class="lineno"> 7 </span>        <span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{scannerObjectLine}@*/</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>        <span class="tok-c1">// Declare variables to hold input data</span>
<span class="lineno">10 </span>        <span class="tok-kt">double</span> <span class="tok-n">height</span><span class="tok-o">,</span> <span class="tok-n">coefficient</span><span class="tok-o">;</span>
<span class="lineno">11 </span>        <span class="tok-kt">int</span> <span class="tok-n">bounces</span><span class="tok-o">;</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>        <span class="tok-c1">// Declare user prompt strings</span>
<span class="lineno">14 </span>        <span class="tok-n">String</span> <span class="tok-n">enterHeight</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Enter the height: &quot;</span><span class="tok-o">;</span>
<span class="lineno">15 </span>        <span class="tok-n">String</span> <span class="tok-n">enterCoefficient</span> <span class="tok-o">=</span>
<span class="lineno">16 </span>        	<span class="tok-s">&quot;Enter restitution coefficient: &quot;</span><span class="tok-o">;</span>
<span class="lineno">17 </span>        <span class="tok-n">String</span> <span class="tok-n">enterBounces</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Enter the number of bounces: &quot;</span><span class="tok-o">;</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Bouncing Ball&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>        <span class="tok-c1">// Prompt the user and read data from the keyboard</span>
<span class="lineno">22 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Bouncing Ball: Subproblem 1&quot;</span><span class="tok-o">);</span>
<span class="lineno">23 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">enterHeight</span><span class="tok-o">);</span>
<span class="lineno">24 </span>        <span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span> <span class="tok-cm">/*@\label{inputDialogScannerIntegratedLineOne}@*/</span>
<span class="lineno">25 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">enterCoefficient</span><span class="tok-o">);</span>
<span class="lineno">26 </span>        <span class="tok-n">coefficient</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span> <span class="tok-cm">/*@\label{inputDialogScannerIntegratedLineTwo}@*/</span>
<span class="lineno">27 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">enterBounces</span><span class="tok-o">);</span>
<span class="lineno">28 </span>        <span class="tok-n">bounces</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span> <span class="tok-cm">/*@\label{inputDialogScannerIntegratedLineThree}@*/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the imports, class declaration, and <code>main()</code> method set up by the
solution to subproblem 1, the solution to subproblem 2 is very short.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>        <span class="tok-c1">// Solution to subproblem 2</span>
<span class="lineno">2 </span>        <span class="tok-kt">double</span> <span class="tok-n">bounceHeight</span> <span class="tok-o">=</span> <span class="tok-n">height</span><span class="tok-o">*</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">pow</span><span class="tok-o">(</span><span class="tok-n">coefficient</span><span class="tok-o">,</span><span class="tok-n">bounces</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{solutionScannerSubProblemTwo}@*/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The solution to subproblem 3 and the braces that mark the end of the
<code>main()</code> method and then the end of the class only take up a few
additional lines.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>        <span class="tok-c1">// Solution to subproblem 3</span>
<span class="lineno">2 </span>        <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;After &quot;</span> <span class="tok-o">+</span> <span class="tok-n">bounces</span> <span class="tok-o">+</span>
<span class="lineno">3 </span>    		<span class="tok-s">&quot; bounces the height of the ball is: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">4 </span>    		<span class="tok-n">bounceHeight</span> <span class="tok-o">+</span> <span class="tok-s">&quot; feet&quot;</span><span class="tok-o">;</span>
<span class="lineno">5 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{constructorExecutionIntegratedEnds}@*/</span>
<span class="lineno">6 </span>    <span class="tok-o">}</span>
<span class="lineno">7 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bouncing_ball_solution_gui_version">2.4.2. Bouncing ball solution (GUI version)</h4>
<div class="paragraph">
<p>If you prefer a GUI for your input and output, we can integrate the
GUI-based versions of the solutions to subproblems 1, 2, and 3 from
<a href="#GetInputCLIProgram">Program 1</a>, <a href="#ComputeHeightProgram">Program 4</a>, and
<a href="#DisplayHeightGUIProgram">Program 6</a>. The final program is below. It only
differs from the command line version in a few details.</p>
</div>
<div id="BouncingBallGUIProgram" class="listingblock">
<div class="title">Program 7. Full program to compute the height of the final bounce of a ball and display the result with a GUI.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BouncingBallGUI</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-c1">// Solution to sub-problem 1</span>
<span class="lineno"> 6 </span>		<span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Bouncing Ball&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>        <span class="tok-kt">double</span> <span class="tok-n">height</span><span class="tok-o">,</span> <span class="tok-n">coefficient</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>        <span class="tok-kt">int</span> <span class="tok-n">bounces</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>        <span class="tok-c1">// Declare user prompt strings</span>
<span class="lineno">11 </span>        <span class="tok-n">String</span> <span class="tok-n">enterHeight</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Enter the height: &quot;</span><span class="tok-o">;</span>
<span class="lineno">12 </span>        <span class="tok-n">String</span> <span class="tok-n">enterCoefficient</span> <span class="tok-o">=</span>
<span class="lineno">13 </span>        	<span class="tok-s">&quot;Enter restitution coefficient: &quot;</span><span class="tok-o">;</span>
<span class="lineno">14 </span>        <span class="tok-n">String</span> <span class="tok-n">enterBounces</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Enter the number of bounces: &quot;</span><span class="tok-o">;</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>        <span class="tok-c1">// Prompt the user, get data, and convert it</span>
<span class="lineno">17 </span>        <span class="tok-n">String</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span><span class="tok-cm">/*@\label{sampleDeclarationAndExecutableStatement}@*/</span>
<span class="lineno">18 </span>        	<span class="tok-n">enterHeight</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">19 </span>        <span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">parseDouble</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span>
<span class="lineno">20 </span>        <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span>
<span class="lineno">21 </span>        	<span class="tok-n">enterCoefficient</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">22 </span>        <span class="tok-n">coefficient</span> <span class="tok-o">=</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">parseDouble</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span>
<span class="lineno">23 </span>        <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span>
<span class="lineno">24 </span>        	<span class="tok-n">enterBounces</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">25 </span>        <span class="tok-n">bounces</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span>        <span class="tok-c1">// Solution to sub-problem 2</span>
<span class="lineno">28 </span>        <span class="tok-kt">double</span> <span class="tok-n">bounceHeight</span> <span class="tok-o">=</span> <span class="tok-n">height</span><span class="tok-o">*</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">pow</span><span class="tok-o">(</span><span class="tok-n">coefficient</span><span class="tok-o">,</span><span class="tok-n">bounces</span><span class="tok-o">);</span>
<span class="lineno">29 </span>
<span class="lineno">30 </span>        <span class="tok-c1">// Solution to sub-problem 3</span>
<span class="lineno">31 </span>        <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;After &quot;</span> <span class="tok-o">+</span> <span class="tok-n">bounces</span> <span class="tok-o">+</span>
<span class="lineno">32 </span>			<span class="tok-s">&quot; bounces the height of the ball is: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">33 </span>			<span class="tok-n">bounceHeight</span> <span class="tok-o">+</span> <span class="tok-s">&quot; feet&quot;</span><span class="tok-o">;</span>
<span class="lineno">34 </span>	    <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
<span class="lineno">35 </span>	    	<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">36 </span>    <span class="tok-o">}</span>
<span class="lineno">37 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_and_maintenance">2.4.3. Testing and maintenance</h4>
<div class="paragraph">
<p>Testing and maintenance are key elements of the software engineering
lifecycle and often take more time and resources than the rest. However,
we only discuss them briefly here.</p>
</div>
<div class="paragraph">
<p>The ball bouncing problem is not complex. There are a few obvious things
to test. We should pick a &#8220;normal&#8221; test case such as a height of 15
units, a coefficient of restitution of 0.3, and 10 bounces. The height
should be \(15\times 0.3^{10} = 0.0000885735\). The result
computed by our program should be the same, ignoring floating point
error. We can also check some boundary test cases. If the coefficient of
restitution is 1, the ball should bounce back perfectly, reaching
whatever height we input. If the coefficient of restitution is 0, the
ball doesn&#8217;t bounce at all, and the final height should be 0.</p>
</div>
<div class="paragraph">
<p>Our code does not account for users entering badly formatted data like
<code>two</code> instead of <code>2</code>. Likewise, our code does not detect invalid values
such as a coefficient of restitution greater than 1 or a negative number
of bounces. An industrial-grade program should. We&#8217;ll discuss testing
further in <a href="#_testing_and_debugging">Chapter 16</a>.</p>
</div>
<div class="paragraph">
<p>As with most of the problems we discuss in this book, issues of
maintenance will not apply. We don&#8217;t have a customer base to keep happy.
However, it is a good thought exercise to imagine a large-scale version
of this program that can solve many different kinds of physics problems.
Who are likely to be your clients? What are the kinds of bugs that are
likely to creep into such a program? How would you provide bug-fixes and
develop new features?</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_solving_problems_in_parallel">2.5. Concurrency: Solving problems in parallel</h3>
<div class="sect3">
<h4 id="_parallelism_and_concurrency">2.5.1. Parallelism and concurrency</h4>
<div class="paragraph">
<p>The terms <em>parallelism</em> and <em>concurrency</em> are often confused and
sometimes used interchangeably. Parallelism or parallel computing occurs
when multiple computations are being performed at the same time.
Concurrency occurs when multiple computations may interact with each
other. The distinction is subtle since many parallel computations are
concurrent and vice versa.</p>
</div>
<div class="paragraph">
<p>An example of parallelism without concurrency is two separate programs
running on a multicore system. They are both performing computations at
the same time, but, for the most part, they are not interacting with
each other. (Concurrency issues can arise if these programs try to
access a shared resource, such as a file, at the same time.)</p>
</div>
<div class="paragraph">
<p>An example of concurrency without parallelism is a program with multiple
threads of execution running on a single-core system. These threads will
not execute at the same time as each other. However, the OS or runtime
system will interleave the execution of these threads, switching back
and forth between them whenever it wants to. Since these threads can
share memory, they can still interact with each other in complicated and
often unpredictable ways.</p>
</div>
<div class="paragraph">
<p>With multicore computers, we want good and effective parallelism,
computing many things at the same time. Unfortunately, striving to reach
parallelism often means struggling with concurrency and carefully
managing the interactions between threads.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sequential_versus_concurrent_programming">2.5.2. Sequential versus concurrent programming</h4>
<div class="paragraph">
<p>Imagine that the evil Lellarap aliens are attacking Earth. They have
sent an extensive list of demands to the world&#8217;s leaders, but only a few
people, including you, have mastered their language, Lellarapian. To
save the people of Earth, it is imperative that you translate their
demands as quickly as possible so that world leaders can decide what
course of action to take. If you do it alone, as illustrated in
<a href="#documentTranslationFigure">Figure 10</a>(a), the Lellaraps might attack
before you finish.</p>
</div>
<div class="paragraph">
<p>In order to finish the work faster, you hire a second translator whose
skills in Lellarap are as good as yours. As shown in
<a href="#documentTranslationFigure">Figure 10</a>(b), you divide the document into
two nearly equal parts, Document A and Document B. You translate
Document A and your colleague translates Document B. When both
translations are complete, you merge the two, check the translation, and
send the result to the world&#8217;s leaders.</p>
</div>
<div id="documentTranslationFigure" class="imageblock">
<div class="content">
<img src="chapters/02-intro/images/documentTranslationFigure.svg" alt="documentTranslationFigure" width="100%">
</div>
<div class="title">Figure 10. (a) Translation by one translator. Time \(t_s\) gives the sequential time taken. (b) Translation by translators A and B. Times \(t_1\), \(t_2\), \(t_3\), and \(t_4\) give the times needed to do each component of the concurrent approach.</div>
</div>
<div class="paragraph">
<p>Translating the demands alone is a <em>sequential</em> approach. In this
context, sequential mean non-parallel. Translating the demands with two
people is a parallel approach. It is concurrent as well because you have
to decide on how to split up the document and how to merge it back
together.</p>
</div>
<div class="paragraph">
<p>If you were to write a computer program to translate the demands using
the sequential approach, you would produce a <em>sequential program</em>. If
you write a computer program that uses the approach shown in
<a href="#documentTranslationFigure">Figure 10</a>(b), it would be a <em>concurrent
program</em>. A concurrent program is also referred to as a <em>multi-threaded</em>
program. <em>Threads</em> are sequences of code that can execute independently
and access each other&#8217;s memory. Imagine you are one thread of execution
and your colleague is another. Thus, the concurrent approach will have
at least two threads. It may have more if separate threads are used to
divide up the document and merge it back together.</p>
</div>
<div class="paragraph">
<p>Because we&#8217;re interested in the time the process takes, we have labeled
different tasks in <a href="#documentTranslationFigure">Figure 10</a> with their
running times. We let \(t_s\) be the time for one person to
complete the translation. The times \(t_1\) through
\(t_4\) mark the times needed to complete tasks 1 through 4,
indicated in <a href="#documentTranslationFigure">Figure 10</a>(b).
<a href="#exercise2.10">Exercise 2.10</a> asks you to calculate
these times for the sequential and concurrent approaches.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise2.10">Exercise 2.10</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kinds_of_concurrency">2.5.3. Kinds of concurrency</h4>
<div class="paragraph">
<p>A sequential program, like the single translator, uses a single
processor on a multi-processor system or a single core on a multicore
chip. To speed up the solution of a program on a multicore chip, it may
be necessary to divide a problem so that different parts of it can be
executed concurrently.</p>
</div>
<div class="paragraph">
<p>This process of dividing up a problem falls into the category of <em>domain
decomposition</em>, <em>task decomposition</em>, or some combination of the two. In
domain decomposition, we take a large amount of data or elements to be
processed and divide up the data among workers that all do the same
thing to different parts of the data. In task decomposition, each worker
is assigned a different task that needs to be done. The following two
examples explore each of these approaches.</p>
</div>
<div class="exampleblock">
<div class="title">Example 28. Domain decomposition</div>
<div class="content">
<div class="paragraph">
<p>Suppose we have an autonomous robot called the Room Rating Robot or
R<sup>3</sup>. The R<sup>3</sup> can measure the area of any home. Suppose that we want to
use an R<sup>3</sup> to measure the area of the home with two floors sketched in
<a href="#figure-floorPlan">Figure 11</a>.</p>
</div>
<div id="figure-floorPlan" class="imageblock text-center">
<div class="content">
<img src="chapters/02-intro/images/floorPlan.svg" alt="floorPlan" width="60%">
</div>
<div class="title">Figure 11. A home with two floors.</div>
</div>
<div class="paragraph">
<p>One way to measure the area is to put an R<sup>3</sup> at the entrance of the
home on the first floor and give it the following instructions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialize total area to 0</p>
</li>
<li>
<p>Find area of next room and add to total area</p>
</li>
<li>
<p>Repeat Step 2 until all rooms have been measured</p>
</li>
<li>
<p>Move to second floor</p>
</li>
<li>
<p>Repeat Step 2 until all rooms have been measured</p>
</li>
<li>
<p>Display total area</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By following these steps, the R<sup>3</sup> will systematically go through each
room, measure its area, and add the value to the total area found so
far. It will then climb up the stairs and repeat the process for the
second floor. It would then add the areas from the two floors and give
us the total living area of the house. This is a sequential approach for
measuring the area.</p>
</div>
<div class="paragraph">
<p>Now suppose we have two R<sup>3</sup> robots, named R<sup>3</sup>A and R<sup>3</sup>B. We can put
R<sup>3</sup>A on the first floor and R<sup>3</sup>B on the second. Both robots are then
instructed to find the area of the floor they&#8217;re on using steps very
similar to the ones listed above for a sequential solution. When done,
we add together the answers from R<sup>3</sup>A and R<sup>3</sup>B to get the total. This
is a concurrent (and also parallel) approach for measuring the living
area of a home with two floors. Using two robots in this way can speed
up the time it takes to measure the area.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise2.11">Exercise 2.11</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example above, the tasks are the same, i.e., measuring the area,
but are performed on two different input domains, i.e., the floors.
Thus, both robots are performing essentially the same operations but on
different floors. This type of task division is also known as domain
decomposition. Here, to achieve concurrency, we take the domain of the
problem (the house) and divide it into smaller subdomains (its floors).
Then, each processor (or robot in this example) performs the same task
on each subdomain. When done, the final answer is found by combining the
answers. Running the robots on each floor is purely parallel, but
combining the answers is concurrent since some interaction between the
robots is necessary.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise2.12">Exercise 2.12</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Another way of solving a problem concurrently is to divide it into
fundamentally different tasks. The tasks could be executed on different
processors and perhaps on different input domains. Eventually, some
coordination of the tasks must be done to generate the final result. The
next example illustrates such a division.</p>
</div>
<div class="exampleblock">
<div class="title">Example 29. Task decomposition</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s expand the problem given in <a href="#_domain_decomposition">Section 13.3.2</a>. R<sup>3</sup> robots can do more than just measure area. In
addition to calculating the living area of a home, we want an R<sup>3</sup> robot
to check if the electrical outlets are in working condition. The robot
should give us the area of the house as well as a list of electrical
outlets that are not working.</p>
</div>
<div class="paragraph">
<p>This problem can be solved in a sequential manner with just one robot.
One way to do so would be for a robot to make a first pass through all
floors and rooms and compute the living area. It can then make a second
pass and make a list of electrical outlets that are not working.</p>
</div>
<div class="paragraph">
<p>One way to solve this problem concurrently is to assign R<sup>3</sup>A to measure
the area and R<sup>3</sup>B to identify broken electrical outlets. Once the
respective tasks are assigned, we place the robots at the entrance to
the house and activate them. It is possible that the two robots will
bump into each other while working, and that&#8217;s one of the difficulties
of concurrency. The burden is on the programmer to give instructions so
that the robots can avoid or recover from collisions. After the robots
are done, we ask R<sup>3</sup>A for the living area of the house and R<sup>3</sup>B for a
list of broken outlets.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_2">2.6. Summary</h3>
<div class="paragraph">
<p>In this chapter, we introduced an approach for developing software to
solve a problem with a computer. A number of examples illustrated how to
move from a problem statement to a complete Java program. Although we
have given rough explanations of all the Java programs in this chapter,
we encourage you to play with each program to expand its functionality.
Several exercises prompt you to do just that. It is impossible to learn
to program without actively practicing programming. Never be afraid of
&#8220;breaking&#8221; the program. Only by breaking it, changing it, and fixing
it will your understanding grow.</p>
</div>
<div class="paragraph">
<p>In addition to the software development lifecycle, we introduced several
building blocks of Java syntax including classes, <code>main()</code> methods,
import statements, and variable declarations. We also gave a preview of
different variable types (<code>int</code>, <code>double</code>, and <code>String</code>) and operations
that can be used with them. Material about types and operations on them
is covered in depth in the next chapter. Furthermore, we discussed input
and output using <code>Scanner</code> and <code>System.out.print()</code> for the command line
interface and <code>JOptionPane</code> methods for a GUI.</p>
</div>
<div class="paragraph">
<p>Finally, we introduced the notions of sequential and concurrent
solutions to problems and clarified the subtle difference between
parallelism and concurrency.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_2">2.7. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise2.1"></a> When solving a problem using a
computer, what problem is solved by the programmer and what problem is
solved by the program written by the programmer? Are they the same?</p>
</li>
<li>
<p><a id="exercise2.2"></a> In <a href="#Input for distance computation">[Input for distance computation]</a>, we declared all variables to be of type
<code>double</code>. How would the program behave differently if we had declared
all the variables with type <code>int</code>?</p>
</li>
<li>
<p>What is the purpose of the statement at
line <a href="#createScannerGetInputDataObject">[createScannerGetInputDataObject]</a> in
<a href="#GetInputCLIProgram">Program 1</a>?</p>
</li>
<li>
<p>Explain the difference between a declaration and an assignment
statement.</p>
</li>
<li>
<p><a id="exercise2.5"></a> Is the following
statement from line <a href="#sampleDeclarationAndExecutableStatement">[sampleDeclarationAndExecutableStatement]</a> of
<a href="#BouncingBallGUIProgram">Program 7</a> a declaration, an assignment, or a
combination of the two?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span>
    <span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">enterHeight</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
    <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise2.6"></a> When would you
prefer using the <code>JOptionPane</code> class for output over
<code>System.out.print()</code>? When might you prefer <code>System.out.print()</code> to
using <code>JOptionPane</code>?</p>
</li>
<li>
<p><a id="exercise2.7"></a> Review
<a href="#BouncingBallGUIProgram">Program 7</a> and identify all the Java keywords
used in it.</p>
</li>
<li>
<p><a id="exercise2.8"></a> Try to recompile
<a href="#BouncingBallGUIProgram">Program 7</a> after removing the <code>import</code>
statement at the top. Read and explain the error message generated by
the compiler.</p>
</li>
<li>
<p><a id="exercise2.9"></a> Explain the difference
between parallel and concurrent tasks. Give examples of tasks that are
parallel but not concurrent, tasks that are concurrent but not parallel,
and tasks that are both.</p>
</li>
<li>
<p><a id="exercise2.10"></a> Refer to
<a href="#documentTranslationFigure">Figure 10</a>. Suppose that you and your
colleague translate from English to Lellarapian at the rate of 200 words
per hour. Suppose that the list of demands contains 10,000 words.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Compute \(t_s\), the time for you to translate the entire
document alone, assuming that, after translation, you perform a final
check at the rate of 500 words per hour.</p>
</li>
<li>
<p>Now assume that the task of splitting up the document and handing
over the correct part to your colleague takes 15 minutes. Also, the task
of receiving the translated document from your colleague and merging
with the one you translated takes another 15 minutes. After merging the
two documents, you do a final check for correctness at a rate of 500
words per hour. Calculate the total time to complete the translation
using this concurrent approach. Let us refer to this time as
\(t_c\).</p>
</li>
<li>
<p>One way to calculate the speedup of a concurrent solution is to
divide the sequential time by the concurrent time. In our case, the
speedup is \(t_s/t_c\). Using the values you have computed in
(a) and (b), calculate the speedup.</p>
</li>
<li>
<p>Suppose that you have a total of two colleagues willing to help you
with the translation. Assuming that the three of you will perform the
translation and that the times needed to split, merge, and check are
unchanged, calculate the total time needed. Then, compute the speedup.</p>
</li>
<li>
<p>Now suppose that there are an unlimited number of people willing and
able to help you with the translation. Will the speedup keep on
increasing as you add more translators? Explain your answer.</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise2.11"></a> In
<a href="#_domain_decomposition">Section 13.3.2</a>, what aspect of a multicore
system do the robots represent?</p>
</li>
<li>
<p><a id="exercise2.12"></a> In
<a href="#_domain_decomposition">Section 13.3.2</a>, suppose that you have two R<sup>3</sup>
robots available. You would like to use these to measure the living area
of a single floor home. Suggest how two robots could be programmed to
work concurrently to measure the living area faster than one.</p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise2.13"></a> Write a program that prompts the user
for three integers from the command line. Read each integer in using the
<code>nextInt()</code> method of a <code>Scanner</code> object. Compute the sum of these
values and print it to the screen using <code>System.out.print()</code> or
<code>System.out.println()</code>.</p>
</li>
<li>
<p><a id="exercise2.14"></a> Expand the program from
<a href="#exercise2.13">Exercise 2.13</a> so that it finds the average of
the three numbers instead of the sum. (Hint: Try dividing by <code>3.0</code>
instead of <code>3</code> to get an average with a fractional part. Then, store the
result in a variable of type <code>double</code>.)</p>
</li>
<li>
<p>Rewrite your solution to <a href="#exercise2.14">Exercise 2.14</a> so
that it uses a <code>JOptionPane</code>-based GUI instead of <code>Scanner</code> and
<code>System.out.print()</code>.</p>
</li>
<li>
<p><a id="exercise2.16"></a> Copy and paste
<a href="#GetInputCLIProgram">Program 1</a> into the Java IDE you prefer. Compile
and run it and make sure that the program executes as intended. Then,
add statements to prompt the user for the color of the ball and read it
in. Store the color in a <code>String</code> value. Add an output statement that
mentions the color of the ball.</p>
</li>
<li>
<p>Rewrite your solution to <a href="#exercise2.16">Exercise 2.16</a>
so that it uses a <code>JOptionPane</code>-based GUI instead of <code>Scanner</code> and
<code>System.out.print()</code>.</p>
</li>
<li>
<p><a id="exercise2.18"></a> In <a href="#Input for distance computation">[Input for distance computation]</a>, we assumed that the speed is given in miles
per hour and the time in hours. Change <a href="#DistanceProgram">Program 2</a> to
compute the distance traveled by a moving object given its speed in
miles per hour but time in seconds. You will need to perform a
conversion from seconds to hours before you can find the distance.</p>
</li>
<li>
<p><a id="exercise2.19"></a> A program can use both a command
line interface and a GUI to interact with a user. Write a program that
uses the <code>Scanner</code> class to read a <code>String</code> value containing the user&#8217;s
favorite food. Then display the name of the food using <code>JOptionPane</code>.</p>
</li>
<li>
<p>Use the complete software development cycle to write a program that
reads in the lengths of two legs of a right triangle and computes the
length of its hypotenuse.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Make sure you understand the problem. How can you apply the
Pythagorean formula (\(a^2 + b^2 = c^2\)) to solve it?</p>
</li>
<li>
<p>Design a solution by listing the steps you will need to take to read
in the appropriate values, find the answer, and then output it.</p>
</li>
<li>
<p>Implement the steps as a Java program.</p>
</li>
<li>
<p>Test the solution with several known values. For example, a right
triangle with legs of lengths 3 and 4 has a hypotenuse of length 5.
Which values cause errors? How should your program react to those
errors?</p>
</li>
<li>
<p>Consider what other features your program should have. If your
intended audience is children who are learning geometry, should your
error handling be different from an audience of architects?</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_primitive_types_and_strings">3. Primitive Types and Strings</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Originality exists in every individual because each of us differs from the others. We are all
primary numbers divisible only by ourselves.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Jean Guitton
</div>
</div>
<div class="sect2">
<h3 id="_problem_college_cost_calculator">3.1. Problem: College cost calculator</h3>
<div class="paragraph">
<p>Perhaps you&#8217;re a student. Perhaps you aren&#8217;t. In either case, you must
be aware of the rapidly rising cost of a college education. The
motivating problem for this chapter is to create a Java program that can
estimate the cost of a college education, including room and board. It
starts by reading a first name, a last name, the per-semester cost of
tuition, the monthly cost of rent, and the monthly cost of food as input
from a user. Many students take out loans for college. In fact, student
debt has surpassed credit card debt in the United States. We can
implement a feature to read in an interest rate and the number of years
expected to pay off the loan.</p>
</div>
<div class="paragraph">
<p>After taking all this data as input, we want to calculate the yearly
cost of such an education, the four year cost, the monthly loan payment,
and the total cost of the loan over time. Furthermore, we want to output
this information on the command line in an attractive way, customized
with the user&#8217;s name. Below is a sample execution of this program.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Welcome to the College Cost Calculator!
Enter your first name:       <strong>Barry</strong>
Enter your last name:        <strong>Wittman</strong>
Enter tuition per semester:  $<strong>17415</strong>
Enter rent per month:        $<strong>350</strong>
Enter food cost per month:   $<strong>400</strong>
Annual interest rate:        <strong>.0937</strong>
Years to pay back your loan: <strong>10</strong>

College costs for Barry Wittman
***************************************
Yearly cost:                 $43830.00
Four year cost:              $175320.00
Monthly loan payment:        $2256.14
Total loan cost:             $270736.5</pre>
</div>
</div>
<div class="paragraph">
<p>Samples from a command line interface can be confusing because it is
difficult to see what is ouput and what is input. In this case, we have
marked the input in <strong>bold</strong> so that it&#8217;s clear what the user enters. In this program, the names, the tuition, the
rent, the food, the interest rate, and the years to pay back the loan
are taken as input. Note that the dollar signs are <strong>not</strong> part of the
input and are outputted as a cue to the user and to give visual polish.</p>
</div>
<div class="paragraph">
<p>If you are following the software development lifecycle, we hope you
have a good understanding of this problem, but there are a few
mathematical details worth addressing. First, the yearly cost is twice
the semester tuition plus 12 times the rent and food costs. The four
year cost is simply four times the yearly cost. The monthly loan payment
amount, however, requires a formula from financial mathematics. Let
\(P\) be the amount of the loan (the principal). Let
\(J\) be the monthly interest rate (the annual interest rate
divided by 12). Let \(N\) be the number of months to pay back
the loan (years of the loan times 12). Let \(M\) be the
monthly payment we want to calculate, then:</p>
</div>
<div class="paragraph">
<p>\(M = P \cdot \frac{J}{1 - (1 + J)^{-N}}\)</p>
</div>
<div class="paragraph">
<p>If you use the concepts and syntax from the previous chapter carefully,
you might be able to solve this problem without reading further.
However, there is a depth to the ideas of types and operations that we
have not explored fully. Getting a program to work is not enough.
Programmers must understand every detail and quirk of their tools to
avoid potential bugs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_types">3.2. Concepts: Types</h3>
<div class="paragraph">
<p>Every operation inside of a Java program manipulates data. Often, this
data is stored in <em>variables</em>, which look similar to variables from
mathematics. Consider the following mathematical equation.</p>
</div>
<div class="paragraph">
<p>\(x + 3 = 7\)</p>
</div>
<div class="paragraph">
<p>In this equation, \(x\) has the value \(4\), and it
always will. You can set up another equation in which \(x\)
has a different value, but it won&#8217;t change in this one. Java variables
are different. They are locations where you can store something. If you
decide later that you want to change what you stored there, you can put
something else into the same location, overwriting the old value.</p>
</div>
<div class="paragraph">
<p>In contrast to a variable is a <em>literal</em>. A literal is a concrete value
that does not change, though it can be stored in a variable. Numbers
like <code>4</code> or <code>2.71828183</code> are literals. We need to represent text and
single characters in Java as well, and there are literals like
<code>"grapefruit segment"</code> and <code>'X'</code> that fill these roles.</p>
</div>
<div class="paragraph">
<p>In Java, both variables and literals have <em>types</em>. If you think of a
variable as a box where you can hold something, its type is the shape of
the box. The kinds of literals that can be stored in that box must have
a matching shape. In the last chapter, we introduced the type <code>int</code> to
store integer values and the type <code>double</code> to store floating point
values. Java is a <em>strongly typed</em> language, meaning that, if we declare
a variable of type <code>int</code>, we can only put <code>int</code> values into it (with a
few exceptions).</p>
</div>
<div class="paragraph">
<p>This idea of a type takes some getting used to. From a mathematical
perspective 3 and 3.0 are identical.
However, if you have an <code>int</code> variable in Java, you can store <code>3</code> into
it, but you can&#8217;t store <code>3.0</code>. Types never change, but you can convert a
value from one type to an equivalent value in another type.</p>
</div>
<div class="sect3">
<h4 id="_types_as_sets_and_operations">3.2.1. Types as sets and operations</h4>
<div class="paragraph">
<p>Before we go any further, let&#8217;s look deeper at what a type really is. We
can think of a type as a set of elements. For example, <code>int</code> represents
a set of integer values (specifically, the integers between
-2,147,483,648 and 2,147,483,647). Consider
the following declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">y</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These declarations indicate that the variables named <code>x</code> and <code>y</code> can
only contain integer values in this range. Furthermore, a type only
allows specific operations. In Java, the <code>int</code> type allows addition,
subtraction, multiplication, division, and several other operations we
will talk about in <a href="#_syntax_types_in_java">Section 3.3</a>, but you cannot
directly raise an <code>int</code> value to a power in Java. Let&#8217;s assume that <code>x</code>
is of type <code>int</code>. As we discussed in the previous chapter, the
expression <code>x + 2</code> performs addition between the variable represented by
<code>x</code> and the literal <code>2</code>. Some languages use the operator <code>^</code> to mean
raising a number to a power. Following this notation, some beginning
Java programmers are tempted to write <code>x ^ 2</code> to compute <code>x</code> squared.
The <code>^</code> operator does have a meaning in Java, but it does not raise
values to a power. Other combinations of operators are simply illegal,
such as <code>x # 2</code>.</p>
</div>
<div class="paragraph">
<p>The idea of using types this way gives structure to a program. All
operations are well-defined. For example, you know that adding two <code>int</code>
values together will give you another <code>int</code> value. Java is a <em>statically
typed</em> language. This means that it can analyze all the types you&#8217;re
using in your program at compile-time and warn you if you&#8217;re doing
something illegal. Consequently, you&#8217;ll get a lot of compiler warnings
and errors, but you can be more confident that your program is correct
if all the types make sense.</p>
</div>
</div>
<div class="sect3">
<h4 id="_primitive_and_reference_types_in_java">3.2.2. Primitive and reference types in Java</h4>
<div class="paragraph">
<p>As shown in <a href="#typesInJavaFigure">Figure 12</a>(a), there are two kinds of
types in Java: <em>primitive types</em> and <em>reference types</em>. Primitive types
are like boxes that hold single, concrete values. The primitive types in
Java are <code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>boolean</code>,
and <code>char</code>. These are types provided by the designers of Java, and it is
not possible to create new ones. Each primitive type has a set of
<em>operators</em> that are legal for it. For example, all the numerical types
can be used with <code>+</code> and <code>-</code>. We&#8217;ll talk about these types and their
operators in great detail in <a href="#_syntax_types_in_java">Section 3.3</a>.</p>
</div>
<div id="typesInJavaFigure" class="imageblock">
<div class="content">
<img src="chapters/03-strings-primitive-types/images/typesInJavaFigure.svg" alt="typesInJavaFigure" width="100%">
</div>
<div class="title">Figure 12. (a) The two categories of types in Java. The <code>int</code> primitive type (b), the <code>boolean</code> primitive type (c), the <code>String</code> reference type (d), and a possible <code>Aircraft</code> reference type (e) are represented as sets of items with operations.</div>
</div>
<div class="paragraph">
<p>Reference types work differently from primitive types. For one thing, a
reference variable <strong>points at</strong> an object. This means that when you
assign one reference variable to another, you are not getting a whole
new copy of the object. Instead, you&#8217;re getting another arrow that
points at the same object. The result is that performing an operation on
one reference can effectively change another reference, if they are both
pointing at the same object.</p>
</div>
<div class="paragraph">
<p>Another difference is that reference variables (or simply <em>references</em>)
do not have a large set of operators that work on them. Every variable
can be used with the assignment (<code>=</code>) and the comparison (<code>==</code>)
operators. Every variable can also be concatenated with a <code>String</code> by
using the <code>+</code> operator, but even if two objects represent numerical
values, they cannot be added together with the <code>+</code> operator.</p>
</div>
<div class="paragraph">
<p>References should still be thought of as types defining a set of objects
and operations that can be done with them. Instead of using operators,
however, references use <em>methods</em>. You have seen methods such as
<code>System.out.print()</code> and <code>JOptionPane.showInputDialog()</code> in the previous
chapter. A method generally has a dot (<code>.</code>) before it and always has
parentheses afterwards. These parentheses contain the input <em>parameters</em>
or <em>arguments</em> that you give to a method. Using operators on primitive
types is convenient, but on the other hand, there is no limit to the
number, kind, or complexity of methods that can be used on references.</p>
</div>
<div class="paragraph">
<p>Another important feature of reference types is that anyone can define
them. So far, you have seen the reference types <code>String</code> and
<code>JOptionPane</code>. As we will discuss later, <code>String</code> is an unusual
reference type in that it is built deeply into the language. There are a
few other types like this (such as <code>Object</code>), but most reference types
could have been written by anyone, even you.</p>
</div>
<div class="paragraph">
<p>To create a new type, you write a class and define data and methods
inside of it. If you wanted to define a type to hold airplanes, you
might create the <code>Airplane</code> class and give it methods such as
<code>takeOff()</code>, <code>fly()</code>, and <code>land()</code> because those are operations that any
airplane should be able to do.</p>
</div>
<div class="paragraph">
<p>Once a class has been defined, it is possible to <em>instantiate</em> an
<em>object</em>. An object is a specific instance of the type. For example, the
type might be <code>Airplane</code>, but the object might be referenced by a
variable called <code>sr71Blackbird</code>. Presumably, this object has a weight, a
maximum speed, and other characteristics that mark it as a Lockheed
SR-71 &#8220;Blackbird,&#8221; the famous spy plane. To summarize: The object is a
concrete instance of the data. The reference is the variable that gives
a name to (points to) the object. The type is the class that both the
variable and the object have, which defines what kinds of data the
object has and what operations it can perform.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.12">Exercise 3.12</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The following table lists some of the differences between primitive
types and reference types.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Primitive Types</strong></th>
<th class="tableblock halign-left valign-top"><strong>Reference Types</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Created by the designers of Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Created by any Java programmer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use operators to perform operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use methods to perform operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">There are only eight different primitive types</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of reference
types is unlimited and grows every time someone creates a new class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hold a specific numbers of bytes of data depending on the type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The
referenced object can hold arbitrary amounts of data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assignment copies a value from one place to another</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assignment copies
an arrow that points at an object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaration creates a box to hold values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaration creates an arrow
that can point at an object, but only instantiation creates a new object</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_type_safety">3.2.3. Type safety</h4>
<div class="paragraph">
<p>Why do we have types? There are weakly typed languages where you can
store any value into almost any variable. Why bother with all these
complicated rules? Most assembly languages have no notion of types and
allow the programmer to manipulate memory directly.</p>
</div>
<div class="paragraph">
<p>Because Java is strongly typed, the type of every variable, whether
primitive or reference, must be declared prior to its use. This
constraint allows the Java compiler to perform many safety and sanity
checks during compilation, and the JVM performs a few more during
execution. These checks avoid errors during program execution that might
otherwise be hard to find. These errors could lead to catastrophic
failures of the program.</p>
</div>
<div class="paragraph">
<p>The Ariane 5 rocket is an example of a catastrophic failure due to a
type error. On its first flight, the rocket left its flight path and
eventually exploded. The failure was caused because of errors that
resulted after converting a 64-bit floating point to 16-bit signed
integer value. The converted value was larger than the integer could
hold, resulting in a meaningless value.</p>
</div>
<div class="paragraph">
<p>Converting from one type to another is called <em>casting</em>. The Ariane 5
failure was due to a problem with casting that was not caught. Even in
Java, it is possible for a human being to circumvent type safety with
irresponsible casting.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_types_in_java">3.3. Syntax: Types in Java</h3>
<div class="paragraph">
<p>In this section we will dig deeper into the type system in Java,
starting with variables and moving on to the properties of the eight
primitive types and the properties of <code>String</code> and other reference
types.</p>
</div>
<div class="sect3">
<h4 id="_variables_and_literals">3.3.1. Variables and literals</h4>
<div class="paragraph">
<p>To use a variable in Java, you must first <em>declare</em> it, which sets aside
memory to hold the variable and attaches a name to that space.
Declarations always follows the same pattern. The type is written first
followed by the identifier, or name, for the variable. Below we declare
a variable named <code>value</code> of type <code>int</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how we use the same pattern to declare a reference variable named
<code>creature</code> of type <code>Wombat</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Wombat</span> <span class="tok-n">creature</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You are always free to declare a variable and then end the line with a
semicolon (<code>;</code>), but it is common to <em>initialize</em> a variable at the same
time. The following line simultaneously declares <code>value</code> and initializes
it to <code>5</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Multiple declarations</div>
<div class="paragraph">
<p>Don&#8217;t forget that you are declaring and initializing in a line like the
above. Beginning Java programmers sometimes try to declare a variable
more than once, as in the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Java will not allow two variables with the same name to exist in the
same block of code. The programmer probably intended the following,
which reuses variable <code>value</code> and replaces its contents with <code>10</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This error is more common when several other lines of code are between
the two assignments.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some of the examples above, we have stored the value <code>5</code> into our
variable <code>value</code>. The symbol <code>5</code> is an example of a <em>literal</em>. A literal
is a value represented directly in code. It cannot be changed, but it
can be stored into variables that have the same type. The values stored
into variables come from literals, input, or more complicated
expressions. Just like variables, literals have types. The type of <code>5</code>
is <code>int</code> while the type of <code>5.0</code> is <code>double</code>. Other types have literals
written in ways we&#8217;ll discuss below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_primitive_types">3.3.2. Primitive types</h4>
<div class="paragraph">
<p>The building blocks of all Java programs are primitive types. Even
objects must fundamentally contain primitive types deep down inside.
There are eight primitive types. Half of them are used to represent
integer values, and we&#8217;ll start by looking at those.</p>
</div>
<div class="sect4">
<h5 id="_integers_code_byte_code_code_short_code_code_int_code_and_code_long_code">Integers: <code>byte</code>, <code>short</code>, <code>int</code>, and <code>long</code></h5>
<div class="paragraph">
<p>A variable intended to hold integer values can be declared with any of
the four types <code>byte</code>, <code>short</code>, <code>int</code>, or <code>long</code>. All of them are signed
(holding positive and negative numbers) and represent numbers in two&#8217;s
complement. They only differ by the range of values that each type can
hold. These ranges and the number of bytes used to represent variables
from each type are given in Table <a href="#rangePrimitiveTypes">[rangePrimitiveTypes]</a>.</p>
</div>
<table class="tableblock frame-all grid-all center">
<caption class="title">Table 1. Ranges for primitive integer types in Java.</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Type</strong></th>
<th class="tableblock halign-center valign-top"><strong>Bytes</strong></th>
<th class="tableblock halign-right valign-top"></th>
<th class="tableblock halign-center valign-top"><strong>Range</strong></th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>byte</pre></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>short</pre></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-32,768</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32,767</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>int</pre></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-2,147,483,648</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,147,483,647</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>long</pre></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-9,223,372,036,854,775,808</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9,223,372,036,854,775,807</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the range of <code>byte</code> is included in that of <code>short</code>, of <code>short</code>
in that of <code>int</code>, and so on. We say that <code>short</code> is <em>broader</em> than
<code>byte</code>, <code>int</code> is broader than <code>short</code>, and <code>long</code> is broader than <code>int</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.1">Exercise 3.1</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A variable declared with type <code>byte</code> can only represent 256 different
values, the integers in the range -128 to 127. Why use <code>byte</code> at all,
then? Since a <code>byte</code> value only takes up a single byte, it can save
memory, especially if you have a list of variables called an <em>array</em>,
which we will discuss in <a href="#_arrays">Chapter 6</a>. However, too narrow
of a range will result in underflow and overflow. Java programmers are
advised to stick with <code>int</code> for general use. If you need to represents
values larger than 2 billion or smaller than -2 billion, use <code>long</code>.
Once you are an experienced programmer, you may occasionally use <code>byte</code>
and <code>short</code> to save space, but they should be used sparingly and for a
clear purpose.</p>
</div>
<div class="exampleblock">
<div class="title">Example 30. Integer variables</div>
<div class="content">
<div class="paragraph">
<p>Consider the following declarations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">byte</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">numberOfRooms</span><span class="tok-o">;</span>
<span class="tok-kt">long</span> <span class="tok-n">foreverCounter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first of these statements declares <code>age</code> to be a variable of type
<code>byte</code>. This declaration means that <code>age</code> can assume any value from the
range for <code>byte</code>. For a human being, this limitation is reasonable (but
dangerously close to the limit) since there is no documented case of a
person living more than 122 years. Similarly, the next declaration
declares <code>numberOfRooms</code> to be of type <code>int</code>. The last declaration
declares <code>foreverCounter</code> to be of type <code>long</code> and initializes it to
<code>0</code>.</p>
</div>
<div class="paragraph">
<p>Since <code>age</code> is a variable, its value can change during program
execution. Note that the above declaration of <code>age</code> does not assign a
value to it. When they are declared, all integer variables are set to
<code>0</code> by Java. However, to make sure that the programmer is explicit about
what he or she wants, the compiler will give an error in most cases if a
variable is used without first having its value set.</p>
</div>
<div class="paragraph">
<p>Like any other integer variable, we can assign <code>age</code> a value as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">age</span> <span class="tok-o">=</span> <span class="tok-mi">32</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing so assigns the value <code>32</code> to variable <code>age</code>. Note that the Java
compiler would not complain if you were to assign <code>-10</code> to the variable
<code>age</code>, even though it is impossible for a human to have a negative age
(at least, without a time machine). Java attaches no meaning to the name
you give to a variable.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Earlier, we said that variables had to match the type of literals you
want to store into them. In the example above, we declared <code>age</code> with
type <code>byte</code> and then stored <code>32</code> into it. What is the type of <code>32</code>? Is
it <code>byte</code>, <code>short</code>, <code>int</code>, or <code>long</code>? By default, all integer literals
have type <code>int</code>, but they can be used with <code>byte</code> or <code>short</code> variables
provided that they fit within the range. Thus, the following line causes
an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">byte</span> <span class="tok-n">fingers</span> <span class="tok-o">=</span> <span class="tok-mi">128</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to specify a literal to have type <code>long</code>, you can append <code>l</code>
or <code>L</code> to it. Thus, <code>42</code> is an <code>int</code> literal, but <code>42L</code> is a <code>long</code>
literal. You should always use <code>L</code> since <code>l</code> can be difficult to
distinguish from <code>1</code>.</p>
</div>
<div class="paragraph">
<p>At the time of this writing, Java 7 is the newest version of Java, but
it has not yet become popular or widespread. In Java 7, you are allowed
to put any number of underscores (<code>_</code>) inside of numerical literals to
break them up for the sake of readability. Thus, <code>123_45_6789</code> might
represent a social security number, or you could use underscores instead
of commas to write three million as <code>3_000_000</code>. To use this syntax,
you must have a Java 7 compiler and be sure that your code will never
need to be compiled in an earlier version of Java. Note that you should
<strong>never</strong> use a comma in a numerical Java literal, no matter which version
of Java.</p>
</div>
</div>
<div class="sect4">
<h5 id="_floating_point_numbers_code_float_code_and_code_double_code">Floating point numbers: <code>float</code> and <code>double</code></h5>
<div class="paragraph">
<p>To represent numbers with fractional parts, Java provides two floating
point types, <code>double</code> and <code>float</code>. Because of limits on floating point
precision discussed in <a href="#_computer_basics">Chapter 1</a>, Java cannot
represent all rational or real numbers, but these types provide good
approximations. If you have a variable that takes on floating point
values such as 3.14, 1.707 × 10<sup>25</sup>,
9.8, and so on, it ought to be declared as a <code>double</code> or a
<code>float</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 31. Floating point declarations</div>
<div class="content">
<div class="paragraph">
<p>Consider the following declarations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">float</span> <span class="tok-n">roomArea</span><span class="tok-o">;</span>
<span class="tok-kt">double</span> <span class="tok-n">avogadro</span> <span class="tok-o">=</span> <span class="tok-mf">6.02214179E23</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first of the above two statements declares <code>roomArea</code> to be of type
<code>float</code>. Note that the declaration does not initialize <code>roomArea</code> to any
value. Similar to integer primitive types, an uninitialized floating
point variable contains <code>0.0</code>, but Java usually forces the programmer to
assign a value to a variable before using it. The second of the above
two statements declares <code>avogadro</code> to be a variable of type <code>double</code> and
initializes it to the well-known Avogadro constant
6.02214179 × 10<sup>23</sup>. Note the use of <code>E</code> to mean
&#8220;ten to the power of.&#8221; In Java, you could write
0.33 × 10<sup>-12</sup> as <code>0.33E-12</code>, or the number
-4.325 × 10<sup>18</sup> as <code>-4.325E18</code> (or even <code>-4.325E+18</code>
if you would like to write the sign of the exponent explicitly).</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_accuracy_in_number_representation">Accuracy in number representation</h5>
<div class="paragraph">
<p>As discussed in <a href="#_computer_basics">Chapter 1</a>, integer types
within their specified ranges have their exact representations. For
example, if you assign <code>19</code> to a variable of type <code>int</code> and then print
this value, you always get exactly <code>19</code>. Floating point numbers do not
have this guarantee of exact representation.</p>
</div>
<div class="exampleblock">
<div class="title">Example 32. Floating point accuracy</div>
<div class="content">
<div class="paragraph">
<p>Try executing the following statements from within a Java program.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">test</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
<span class="tok-n">test</span> <span class="tok-o">+=</span> <span class="tok-mf">0.1</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">test</span><span class="tok-o">);</span>
<span class="tok-n">test</span> <span class="tok-o">+=</span> <span class="tok-mf">0.1</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">test</span><span class="tok-o">);</span>
<span class="tok-n">test</span> <span class="tok-o">+=</span> <span class="tok-mf">0.1</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">test</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we are adding 0.1 each time, one would expect to see outputs of
<code>0.1</code>, <code>0.2</code>, and <code>0.3</code>. The first two numbers print as expected, but
the third number prints out as <code>0.30000000000000004</code>. It may seem
counterintuitive, but 0.1 is a repeating decimal in binary, meaning that
it cannot be represented exactly using the 64-bit IEEE floating point
standard. The <code>System.out.println()</code> method hides this ugliness by
rounding the output past a certain level of precision, but by the third
addition, the number has drifted far enough away from 0.3 that an
unexpected number peeks out.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Variables of type <code>float</code> give you an accuracy of about 6 decimal digits
while those of type <code>double</code> give about 15 decimal digits. Does the
accuracy of floating point number representation matter? The answer to
this question depends on your application. In some applications, 6-digit
accuracy may be adequate. However, when doing large-scale simulations,
such as computing the trajectory of a spacecraft on a mission to Mars,
15-digit accuracy might be a matter of life or death. In fact, even
double precision may not be enough. There is a special <code>BigDecimal</code>
class which can perform arbitrarily high precision calculations, but due
to its low speed and high complexity, it should only be used in those
rare situations when a programmer requires a much higher level of
precision than what <code>double</code> provides.</p>
</div>
<div class="paragraph">
<p>Java programmers are recommended to use <code>double</code> for general purpose
computing. The <code>float</code> type should only be used in special cases where
storage or speed are critical and accuracy is not. Because of its
greater accuracy, <code>double</code> is considered a broader type than <code>float</code>.
You can store <code>float</code> values in a <code>double</code> without losing precision, but
the reverse is not true.</p>
</div>
<div class="paragraph">
<p>All floating point literals in Java have type <code>double</code> unless they have
an <code>f</code> or <code>F</code> appended on the end. Thus, <code>3.14</code> is a <code>double</code> literal,
but <code>3.14f</code> is a <code>float</code> literal.</p>
</div>
</div>
<div class="sect4">
<h5 id="_floating_point_output">Floating point output</h5>
<div class="paragraph">
<p>Formatting output for floating point numbers has an extra complication
compared to integers: How many digits after the decimal point should be
displayed? If you are representing money, it is common to show exactly
two digits after the decimal point. By default, all of the non-zero
digits are shown.</p>
</div>
<div class="paragraph">
<p>Instead of using <code>System.out.print()</code>, you can use <code>System.out.format()</code>
to control formatting. When using <code>System.out.format()</code>, the first
argument to the method is a <em>format string</em>, a piece of text that gives
all the text you want to output as well as special format specifiers
that indicate where other data is to appear and how it should be
formatted. This method takes an additional argument for each format
specifier you use. The specifier <code>%d</code> is for integer values, the
specifier <code>%f</code> is for floating point values (including both <code>float</code> and
<code>double</code> types), and the specifier <code>%s</code> is for text. Consider the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;%s! I broke %d records in %f seconds.\n&quot;</span><span class="tok-o">,</span>
    <span class="tok-s">&quot;Bob&quot;</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mf">2.4985</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of this code is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Bob</span><span class="tok-o">!</span> <span class="tok-n">I</span> <span class="tok-n">broke</span> <span class="tok-mi">3</span> <span class="tok-n">records</span> <span class="tok-n">in</span> <span class="tok-mf">2.4985</span> <span class="tok-n">seconds</span><span class="tok-o">.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This kind of output is based on the <code>printf()</code> function used for output
in the C programming language. It allows the programmer to have a
holistic picture of what the final output might look like, but it also
gives control of formatting through the format specifiers. For example,
you can choose the number of digits for a floating point value to
display after the decimal point by putting a <code>.</code> and the number between
the <code>%</code> and the <code>f</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;$%.2f\n&quot;</span><span class="tok-o">,</span> <span class="tok-mf">123.456789</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of this code is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">$123</span><span class="tok-mf">.46</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>rounding the last digit appropriately. To learn about other ways to use
format strings to manipulate output, read the documentation at
<a href="http://download.oracle.com/javase/7/docs/api/java/util/Formatter.html#syntax" class="bare">http://download.oracle.com/javase/7/docs/api/java/util/Formatter.html#syntax</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_basic_arithmetic">Basic arithmetic</h5>
<div class="paragraph">
<p>The following table lists the arithmetic operators available in Java.
All of these operators can be used on both the integer primitive types
and the floating point primitive types.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong>Operator</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>+</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>-</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtract</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>*</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiply</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>/</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Divide</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>%</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulus (remainder)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first four of these should be familiar to you. Addition,
subtraction, and multiplication work as you would expect, provided that
the result is within the range defined for the types you&#8217;re using, but
division is a little confusing. If you divide two integer values in
Java, you&#8217;ll get an integer as a result. If there would have been a
fractional part, it will be truncated, not rounded. Consider the
following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">1999</span><span class="tok-o">/</span><span class="tok-mi">1000</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In normal mathematics, 1,999 ÷ 1,000 = 1.999. In Java,
<code>1999/1000</code> yields <code>1</code>, and that&#8217;s what is stored in <code>x</code>. For floating
point numbers, Java works much more like normal mathematics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mf">1999.0</span><span class="tok-o">/</span><span class="tok-mf">1000.0</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>y</code> contains <code>1.999</code>. The literals <code>1999.0</code> and <code>1000.0</code>
have type <code>double</code>. The type of <code>y</code> does not affect the division, but it
had to be <code>double</code> to be a legal place to store the result.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Unexpected integer division</div>
<div class="paragraph">
<p>It&#8217;s easy to focus on the variable and forget about the types involved
in the operation. Consider the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-mi">1999</span><span class="tok-o">/</span><span class="tok-mi">1000</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because <code>z</code> has type <code>double</code>, it seems that the result of the division
should be <code>1.999</code>. However, the dividend and the divisor have type
<code>int</code>, and the result is <code>1</code>. This value is converted into <code>double</code> and
stored in <code>z</code> as <code>1.0</code>. This mistake is more commonly seen in the
following scenario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">half</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code looks fine at first, but <code>1/2</code> yields <code>0</code>. If the result is to
be stored in a <code>double</code> variable, it is better to multiply by <code>0.5</code>
instead of dividing by <code>2</code>.<br></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You may not have thought about this idea since elementary school, but
the division operator (<code>/</code>) finds the quotient of two numbers. The
modulus operator (<code>%</code>) finds the remainder. For example, <code>15 / 6</code> is
<code>2</code>, but <code>15 % 6</code> is <code>3</code> because <code>6</code> goes into <code>15</code> twice with <code>3</code> left
over. The modulus operator is usually used with integer values, but it
is also defined to work with floating point values in Java. It&#8217;s easy to
dismiss the modulus operator because we don&#8217;t often use it in daily
life, but it is incredibly useful in programming. On its face, it allows
us to see the remainder after division. This idea can be applied to see
if a number is even or odd. It can also be used to compress a large
range of random integers to a smaller range. Keep an eye out for it.
We&#8217;ll use it many times in this book.</p>
</div>
</div>
<div class="sect4">
<h5 id="_precedence">Precedence</h5>
<div class="paragraph">
<p>Although all the previous examples use only one mathematical operator,
you can combine several operators and operands into a larger expression
like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-o">((</span><span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">b</span><span class="tok-o">)</span> <span class="tok-o">*</span> <span class="tok-o">(</span><span class="tok-n">c</span> <span class="tok-o">+</span> <span class="tok-n">d</span><span class="tok-o">))</span> <span class="tok-o">%</span> <span class="tok-n">e</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Such expressions are evaluated from left to right, using the standard
order of operations: The <code>*</code> and <code>/</code> (and also <code>%</code>) operators are given
precedence over the <code>+</code> and <code>-</code> operators. Like in mathematics,
parentheses have the highest precedence and can be used to add clarity.
Thus, the order of evaluation of <code>a + b / c</code> is the same as
<code>a + (b / c)</code> but different from <code>(a + b) / c</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 33. Order of operations</div>
<div class="content">
<div class="paragraph">
<p>Consider the following lines of code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">31</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-mi">16</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">d</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">b</span> <span class="tok-o">+</span> <span class="tok-n">c</span> <span class="tok-o">*</span> <span class="tok-n">d</span> <span class="tok-o">-</span> <span class="tok-n">a</span> <span class="tok-o">/</span> <span class="tok-n">b</span> <span class="tok-o">/</span> <span class="tok-n">d</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What is the result? The first operation to be evaluated is <code>c * d</code>,
yielding <code>2</code>. The next is <code>a / b</code>, yielding <code>1</code>, which is then divided
by <code>d</code>, yielding <code>0</code>. Next <code>b + 2</code> gives <code>18</code>, and <code>18 - 0</code> is still
<code>18</code>. Thus, the value stored in <code>a</code> is <code>18</code>.</p>
</div>
<div class="paragraph">
<p>Your inner mathematician might be nervous that <code>a</code> is used in the
expression on the right side of the assignment and is also the variable
where the result is stored. This situation is very common in
programming. The value of <code>a</code> doesn&#8217;t change until after all the math
has been done. The assignment always happens last.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>All of the operators we have discussed so far are <em>binary</em> operators.
This use of the word &#8220;binary&#8221; has nothing to do with base 2. A binary
operator takes two things and does something, like adding them together.
A <em>unary</em> operator takes a single operand and does something. The <code>-</code>
operator can be used as a unary operator to negate a literal, variable,
or expression. A unary negation has a higher precedence than the other
operators, just like in mathematics. In other words, the variable or
expression will be negated before it is multiplied or divided. The <code>+</code>
operator can be used anywhere you would use a unary negation, although
it doesn&#8217;t actually do anything. Consider the following statements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-o">-</span> <span class="tok-mi">4</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-n">c</span> <span class="tok-o">+</span> <span class="tok-n">d</span> <span class="tok-o">/</span> <span class="tok-o">-(</span><span class="tok-n">e</span> <span class="tok-o">*</span> <span class="tok-n">f</span><span class="tok-o">);</span>
<span class="tok-kt">int</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-o">+</span><span class="tok-n">t</span> <span class="tok-o">+</span> <span class="tok-o">(-</span><span class="tok-n">r</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_shortcuts">Shortcuts</h5>
<div class="paragraph">
<p>Some operations happen frequently in Java. For example, increasing a
variable by some amount is a common task. If you want to increase the
value of variable <code>value</code> by 10, you can write the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span> <span class="tok-o">+</span> <span class="tok-mi">10</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Although the statement above is not excessively long, increasing a
variable is common enough that there&#8217;s shorthand for it. To achieve the
same effect, you can use the <code>+=</code> operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">value</span> <span class="tok-o">+=</span> <span class="tok-mi">10</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>+=</code> operator gets the value of the variable, in this case <code>value</code>,
adds whatever is on its right side, in this case <code>10</code>, and stores the
result back into the variable. Essentially, it saves you from writing
the name of the variable twice. And <code>+=</code> is not the only shortcut. It is
only one member of a family of shortcut operators that perform a binary
operation between the variable on the left side and the expression on
the right side and then store the value back into the variable. There is
a <code>-=</code> operator that decreases a variable, a <code>*=</code> operator that scales a
variable, and several others, including shortcuts for bitwise operations
we cover in the next subsection.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"><strong>Operator</strong></th>
<th class="tableblock halign-center valign-middle"><strong>Example</strong></th>
<th class="tableblock halign-center valign-middle"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>+=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a += b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a + b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>-=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a -= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a - b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>*=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a *= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a * b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>/=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a /= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a / b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>%=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a %= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a % b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>&amp;=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a &amp;= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a &amp; b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>^=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a ^= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a ^ b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>|=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a |= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a | b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>&lt;&lt;=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a &lt;&lt;= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a &lt;&lt; b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>&gt;&gt;=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a &gt;&gt;= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a &gt;&gt; b;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>&gt;&gt;&gt;=</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a &gt;&gt;&gt;= b;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a &gt;&gt;&gt; b;</pre></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These assignment shortcuts are useful and can make a line shorter and
easier to read.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Weak type checking with assignment shortcuts</div>
<div class="paragraph">
<p>Because you can lose precision, it is not allowed to store a <code>double</code>
value into an <code>int</code> variable. Thus, the following lines of code are
illegal and will not compile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-mf">0.1</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the check makes a lot of sense. If you were able to add
<code>0.1</code> to <code>0</code> and then store that value into an <code>int</code> variable, the
fractional part would be truncated, keeping <code>0</code> in the variable.
However, this safeguard against lost precision is not done with
assignment shortcuts. Even though we expect the following lines to be
functionally identical to the previous ones, they will compile (but
still do nothing).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-n">x</span> <span class="tok-o">+=</span> <span class="tok-mf">0.1</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This kind of error can cause problems when the program expects the value
of <code>x</code> to grow and eventually reach some level.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are also two unary shortcuts. Incrementing a value by one and
decrementing a value by one are such common operations that they get
their own special operators, <code>++</code> and <code>--</code>.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"><strong>Operator</strong></th>
<th class="tableblock halign-center valign-middle"><strong>Example</strong></th>
<th class="tableblock halign-center valign-middle"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>++</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a++;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a + 1;</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>--</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a--;</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>a = a - 1;</pre></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Using either an increment or decrement changes the value of a variable.
In all other cases, the use of an assignment operator is required to
change a variable. Even in the binary shortcuts given before, the
programmer is reminded that an assignment is occurring because the <code>=</code>
symbol is present.</p>
</div>
<div class="paragraph">
<p>Both the increment and decrement operators come in prefix and postfix
flavors. You can write the <code>++</code> (or the <code>--</code>) in front of the variable
you are changing or behind it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-n">value</span><span class="tok-o">++;</span> <span class="tok-c1">//now value is 6</span>
<span class="tok-o">++</span><span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-c1">//now value is 7</span>
<span class="tok-n">value</span><span class="tok-o">--;</span> <span class="tok-c1">//value is 6 again</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When used in a line by itself, each flavor works exactly the same.
However, the incremented (or decremented) variable can also be used as
part of a larger expression. In a larger expression, the prefix form
increments (or decrements) the variable <strong>before</strong> the value is used in
the expression. Conversely, the postfix form gives back a copy of the
original value, effectively incrementing (or decrementing) the variable
<strong>after</strong> the value is used in the expression. Consider the following
example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">prefix</span> <span class="tok-o">=</span> <span class="tok-mi">7</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">prefixResult</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-o">+</span> <span class="tok-o">++</span><span class="tok-n">prefix</span><span class="tok-o">;</span>

<span class="tok-kt">int</span> <span class="tok-n">postfix</span> <span class="tok-o">=</span> <span class="tok-mi">7</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">postfixResult</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-o">+</span> <span class="tok-n">postfix</span><span class="tok-o">++;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the code is executed, the values of <code>prefix</code> and <code>postfix</code> are
both <code>8</code>. However, <code>prefixResult</code> is <code>13</code> while <code>postfixResult</code> is only
<code>12</code>. The original value of <code>postfix</code>, which is <code>7</code>, is added to <code>5</code>,
and then the increment operation happens afterwards.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Increment confusion</div>
<div class="paragraph">
<p>Incrementing a variable in Java is a very common operation. Expressions
like <code>i` and `i</code> pop up so often that it is easy to forget exactly
what they mean. Programmers occasionally forget that they are shorthand
for <code>i = i + 1</code> and begin to think of them as a fancy way to write
<code>i + 1</code>.</p>
</div>
<div class="paragraph">
<p>When confused, a programmer might write something like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">14</span><span class="tok-o">;</span>
<span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">++;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At first glance, it may appear that the second line of code really means
<code>i = i = i + 1</code>. Assigning <code>i</code> an extra time is pointless, but it does
no harm. However, remember that the postfix version gives back a copy of
the original value, before it has been incremented. In this case, <code>i</code>
will be incremented, but then its original value will be stored back
into itself. In the code given above, the final value of <code>i</code> is still
<code>14</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In general it is unwise to perform increment or decrement operations in
the middle of larger expressions, and we advise against doing so. In
some cases, code can be shortened by cleverly hiding an increment in the
middle of some other expression. However, when reading back over the
code, it always takes a moment to be sure that increment or decrement is
doing exactly what it should. The additional confusion caused by this
cleverness is not worth the line of code saved. Furthermore, the
compiler will translate the operations into exactly the same bytecode,
meaning that the shorter version is no more efficient than the longer
version.</p>
</div>
<div class="paragraph">
<p>Nevertheless, many programmers enjoy squeezing their code down to the
smallest number of lines of code possible. You may have to read code
that uses increments and decrements in clever (if obscure) ways, but you
should always strive to make your own code as readable as possible.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bitwise_operators_2">Bitwise operators</h5>
<div class="paragraph">
<p>In addition to normal mathematical operators, Java provides a set of
<em>bitwise</em> operators corresponding to the operations we discussed in
<a href="#_computer_basics">Chapter 1</a>. These operators perform bitwise
operations on integer values. The bitwise operators are <code>&amp;</code>, <code>|</code>, <code>^</code>,
and <code>~</code> (which is unary). In addition, there are bitwise <em>shift</em>
operators: <code>&lt;&lt;</code> for signed left shift, <code>&gt;&gt;</code> for signed right shift, and
<code>&gt;&gt;&gt;</code> for unsigned right shift. There is no unsigned left shift operator
in Java.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"><strong>Operator</strong></th>
<th class="tableblock halign-center valign-middle"><strong>Name</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>&amp;</pre></div></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Bitwise AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines two binary representations into a new
representation that has 1s in every position that both the original
representations have a 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>|</pre></div></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Bitwise OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines two binary representations into a new
representation that has 1s in every position that either of the original
representations have a 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>^</pre></div></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Bitwise XOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines two binary representations into a new
representation that has 1s in every position that the original
representations have different values</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>~</pre></div></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Bitwise NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a representation and creates a new
representation in which every bit is flipped from 0 to 1 and 1 to 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>&lt;&lt;</pre></div></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Signed left shift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moves all the bits the specified number of
positions to the left, shifting 0s into the rightmost bits</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>&gt;&gt;</pre></div></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Signed right shift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moves all the bits the specified number of
positions to the right, padding the left with copies of the sign bit</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>&gt;&gt;&gt;</pre></div></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Unsigned right shift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moves all the bits the specified number of
positions to the right, padding with 0s</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When used with <code>byte</code> and <code>short</code>, all bitwise operators will
automatically convert their operands to 32-bit <code>int</code> values. It is
crucial to remember this conversion since the number of bits used for
representation is a fundamental part of bitwise operators.</p>
</div>
<div class="paragraph">
<p>The following example shows these operators in use. In order to
understand the output, you need to understand how integers are
represented in the binary number system, which is discussed in
<a href="#_syntax_data_representation">Section 1.3</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.5">Exercise 3.5</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 34. Binary operators in Java</div>
<div class="content">
<div class="paragraph">
<p>The following code shows a sequence of bitwise operations performed with
the values <code>3</code> and <code>-7</code>. To understand the results, remember that, in
32-bit two&#8217;s complement representation, <code>3</code> =
<code>0000 0000 0000 0000 0000 0000 0000 0011</code> and <code>-7</code> =
<code>1111 1111 1111 1111 1111 1111 1111 1001</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mi">7</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">x</span> <span class="tok-o">&amp;</span> <span class="tok-n">y</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;x &amp; y\t= &quot;</span> <span class="tok-o">+</span> <span class="tok-n">z</span><span class="tok-o">);</span>
<span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">x</span> <span class="tok-o">|</span> <span class="tok-n">y</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;x | y\t= &quot;</span> <span class="tok-o">+</span> <span class="tok-n">z</span><span class="tok-o">);</span>
<span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">x</span> <span class="tok-o">^</span> <span class="tok-n">y</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;x ^ y\t= &quot;</span> <span class="tok-o">+</span> <span class="tok-n">z</span><span class="tok-o">);</span>
<span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">x</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;x &lt;&lt; 2\t= &quot;</span> <span class="tok-o">+</span> <span class="tok-n">z</span><span class="tok-o">);</span>
<span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">y</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;y &gt;&gt; 2\t= &quot;</span> <span class="tok-o">+</span> <span class="tok-n">z</span><span class="tok-o">);</span>
<span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">y</span> <span class="tok-o">&gt;&gt;&gt;</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;y &gt;&gt;&gt; 2\t= &quot;</span> <span class="tok-o">+</span> <span class="tok-n">z</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of this fragment of code is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">x</span> <span class="tok-o">&amp;</span> <span class="tok-n">y</span>   <span class="tok-o">=</span> <span class="tok-mi">1</span>
<span class="tok-n">x</span> <span class="tok-o">|</span> <span class="tok-n">y</span>   <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mi">5</span>
<span class="tok-n">x</span> <span class="tok-o">^</span> <span class="tok-n">y</span>   <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mi">6</span>
<span class="tok-n">x</span> <span class="tok-o">&lt;&lt;</span> <span class="tok-mi">2</span>  <span class="tok-o">=</span> <span class="tok-mi">12</span>
<span class="tok-n">y</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-mi">2</span>  <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mi">2</span>
<span class="tok-n">y</span> <span class="tok-o">&gt;&gt;&gt;</span> <span class="tok-mi">2</span> <span class="tok-o">=</span> <span class="tok-mi">1073741822</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the escape sequence <code>\t</code> is used to put a tab character in the
output, making the results line up.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Why use the bitwise operators at all? Sometimes you may read data as
individual <code>byte</code> values, and you might need to combine four of these
values into a single <code>int</code> value. Although the signed left shift (<code>&lt;&lt;</code>)
and signed right shift (<code>&gt;&gt;</code>) are, respectively, equivalent to repeated
multiplications by 2 or repeated divisions by 2, they are faster than
doing these operations over and over. Finally, some of these operations
are used for cryptographic or random number generation purposes.</p>
</div>
</div>
<div class="sect4">
<h5 id="castSection">Casting</h5>
<div class="paragraph">
<p>Sometimes you need to use different types (like integers and floating
point values) together. Other times, you have a value in one type, but
you need to store it in another (like when you are rounding a <code>double</code>
to the nearest <code>int</code>). Some combinations of operators and types are
allowed, but others cause compiler errors.</p>
</div>
<div class="paragraph">
<p>The guiding rule is that Java allows an assignment from one type to
another, provided that no precision is lost. That is, we can copy a
value of one type into a variable of another type, provided that the
destination variable has a broader type than the source value. The next
few examples illustrate how to convert between different numerical
types.</p>
</div>
<div class="exampleblock">
<div class="title">Example 35. Upcast with integers</div>
<div class="content">
<div class="paragraph">
<p>Consider the following statements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">short</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">341</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">x</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the type of <code>y</code> is <code>int</code>, which is broader than <code>short</code>, the
type of <code>x</code>, it is legal to assign the value in <code>x</code> to variable <code>y</code>. In
the assignment, a value with the narrower type <code>short</code> is converted to
an equivalent value with the broader type <code>int</code>. Converting from a
narrower type to a broader type is called an <em>upcast</em> or a <em>promotion</em>,
and Java allows it with no complaint. Most languages allow upcasts
without any special syntax because it is always safer to move from a
narrower, more restrictive type to a broader, less restrictive one.</p>
</div>
</div>
</div>
<div id="downcastErrorExample" class="exampleblock">
<div class="title">Example 36. Downcast error</div>
<div class="content">
<div class="paragraph">
<p>Consider these statements that declare variables <code>a</code>, <code>b</code>, and <code>c</code> and
compute a value for <code>c</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="tok-kt">byte</span> <span class="tok-n">c</span><span class="tok-o">;</span>
<span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">b</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you try compiling these statements as part of a Java program, you get
an error message like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nl">Error:</span> <span class="tok-n">possible</span> <span class="tok-n">loss</span> <span class="tok-n">of</span> <span class="tok-n">precision</span>
<span class="tok-nl">found:</span> <span class="tok-kt">int</span>
<span class="tok-nl">required:</span> <span class="tok-kt">byte</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The compiler generates the error above because the sum of two <code>int</code>
values is another <code>int</code> value, which could be greater than the maximum
value you can store in <code>c</code>, of type <code>byte</code>. In this example, <strong>you</strong> know
that the value of <code>12</code> does not exceed the maximum of <code>127</code>, but the
Java compiler is inherently cautious. It complains whenever the type of
the expression to be evaluated is broader than the type of the
destination variable.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.2">Exercise 3.2</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 37. Upcast from integers to floating point</div>
<div class="content">
<div class="paragraph">
<p>Integers are automatically converted to floating point when needed.
Consider the following statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">tolerance</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The literal <code>3</code> has type <code>int</code>, but it is automatically converted to the
floating point value <code>3.0</code> with type <code>double</code>. Again, <code>double</code> (and also
<code>float</code>) are considered broader types than any integer types.
Consequently, this type conversion is an upcast and is completely legal.</p>
</div>
<div class="paragraph">
<p>Upcasts also occur with arithmetic operations. Whenever you try to do
arithmetic with two different numerical types, the narrower type is
automatically upcast to the broader one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">3</span> <span class="tok-o">+</span> <span class="tok-mf">7.2</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this statement, <code>3</code> is automatically upcast to its <code>double</code> version
<code>3.0</code> because <code>7.2</code> has the broader <code>double</code> type.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In order to perform a downcast, the programmer has to mark that he or
she intends for the conversion to happen. A downcast is marked by
putting the result type in parentheses before the expression you want
converted. The next example illustrates how to cast a <code>double</code> value to
type <code>int</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 38. Downcast from double to int</div>
<div class="content">
<div class="paragraph">
<p>The following statements cause a compiler error because an expression
with type <code>double</code> cannot be stored into a variable with type <code>int</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">roomArea</span> <span class="tok-o">=</span> <span class="tok-mf">3.5</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">houseArea</span> <span class="tok-o">=</span> <span class="tok-n">roomArea</span> <span class="tok-o">*</span> <span class="tok-mf">4.0</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A downcast can lose precision, and that&#8217;s why Java doesn&#8217;t allow it.
Sometimes a downcast is necessary, and you can override Java&#8217;s type
system with an explicit cast. To do so, we put the expected (or desired)
result type in parentheses before the expression. In this case (and many
others), it is also necessary to surround the expression with
parentheses so that the entire expression (and not just <code>roomArea</code>) is
converted to type <code>int</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">roomArea</span> <span class="tok-o">=</span> <span class="tok-mf">3.5</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">houseArea</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)</span> <span class="tok-o">(</span><span class="tok-n">roomArea</span> <span class="tok-o">*</span> <span class="tok-mf">4.0</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the expression has value <code>14.0</code>. Consequently, the <code>int</code>
version is <code>14</code>. In general, the value could have a fractional part.
When casting from a floating point type to an integer type, the
fractional part is truncated <strong>not</strong> rounded. Consider the following
statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)</span> <span class="tok-mf">15.99999</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mathematically, it seems obvious that <code>15.99999</code> should be rounded to
the nearest <code>int</code> value of <code>16</code>, but Java does not do this. Instead, the
code above stores <code>15</code> into <code>count</code>. If you want to round the value,
Java provides a method for rounding in the <code>Math</code> class. The rounding
(instead of truncating) version is given below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">round</span><span class="tok-o">(</span><span class="tok-mf">15.99999</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value given back by <code>Math.round()</code> has type <code>long</code>. The designers of
the <code>Math</code> class did this so that the same method could be used to round
large <code>double</code> values into a <code>long</code> value, since the result might not
fit in an <code>int</code> value. Since <code>long</code> is a broader type than <code>int</code>, we
have to downcast the result to an <code>int</code> so that we can store it in
<code>count</code>.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.10">Exercise 3.10</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 39. Conversion from double to float</div>
<div class="content">
<div class="paragraph">
<p>Consider the following declaration and assignment of variable
<code>roomArea</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">float</span> <span class="tok-n">roomArea</span><span class="tok-o">;</span>
<span class="tok-n">roomArea</span> <span class="tok-o">=</span> <span class="tok-mf">2.0</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This assignment is illegal in Java, and the compiler gives an error
message like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nl">Error:</span> <span class="tok-n">possible</span> <span class="tok-n">loss</span> <span class="tok-n">of</span> <span class="tok-n">precision</span>
<span class="tok-nl">found:</span> <span class="tok-kt">double</span>
<span class="tok-nl">required:</span> <span class="tok-kt">float</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we mentioned earlier, the literal <code>2.0</code> has type <code>double</code>. When you
try to assign a <code>double</code> value to a <code>float</code> variable, there is always a
risk that precision will be lost. The best way to avoid the error above
is to declare <code>roomArea</code> with type <code>double</code>. Alternatively, we could
store the <code>float</code> literal <code>2.0f</code> into <code>roomArea</code>. We could also assign
<code>2</code> instead of <code>2.0</code> to <code>roomArea</code>, since the upcast from <code>int</code> is done
automatically.</p>
</div>
<div class="paragraph">
<p>Remember, you should almost always use the <code>double</code> type to represent
floating point numbers. Only in rare cases when you need to save memory
should you use <code>float</code> values. By making it illegal to store <code>2.0</code> into
a <code>float</code> variable, Java is encouraging you to use high precision
storage.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.3">Exercise 3.3</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Numerical types and the conversions between them are critical elements
of programming in Java, which has a strong mathematical foundation. In
addition to these numerical types, Java also provides two other types
that represent individual characters and Boolean values. We examine
these next.</p>
</div>
</div>
<div class="sect4">
<h5 id="_characters_code_char_code">Characters: <code>char</code></h5>
<div class="paragraph">
<p>Sentences are made up of words. Words are made up of letters. Although
we have discussed many powerful tools for representing numbers in Java,
we need a way to represent letters and other characters that we might
find in printed text. Values with the <code>char</code> type are used to represent
individual letters.</p>
</div>
<div class="paragraph">
<p>In the older languages of C and C++, the <code>char</code> type used 8 bits for
storage. From <a href="#_computer_basics">Chapter 1</a>, you know that you can
represent up to 2<sup>8</sup> = 256 values with 8 bits. The Latin
alphabet, which is used to write English, uses 26 letters. If we need to
represent upper and lower case letters, the 10 decimal digits,
punctuation marks, and quite a few other special symbols, 256 values is
plenty. However, people all over the world use computers and want to
store text from their language written in their script digitally. Taking
the Chinese character system alone, some Chinese dictionaries list over
100,000 characters!</p>
</div>
<div class="paragraph">
<p>Java uses a standard called the UTF-16 encoding to represent characters.
UTF-16 is part of a larger international standard called Unicode, which
is an attempt to represent most of the world&#8217;s writing systems as
numbers that can be stored digitally. Most of the inner workings of
Unicode aren&#8217;t important for day-to-day Java programming, but you can
visit <a href="http://www.unicode.org/" class="bare">http://www.unicode.org/</a> if you want more information.</p>
</div>
<div class="paragraph">
<p>In Java, each variable of type <code>char</code> uses 16 bits of storage.
Therefore, each character variable could assume any value from among a
total of 2<sup>16</sup> = 65,536 possibilities (although a few of
these are not legal characters). Here are a few declarations and
assignments of variables of type <code>char</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">char</span> <span class="tok-n">letter</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;A&#39;</span><span class="tok-o">;</span>
<span class="tok-kt">char</span> <span class="tok-n">punctuation</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;?&#39;</span><span class="tok-o">;</span>
<span class="tok-kt">char</span> <span class="tok-n">digit</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;7&#39;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are storing <code>char</code> literals into each of the variables above. Most of
the <code>char</code> literals you will use commonly are made by typing the single
character you want in <strong>single</strong> quotes (<code>'</code>), such a <code>'z'</code>. These
characters can be upper- or lowercase letters, single numerical digits,
or other symbols.</p>
</div>
<div class="paragraph">
<p>The space character literal is <code>' '</code>, but some characters are harder to
represent. For example, a new line (the equivalent of pressing
<code>&lt;enter&gt;</code>) is represented as a single character, but we can&#8217;t type a
single quote, hit <code>&lt;enter&gt;</code>, and then type the second quote. Instead,
the character to represent a new line is <code>'\n'</code>, which we will refer to
simply as a <em>newline</em>. Every <code>char</code> variable can only hold a single
character. It appears that <code>'\n'</code> has multiple characters in it, but it
does not. The use of the backslash (<code>\</code>) marks an <em>escape sequence</em>,
which is a combination of characters used to represent a specific
difficult to type or represent character. Here is a table of common
escape sequences.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong>Escape Sequence</strong></th>
<th class="tableblock halign-center valign-top"><strong>Character</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>\n</pre></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Newline</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>\t</pre></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Tab</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>\'</pre></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Single quote</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>\\</pre></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Backslash</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Remember, everything inside of a computer is represented with numbers,
and each <code>char</code> value has some numerical equivalent. These numbers are
arbitrary but systematic. For example, the character <code>'a'</code> has a
numerical value of <code>97</code>, and <code>'b'</code> has a numerical value of <code>98</code>. The
codes for all of the lowercase Latin letters are sequential in
alphabetical order. (The codes for uppercase letters are sequential too,
but there is a gap between them and the lowercase codes.)</p>
</div>
<div class="paragraph">
<p>Some Unicode characters are difficult to type because your keyboard or
operating system has no easy way to produce the character. Another kind
of escape sequence allows you to specify any character by its Unicode
value. There are large tables listing all possible Unicode characters by
numerical values. If you want to represent a specific literal, you type
<code>'\uxxxx'</code> where <code>xxxx</code> is a hexadecimal number representing the value.
For example, <code>'\u0064'</code> converted into decimal is
16 × 6 + 4 = 100, which is the letter <code>'d'</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 40. Printing single characters</div>
<div class="content">
<div class="paragraph">
<p>If you print a <code>char</code> variable or literal directly, it prints the
character representation on the screen. For example, the following
statement prints <code>A</code> not <code>65</code>, the Unicode value of <code>'A'</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-sc">&#39;A&#39;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the Unicode values <strong>are</strong> numbers. If you try to perform
arithmetic on them, Java will treat them like numbers. For example, the
following statement adds the integer equivalents of the characters
(65 + 66 = 131), concatenates the sum with the <code>String</code>
<code>"C"</code>, and concatenates the result with a <code>String</code> representation of the
<code>int</code> literal <code>999</code>. The final output is <code>131C999</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-sc">&#39;A&#39;</span> <span class="tok-o">+</span> <span class="tok-sc">&#39;B&#39;</span> <span class="tok-o">+</span> <span class="tok-s">&quot;C&quot;</span> <span class="tok-o">+</span> <span class="tok-mi">999</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_booleans_code_boolean_code">Booleans: <code>boolean</code></h5>
<div class="paragraph">
<p>If you are new to programming, it may seem useless to have a type
designed to hold only true and false values. These values are called
<em>Boolean values</em>, and the logic used to manipulate them turns out to be
crucial to almost every program. We use them to represent conditions in
<a href="#_selection">Chapter 4</a>, <a href="#_repetition">Chapter 5</a>, and beyond.</p>
</div>
<div class="paragraph">
<p>To store these truth values, Java uses the type <code>boolean</code>. There are
exactly two literals for type <code>boolean</code>: <code>true</code> and <code>false</code>. Here are
two declarations and assignments of <code>boolean</code> variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">awesome</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="tok-kt">boolean</span> <span class="tok-n">testFailed</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we could only store these two literals, <code>boolean</code> variables would
have limited usefulness. However, Java provides a full range of
<em>relational</em> operators that allow us to compare values. Each of these
operators generates a <code>boolean</code> result. For example, we can test to see
if two numbers are equal, and the answer is either <code>true</code> or <code>false</code>.
All Java relational operators are listed in the table below. Assume that
all variables used in the <strong>Example</strong> column have a numeric type.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong>Symbol</strong></th>
<th class="tableblock halign-left valign-top"><strong>Read as</strong></th>
<th class="tableblock halign-left valign-top"><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>==</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equal to</p></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>x + 3 == y * 2</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>!=</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not equal to</p></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>x !=  y / 4</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>&lt;</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than</p></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>x &lt; 3.5</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>&lt;=</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than or equal to</p></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>x &lt;= y</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>&gt;</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than</p></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>x &gt; y+1</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>&gt;=</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than or equal to</p></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>x + y &gt;= z</pre></div></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 41. Boolean variables</div>
<div class="content">
<div class="paragraph">
<p>The following declarations and assignments illustrate some uses of
<code>boolean</code> variables. Note the use of the relational operators <code>==</code> and
<code>&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-o">;</span>
<span class="tok-kt">boolean</span> <span class="tok-n">same</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">==</span> <span class="tok-mi">3</span><span class="tok-o">);</span>
<span class="tok-n">same</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">==</span> <span class="tok-n">y</span><span class="tok-o">);</span>
<span class="tok-kt">boolean</span> <span class="tok-n">xIsGreater</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">&gt;</span> <span class="tok-n">y</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the first use of <code>==</code> above, the value of <code>same</code> is <code>true</code> because
the value of <code>x</code> is <code>3</code>. In the second comparison, the value of <code>same</code>
is <code>false</code> because the values of <code>x</code> and <code>y</code> are different. The value of
<code>xIsGreater</code> is also <code>false</code> since the value of <code>x</code> is not greater than
the value of <code>y</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition to the relational operators, Java also provides <em>logical</em>
operators that can be used to combine or negate <code>boolean</code> values. These
are the logical AND (<code>&amp;&amp;</code>), logical OR (<code>||</code>), logical XOR (<code>^</code>), and
logical NOT (<code>!</code>) operators.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"><strong>Name</strong></th>
<th class="tableblock halign-center valign-middle"><strong>Operator</strong></th>
<th class="tableblock halign-left valign-middle"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">AND</p></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>&amp;&amp;</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if both values are <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">OR</p></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>||</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if either value is <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">XOR</p></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>^</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if values are different</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">NOT</p></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>!</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns the opposite of the value</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All of these operators, except for NOT, are binary operators. Logical
AND is used when you want your result to be <code>true</code> only if both the
operands being combined evaluate to <code>true</code>. Logical OR is used when you
want your result to be <code>true</code> if either operand is <code>true</code>. Logical XOR
is used when you want your result to be <code>true</code> if one but not both of
your operands is <code>true</code>. The unary logical NOT operator (<code>!</code>) results in
the opposite value of its operand, switching <code>true</code> to <code>false</code> or
<code>false</code> to <code>true</code>. Both the relational operators and the logical
operators are described in greater detail in
<a href="#_selection">Chapter 4</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reference_types">3.3.3. Reference types</h4>
<div class="paragraph">
<p>Now we will move on to reference types, which vastly outnumber the
primitive types, with new types created all the time. Nevertheless, the
primitive types in Java are important, partly because they are the
building blocks for reference types.</p>
</div>
<div class="paragraph">
<p>Recall that a variable with a reference type does not contain a concrete
value like a primitive variable. Instead, the value it holds is a
reference or arrow pointing to the &#8220;real&#8221; object. It&#8217;s like a name for
an object. When you declare a reference variable in Java, it starts off
pointing at nothing, represented by the special literal <code>null</code>. For
example, the following code creates a <code>Wombat</code> variable called <code>w</code>,
which doesn&#8217;t point at anything.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Wombat</span> <span class="tok-n">w</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To create an object in Java, you use the <code>new</code> keyword followed by the
name of the type and parentheses, which can either be empty or contain
data you want to use to initialize the object. This process is called
invoking the <em>constructor</em>, which creates space for the object and then
initializes it with the values you specify or with default values if you
leave the parentheses empty. Below we invoke the default <code>Wombat</code>
constructor and point the variable <code>w</code> at the resulting object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">w</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Wombat</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, the <code>Wombat</code> type might allow you to specify its mass in
kilograms when creating one, as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">w</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Wombat</span><span class="tok-o">(</span><span class="tok-mf">26.3</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Assignment of reference types points the two references to the same
object. Thus, we can have two different <code>Wombat</code> references pointing at
the same object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Wombat</span> <span class="tok-n">w1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Wombat</span><span class="tok-o">(</span><span class="tok-mf">26.3</span><span class="tok-o">);</span>
<span class="tok-n">Wombat</span> <span class="tok-n">w2</span> <span class="tok-o">=</span> <span class="tok-n">w1</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/03-strings-primitive-types/images/wombat.svg" alt="wombat" width="50%">
</div>
<div class="title">Figure 13. Two <code>Wombat</code> references pointing at the same object.</div>
</div>
<div class="paragraph">
<p>Then, anything we do to <code>w1</code> will affect <code>w2</code> and vice versa. For
example, we can tell <code>w1</code> to eat leaves using the <code>eatLeaves()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">w1</span><span class="tok-o">.</span><span class="tok-na">eatLeaves</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Perhaps this will increase the mass of the object that <code>w1</code> points at to
<code>26.9</code> kilograms. But the mass of the object that <code>w2</code> points at will be
increased as well, because they are the <strong>same object</strong>. Since primitive
variables hold values and not references to objects, this kind of code
works very differently with them. Consider the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-mi">5</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this code, <code>a</code> is initialized to have a value of <code>10</code> and <code>b</code> is
initialized to have whatever value <code>a</code> has, namely <code>10</code>. The third line
increases the value of <code>a</code> to <code>15</code>, but <code>b</code> is still <code>10</code>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/03-strings-primitive-types/images/primitive.svg" alt="primitive" width="25%">
</div>
<div class="title">Figure 14. Because they are primitive, <code>int</code> variables store values, not references.</div>
</div>
<div class="paragraph">
<p>Now that we&#8217;ve highlighted some of the differences between primitive and
reference types, we explain the <code>String</code> type more deeply. You use it
frequently, but it has a few unusual features that are not shared by any
other reference types.</p>
</div>
<div class="sect4">
<h5 id="_code_string_code_basics"><code>String</code> basics</h5>
<div class="paragraph">
<p>The <code>String</code> type is used to represent text in Java. A <code>String</code> object
contains a sequence of zero or more <code>char</code> values. Unlike every other
reference type, there is a literal form for <code>String</code> objects. These
literals are written with the text you want to represent inside of
double quotes (<code>"</code>), such as <code>"Fight the power!"</code>. You can declare a
<code>String</code> reference and initialize it by setting it equal to another
<code>String</code> reference or a <code>String</code> literal. Like any other reference, you
could leave it uninitialized.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.18">Exercise 3.18</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>There is a difference between an uninitialized <code>String</code> (a reference
that points to <code>null</code>) and a <code>String</code> of length 0. A <code>String</code> of length
0 is also known as an <em>empty string</em> and is written <code>""</code>. The space
character (<code>' '</code>) and escape sequences such as <code>'\n'</code> can be a part of
a <code>String</code> and add to its length. For example, <code>"ABC"</code> contains three
characters, but the <code>String</code> <code>"A B C"</code> has five, because the spaces on
each side of <code>'B'</code> count. The next example illustrates some ways of
defining and using the <code>String</code> type.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.17">Exercise 3.17</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 42. String assignment</div>
<div class="content">
<div class="paragraph">
<p>The following declarations define two <code>String</code> references named
<code>greeting</code> and <code>title</code> and initialize each with a literal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">greeting</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Bonjour!&quot;</span>
<span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;French Greeting&quot;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you have seen in <a href="#_problem_solving_and_programming">Chapter 2</a>,
<code>String</code> values can be output using <code>System.out.print()</code> and
<code>JOptionPane</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">greeting</span><span class="tok-o">);</span>
<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">greeting</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first statement above displays <code>Bonjour!</code> on the terminal. The
second statement creates a dialog box with the title <code>French Greeting</code>
and the message <code>Bonjour!</code></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_string_code_operations"><code>String</code> operations</h5>
<div class="paragraph">
<p>In <a href="#_problem_solving_and_programming">Chapter 2</a>, you saw that we
can <em>concatenate</em> two <code>String</code> objects into a third <code>String</code> object
using the <code>+</code> operator. This operator is unusual for a reference type.
Almost all other reference types are only able to use the assignment
operator (<code>=</code>) and the comparison operator (<code>==</code>). Like other reference
types, the <code>String</code> class provides methods for interaction. We introduce
a few <code>String</code> methods in this section and subsequent sections, but the
<code>String</code> class defines many more.</p>
</div>
<div class="exampleblock">
<div class="title">Example 43. String concatenation</div>
<div class="content">
<div class="paragraph">
<p>Here is another example of combining <code>String</code> objects using the <code>+</code>
operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">argument</span> <span class="tok-o">=</span> <span class="tok-s">&quot;the cannon&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">phrase</span> <span class="tok-o">=</span> <span class="tok-s">&quot;No argument but &quot;</span> <span class="tok-o">+</span> <span class="tok-n">argument</span> <span class="tok-o">+</span> <span class="tok-s">&quot;!&quot;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In these statements, we initialize <code>argument</code> to <code>"the cannon"</code>. We then
compute the value of <code>phrase</code> by adding, or concatenating, three
<code>String</code> values: <code>"No argument but "</code>, the value of <code>argument</code>, and
<code>"!"</code>. The result is <code>"No argument but the cannon!"</code>. If <code>argument</code> had
been initialized to <code>"a pie in the face"</code>, then <code>phrase</code> would point to
<code>"No argument but a pie in the face!"</code>.</p>
</div>
<div class="paragraph">
<p>Another way of concatenating two <code>String</code> objects is by using the
<code>String</code> <code>concat()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">argument</span> <span class="tok-o">=</span> <span class="tok-s">&quot;the cannon&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">exclamation</span> <span class="tok-o">=</span> <span class="tok-s">&quot;!&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">phraseStart</span> <span class="tok-o">=</span> <span class="tok-s">&quot;No argument but &quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">phrase</span> <span class="tok-o">=</span> <span class="tok-n">phraseStart</span><span class="tok-o">.</span><span class="tok-na">concat</span><span class="tok-o">(</span><span class="tok-n">argument</span><span class="tok-o">);</span>
<span class="tok-n">phrase</span> <span class="tok-o">=</span> <span class="tok-n">phrase</span><span class="tok-o">.</span><span class="tok-na">concat</span><span class="tok-o">(</span><span class="tok-n">exclamation</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This sequence of statements gives the same result as the one above it
using the <code>+</code> operator. In practice, the <code>concat()</code> method is rarely
used because the <code>+</code> operator is so convenient. Note that <code>String</code>
objects in Java are <em>immutable</em>, meaning that calling a method on a
<code>String</code> object will never change it. In the code above, calling
<code>concat()</code> creates new <code>String</code> objects. The <code>phrase</code> reference points
first at one <code>String</code> then it points at a new <code>String</code> on the next line.
In this case the <strong>reference</strong> can be changed, but a <code>String</code> <strong>object</strong>
never changes once it has been created. This distinction is a subtle but
important one.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A host of other methods can be used on a <code>String</code> just like <code>concat()</code>.
For example, the length of a <code>String</code> can be found using the <code>length()</code>
method. The following statements prints <code>30</code> to the terminal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">motto</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Fight for your right to party!&quot;</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">motto</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()):</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>String</code> literals are <code>String</code> objects as well, and you can call methods
on them. The following code stores <code>11</code> into <code>letters</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">letters</span> <span class="tok-o">=</span> <span class="tok-s">&quot;cellar door&quot;</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that a <code>String</code> is a sequence of <code>char</code> values. If you want to
find out what <code>char</code> is at a particular location within a <code>String</code>, you
can use the <code>charAt()</code> method.</p>
</div>
<div class="paragraph">
<p>This method is called with an <code>int</code> value giving the index you want to
know about. Indexes inside of a <code>String</code> start at 0, not at 1.
Zero-based numbering is used extensively in programming, and we discuss
it further in <a href="#_arrays">Chapter 6</a>. (It may help if you think of
the index as the number of characters that appear before the character
at the specified index.) The next example shows how <code>charAt()</code> can be
used.</p>
</div>
<div class="exampleblock">
<div class="title">Example 44. Examining the char value at an index</div>
<div class="content">
<div class="paragraph">
<p>To see what <code>char</code> is at a given location, we call <code>charAt()</code> with the
index in question, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">word</span> <span class="tok-o">=</span> <span class="tok-s">&quot;antidisestablishmentarianism&quot;</span><span class="tok-o">;</span>
<span class="tok-kt">char</span> <span class="tok-n">letter</span> <span class="tok-o">=</span> <span class="tok-n">word</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-mi">11</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>letter</code> is assigned the value <code>'b'</code>. Remember, indexes
for <code>char</code> values inside of a <code>String</code> start with 0. Thus, the <code>char</code> at
index 0 is <code>'a'</code>, the <code>char</code> at index 1 is <code>'n'</code>, the <code>char</code> at index 2
is <code>'t'</code>, and so on. If you count up to the twelfth <code>char</code> (which has
index 11), it should be <code>'b'</code>.</p>
</div>
<div class="paragraph">
<p>Every <code>char</code> inside of a <code>String</code> counts, whether it is a letter, a
digit, a space, punctuation, or some other symbol.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-s">&quot;^_^ l337 #haxor# skillz!&quot;</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code prints out <code>h</code> since <code>'h'</code> is the eleventh <code>char</code> (with index
10) in <code>text</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A contiguous sequence of characters inside of a <code>String</code> is called a
<em>substring</em>. For example, a few substrings of
<code>"Throw your hands in the air!"</code> are <code>"T"</code>, <code>"Throw"</code>, <code>"hands"</code>, and
<code>"ur ha"</code>. Note that <code>"Ty"</code> is not a substring because these characters
do not appear next to each other.</p>
</div>
<div class="paragraph">
<p>The <code>String</code> class provides the <code>indexOf()</code> method to find the position
of a substring, as shown in the next example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 45. String search</div>
<div class="content">
<div class="paragraph">
<p>Suppose we wish to find a <code>String</code> inside of another <code>String</code>. To do so,
we call the <code>indexOf()</code> method on the <code>String</code> we&#8217;re searching inside
of, with the <code>String</code> we&#8217;re searching for as the argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">countries</span> <span class="tok-o">=</span> <span class="tok-s">&quot;USA Mexico China Canada&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">search</span> <span class="tok-o">=</span> <span class="tok-s">&quot;China&quot;</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">countries</span><span class="tok-o">.</span><span class="tok-na">indexOf</span><span class="tok-o">(</span><span class="tok-n">search</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>indexOf()</code> method returns an <code>int</code> value that gives the position of
the <code>String</code> we&#8217;re searching for. In the code above, the output is <code>11</code>
because <code>"China"</code> appears starting at index 11 inside the <code>countries</code>
<code>String</code>. (Alternatively, there are 11 characters before <code>"China"</code> in
the <code>String</code>.) If the given substring cannot be found, the <code>indexOf()</code>
method returns <code>-1</code>. For example, <code>-1</code> will be printed to the terminal
if we replace the print statement above with the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">countries</span><span class="tok-o">.</span><span class="tok-na">indexOf</span><span class="tok-o">(</span><span class="tok-s">&quot;Honduras&quot;</span><span class="tok-o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are several other methods provided by <code>String</code> that we introduce
as the need arises. If you are curious, you should look into the Java
documentation for <code>String</code> at
<a href="http://download.oracle.com/javase/7/docs/api/java/lang/String.html" class="bare">http://download.oracle.com/javase/7/docs/api/java/lang/String.html</a> for a
complete list of available methods.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assignment_and_comparison">3.3.4. Assignment and comparison</h4>
<div class="paragraph">
<p>Both assigning one variable to another and testing two variables to see
if they are equal to each other are important operations in Java. These
operations are used on both primitive and reference types, but there are
subtle differences between the two that we discuss below.</p>
</div>
<div class="sect4">
<h5 id="_assignment_statements">Assignment statements</h5>
<div class="paragraph">
<p>Assignment is the act of setting one variable to the value of another.
With a primitive type, the value held inside one variable is copied to
the other. With a reference type, the arrow that points at the object is
copied. All types in Java perform assignment with the assignment
operator (<code>=</code>).</p>
</div>
<div class="paragraph">
<p>As we have discussed, values can be computed and then assigned to
variables as in the following statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, a statement that computes a value and assigns it is called an
<em>assignment statement</em>. The generic form of the assignment statement is
as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">identifier</span> <span class="tok-o">=</span> <span class="tok-n">expression</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>identifier</code> gives the name of some variable. For example, in the
statement above, <code>value</code> is the name of the variable.</p>
</div>
<div class="paragraph">
<p>The right-hand side of an assignment statement is an expression that
returns a value that is assigned to the variable on the left-hand side.
Even an assignment statement can be considered an expression, allowing
us to stack multiple assignments into one line, as in the following
code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">b</span><span class="tok-o">,</span> <span class="tok-n">c</span><span class="tok-o">;</span>
<span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-mi">15</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java compiler checks for type compatibility between the left and the
right sides of an assignment statement. If the right-hand side is a
broader type than the left-hand side (or is completely mismatched), the
compiler gives an error, as in the following cases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-mf">4.9</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-mi">9</span><span class="tok-o">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_comparison">Comparison</h5>
<div class="paragraph">
<p>Comparing two values to see if they are the same uses the comparison
operator (<code>==</code>) in Java. With primitive types, this kind of check is
intuitive: The comparison is <code>true</code>, if the two values are the same.
With reference types, the value held by the variable is the arrow
pointing to the object. Two reference variables could point to different
objects with identical contents and return <code>false</code> when compared to each
other. The following gives examples of these comparisons.</p>
</div>
<div class="exampleblock">
<div class="title">Example 46. Comparison</div>
<div class="content">
<div class="paragraph">
<p>Consider the following lines of code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">2</span> <span class="tok-o">+</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="tok-kt">boolean</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">==</span> <span class="tok-n">y</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of variable <code>z</code> is <code>true</code> because <code>x</code> and <code>y</code> contain the same
values. If <code>x</code> were assigned <code>6</code> instead, <code>z</code> would be <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Now, consider the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">thing1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">(</span><span class="tok-s">&quot;Magical mystery&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">thing2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">(</span><span class="tok-s">&quot;Magical mystery&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">thing3</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">(</span><span class="tok-s">&quot;Tragical tapestry&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div id="differentObjectsFigure" class="imageblock">
<div class="content">
<img src="chapters/03-strings-primitive-types/images/differentObjectsFigure.svg" alt="differentObjectsFigure" width="100%">
</div>
<div class="title">Figure 15. Objects <code>thing1</code>, <code>thing2</code>, and <code>thing3</code> (a) in their initial states and (b) after the assignment <code>thing1 = thing2;</code>.</div>
</div>
<div class="paragraph">
<p>This code declares and initializes three <code>String</code> values. Although it is
possible to store <code>String</code> literals directly without invoking a <code>String</code>
constructor, we are using this style of <code>String</code> creation to make our
point because Java can do some confusing optimizations otherwise.
Variables <code>thing1</code> and <code>thing2</code> point to <code>String</code> values that contain
identical sequences of characters. Variable <code>thing3</code> points to a
different <code>String</code>. Consider the following statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">same</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">thing1</span> <span class="tok-o">==</span> <span class="tok-n">thing3</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the value of <code>same</code> is clearly <code>false</code> because the two
<code>String</code> values are not the same. What about the following case?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">same</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">thing1</span> <span class="tok-o">==</span> <span class="tok-n">thing2</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, <code>same</code> contains <code>false</code>. Although, <code>thing1</code> and <code>thing2</code> point at
identical objects, they point at <strong>different</strong> identical objects. Since
the value held by a reference is the arrow that points to the object,
the comparison operator only shows that two references are the same if
they point at the same object.</p>
</div>
<div class="paragraph">
<p>To better understand comparison between reference types, consider
<a href="#differentObjectsFigure">Figure 15</a>(a), which shows three different
objects. Note that each reference points at a distinct object, even
though two objects have the same contents.</p>
</div>
<div class="paragraph">
<p>Now consider the following assignment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">thing1</span> <span class="tok-o">=</span> <span class="tok-n">thing2</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown in <a href="#differentObjectsFigure">Figure 15</a>(b), this assignment points
reference <code>thing1</code> to the same location as reference <code>thing2</code>. Then,
<code>(thing1 == thing2)</code> would be <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The <code>==</code> operator is generally not very useful with references, and the
<code>equals()</code> method should be used instead. This method compares the
contents of objects in whatever way the designer of the type specifies.
For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">thing1</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">thing2</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is <code>true</code> when <code>thing1</code> and <code>thing2</code> are pointing at distinct but
identical <code>String</code> objects.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.13">Exercise 3.13</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_constants">3.3.5. Constants</h4>
<div class="paragraph">
<p>In addition to normal variables, we can define <em>named constants</em>. A
named constant is similar to a variable of the same type except that its
value cannot be changed once set. A constant in Java is declared like
any other variable with the addition of the keyword <code>final</code> before the
declaration.</p>
</div>
<div class="paragraph">
<p>The convention in Java (and many other languages) is to name constants
with all capital letters. Because camel case can no longer be used to
tell where one word starts and another ends, an <em>underscore</em> (<code>_</code>) is
used to separate words. Here are a few examples of named constant
declarations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">POPULATION</span> <span class="tok-o">=</span> <span class="tok-mi">25000</span><span class="tok-o">;</span>
<span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">PLANCK_CONSTANT</span> <span class="tok-o">=</span> <span class="tok-mf">6.626E-34</span><span class="tok-o">;</span>
<span class="tok-kd">final</span> <span class="tok-kt">boolean</span> <span class="tok-n">FLAG</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="tok-kd">final</span> <span class="tok-kt">char</span> <span class="tok-n">FIRST_INITIAL</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;A&#39;</span><span class="tok-o">;</span>
<span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">MESSAGE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;All your base are belong to us.&quot;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this code, the value of <code>POPULATION</code> is <code>25000</code> and cannot be
changed. For example, if you now write <code>population = 30000;</code> on a later
line, your compiler will give an error. <code>PLANCK_CONSTANT</code>, <code>FLAG</code>,
<code>FIRST_INITIAL</code>, and <code>MESSAGE</code> are also defined as named constants.
Because of the syntax Java uses, these constants are sometimes referred
to as <em>final variables</em>.</p>
</div>
<div class="paragraph">
<p>In the case of <code>MESSAGE</code> and all other reference variables, being
<code>final</code> means that the reference can never point at a different object.
Even with a <code>final</code> reference, the objects themselves can change if
their methods allow it. (Since they are immutable, <code>String</code> objects can
never change.)</p>
</div>
<div class="paragraph">
<p>Named constants are useful in two ways. First, a well-named constant can
make your code more readable than using a literal. Second, if you do
need to change the value to a different constant, you only have to
change it in one place. For example, if you have used <code>25000</code> in five
different places in your program, changing it to <code>30000</code> requires five
changes. If you have used <code>POPULATION</code> throughout your program instead
of a literal, you only have to change it in one place.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_useful_libraries">3.4. Syntax: Useful libraries</h3>
<div class="paragraph">
<p>Computer software is difficult to write, but many of the same problems
come up over and over. If we had to solve these problems every time we
wrote a program, we&#8217;d never get anywhere. Java allows us to use code
other people have written called <em>libraries</em>. One selling point of Java
is its large standard library that can be used by any Java programmer
without special downloads. You have already used the <code>Scanner</code> class,
the <code>Math</code> class, and perhaps the <code>JOptionPane</code> class, which are all
part of libraries. Below, we&#8217;ll go deeper into the <code>Math</code> class and a
few other useful libraries.</p>
</div>
<div class="sect3">
<h4 id="_the_code_math_code_library">3.4.1. The <code>Math</code> library</h4>
<div class="paragraph">
<p>Basic arithmetic operators are useful, but Java also provides a rich set
of mathematical methods through the <code>Math</code> class.
The following table lists a few of the methods available. For a
complete list of methods provided by the <code>Math</code> class at the time of
writing, visit
<a href="http://download.oracle.com/javase/7/docs/api/java/lang/Math.html" class="bare">http://download.oracle.com/javase/7/docs/api/java/lang/Math.html</a>.</p>
</div>
<table class="tableblock frame-all grid-all center">
<caption class="title">Table 2. A sample of methods available in the Java <code>Math</code> class. Arguments to trigonometric methods are given in radians.</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"><strong>Method</strong></th>
<th class="tableblock halign-left valign-middle"><strong>Sample use</strong></th>
<th class="tableblock halign-left valign-middle"><strong>Purpose</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle" colspan="3"><p class="tableblock">Trigonometric functions</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>cos()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>double adjacent = hypotenuse * Math.cos(theta);</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Find the cosine of the argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>sin()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>double opposite = hypotenuse * Math.sin(theta);</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Find the sine of the argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>tan()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>double opposite = adjacent * Math.tan(theta);</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Find the tangent of the argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" colspan="3"><p class="tableblock">Exponentiation and logarithms</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>exp()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>double population = 250 * Math.exp(0.03 * time);</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Compute \(e^x\), where \(x\) is the
argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>log()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>double digits = Math.log(1000000);</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Compute the natural logarithm of the argument.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>pow()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>double money = principal * Math.pow(1.0 + rate, time);</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Compute \(a^b\), where \(a\) and \(b\)
are the first and second arguments.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" colspan="3"><p class="tableblock">Miscellaneous</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>random()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>double percent = Math.random();</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Generate a random number \(x\) where
\(0.0 \leq x &lt; 1.0\).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>round()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>long items = Math.round(material);</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Round to the nearest <code>long</code> (or nearest <code>int</code> when
rounding a <code>float</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>sqrt()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>double hypotenuse = Math.sqrt(a*a+b*b);</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Compute the square root of the argument.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 47. Math library usage</div>
<div class="content">
<div class="paragraph">
<p>Here is a program that uses the <code>Math.pow()</code> method to compute compound
interest. Unlike <code>Scanner</code> and <code>JOptionPane</code>, the <code>Math</code> class is
imported by default in Java programs and requires no explicit import
statement.</p>
</div>
<div id="CompoundInterestCalculatorProgram" class="listingblock">
<div class="title">Program 8. Computes interest earned and new balance.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">class</span> <span class="tok-nc">CompoundInterestCalculator</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>        <span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>    	<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Compound Interest Calculator&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>    	<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter starting balance: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>        <span class="tok-kt">double</span> <span class="tok-n">startingBalance</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">10 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter interest rate: &quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>        <span class="tok-kt">double</span> <span class="tok-n">rate</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">12 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter time in years: &quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>        <span class="tok-kt">double</span> <span class="tok-n">years</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">14 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter compounding frequency: &quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>        <span class="tok-kt">double</span> <span class="tok-n">frequency</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">16 </span>        <span class="tok-kt">double</span> <span class="tok-n">newBalance</span> <span class="tok-o">=</span> <span class="tok-n">startingBalance</span> <span class="tok-o">*</span>
<span class="lineno">17 </span>        	<span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">pow</span><span class="tok-o">(</span><span class="tok-mf">1.0</span> <span class="tok-o">+</span> <span class="tok-n">rate</span><span class="tok-o">/</span><span class="tok-n">frequency</span><span class="tok-o">,</span> <span class="tok-n">frequency</span><span class="tok-o">*</span><span class="tok-n">years</span><span class="tok-o">);</span>
<span class="lineno">18 </span>        <span class="tok-kt">double</span> <span class="tok-n">interest</span> <span class="tok-o">=</span> <span class="tok-n">newBalance</span> <span class="tok-o">-</span> <span class="tok-n">startingBalance</span><span class="tok-o">;</span>
<span class="lineno">19 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Interest earned: $&quot;</span> <span class="tok-o">+</span> <span class="tok-n">interest</span><span class="tok-o">);</span>
<span class="lineno">20 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;New balance: $&quot;</span> <span class="tok-o">+</span> <span class="tok-n">newBalance</span><span class="tok-o">);</span>
<span class="lineno">21 </span>    <span class="tok-o">}</span>
<span class="lineno">22 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition to methods, the <code>Math</code> library contains named constants
including Euler&#8217;s number \(e\) and \(\pi\). These
are written in code as <code>Math.E</code> and <code>Math.PI</code>, respectively. For
example, the following assignment statement computes the circumference
of a circle with radius given by the variable <code>radius</code>, using the
formula \(2\pi r\).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">circumference</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">PI</span><span class="tok-o">*</span><span class="tok-n">radius</span><span class="tok-o">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_random_numbers">3.4.2. Random numbers</h4>
<div class="paragraph">
<p>Random numbers are often needed in applications such as games and
scientific simulations. For example, card games require a random
distribution of cards. To simulate a deck of 52 cards, we could
associate an integer from 1 to 52 with each card. If we had a list of
these values, we could swap each value in the list with a value at a
random location later in the list. Doing so is equivalent to shuffling
the deck.</p>
</div>
<div class="paragraph">
<p>Java provides the <code>Random</code> class in package <code>java.util</code> to generate
random values. Before you can generate a random number with this class,
you need to create a <code>Random</code> object as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have created an object named <code>random</code> of type <code>Random</code>.
Depending on the kind of random value you need, you can use the
<code>nextInt()</code>, <code>nextBoolean()</code>, or <code>nextDouble()</code> to generate a random
value of the corresponding type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// Random integer with all values possible</span>
<span class="tok-kt">int</span> <span class="tok-n">balance</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>

<span class="tok-c1">// Random integer between 0 (inclusive) and 130 (exclusive)</span>
<span class="tok-kt">int</span> <span class="tok-n">humanAge</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">130</span><span class="tok-o">);</span>

<span class="tok-c1">// Random boolean value</span>
 <span class="tok-kt">boolean</span> <span class="tok-n">gender</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextBoolean</span><span class="tok-o">();</span>

<span class="tok-c1">// Random floating point value between 0.0 (inclusive)</span>
<span class="tok-c1">// and 1.0 (exclusive)</span>
<span class="tok-kt">double</span> <span class="tok-n">percent</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In these examples, <em>inclusive</em> means that the number could be generated,
while <em>exclusive</em> means that the number cannot be. Thus, the call
<code>random.nextInt(130)</code> generates the integers 0 through 129, but never
130. Exclusive upper bounds on ranges of random values are very common
in programming.</p>
</div>
<div class="paragraph">
<p>To generate a random <code>int</code> between values <code>a</code> and <code>b</code>, not including
<code>b</code>, use the following code, assuming you have a <code>Random</code> object named
<code>random</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-n">b</span> <span class="tok-o">-</span> <span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-n">a</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>nextInt()</code> method call generates a value between <code>0</code>
and <code>b - a</code>, and adding <code>a</code> shifts it into the
range from <code>a</code> up to (but not including) <code>b</code>.</p>
</div>
<div class="paragraph">
<p>Generating a random <code>double</code> between values <code>a</code> and <code>b</code> is similar
except that <code>nextDouble()</code> always generates a value between <code>0.0</code> and
<code>1.0</code>, not including <code>1.0</code>. Thus, you must scale the output by <code>b - a</code>
as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">()*(</span><span class="tok-n">b</span> <span class="tok-o">-</span> <span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-n">a</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates a potential use of random numbers in a
video game.</p>
</div>
<div class="exampleblock">
<div class="title">Example 48. Dragon attribute generation</div>
<div class="content">
<div class="paragraph">
<p>Suppose you are designing a video in which the hero must fight a dragon
with random attributes. <a href="#DragonAttributes">[DragonAttributes]</a> generates
random values for the age, height, gender, and hit points of the dragon.</p>
</div>
<div id="DragonAttributesProgram" class="listingblock">
<div class="title">Program 9. Sets attributes of a randomly generated dragon for a video game.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DragonAttributes</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>    	<span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{createRandomNumberGeneratorLine}@*/</span>
<span class="lineno"> 6 </span>        <span class="tok-kt">int</span> <span class="tok-n">age</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span><span class="tok-cm">/*@\label{generateAgeLine}@*/</span>
<span class="lineno"> 7 </span>        <span class="tok-kt">double</span> <span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">()*</span><span class="tok-mi">30</span><span class="tok-o">;</span><span class="tok-cm">/*@\label{generateHeightLine}@*/</span>
<span class="lineno"> 8 </span>        <span class="tok-kt">boolean</span> <span class="tok-n">gender</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextBoolean</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{generateStatusLine}@*/</span>
<span class="lineno"> 9 </span>        <span class="tok-kt">int</span> <span class="tok-n">hitPoints</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">51</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">25</span><span class="tok-o">;</span>
<span class="lineno">10 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Dragon Statistics&quot;</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{displayTurtleAttributesLine}@*/</span>
<span class="lineno">11 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Age:\t\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">age</span><span class="tok-o">);</span>
<span class="lineno">12 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;Height:\t\t%.1f feet\n&quot;</span><span class="tok-o">,</span> <span class="tok-n">height</span><span class="tok-o">);</span>
<span class="lineno">13 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Female:\t\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">gender</span><span class="tok-o">);</span>
<span class="lineno">14 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Hit points:\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">hitPoints</span><span class="tok-o">);</span>
<span class="lineno">15 </span>    <span class="tok-o">}</span>
<span class="lineno">16 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we begin by importing <code>java.util.*</code> to include all the classes
in the <code>java.util</code> package, including <code>Random</code>. At
line <a href="#createRandomNumberGeneratorLine">[createRandomNumberGeneratorLine]</a>, we create an object <code>random</code>
of type <code>Random</code>. At line <a href="#generateAgeLine">[generateAgeLine]</a>, we use it to generate a
random <code>int</code> between <code>0</code> and <code>99</code>, to which we add <code>1</code>, making an age
between <code>1</code> and <code>100</code>. To generate the height, we multiply a random
<code>double</code> by <code>75</code>, yielding a value between <code>0.0</code> and <code>75.0</code> (exclusive).
Since there are only two choices for a dragon&#8217;s gender, we generate a
random <code>boolean</code> value, interpreting <code>true</code> as female and <code>false</code> as
male. Finally, we determine the number of hit points the dragon has by
generating a random <code>int</code> between <code>0</code> and <code>50</code>, then add <code>25</code> to it,
yielding a value between <code>25</code> and <code>75</code>.</p>
</div>
<div class="paragraph">
<p>Because we are using random values, the output of
<a href="#DragonAttributesProgram">Program 9</a> changes every time we run the
program. Sample output is given below.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Dragon Statistics
Age:            90
Height:         13.7 feet
Female:         true
Hit points:     67</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you only need a random <code>double</code> value, you can generate a number
between <code>0.0</code> and <code>1.0</code> (exclusive) using the <code>Math.random()</code> method
from the <code>Math</code> class. This method is a quick and dirty way to generate
random numbers without importing <code>java.util.Random</code> or creating a
<code>Random</code> object.</p>
</div>
<div class="paragraph">
<p>The random numbers generated by the <code>Random</code> class and by
<code>Math.random()</code> are <em>pseudorandom</em> numbers, meaning that they are
generated by a mathematical formula instead of truly random events. Each
number is computed using the previous one, and the starting number is
determined using time information from the OS. For most purposes, these
pseudorandom numbers are good enough. Since each number can be predicted
from the previous one, pseudorandom numbers are insufficient for some
security applications. For those cases, Java provides the <code>SecureRandom</code>
class, which is slower than <code>Random</code> but produces random numbers that
are much harder to predict.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wrapper_classes">3.4.3. Wrapper classes</h4>
<div class="paragraph">
<p>Reference types have methods that allow a user to interact with them in
many useful ways. The primitive types (<code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>,
<code>float</code>, <code>double</code>, <code>char</code>, and <code>boolean</code>) do not have methods, but we
sometimes need to manipulate them with methods or store them in a place
that can only take a reference type.</p>
</div>
<div class="paragraph">
<p>To deal with such situations, Java uses <em>wrapper classes</em>, reference
types that correspond to each primitive type. Following Java conventions
for class names, the wrapper types all start with an uppercase letter
but are otherwise similar to the name of the primitive type they
support: <code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code>, <code>Float</code>, <code>Double</code>,
<code>Character</code>, and <code>Boolean</code>.</p>
</div>
<div class="sect4">
<h5 id="_code_string_code_to_numerical_conversions"><code>String</code> to numerical conversions</h5>
<div class="paragraph">
<p>A common task for a wrapper class is to convert a <code>String</code>
representation of a number such as <code>"37"</code> or <code>"2.097"</code> to its
corresponding numeric value. We had such a situation in
<a href="#GetInputGUIProgram">Program 3</a>, where we did the conversion as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">enterHeight</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span>
<span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">parseDouble</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code uses the <code>JOptionPane.showInputDialog()</code> method to get from
the user the height from which a ball is dropped. This method always
returns data as a <code>String</code>. In order for us to do computation with the
value, we need to convert it to a numeric type, such as an <code>int</code> or a
<code>double</code>. To do so, we use the appropriate <code>Byte.parseByte()</code>,
<code>Short.parseShort()</code>, <code>Integer.parseInt()</code>, <code>Long.parseLong()</code>,
<code>Float.parseFloat()</code>, or <code>Double.parseDouble()</code> method.</p>
</div>
<div class="paragraph">
<p>The following example shows conversions from a <code>String</code> to a number
using three of these methods.</p>
</div>
<div class="exampleblock">
<div class="title">Example 49. String to numeric conversion</div>
<div class="content">
<div class="paragraph">
<p>Consider the following statements that show how a string can be
converted to a numerical value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-s">&quot;15&quot;</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">text</span><span class="tok-o">);</span>
<span class="tok-kt">float</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">Float</span><span class="tok-o">.</span><span class="tok-na">parseFloat</span><span class="tok-o">(</span><span class="tok-n">text</span><span class="tok-o">);</span>
<span class="tok-kt">double</span> <span class="tok-n">tolerance</span> <span class="tok-o">=</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">parseDouble</span><span class="tok-o">(</span><span class="tok-n">text</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we declare a <code>String</code> object named <code>text</code> and
initialize it to <code>"15"</code>. Since <code>text</code> is a <code>String</code> and not a number,
arithmetic expressions such as <code>(text*29)</code> are illegal.</p>
</div>
<div class="paragraph">
<p>To use the <code>String</code> <code>"15"</code> in a numerical computation, we need to
convert it to a number. We used the <code>Integer.parseInt()</code>,
<code>Float.parseFloat()</code>, and <code>Double.parseDouble()</code> methods to convert the
<code>String</code> to <code>int</code>, <code>float</code>, and <code>double</code> values, respectively. Each
method gives us 15 stored as the appropriate type.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.19">Exercise 3.19</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>What happens if the <code>String</code> <code>"15.5"</code> (or even <code>"cinnamon"</code>) is given as
input to the <code>Integer.parseInt()</code> method? If the <code>String</code> is not
formatted as the appropriate kind of number, Java throws a
<code>NumberFormatException</code>, probably crashing the program. An <em>exception</em>
is an error that happens in the middle of running a program. We discuss
how to work with exceptions in <a href="#_exceptions">Chapter 12</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_code_character_code_methods"><code>Character</code> methods</h5>
<div class="paragraph">
<p>When working with <code>char</code> values, it can be useful to know whether a
particular value is a digit, a letter, or has a particular case. It may
also be useful to convert a <code>char</code> to upper or lower case. Here is a
partial list of the methods provided by the <code>Character</code> wrapper class to
do these tasks.<br></p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle"><strong>Method</strong></th>
<th class="tableblock halign-left valign-middle"><strong>Purpose</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>isDigit(char value)</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if <code>value</code> is a numerical digit
and <code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>isLetter(char value)</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if <code>value</code> is a letter and
<code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>isLetterOrDigit(char value)</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if <code>value</code> is a digit or
a letter and <code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>isLowerCase(char value)</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if <code>value</code> is a lower case
letter and <code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>isUpperCase(char value)</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if <code>value</code> is an upper case
letter and <code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>isWhitespace(char value)</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if <code>value</code> is a whitespace
character such as space, tab, or newline and <code>false</code> otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>toLowerCase(char value)</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns a lower case version of <code>value</code>,
with no change if it is not a letter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>toUpperCase(char value)</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns an upper case version of <code>value</code>,
with no change if it is not a letter.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, the variable <code>test</code> contains <code>true</code> after the following
code is executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">test</span> <span class="tok-o">=</span> <span class="tok-n">Character</span><span class="tok-o">.</span><span class="tok-na">isLetter</span><span class="tok-o">(</span><span class="tok-sc">&#39;x&#39;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the variable <code>letter</code> contains <code>'M'</code> after the following code is
executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">char</span> <span class="tok-n">letter</span> <span class="tok-o">=</span> <span class="tok-n">Character</span><span class="tok-o">.</span><span class="tok-na">toUpperCase</span><span class="tok-o">(</span><span class="tok-sc">&#39;m&#39;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These methods can be especially useful when processing input.</p>
</div>
</div>
<div class="sect4">
<h5 id="_maximum_and_minimum_values">Maximum and minimum values</h5>
<div class="paragraph">
<p>As you recall from <a href="#_computer_basics">Chapter 1</a>, integer
arithmetic in Java has limitations. If you increase a large positive
number past its maximum value, it becomes a large magnitude negative
number, a phenomenon called overflow. Conversely, if you decrease a
large magnitude negative number past its minimum value, it becomes a
large positive number, a phenomenon called underflow.</p>
</div>
<div class="paragraph">
<p>With floating point numbers, increasing their magnitudes past their
maximum values results in special values that Java reserves to represent
either positive or negative infinity, as the case may be. If a floating
point value gets too close to zero, it eventually rounds to zero.</p>
</div>
<div class="paragraph">
<p>In addition to useful conversion methods, the numerical wrapper classes
also have constants for the maximum and minimum values for each type.
Instead of trying to remember that the largest positive <code>int</code> value is
2,147,483,647, you can use the equivalent
<code>Integer.MAX_VALUE</code>.</p>
</div>
<div class="paragraph">
<p>The <code>MAX_VALUE</code> constants are always the largest positive number that
can be represented with the corresponding type. The <code>MIN_VALUE</code> is more
confusing. For integer types, it is the largest magnitude negative
number. For floating point types, it is the smallest positive non-zero
value that can be represented. Here is a table listing all these
constants.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle"><strong>Constant</strong></th>
<th class="tableblock halign-left valign-middle"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Byte.MAX_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Most positive value a <code>byte</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Byte.MIN_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Most negative value a <code>byte</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Short.MAX_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Most positive value a <code>short</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Short.MIN_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Most negative value a <code>short</code> value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Integer.MAX_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Most positive value an <code>int</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Integer.MIN_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Most negative value an <code>int</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Long.MAX_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Most positive value a <code>long</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Long.MIN_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Most negative value a <code>long</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Float.MAX_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Largest absolute value a <code>float</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Float.MIN_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Smallest absolute value a <code>float</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Double.MAX_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Largest absolute value a <code>double</code> value can have</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>Double.MIN_VALUE</pre></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Smallest absolute value a <code>double</code> value can have</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The wrap-around nature of integer arithmetic means that adding 1 to<br>
<code>Integer.MAX_VALUE</code> results in <code>Integer.MIN_VALUE</code>. Note that all
integer arithmetic in Java is done assuming type <code>int</code>, unless
explicitly specified otherwise. Thus, <code>Short.MAX_VALUE + 1</code> does not
overflow to a negative value unless you store the result into a <code>short</code>.
The same rules apply to underflow.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.6">Exercise 3.6</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Overflow and underflow do not work in the same way with the floating
point numbers represented by <code>float</code> and <code>double</code>. The expression
<code>Double.MAX_VALUE + 1</code> results in <code>Double.MAX_VALUE</code> because <code>1</code> is so
small in comparison that it is lost in rounding error. However,
<code>1.5*Double.MAX_VALUE</code> results in <code>Double.POSITIVE_INFINITY</code>, a
constant used to represent any value larger than <code>Double.MAX_VALUE</code>
Since <code>Double.MIN_VALUE</code> is the smallest non-zero number,
<code>Double.MIN_VALUE - 1</code> evaluates to <code>-1.0</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise3.7">Exercise 3.7</a><br>
<a href="#exercise3.8">Exercise 3.8</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_wrapper_classes_for_storage">Using wrapper classes for storage</h5>
<div class="paragraph">
<p>Wrapper classes in Java have a split personality. On the one hand, the
classes themselves can be used for the utility methods and constants we
have described above. However, <em>objects</em> of these same wrapper classes
can be used in an entirely separate way to store primitive values. Each
primitive type can be stored in its wrapper type as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Integer</span> <span class="tok-n">fingers</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Integer</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">);</span>
<span class="tok-n">Double</span> <span class="tok-n">pi</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Double</span><span class="tok-o">(</span><span class="tok-mf">3.141592</span><span class="tok-o">);</span>
<span class="tok-n">Character</span> <span class="tok-n">question</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Character</span><span class="tok-o">(</span><span class="tok-sc">&#39;?&#39;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Why would we want to do this? There are many situations in which a
library method or data structure requires a reference type, not a
primitive type. These wrappers were specially designed to handle these
cases when you have to treat a primitive type as an object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Object</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Integer</span><span class="tok-o">(</span><span class="tok-mi">42</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To make working with wrapper classes easier, Java 5 and higher support
automatic boxing and unboxing, meaning that primitive types will
automatically be converted to their wrapper types (and vice versa) when
appropriate. Thus, the earlier code could be written as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Integer</span> <span class="tok-n">fingers</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-n">Double</span> <span class="tok-n">pi</span> <span class="tok-o">=</span> <span class="tok-mf">3.141592</span><span class="tok-o">;</span>
<span class="tok-n">Character</span> <span class="tok-n">question</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;?&#39;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Programmers who do not understand wrapper classes will sometimes use
primitive types and wrapper classes interchangeably, mixing <code>double</code> and
<code>Double</code>, for example. You should avoid using wrapper classes whenever
possible, since it requires more memory and more computation to perform
operations with wrapper classes.</p>
</div>
<div class="paragraph">
<p>Fortunately, automatic boxing and unboxing reduces the need to think
about wrapper classes, and most programmers will rarely need to declare
an explicit wrapper reference. We will discuss wrapper classes further
in <a href="#_dynamic_data_structures">Chapter 18</a>, where they are used to
allow generic classes<em>generic class</em> to store primitive types as well
as reference types.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_college_cost_calculator">3.5. Solution: College cost calculator</h3>
<div class="paragraph">
<p>In this chapter, we have introduced and more fully explained many
aspects of manipulating data in Java, including declaring variables,
assigning values, performing simple arithmetic and more advanced math,
inputting and outputting data, and using the type system, which has
small differences for primitive and reference types. Our solution to the
college cost calculator problem posed at the beginning of the chapter
uses all of these features at some level.</p>
</div>
<div class="paragraph">
<p>We present this solution below. The first step in our solution is to
import <code>java.util.*</code> so that we can use the <code>Scanner</code> class. Then, we
start the enclosing <code>CollegeCosts</code> class, begin the <code>main()</code> method,
print a welcome message for the user, and create a <code>Scanner</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CollegeCosts</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span>
<span class="lineno">6 </span>			<span class="tok-s">&quot;Welcome to the College Cost Calculator!&quot;</span><span class="tok-o">);</span>
<span class="lineno">7 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next is a sequence of prompts to the user interspersed with input done
with the <code>Scanner</code> object. The program reads the user&#8217;s first name as a
<code>String</code>, the user&#8217;s last name as a <code>String</code>, the per-semester tuition
cost as a <code>double</code>, the monthly cost of rent as a <code>double</code>, the monthly
cost of food as a <code>double</code>, the interest rate for the loan as a
<code>double</code>, and the number of years needed to pay back the loan as an
<code>int</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter your first name:\t\t&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 2 </span>		<span class="tok-n">String</span> <span class="tok-n">firstName</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
<span class="lineno"> 3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter your last name:\t\t&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 4 </span>		<span class="tok-n">String</span> <span class="tok-n">lastName</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter tuition per semester:\t$&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-kt">double</span> <span class="tok-n">semesterTuition</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter rent per month:\t\t$&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">double</span> <span class="tok-n">monthlyRent</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter food cost per month:\t$&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-kt">double</span> <span class="tok-n">monthlyFood</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">11 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Annual interest rate:\t\t&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-kt">double</span> <span class="tok-n">annualInterest</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">13 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Years to pay back your loan:\t&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>		<span class="tok-kt">int</span> <span class="tok-n">years</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next segment of code completes the computations needed. First, it
finds the total yearly cost by doubling the semester cost, multiplying
the monthly rent and food costs by 12, and summing the answers together.
The four year cost is simply four times the yearly cost. To find the
monthly payment, we find the monthly interest by dividing the annual
interest rate by 12 and plugging this value into the formula from the
beginning of the chapter. Finally, the total cost of the loan is the
monthly payment times 12 times the number of years.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-kt">double</span> <span class="tok-n">yearlyCost</span> <span class="tok-o">=</span> <span class="tok-n">semesterTuition</span> <span class="tok-o">*</span> <span class="tok-mf">2.0</span> <span class="tok-o">+</span>
<span class="lineno">2 </span>			<span class="tok-o">(</span><span class="tok-n">monthlyRent</span> <span class="tok-o">+</span> <span class="tok-n">monthlyFood</span><span class="tok-o">)</span> <span class="tok-o">*</span> <span class="tok-mf">12.0</span><span class="tok-o">;</span>
<span class="lineno">3 </span>		<span class="tok-kt">double</span> <span class="tok-n">fourYearCost</span> <span class="tok-o">=</span> <span class="tok-n">yearlyCost</span> <span class="tok-o">*</span> <span class="tok-mf">4.0</span><span class="tok-o">;</span>
<span class="lineno">4 </span>		<span class="tok-kt">double</span> <span class="tok-n">monthlyInterest</span> <span class="tok-o">=</span> <span class="tok-n">annualInterest</span> <span class="tok-o">/</span> <span class="tok-mf">12.0</span><span class="tok-o">;</span>
<span class="lineno">5 </span>		<span class="tok-kt">double</span> <span class="tok-n">monthlyPayment</span> <span class="tok-o">=</span> <span class="tok-n">fourYearCost</span> <span class="tok-o">*</span> <span class="tok-n">monthlyInterest</span> <span class="tok-o">/</span>
<span class="lineno">6 </span>			<span class="tok-o">(</span><span class="tok-mf">1.0</span> <span class="tok-o">-</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">pow</span><span class="tok-o">(</span><span class="tok-mf">1.0</span> <span class="tok-o">+</span> <span class="tok-n">monthlyInterest</span><span class="tok-o">,</span>
<span class="lineno">7 </span>			<span class="tok-o">-</span><span class="tok-n">years</span> <span class="tok-o">*</span> <span class="tok-mf">12.0</span><span class="tok-o">));</span>
<span class="lineno">8 </span>		<span class="tok-kt">double</span> <span class="tok-n">totalLoanCost</span> <span class="tok-o">=</span> <span class="tok-n">monthlyPayment</span> <span class="tok-o">*</span> <span class="tok-mf">12.0</span> <span class="tok-o">*</span> <span class="tok-n">years</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All that remains is to print out the output. First, we output a header
describing the following output as college costs for the user. Using
<code>System.out.format()</code> as described in <a href="#_primitive_types">Section 3.3.2</a>, we print out the yearly cost, four year cost, monthly loan
payment, and total cost, all formatted with dollar signs, 2 places after
the decimal point, and tabs so that the output lines up.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;\nCollege costs for &quot;</span> <span class="tok-o">+</span>
<span class="lineno"> 2 </span>				<span class="tok-n">firstName</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">lastName</span> <span class="tok-o">);</span>
<span class="lineno"> 3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span>
<span class="lineno"> 4 </span>				<span class="tok-s">&quot;***************************************&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Yearly cost:\t\t\t$&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;%.2f\n&quot;</span><span class="tok-o">,</span> <span class="tok-n">yearlyCost</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Four year cost:\t\t\t$&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;%.2f\n&quot;</span><span class="tok-o">,</span> <span class="tok-n">fourYearCost</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Monthly loan payment:\t\t$&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;%.2f\n&quot;</span><span class="tok-o">,</span> <span class="tok-n">monthlyPayment</span><span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Total loan cost:\t\t$&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;%.2f\n&quot;</span><span class="tok-o">,</span> <span class="tok-n">totalLoanCost</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_expressions">3.6. Concurrency: Expressions</h3>
<div class="paragraph">
<p>In <a href="#_concurrency_solving_problems_in_parallel">Section 2.5</a>, we introduced
the ideas of task and domain decomposition that could be used to solve a
problem in parallel. By splitting up the jobs to be done (as in task
decomposition) or dividing a large amount of data into pieces (as in
domain decomposition), we can attack a problem with several workers and
finish the work more quickly.</p>
</div>
<div class="sect3">
<h4 id="_splitting_expressions">3.6.1. Splitting expressions</h4>
<div class="paragraph">
<p>Performing arithmetic is some of the only Java syntax we have introduced
that can be used to solve problems directly, but evaluating a single
mathematical expression usually does not warrant concurrency. If the
terms in the expression are themselves complex functions (such as
numerical integrations or simulations that produce answers), it might be
reasonable to evaluate these functions concurrently.</p>
</div>
<div class="paragraph">
<p>In this section, we will give an example of splitting an expression into
smaller sub-expressions that could be evaluated concurrently. The basic
steps underlying the concurrent evaluation of expressions are the
following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identify sub-expressions that are independent of each other.</p>
</li>
<li>
<p>Create a separate thread that evaluates each sub-expression.</p>
</li>
<li>
<p>Combine the results from each thread to obtain a final answer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While this sequence of steps looks simple, each step can be complex.
Worse, being careless at any step could result in a concurrent solution
that runs slower than the sequential solution or even gives the wrong
answer. The following example illustrates these steps.</p>
</div>
<div class="exampleblock">
<div class="title">Example 50. Split expression</div>
<div class="content">
<div class="paragraph">
<p>Consider the following statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">f</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">,</span><span class="tok-n">b</span><span class="tok-o">)*</span><span class="tok-n">g</span><span class="tok-o">(</span><span class="tok-n">c</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement evaluates methods <code>f()</code> and <code>g()</code>, multiplies the
computed values, and assigns the result to variable <code>value</code>. In
<a href="#splitExpressionFigure">Figure 16</a>, we show two ways of evaluating the
expression <code>f(a,b)*g(c)</code>. <a href="#splitExpressionFigure">Figure 16</a>(a) shows
sequential evaluation of the expression, where <code>f()</code> is computed, <code>g()</code>
follows, and then the two results are multiplied to get the final value.
<a href="#splitExpressionFigure">Figure 16</a>(b) shows evaluation of the expression
in which <code>f()</code> and <code>g()</code> are evaluated concurrently instead.</p>
</div>
<div id="splitExpressionFigure" class="imageblock">
<div class="content">
<img src="chapters/03-strings-primitive-types/images/splitExpressionFigure.svg" alt="splitExpressionFigure" width="100%">
</div>
<div class="title">Figure 16. Computation of <code>value = f(a,b)*g(c)</code> with (a) sequential and (b) concurrent approaches.</div>
</div>
<div class="paragraph">
<p>On a multicore processor, the computation of <code>f()</code> and <code>g()</code> could be
carried out on separate cores. We can create one thread for each method
and wait for the threads to complete. Upon completion, we can retrieve
the results of each computation and multiply them together as in
<a href="#splitExpressionFigure">Figure 16</a>(b). <a href="#SplitExpressionProgram">Program 10</a>
illustrates this concurrent approach.</p>
</div>
<div class="paragraph">
<p>In <a href="#SplitExpressionProgram">Program 10</a>, we create two objects named
<code>fThread</code> and <code>gThread</code> at lines <a href="#createFLine">[createFLine]</a> and <a href="#createGLine">[createGLine]</a>,
respectively. Both of these objects have types that extend the <code>Thread</code>
class, which means that they can be made to run independently. Object
<code>fThread</code> needs two arguments (<code>3.14</code> and <code>2.99</code> in this example), and
<code>gThread</code> needs one (<code>5.55</code>).</p>
</div>
<div id="SplitExpressionProgram" class="listingblock">
<div class="title">Program 10. Concurrent evaluation of an expression.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SplitExpression</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-n">ComputeF</span> <span class="tok-n">fThread</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ComputeF</span><span class="tok-o">(</span><span class="tok-mf">3.14</span><span class="tok-o">,</span> <span class="tok-mf">2.99</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{createFLine}@*/</span>
<span class="lineno"> 4 </span>        <span class="tok-n">ComputeG</span> <span class="tok-n">gThread</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ComputeG</span><span class="tok-o">(</span><span class="tok-mf">5.55</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{createGLine}@*/</span>
<span class="lineno"> 5 </span>        <span class="tok-n">fThread</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{startFComputationLine}@*/</span>
<span class="lineno"> 6 </span>        <span class="tok-n">gThread</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{startGComputationLine}@*/</span>
<span class="lineno"> 7 </span>        <span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>            <span class="tok-n">fThread</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>  <span class="tok-cm">/*@\label{waitForFToFiniLinesh}@*/</span>
<span class="lineno"> 9 </span>            <span class="tok-n">gThread</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span> <span class="tok-cm">/*@\label{waitForGToFiniLinesh}@*/</span>
<span class="lineno">10 </span>            <span class="tok-kt">double</span> <span class="tok-n">fResult</span> <span class="tok-o">=</span> <span class="tok-n">fThread</span><span class="tok-o">.</span><span class="tok-na">getResult</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{getResultFromFLine}@*/</span>
<span class="lineno">11 </span>            <span class="tok-kt">double</span> <span class="tok-n">gResult</span> <span class="tok-o">=</span> <span class="tok-n">gThread</span><span class="tok-o">.</span><span class="tok-na">getResult</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{getResultFroLineG}@*/</span>
<span class="lineno">12 </span>            <span class="tok-kt">double</span> <span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">fResult</span><span class="tok-o">*</span><span class="tok-n">gResult</span><span class="tok-o">;</span><span class="tok-cm">/*@\label{computeFinalValueLine}@*/</span>
<span class="lineno">13 </span>            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Result of f: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">fResult</span> <span class="tok-o">);</span>
<span class="lineno">14 </span>            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Result of g: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">gResult</span> <span class="tok-o">);</span>
<span class="lineno">15 </span>            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Final answer: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">answer</span><span class="tok-o">);</span>
<span class="lineno">16 </span>        <span class="tok-o">}</span>
<span class="lineno">17 </span>        <span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">18 </span>        	<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Computation interrupted!&quot;</span><span class="tok-o">);</span>
<span class="lineno">19 </span>        <span class="tok-o">}</span>
<span class="lineno">20 </span>    <span class="tok-o">}</span>
<span class="lineno">21 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the thread objects have been created, we start the threads at
lines <a href="#startFComputationLine">[startFComputationLine]</a> and <a href="#startGComputationLine">[startGComputationLine]</a>. Every
object whose type is <code>Thread</code> (or a child of <code>Thread</code>, which we will
discuss in <a href="#_inheritance">Chapter 11</a>) has a <code>start()</code> method which
begins its execution as a separate thread.</p>
</div>
<div class="paragraph">
<p>How do we know when a thread is done executing? Every <code>Thread</code> object
has a <code>join()</code> method. If some code calls a thread&#8217;s <code>join()</code> method,
the method will not return until the thread is finished. When code is
waiting for a thread to finish, it is possible for it to be interrupted
if some other thread has gotten tired of the code waiting around doing
nothing. If that happens, an <code>InterruptedException</code> is thrown.
Exceptions are the way that Java deals with errors and other unusual
situations. We will discuss them further in
<a href="#_exceptions">Chapter 12</a>, but, for now, you only need to know that
code (like the <code>join()</code> method) that can cause certain kinds of
exceptions (like the <code>InterruptedException</code>) needs to be enclosed in a
<code>try</code> block. After the <code>try</code> block comes a <code>catch</code> block that says what
to do in the even of that exception. In our case, we print out
<code>"Computation interrupted!"</code></p>
</div>
<div class="paragraph">
<p>Once the threads have completed their respective tasks, the execution of
<a href="#SplitExpressionProgram">Program 10</a> resumes at
line <a href="#getResultFromFLine">[getResultFromFLine]</a>, where we obtain the result of the
computation done by <code>fThread</code> by calling its <code>getResult()</code> method. On
the next line, we call the <code>getResult()</code> method on <code>gThread</code> to obtain
its result. Note that we could have called these <code>getResult()</code> methods
before the <code>join()</code> calls, but the computations might not have
completed, yielding invalid or incorrect results (or crashing the
program). Finally, at line <a href="#computeFinalValueLine">[computeFinalValueLine]</a>, these two computed
values are multiplied to get the final result, which is assigned to
<code>value</code> and printed.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>We would like to show how classes <code>ComputeF</code> and <code>ComputeG</code> are written,
but we will hold off since they use concepts relating to methods, class
design, and inheritance that we will cover in <a href="#_methods">Chapter 8</a>, <a href="#_classes">Chapter 9</a>, and <a href="#_inheritance">Chapter 11</a>.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t understand all the elements of
<a href="#SplitExpressionProgram">Program 10</a>, don&#8217;t despair. We&#8217;re trying to give
you an example of what concurrency looks like in Java, but you cannot be
expected to master all the details at this stage. However, concurrency
in Java will often follow the steps shown:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creation of <code>Thread</code> (or children of <code>Thread</code>) objects</p>
</li>
<li>
<p>Calling the <code>start()</code> method on these objects to start them
executing</p>
</li>
<li>
<p>Calling the <code>join()</code> method on them to wait for them to finish</p>
</li>
<li>
<p>Retrieving the results (if any) of the computations done by the
objects</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_care_in_splitting_expressions">3.6.2. Care in splitting expressions</h4>
<div class="paragraph">
<p>The above example illustrates how you could split an expression and
evaluate it concurrently. Note the following points when deciding
whether or not to use concurrency. First, your program will run faster
concurrently only if the work done is complex enough that its
computation takes significantly longer than the time to create the
necessary threads. In the example above, the methods <code>f()</code> and <code>g()</code>
must be complex enough that it takes a significant amount of time to
evaluate them. Otherwise, concurrency will not reduce the running time.
This aspect of speedup is explained in detail in
<a href="#_concurrent_programming">Chapter 13</a>.</p>
</div>
<div class="paragraph">
<p>Second, splitting an expression (or any complex sequence of
computations) is easy when its individual components are independent. If
they are interdependent, splitting requires care or subtle programming
errors can occur. Consider the expression <code>f(a)+g(b)</code> and suppose that
<code>f()</code> modifies the value of <code>b</code> during execution. Such a modification is
called a <em>side effect</em>. This side effect creates a dependency between
<code>f()</code> and <code>g()</code>. Concurrent execution of these two methods must be done
carefully, if it can be done at all. <a href="#_synchronization">Chapter 14</a>
discusses concurrency in the presence of dependencies.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_3">3.7. Summary</h3>
<div class="paragraph">
<p>In a strongly typed language such as Java, types are an important
concept. Every literal and variable in Java has a type, which specifies
the possible values items with that type could have and the operations
that can be done with them. Types are used to catch programming errors
at compile time.</p>
</div>
<div class="paragraph">
<p>Java has a small set of primitive types such as <code>int</code> and <code>double</code>,
which hold single values and use operators to manipulate them. Java also
has reference types, which use primitive types as building blocks, can
be created by any Java programmer, can contain arbitrarily complex data,
and are manipulated with methods. One of the most commonly used
reference types is <code>String</code>, which is used to store text of any length.</p>
</div>
<div class="paragraph">
<p>A number of library classes have been provided by the developers of
Java. Programs performing mathematical operations beyond simple
arithmetic may need to use methods from the <code>Math</code> class. Programs that
need to generate random numbers can use methods from the <code>Random</code> class.
Conversions and other useful manipulations of primitive types are
provided by wrapper classes.</p>
</div>
<div class="paragraph">
<p>We also gave a taste of the syntax for creating, running, and waiting
for the completion of threads. Such threads could be used to speed up
the evaluation of mathematical computations on multicore processors, but
only if the computations are long, complex, and not too interdependent.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_3">3.8. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise3.1"></a> What is the difference
between the set of integers from mathematics and the sets defined by
<code>int</code> and <code>long</code>?</p>
</li>
<li>
<p><a id="exercise3.2"></a> In <a href="#downcastErrorExample">Example 36</a>, the sum
of two <code>int</code> variables was another <code>int</code> value, which could not be
stored into a <code>byte</code> variable. Would this code have worked if variables
<code>a</code> and <code>b</code> had been declared with type <code>byte</code>? What if <code>a</code> was assigned
<code>121</code> and <code>b</code> was assigned <code>98</code>?</p>
</li>
<li>
<p><a id="exercise3.3"></a> The following three
statements are legal Java (if properly included inside of a method).
However, if we changed <code>2</code> to <code>2.0</code> or <code>5</code> to <code>5.0</code>, the statements
would not be legal. Explain why.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">float</span> <span class="tok-n">roomArea</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="tok-kt">float</span> <span class="tok-n">homeArea</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-kt">float</span> <span class="tok-n">area</span> <span class="tok-o">=</span> <span class="tok-n">roomArea</span> <span class="tok-o">*</span> <span class="tok-n">homeArea</span><span class="tok-o">;</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise3.4"></a> Consider the following variable
declarations.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mi">9</span><span class="tok-o">;</span>
<span class="tok-kt">float</span> <span class="tok-n">p</span> <span class="tok-o">=</span> <span class="tok-mf">3.99f</span><span class="tok-o">,</span> <span class="tok-n">q</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mf">9.89f</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">population1</span> <span class="tok-o">=</span> <span class="tok-mi">15000</span><span class="tok-o">,</span> <span class="tok-n">population2</span> <span class="tok-o">=</span> <span class="tok-mi">8000</span><span class="tok-o">;</span>
<span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">MAXIMUM_LEVEL</span> <span class="tok-o">=</span> <span class="tok-mi">350</span><span class="tok-o">;</span>
<span class="tok-kt">double</span> <span class="tok-n">limitPerCapita</span> <span class="tok-o">=</span> <span class="tok-mf">0.03</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">age</span> <span class="tok-o">=</span> <span class="tok-mi">14</span><span class="tok-o">;</span>
<span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">MAXIMUM_AGE</span> <span class="tok-o">=</span> <span class="tok-mi">23</span><span class="tok-o">;</span>
<span class="tok-kt">boolean</span> <span class="tok-n">allowed</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now evaluate each of the following expressions to <code>true</code> or <code>false</code>.
a.  <code>MAXIMUM_LEVEL/population1 &gt; limitPerCapita &amp;&amp;</code><br>
<code>MAXIMUM_LEVEL/population2 &lt; limitPerCapita</code>
b.  <code>MAXIMUM_LEVEL/population1 &gt; limitPerCapita ||</code><br>
<code>MAXIMUM_LEVEL/population2 &lt; limitPerCapita</code>
c.  <code>age &lt; MAXIMUM_AGE &amp;&amp; allowed</code>
d.  <code>(x &lt; y &amp;&amp; y &gt; z) || (p &gt; q &amp;&amp; population1 &lt; population2)</code></p>
</div>
</li>
<li>
<p><a id="exercise3.5"></a> Evaluate the following
expressions by hand and then check the results with a Java compiler.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>5 &amp; 6</code></p>
</li>
<li>
<p><code>5 | 6</code></p>
</li>
<li>
<p><code>5 ^ 6</code></p>
</li>
<li>
<p><code>~5</code></p>
</li>
<li>
<p><code>5 &gt;&gt; 2</code></p>
</li>
<li>
<p><code>5 &lt;&lt; 2</code></p>
</li>
<li>
<p><code>5 &gt;&gt;&gt; 2</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise3.6"></a> Evaluate the following
expressions by hand and then check the results with a Java compiler.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Byte.MIN_VALUE - 1</code></p>
</li>
<li>
<p><code>Byte.MAX_VALUE + 1</code></p>
</li>
<li>
<p><code>Integer.MIN_VALUE - 1</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise3.7"></a> Evaluate the following
expressions by hand and then check the results with a Java compiler.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Float.MAX_VALUE + 1</code></p>
</li>
<li>
<p><code>Double.MAX_VALUE - 1</code></p>
</li>
<li>
<p><code>-Double.MAX_VALUE - 1</code></p>
</li>
<li>
<p><code>-Double.MIN_VALUE - 1</code></p>
</li>
<li>
<p><code>-Double.MIN_VALUE + 1</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise3.8"></a> When evaluated in Java, the
expression <code>2*Double.MAX_VALUE</code> results in <code>Double.POSITIVE_INFINITY</code>
to indicate that the maximum representable value has been exceeded.
However, the expression <code>Double.MAX_VALUE + 1</code> results in
<code>Double.MAX_VALUE</code>. Why doesn&#8217;t the second case yield
<code>Double.POSITIVE_INFINITY</code> as well?</p>
</li>
<li>
<p><a id="exercise3.9"></a> Explain what is printed when the
following statements are executed.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-mi">15</span> <span class="tok-o">+</span> <span class="tok-mi">20</span><span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;15&quot;</span> <span class="tok-o">+</span> <span class="tok-mi">20</span><span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-mi">15</span> <span class="tok-o">+</span> <span class="tok-mi">20</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise3.10"></a> For each of the
following Java expressions, indicate the types of each value being used
and the type of the result when the expression is evaluated.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>3 + 4</code></p>
</li>
<li>
<p><code>3 + 4.0</code></p>
</li>
<li>
<p><code>3.0 + 4.0</code></p>
</li>
<li>
<p><code>3.0f + 4.0</code></p>
</li>
<li>
<p><code>(double)(3 + 4)</code></p>
</li>
<li>
<p><code>(double)(3.0 + 4.0)</code></p>
</li>
<li>
<p><code>Math.round(3 * 4.2)</code></p>
</li>
<li>
<p><code>Math.round(3.2 * 4.9)</code></p>
</li>
<li>
<p><code>Math.round(15.5 * 4.0)</code></p>
</li>
<li>
<p><code>(int)(15.5 * 4.0)</code></p>
</li>
<li>
<p><code>Math.round(3.154)</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise3.11"></a> For each of the
following expressions, determine the maximum amount of concurrency that
can be achieved. Using a diagram similar to
<a href="#splitExpressionFigure">Figure 16</a>(b), show how the computation of each
expression will proceed. Assume there are no side effects. Note that you
can create separate threads for multiple instances of method <code>f()</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>f(a) + f(b) + f(c)</code></p>
</li>
<li>
<p><code>f(a * g(b))</code></p>
</li>
<li>
<p><code>f(g(a)) + f(b) + f(c)</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise3.12"></a> Answer the following questions about
types, values, and references.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>What is the difference between a value and the type that the value
has?</p>
</li>
<li>
<p>In Java, the primitive type <code>int</code> represents a limited set of
integers, not the entire set of integers from mathematics. Why is this
the case? Why didn&#8217;t the designers of Java allow <code>int</code> to represent all
integers?</p>
</li>
<li>
<p>How are operations defined for reference types?</p>
</li>
<li>
<p>Explain the subtle difference between a reference and an object in
Java.</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise3.13"></a> Consider the following
declarations of three <code>Car</code> objects.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span> <span class="tok-n">Car</span> <span class="tok-n">car1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Car</span><span class="tok-o">(</span><span class="tok-s">&quot;Mercedes&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;C300 Sport&quot;</span><span class="tok-o">,</span> <span class="tok-mi">75000</span><span class="tok-o">);</span>
 <span class="tok-n">Car</span> <span class="tok-n">car2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Car</span><span class="tok-o">(</span><span class="tok-s">&quot;Pontiac&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Vibe&quot;</span><span class="tok-o">,</span> <span class="tok-mi">17000</span><span class="tok-o">);</span>
 <span class="tok-n">Car</span> <span class="tok-n">car3</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Car</span><span class="tok-o">(</span><span class="tok-s">&quot;Mercedes&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;C300 Sport&quot;</span><span class="tok-o">,</span> <span class="tok-mi">75000</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let <code>same</code> be a variable of type <code>boolean</code>. What is the value of
variable <code>same</code> after each of the following statements? Assume that the
<code>equals()</code> method will return <code>true</code> if all of the attributes specified
by the constructors for the two objects are the same.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>same = (car1 == car2);</code></p>
</li>
<li>
<p><code>same = (car1 == car3);</code></p>
</li>
<li>
<p><code>same = car1.equals(car3);</code></p>
</li>
<li>
<p><code>car2 = car3;</code></p>
</li>
<li>
<p><code>same = (car2 == car1);</code></p>
</li>
<li>
<p><code>same = (car2 == car3);</code></p>
</li>
<li>
<p><code>same = car2.equals(car3);</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise3.14"></a> Characters <code>'a'</code> and <code>'A'</code> have Unicode values
<code>\u0061</code> and <code>\u0041</code>, respectively. Give the representation of these
two characters as 16-bit unsigned binary integers.</p>
</li>
<li>
<p><a id="exercise3.15"></a> Assuming that each character occupies 16
bits (two bytes) in memory and is coded using Unicode, use hexadecimal
numbers to show how the word <code>"Java"</code> will be represented in computer
memory. Unicode values for the Latin alphabet are the same as the values
for the older ASCII standard. You can find a listing of these values on
many websites such as <a href="http://www.asciitable.com/" class="bare">http://www.asciitable.com/</a>.</p>
</li>
<li>
<p><a id="exercise3.16"></a> What is the output from the following
sequence of statements?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">p</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Break it&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">q</span> <span class="tok-o">=</span> <span class="tok-s">&quot;down like this!&quot;</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">((</span><span class="tok-n">p</span> <span class="tok-o">+</span> <span class="tok-n">q</span><span class="tok-o">).</span><span class="tok-na">length</span><span class="tok-o">());</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise3.17"></a> What is the output from the
following sequence of statements? Note that <code>r</code> contains a single space
character.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">p</span> <span class="tok-o">=</span> <span class="tok-s">&quot;This is not a string.&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">q</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-s">&quot; &quot;</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">((</span><span class="tok-n">p</span> <span class="tok-o">+</span> <span class="tok-n">q</span> <span class="tok-o">+</span> <span class="tok-n">r</span><span class="tok-o">).</span><span class="tok-na">length</span><span class="tok-o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise3.18"></a> Try compiling the
following program and observe the error reported by the compiler.</p>
<div id="UninitializedStringProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UninitializedString</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	 <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>          <span class="tok-n">String</span> <span class="tok-n">greeting</span><span class="tok-o">;</span>
<span class="lineno">4 </span>          <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">greeting</span><span class="tok-o">);</span><span class="tok-cm">/*@ \label{uninitializedStringPrintout}@*/</span>
<span class="lineno">5 </span>    <span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now initialize the <code>greeting</code> object and rerun the program. Why does the
program compile now?</p>
</div>
</li>
<li>
<p><a id="exercise3.19"></a> Write a Java
program that prompts the user to enter the number of rooms in her home,
uses a <code>Scanner</code> object to read the input into an <code>int</code> variable named
<code>rooms</code>, and then outputs the value on the screen. If you compile and
execute your program and type in the value <code>3.5</code>, can you explain the
output you see?</p>
</li>
<li>
<p>Convert the college cost calculator solution given in
<a href="#_solution_college_cost_calculator">Section 3.5</a> to use <code>JOptionPane</code> methods for both input and output. Use the header giving
the user&#8217;s first and last name for the title of the output dialog and
omit the line of asterisks. If you put all the output in a single
<code>String</code> with a newline (<code>\n</code>) separating each line, the output will
display properly.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_selection">4. Selection</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Life is a sum of all your choices.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Albert Camus
</div>
</div>
<div class="sect2">
<h3 id="_problem_monty_hall_simulation">4.1. Problem: Monty Hall simulation</h3>
<div class="paragraph">
<p>There is a famous mathematical puzzle called the Monty Hall problem,
based on the television show <em>Let&#8217;s Make a Deal</em> hosted by the eponymous
Monty Hall. In this problem, you are presented with three doors. Two of
the three doors have junk behind them. One randomly selected door
conceals something like a pile of gold. If you can choose that door, you
win the gold. After you make an initial choice, Monty, who knows which
door the pile of gold is behind, will open one of the two other doors,
always picking a door with junk behind it. If you chose the gold door,
Monty will pick between the two junk doors randomly. After opening a
door, Monty gives you a chance to switch to the other unopened door. You
decide to switch or not, the appropriate door is opened, and you win
either junk or a pile of gold, depending on your luck.</p>
</div>
<div class="paragraph">
<p>As it turns out, it is always a better strategy to switch doors. If you
keep your initial choice, you will win the gold with probability
\(\frac{1}{3}\). However, if you switch doors, you will win
with probability \(\frac{2}{3}\). The problem is
counterintuitive and leads many people, including mathematicians and
people holding advanced degrees, to the incorrect answer.</p>
</div>
<div class="paragraph">
<p>Think about it this way: Suppose you could pick two doors to open, and
if the gold was behind either one of them, you would win. Clearly, your
probability of winning would be \(\frac{2}{3}\). Monty allows
you this option. Just pick the two doors you want and tell Monty the
third. He reveals one of your two initial doors as junk, and you switch
to the other one.</p>
</div>
<div class="paragraph">
<p>If you still aren&#8217;t convinced, that&#8217;s fine. Your goal is to write a
program that simulates the Monty Hall dilemma, allowing a user to guess
a door and then, potentially, switch. Once you have written the
simulation, you can choose to play repeatedly and see how well you do if
you switch.</p>
</div>
<div class="paragraph">
<p>A Monty Hall scenario has two significant features that distinguish it
from problems in previous chapters. First, randomness play a role.
Generating random numbers has become an important part of computer
science, and most languages provide programmers with tools for
generating random or nearly random numbers. Recall the <code>Random</code> class
from <a href="#_primitive_types_and_strings">Chapter 3</a>. With an object of
type <code>Random</code> called <code>random</code>, you can generate a random <code>int</code> between
<code>0</code> and <code>n - 1</code> by calling <code>random.nextInt(n)</code>.</p>
</div>
<div class="paragraph">
<p>The second and much more important feature of Java in the solution to
this problem is the element of choice. A random door is chosen to hide
gold, and the program must react appropriately. The user chooses a door,
and the program must carefully choose another door to open in response.
Finally, the user must decide whether or not he or she wants to switch
his or her choice. Inherent in this problem is the idea of <em>conditional
execution</em>. Every program from the previous chapter runs sequentially,
line by line. With conditional execution, only some of the code may be
executed, depending on input from the user or the values that random
numbers take. Previously, every program was deterministic, a series of
inevitable consequences. Now, that linear, one-thing-follows-another
paradigm has split into complex trees and webs of possible program
executions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_choosing_between_options">4.2. Concepts: Choosing between options</h3>
<div class="paragraph">
<p>Before we get to random numbers and the complex choices involved in the
Monty Hall problem, let&#8217;s talk about the simplified approach that most
programming languages take to conditional execution. When we come to a
point in a program where there is a choice to be made, we can think of
it as the question, &#8220;Do I want to perform this series of tasks?&#8221; Like
the classic game of 20 Questions, these questions in Java generally only
have two answers: &#8220;yes&#8221; or &#8220;no.&#8221; If the answer is &#8220;yes,&#8221; the
program completes Task A, otherwise it completes Task B. It is easier to
design programming languages that can handle yes-or-no questions than
any general question. If you have studied logic in the past, you have
probably run across <em>Boolean logic</em>. Boolean logic gives a set of rules,
similar to the rules of traditional algebra, that can be applied to a
system with only two values: true and false.</p>
</div>
<div class="sect3">
<h4 id="_simple_choices">4.2.1. Simple choices</h4>
<div class="paragraph">
<p>Because we want to build a system using only yes-or-no questions,
Boolean logic is a perfect fit for computer science. To conform with
other computer scientists, we try to think of conditions in terms of
true and false, instead of yes and no. Thus, we can begin to formulate
the kinds of choices we want to make:</p>
</div>
<div class="paragraph">
<p><em>If it is raining outside, then I will take my umbrella.</em></p>
</div>
<div class="paragraph">
<p>This statement is a very simple program, even though it is not one
executed by a computer. The person following this program asks herself,
&#8220;Is it raining today?&#8221; If the answer is &#8220;yes,&#8221; then she will take
her umbrella. We can abstract this idea a bit further by saying that
<em>raining outside</em> is a condition \(p\) and that <em>taking my
umbrella</em> is an action \(a\). In other words, if
\(p\) is true, then do \(a\). We have not specified
what is to be done if \(p\) is not true, although it is
assumed that the actor in this drama will not take an umbrella.</p>
</div>
<div class="paragraph">
<p>If we want to view \(p\) as a decision to make, we can specify
what happens if it is not true. For example, we could formulate another
choice:</p>
</div>
<div class="paragraph">
<p><em>If I have at least $50 in my pocket, then I will eat a lobster dinner,
otherwise I will eat fast food.</em></p>
</div>
<div class="paragraph">
<p>In this case, we let <em>having at least $50</em> be condition \(q\),
<em>eating a lobster dinner</em> be action \(b\), and <em>eating fast
food</em> be action \(c\). Now we have created a decision. If
\(q\) is true, the person will do action \(b\), but,
if it is false, she will do action \(c\).</p>
</div>
</div>
<div class="sect3">
<h4 id="_boolean_operations">4.2.2. Boolean operations</h4>
<div class="paragraph">
<p>Even by itself, the ability to pick between two options is powerful, but
we can augment this ability in a couple of ways. First, we don&#8217;t have to
rely on simple conditions. Using Boolean logic, we can make arbitrarily
complex conditions.</p>
</div>
<div class="paragraph">
<p><em>If I am bored, or it is late and I can&#8217;t sleep, then I will watch
television.</em></p>
</div>
<div class="paragraph">
<p>Someone following this program will watch television if he is bored or
if it is late and he also cannot sleep. We can break the condition into
three sub-conditions: <em>I am bored</em> is condition \(x\), <em>it is
late</em> is condition \(y\), and <em>I can&#8217;t sleep</em> is condition
\(z\). We have connected these three conditions together using
the words &#8220;and&#8221; and &#8220;or.&#8221; These two simple words represent powerful
concepts in Boolean logic, AND and OR. When two conditions are combined
with AND, the result is true only if both conditions are true. When two
conditions are combined with OR, the result is true if either of the
conditions is true.</p>
</div>
<div class="paragraph">
<p>We can create a table called a <em>truth table</em> to show all the possible
values certain conditions can take. We are going to use the symbol
\(\land\) to represent the concept of AND and the symbol
\(\lor\) to represent the concept of OR. We will also
abbreviate true to T and false to F.</p>
</div>
<div class="paragraph">
<p>Given a condition \(x\), a condition \(y\), and the condition made by \(x \land y\), this truth table shows all possible values. As stipulated, \(x \land y\) is true only when both \(x\) and \(y\) are true.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">\(x\)</th>
<th class="tableblock halign-center valign-top">\(y\)</th>
<th class="tableblock halign-center valign-top">\(x \land y\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This truth table gives all the values for \(x \lor y\). As you can see, \(x \lor y\) is true if \(x\) or \(y\) are true.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">\(x\)</th>
<th class="tableblock halign-center valign-top">\(y\)</th>
<th class="tableblock halign-center valign-top">\(x \lor y\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that there is confusion with the use of the word &#8220;or&#8221; in English.
Sometimes &#8220;or&#8221; is used in an exclusive sense to mean one or the other
but not both, as in, &#8220;Would you like lemonade or iced tea with your
meal?&#8221; In logic, this exclusive or exists as well and is called XOR.
This difference gives another reason for a formally structured language
like mathematics or Java to express ourselves precisely. When two
conditions are connected with XOR, the result is true if one or the
other but not both conditions are true. We use the symbol
\(\oplus\) to represent the XOR operation in the truth table
below.</p>
</div>
<div class="paragraph">
<p>This truth table gives all the values for \(x \oplus y\).</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">\(x\)</th>
<th class="tableblock halign-center valign-top">\(y\)</th>
<th class="tableblock halign-center valign-top">\(x \oplus y\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The operations AND, OR, and XOR are all binary operations like addition
and multiplication. They connect two conditions together to get a
result. There is a single unary operation in Boolean logic, the NOT
operator. A NOT simply reverses a condition. If a condition is true,
then NOT applied to that condition will yield false, and vice versa.</p>
</div>
<div class="paragraph">
<p>Here is a truth table for NOT, using the symbol \(\lnot\) to represent the NOT operation.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">\(x\)</th>
<th class="tableblock halign-center valign-top">\(\lnot x\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now that we have nailed down some notation for Boolean logic, we can
express the complicated expression that sent us down this path in the
first place. Recall that \(x\) is <em>I am bored</em>,
\(y\) is <em>it is late</em>, and \(z\) is <em>I can&#8217;t sleep</em>.
Let \(d\) be the action <em>I will watch television</em>. We can
express the choice in this way: If \(x \lor (y \land z)\),
then do \(d\). Using this notation, we have expressed
precisely the conditions for watching television, using parentheses to
clear up the ambiguity present in the original statement. If we can map
individual conditions to Boolean variables, we can build conditions of
arbitrary complexity.</p>
</div>
</div>
<div class="sect3">
<h4 id="_nested_choices">4.2.3. Nested choices</h4>
<div class="paragraph">
<p>Making one choice is all well and good, but in life and computer
programs, we may have to make many interrelated choices. For example, if
you choose to eat at a seafood restaurant, then you might choose between
eating shrimp and lobster, but, if you choose instead to eat at a
steakhouse, the options of shrimp and lobster might not be available.</p>
</div>
<div class="paragraph">
<p>A <em>nested</em> choice is one that sits inside of another choice you have
already made. We could describe choices of restaurant and meal as
follows.</p>
</div>
<div class="paragraph">
<p><em>If I want seafood, then I will eat at Sharky&#8217;s, otherwise I will eat at
the Golden Calf. When dining at Sharky&#8217;s, if I have at least $50, I will
order the lobster, otherwise I will order the shrimp. When dining at the
Golden Calf, if I have at least $30, I will order the filet mignon,
otherwise I will order the pork chops.</em></p>
</div>
<div class="paragraph">
<p>The previous description is long, but it precisely expresses the
decisions our imaginary diner might make. This description in English
has drawbacks: It is long and repetitive, and the grouping of specific
meal choices with specific restaurants is not clear.</p>
</div>
<div class="paragraph">
<p>In the next section, we discuss the Java syntax that allows us to
express the same sorts of decision patterns. Unlike English, Java has
been designed to make these sequences of decisions clear and easy to
read.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_selection_in_java">4.3. Syntax: Selection in Java</h3>
<div class="paragraph">
<p>With some theoretical background on the kinds of choices we are
interested in making, we are going to discuss the Java syntax used to
describe these choices. It was no accident that we kept repeating the
word &#8220;if,&#8221; because the main Java language feature for making choices
is called an <code>if</code> statement.</p>
</div>
<div class="sect3">
<h4 id="_code_if_code_statements">4.3.1. <code>if</code> statements</h4>
<div class="paragraph">
<p>The designers of Java studied Boolean logic and created a type called
<code>boolean</code>. Every condition used by an <code>if</code> statement must evaluate to a
<code>boolean</code> value, which can only be one of two things: <code>true</code> or <code>false</code>.</p>
</div>
<div class="paragraph">
<p>For example, we could have a <code>boolean</code> variable called <code>raining</code>. Stored
in this variable is the value <code>true</code> if it is raining and <code>false</code> if it
isn&#8217;t. Using Java syntax, we could encode our first example in which our
actor takes her umbrella if it is raining.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">raining</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">umbrella</span><span class="tok-o">.</span><span class="tok-na">take</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The action taken if it is raining is done by calling a <em>method</em> on an
<em>object</em>. We&#8217;ll discuss objects and methods further in
<a href="#_methods">Chapter 8</a> and <a href="#_classes">Chapter 9</a>. What we&#8217;re
focusing on now is that the line <code>umbrella.take();</code> is executed only if
<code>raining</code> has the value <code>true</code>. Nothing is done if it is <code>false</code>.
<a href="#figure-if">Figure 17</a> shows this pattern of conditional execution
followed by all <code>if</code> statements.</p>
</div>
<div id="figure-if" class="imageblock text-center">
<div class="content">
<img src="chapters/04-selection/images/if.svg" alt="if" width="50%">
</div>
<div class="title">Figure 17. Execution goes inside the <code>if</code> statement when its condition is <code>true</code> and skips past it otherwise.</div>
</div>
<div class="paragraph">
<p>Our descriptions of logical scenarios from the previous section used the
word &#8220;then&#8221; to mark the actions that would be done if a condition was
true. Some languages use <code>then</code> as a keyword, but Java does not.
Instead, note the left brace (<code>\{</code>) and the right brace (<code>\}</code>) that
enclose the executable line <code>umbrella.take();</code>. These braces serve the
same role as the word &#8220;then,&#8221; clearly marking the action to be
performed if a condition is true. Braces are unambiguous because they
mark a start and an end. If there are many actions to be done, they can
all be put inside the braces, and there will be no question as to which
actions are associated with a given <code>if</code> statement.</p>
</div>
<div class="paragraph">
<p>For example, we may also need to close the window and put on a raincoat
if it is raining. We might accomplish these tasks in Java as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">raining</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">umbrella</span><span class="tok-o">.</span><span class="tok-na">take</span><span class="tok-o">();</span>
    <span class="tok-n">window</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
    <span class="tok-n">raincoat</span><span class="tok-o">.</span><span class="tok-na">putOn</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Within a matching pair of braces (<code>{ }</code>), called a <em>block</em> of code,
execution proceeds normally, line by line. First, the JVM will cause the
umbrella to be taken, then the window to be closed, and finally the
raincoat to be put on.</p>
</div>
<div class="paragraph">
<p>If only a single line of code is contained within a block of code, the
braces can be left out. For example, many experienced Java programmers
would have written our first example as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">raining</span> <span class="tok-o">)</span>
    <span class="tok-n">umbrella</span><span class="tok-o">.</span><span class="tok-na">take</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For beginning Java programmers, however, it is a good idea to use braces
even when you don&#8217;t need to. Without braces, code can appear to be doing
one thing when it really is doing another.</p>
</div>
<div class="paragraph">
<p>Since programmers must often choose between two alternatives, Java
provides an <code>else</code> statement to specify code that should be run if the
condition of the <code>if</code> statement is false.</p>
</div>
<div class="paragraph">
<p>Let <code>fiftyDollars</code> be a <code>boolean</code> variable that is <code>true</code> if we have at
least $50 and is <code>false</code> otherwise. Now, we can choose between two
dining options based on how much money we have.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">fiftyDollars</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">lobsterDinner</span><span class="tok-o">.</span><span class="tok-na">eat</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-k">else</span> <span class="tok-o">{</span>
    <span class="tok-n">fastFood</span><span class="tok-o">.</span><span class="tok-na">eat</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This Java code matches the logical statements we wrote before. If we
have enough money, we&#8217;ll eat a lobster dinner, otherwise, we&#8217;ll eat fast
food. As with an <code>if</code> statement, we use braces to mark a block of code
for an <code>else</code> statement, too. Since a single line of code will be
executed in each case, the braces are optional here. We could have
written code with the same functionality as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">fiftyDollars</span> <span class="tok-o">)</span>
    <span class="tok-n">lobsterDinner</span><span class="tok-o">.</span><span class="tok-na">eat</span><span class="tok-o">();</span>
<span class="tok-k">else</span>
    <span class="tok-n">fastFood</span><span class="tok-o">.</span><span class="tok-na">eat</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#figure-else">Figure 18</a> shows the pattern of conditional execution
followed by all <code>if</code> statements that have a matching <code>else</code> statement.</p>
</div>
<div id="figure-else" class="imageblock text-center">
<div class="content">
<img src="chapters/04-selection/images/else.svg" alt="else" width="50%">
</div>
<div class="title">Figure 18. Execution goes inside the <code>if</code> statement when its condition is <code>true</code> and jumps into the <code>else</code> statement otherwise.</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Misleading indentation</div>
<div class="paragraph">
<p>Indentation is used to make the code more readable, but Java ignores
whitespace, meaning that the indentation has no effect on the execution
of the code. To demonstrate, let&#8217;s assume that our imaginary diner knows
he will get a stomachache after eating fast food. Thus, he will take
some Pepto-Bismol after eating it. If you modified the code above, which
does not contain braces, you might get the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">fiftyDollars</span> <span class="tok-o">)</span>
    <span class="tok-n">lobsterDinner</span><span class="tok-o">.</span><span class="tok-na">eat</span><span class="tok-o">();</span>
<span class="tok-k">else</span>
    <span class="tok-n">fastFood</span><span class="tok-o">.</span><span class="tok-na">eat</span><span class="tok-o">();</span>
    <span class="tok-n">peptoBismol</span><span class="tok-o">.</span><span class="tok-na">take</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Although it looks like both <code>fastFood.eat();</code> and <code>peptoBismol.take();</code>
are within the block of the <code>else</code> statement, only <code>fastFood.eat();</code> is.
The line <code>peptoBismol.take();</code> is not part of the <code>if</code>-<code>else</code> structure
at all and will be executed no matter what. The correct way to program
this decision is below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">fiftyDollars</span> <span class="tok-o">)</span>
    <span class="tok-n">lobsterDinner</span><span class="tok-o">.</span><span class="tok-na">eat</span><span class="tok-o">();</span>
<span class="tok-k">else</span> <span class="tok-o">{</span>
    <span class="tok-n">fastFood</span><span class="tok-o">.</span><span class="tok-na">eat</span><span class="tok-o">();</span>
    <span class="tok-n">peptoBismol</span><span class="tok-o">.</span><span class="tok-na">take</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_the_code_boolean_code_type_and_its_operations">4.3.2. The <code>boolean</code> type and its operations</h4>
<div class="paragraph">
<p>Recall that Java uses the type <code>boolean</code> for values that can only be
true or false. Just like the numerical types <code>double</code> and <code>int</code>, the
<code>boolean</code> type has specific operations that can be used to combine them
together. By design, these operations correspond exactly to the logical
operations we described before. Here is a table giving the Java
operators that are equivalent to the logical Boolean operations.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-bottom">Name</th>
<th class="tableblock halign-center valign-bottom">Math<br>
Symbol</th>
<th class="tableblock halign-center valign-bottom">Java<br>
Operator</th>
<th class="tableblock halign-left valign-bottom">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">AND</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(\land\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>&amp;&amp;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if both values are <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">OR</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(\lor\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>||</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if either value is <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">XOR</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(\oplus\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns <code>true</code> if values are different</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">NOT</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(\lnot\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>!</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Returns the opposite of the value</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Using these operators, we can create <code>boolean</code> values and combine them
together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="tok-kt">boolean</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="tok-kt">boolean</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-o">!((</span><span class="tok-n">x</span> <span class="tok-o">||</span> <span class="tok-n">y</span><span class="tok-o">)</span> <span class="tok-o">^</span> <span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">y</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When this code is executed, the value of <code>z</code> will be <code>false</code>. Although
it is perfectly legal to perform <code>boolean</code> operations this way, it is
much more common to combine them &#8220;on the fly&#8221; inside of the condition
of an <code>if</code> statement. Recall the statement from the previous section:</p>
</div>
<div class="paragraph">
<p><em>If I am bored, or it is late and I can&#8217;t sleep, then I will watch
television.</em></p>
</div>
<div class="paragraph">
<p>If we let <code>bored</code>, <code>late</code>, and <code>canSleep</code> be <code>boolean</code> variables whose
values indicate if we are bored, if it is late, and if we can sleep,
respectively, we can encode this statement in Java like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">bored</span> <span class="tok-o">||</span> <span class="tok-o">(</span><span class="tok-n">late</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-n">canSleep</span><span class="tok-o">)</span> <span class="tok-o">)</span>
    <span class="tok-n">television</span><span class="tok-o">.</span><span class="tok-na">watch</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Combining the <code>||</code> operator with other <code>||</code> operators is both
commutative and associative: order and grouping doesn&#8217;t matter.
Likewise, combining the <code>&amp;&amp;</code> operator with other <code>&amp;&amp;</code> operators is
also commutative and associative. However, once you start mixing <code>||</code>
with <code>&amp;&amp;</code>, it is a good idea to use parentheses for grouping. If, in
the above example, <code>bored</code> is <code>true</code>, <code>late</code> is <code>false</code>, and <code>canSleep</code>
is <code>true</code>, then the expression <code>bored || (late &amp;&amp; !canSleep)</code> will be
<code>true</code>. However, with the same values, the expression
<code>bored || late &amp;&amp; !canSleep</code> will be <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Now that we are discussing ordering, it is important to note that <code>||</code>
and <code>&amp;&amp;</code> are <em>short circuit</em> operators. Short circuit means that, if
the value of the expression can be determined without evaluating the
rest of it, the JVM will not bother to compute any more of the
expression. With <code>||</code> this situation arises because <code>true</code> OR anything
else is still <code>true</code>. With <code>&amp;&amp;</code> this situations arises because <code>false</code>
AND anything else is still <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">||</span> <span class="tok-o">((</span><span class="tok-n">late</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-n">canSleep</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">isTired</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">isHungry</span><span class="tok-o">)</span> <span class="tok-o">||</span>
    <span class="tok-o">(</span><span class="tok-n">wantsToFindOutWhatHappensNextInHisFavoriteShow</span> <span class="tok-o">||</span>
    <span class="tok-n">likesTV</span> <span class="tok-o">))</span> <span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The condition of this <code>if</code> statement will always evaluate to <code>true</code> and
its body will always be executed. Because Java knows this, it will not
even bother to execute any of the code after the first <code>||</code> operator.
This short circuit evaluation is done at run time and will work if the
value of a variable at the beginning of an OR clause is <code>true</code>. It need
not be the literal <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-kc">false</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">((</span><span class="tok-n">late</span> <span class="tok-o">||</span> <span class="tok-o">!</span><span class="tok-n">canSleep</span> <span class="tok-o">||</span> <span class="tok-n">isTired</span> <span class="tok-o">||</span> <span class="tok-n">isHungry</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span>
    <span class="tok-o">(</span><span class="tok-n">wantsToFindOutWhatHappensNextInHisFavoriteShow</span> <span class="tok-o">||</span>
    <span class="tok-n">likesTV</span> <span class="tok-o">))</span> <span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The condition of this <code>if</code> statement will always evaluate to <code>false</code> and
its body will not be executed. As before, nothing after the first <code>&amp;&amp;</code>
will even be executed. If you are combining literals and <code>boolean</code>
values with the <code>||</code> and <code>&amp;&amp;</code> operators, it makes no difference that
short circuit evaluation occurs. However, if a method call is part of
the clauses, your code might miss valuable side-effects. For example,
let the <code>boolean</code> variable <code>working</code> be <code>false</code> in the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">working</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">doSomethingImportant</span><span class="tok-o">()</span> <span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>doSomethingImportant()</code> method must return a
<code>boolean</code> value to be a valid statement. Still, if <code>working</code> is <code>false</code>,
the <code>doSomethingImportant()</code> method will not be called. As soon as the
JVM realizes that it is applying the <code>&amp;&amp;</code> operation to a <code>false</code>
value, it will give up. In many cases, doing so is fine. In fact,
programmers will sometimes exploit this feature to allow code in a
method like <code>doSomethingImportant()</code> to run only if it is safe to do so.
In this case, if we assume that we always want to run the
<code>doSomethingImportant()</code> method (because it does something important)
every time the condition of the <code>if</code> statement is evaluated, we need to
restructure the code. For example, we can reverse the order of the two
terms in the AND clause to achieve this effect. Alternatively, Java
provides non-short circuit versions of the <code>||</code> and <code>&amp;&amp;</code> operators,
namely <code>|</code> and <code>\&amp;</code>, if you need to force full evaluation.</p>
</div>
<div class="paragraph">
<p>You may have been wondering where the majority of <code>boolean</code> values come
from. Most computer programs do not ask the user a long series of true
or false questions before spitting out an answer. Most <code>boolean</code> values
in Java programs are the result of comparisons, often of numerical data
types.</p>
</div>
<div class="paragraph">
<p>It is useful to compare two numbers to see if one is larger, smaller, or
equal to the other. For example, you might have a <code>double</code> variable
called <code>pressure</code> that gives the water pressure in a hydraulic system.
Perhaps you also have a constant called <code>CRITICAL_PRESSURE</code> that gives
the maximum safe pressure for your system. You can compare these values
using the <code>&gt;</code> operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">pressure</span> <span class="tok-o">&gt;</span> <span class="tok-n">CRITICAL_PRESSURE</span> <span class="tok-o">)</span>
    <span class="tok-n">emergencyShutdown</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code allows you to call the appropriate emergency method when
<code>pressure</code> is too high. Of course, the <code>&gt;</code> operator is not the only way
to compare two values in Java. We list all the relational operators in
<a href="#_primitive_types_and_strings">Chapter 3</a>, but
the table below shows them again in a
mathematical context.</p>
</div>
<table class="tableblock frame-all grid-all center">
<caption class="title">Table 3. Relational operators</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-bottom">Name</th>
<th class="tableblock halign-center valign-bottom">Math<br>
Symbol</th>
<th class="tableblock halign-center valign-bottom">Java<br>
Operator</th>
<th class="tableblock halign-left valign-bottom">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Equals</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(=\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>==</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> if the two values are equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Not Equals</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(\neq\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>!=</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> if the two values are not
equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Less Than</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(&lt;\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> if the first value is strictly
less than the second</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Less Than or Equals</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(\leq\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> if the first
value is less than or equal to the second</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Greater Than</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(&gt;\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> if the first value is
strictly greater than the second</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Greater Than or Equals</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">\(\geq\)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code> if the first
value is greater than or equal to the second</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The concepts and mathematical symbols for these operators should be
familiar from mathematics. There are a few differences from the
mathematical versions of these ideas that are worth pointing out. First,
only easy-to-type symbols are used for Java operators. Thus, we need two
characters to represent most operators in the language. These operators
can be used to compare any numerical type with any other numerical type,
including <code>char</code>. In the case of mismatched types, such as an <code>int</code> and
a <code>double</code>, the lower precision type is automatically cast to the higher
precision type. Care should be taken when using the <code>==</code> operator with
floating point types because of rounding errors. For example, the
expression <code>(1.0/3.0 == 0.3333333333)</code> always evaluates to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>The <code>==</code> operator is not the same as the <code>=</code> operator from previous
chapters. In Java, the double equal sign <code>==</code> is used to compare two
things while the single equal sign <code>=</code> is used to assign one thing to
another.</p>
</div>
<div class="paragraph">
<p>Confusion can also arise because, in the mathematical world, relational
symbols are used to make a statement: \(x &lt; y\) is an
announcement or a discovery that the value contained in \(x\)
is, in fact, smaller than the value contained in \(y\). In the
Java world, the statement <code>x &lt; y</code> is a <strong>test</strong> whose answer is <code>true</code> if
the value contained in <code>x</code> is smaller than the value contained in <code>y</code>
and <code>false</code> otherwise. Using these operators means performing a test at
a specific point in the code, asking a question about the values that
certain variables or literals (or the results of method calls) have at
that moment in time. In another sense, using these comparisons is a way
to take numerical data and convert it into the language of <code>boolean</code>
values. Note that the following statement does not compile in Java.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-mi">4</span> <span class="tok-o">)</span>
    <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">y</span> <span class="tok-o">+</span> <span class="tok-n">z</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To be used in an <code>if</code> statement, the value <code>4</code> must be first compared
with some other numerical type to yield a <code>true</code> or <code>false</code>.<br></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Assignment instead of equality</div>
<div class="paragraph">
<p>Along these lines, a common pitfall is to forget one of the equal signs
in the comparison operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">4</span> <span class="tok-o">)</span>
    <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">y</span> <span class="tok-o">+</span> <span class="tok-n">z</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, this code will not compile. If it did, the variable <code>x</code> would be
assigned the value <code>4</code>, which would in turn be given to the <code>if</code>
statement, but an <code>if</code> statement does not know what to do with anything
other than a <code>boolean</code> value. Extreme care should be taken when
comparing two <code>boolean</code> values. For example, we might have two <code>boolean</code>
values <code>genderA</code> and <code>genderB</code>, corresponding to the genders of two
different people. Let&#8217;s say that the value of each one is <code>true</code> if the
person is female and <code>false</code> otherwise. We could create an <code>if</code>
statement that would work only if their genders are the same.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">genderA</span> <span class="tok-o">==</span> <span class="tok-n">genderB</span> <span class="tok-o">)</span>
    <span class="tok-n">makeRoommates</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code correctly calls the <code>makeRoommates()</code> method only if the two
individuals have the same gender. However, a tiny mistake in the code
could yield the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">genderA</span> <span class="tok-o">=</span> <span class="tok-n">genderB</span> <span class="tok-o">)</span>
    <span class="tok-n">makeRoommates</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>genderA</code> would be assigned to whatever <code>genderB</code> is.
Then, that value would be given to the <code>if</code> statement. In this
situation, the <code>makeRoommates()</code> method will be called only if <code>genderB</code>
is <code>true</code>, meaning female. Thus, the two people will become roommates if
the second one is female, and the gender of the first person won&#8217;t be
considered. Unlike the <code>x = 4</code> example, this code will compile with no
warning.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next few examples illustrate the use of the <code>if</code> statement. They
also use some methods from class <code>Math</code>.</p>
</div>
<div id="leapYearExample" class="exampleblock">
<div class="title">Example 51. Leap year</div>
<div class="content">
<div class="paragraph">
<p>In the standard Gregorian calendar, leap years occur roughly once every
four years. During leap years, the month of February has 29 days instead
of 28. This extra day makes up for the fact that it takes almost 365.24
days for the earth to orbit the sun. Unfortunately, the orbit of the
earth around the sun does not match up in any exact way with the
rotation of the earth. So, there are exceptions to the rule of every
four years.</p>
</div>
<div class="paragraph">
<p>In fact, the official definition for a leap year is a year that is
evenly divisible by 4, except for those years that are evenly divisible
by 100, with the exception to the exception of years that are evenly
divisible by 400. For example, 1988 was a leap year because it was
divisible by 4. The year 1900 was not a leap year because it was
divisible by 100 but not by 400, and the year 2000 was a leap year
because it was divisible by 400.</p>
</div>
<div class="paragraph">
<p>Recall that the mod operator (<code>%</code>) allows us to find the remainder
after integer division. Thus, if <code>n % 100</code> gives zero, <code>n</code> has no
remainder after being divided by <code>100</code> and must be evenly divisible by
100.</p>
</div>
<div id="LeapYearProgram" class="listingblock">
<div class="title">Program 11. Prompts the user for a year and then determines whether or not it is a leap year.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LeapYear</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a year: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">year</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">%</span> <span class="tok-mi">400</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">year</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is a leap year.&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">%</span> <span class="tok-mi">100</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">year</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is not a leap year.&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">%</span> <span class="tok-mi">4</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">year</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is a leap year.&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>		<span class="tok-k">else</span>
<span class="lineno">15 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">year</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is not a leap year.&quot;</span><span class="tok-o">);</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span>
<span class="lineno">17 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with all of the programs in this section, we begin by importing
<code>java.util.*</code>, which is needed for the <code>Scanner</code> class for input. The
program prompts the user for a year and reads it in. If the year is
evenly divisible by 400, the program outputs that it is a leap year.
Otherwise, if the year is evenly divisible by 100, the program outputs
that it is not a leap year. Otherwise, if the year is evenly divisible
by 4, the program outputs that it is a leap year. Finally, if all the
other conditions have failed, the program outputs that the year is not a
leap year.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 52. Quadratic formula</div>
<div class="content">
<div class="paragraph">
<p>The quadratic formula is a useful tool from mathematics. Using this
formula, you can solve equations of the form \(ax^2 + bx
+ c = 0\). As you might recall, the quadratic equation that gives the
solutions is: \(\frac{-b \pm \sqrt{b^2 - 4ac}}{2a}\)</p>
</div>
<div class="paragraph">
<p>The \(b^2 - 4ac\) part of the formula is called the
<em>discriminant</em>. If the discriminant is positive, there will be two real
answers to the equation. If the discriminant is negative, there will be
two complex answers to the equation. Finally, if the discriminant is
zero, there will be a single real answer to the problem. If you want to
write a program to solve quadratic equations for you, it should take
these three possibilities into account.</p>
</div>
<div id="QuadraticProgram" class="listingblock">
<div class="title">Program 12. Solves a quadratic equation.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Quadratic</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;This program solves quadratic&quot;</span> <span class="tok-o">+</span>
<span class="lineno"> 7 </span>			<span class="tok-s">&quot; equations of the form ax^2 + bx + c = 0.&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a value for a: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">double</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a value for b: &quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-kt">double</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">12 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a value for c: &quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>		<span class="tok-kt">double</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">14 </span>		<span class="tok-kt">double</span> <span class="tok-n">discriminant</span> <span class="tok-o">=</span> <span class="tok-n">b</span><span class="tok-o">*</span><span class="tok-n">b</span> <span class="tok-o">-</span> <span class="tok-mi">4</span><span class="tok-o">*</span><span class="tok-n">a</span><span class="tok-o">*</span><span class="tok-n">c</span><span class="tok-o">;</span>
<span class="lineno">15 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">discriminant</span> <span class="tok-o">==</span> <span class="tok-mf">0.0</span> <span class="tok-o">)</span>
<span class="lineno">16 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The answer is x = &quot;</span> <span class="tok-o">+</span> <span class="tok-o">(-</span><span class="tok-n">b</span><span class="tok-o">/(</span><span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">a</span><span class="tok-o">)));</span>
<span class="lineno">17 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">discriminant</span> <span class="tok-o">&lt;</span> <span class="tok-mf">0.0</span> <span class="tok-o">)</span>
<span class="lineno">18 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The answers are x = &quot;</span> <span class="tok-o">+</span>
<span class="lineno">19 </span>                <span class="tok-o">(-</span><span class="tok-n">b</span> <span class="tok-o">/</span> <span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">a</span><span class="tok-o">))</span> <span class="tok-o">+</span> <span class="tok-s">&quot; + &quot;</span> <span class="tok-o">+</span>
<span class="lineno">20 </span>                <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(-</span><span class="tok-n">discriminant</span><span class="tok-o">)</span> <span class="tok-o">/</span> <span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot;i and x = &quot;</span> <span class="tok-o">+</span>
<span class="lineno">21 </span>                <span class="tok-o">(-</span><span class="tok-n">b</span> <span class="tok-o">/</span> <span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">a</span><span class="tok-o">))</span> <span class="tok-o">+</span> <span class="tok-s">&quot; - &quot;</span> <span class="tok-o">+</span>
<span class="lineno">22 </span>                <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(-</span><span class="tok-n">discriminant</span><span class="tok-o">)</span> <span class="tok-o">/</span> <span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot;i&quot;</span><span class="tok-o">);</span>
<span class="lineno">23 </span>		<span class="tok-k">else</span>
<span class="lineno">24 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The answers are x = &quot;</span> <span class="tok-o">+</span>
<span class="lineno">25 </span>                <span class="tok-o">(-</span><span class="tok-n">b</span> <span class="tok-o">+</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-n">discriminant</span><span class="tok-o">))/(</span><span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">a</span><span class="tok-o">)</span> <span class="tok-o">+</span>
<span class="lineno">26 </span>                <span class="tok-s">&quot; and x = &quot;</span> <span class="tok-o">+</span>
<span class="lineno">27 </span>                <span class="tok-o">(-</span><span class="tok-n">b</span> <span class="tok-o">-</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-n">discriminant</span><span class="tok-o">))/(</span><span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">a</span><span class="tok-o">));</span>
<span class="lineno">28 </span>	<span class="tok-o">}</span>
<span class="lineno">29 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program begins by prompting the user and reading in values for <code>a</code>,
<code>b</code>, and <code>c</code>. Then, it computes the discriminant. In the first case, we
want to test to see if the discriminant is zero. If the discriminant was
not zero but is negative, we account for this situation in the next
case. We compute the real and complex parts separately and output the
two answers. Finally, if the discriminant is positive, we find the two
answers and output them. Note that braces were not needed for the <code>if</code>,
<code>else</code>-<code>if</code>, and <code>else</code> blocks because each is composed of only a single
line of code. Although these <code>System.out.println()</code> method calls may
take up more than one line visually, Java interprets them as single
lines because they each only have a single semicolon (<code>;</code>).</p>
</div>
<div class="paragraph">
<p>The line <code>if( discriminant == 0.0 )</code> is dangerous since we are using
<code>double</code> values. Because of rounding errors, the discriminant might not
be exactly zero even if it should be, mathematically. Industrial
strength code would probably check to see if the absolute value of the
discriminant is less than a very small number (such as 0.00000001).
Values that small would then be treated as if they were zero.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 53. 20 Questions</div>
<div class="content">
<div class="paragraph">
<p>In the time-honored game of 20 Questions, one person mentally chooses
something, and the other participants must guess what the thing is by
asking questions whose answer is either &#8220;yes&#8221; or &#8220;no.&#8221; In one
popular version, the person who chooses the thing starts by declaring
whether it is animal, vegetable, or mineral.</p>
</div>
<div class="paragraph">
<p>Using counting principles from math, 20 yes-or-no questions makes it
possible to differentiate \(2^{20} = 1,048,576\) items. If you
are told ahead of time whether the thing is animal, vegetable, or
mineral, it should be possible to guess over 3 million items! We are not
yet ready to deal with such a large range of possibilities. To keep the
size of the code reasonable, let&#8217;s narrow the field to 10 different
items: a lizard, an eagle, a dolphin, a human, some lead, a diamond, a
tomato, a peach, a maple tree, and a potato.</p>
</div>
<div id="figure-flowchart" class="imageblock">
<div class="content">
<img src="chapters/04-selection/images/flowchart.svg" alt="flowchart" width="100%">
</div>
<div class="title">Figure 19. Decision tree to distinguish 10 items.</div>
</div>
<div class="paragraph">
<p>Using these items, we can construct a tree of decisions to make,
starting with the decision between animal, vegetable, and mineral. If
the thing is an animal, we could then ask if it is a mammal. If it is a
mammal, we could ask if it lives on land, deciding between human and
dolphin. If it is not a mammal, we could ask if it flies, deciding
between an eagle and a lizard. We can construct similar questions for
the things in the vegetable and mineral categories, matching
<a href="#figure-flowchart">Figure 19</a>.</p>
</div>
<div id="TwentyQuestionsProgram" class="listingblock">
<div class="title">Program 13. Navigates the possible choices in the decision tree.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TwentyQuestions</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Is it an animal, vegetable, or mineral?&quot;</span> <span class="tok-o">+</span>
<span class="lineno"> 7 </span>			<span class="tok-s">&quot;(&#39;a&#39;, &#39;v&#39;, or &#39;m&#39;): &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-n">String</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;a&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Is it a mammal? (&#39;y&#39; or &#39;n&#39;): &quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>			<span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">12 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;y&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span>
<span class="lineno">14 </span>					<span class="tok-s">&quot;Does it live on land? (&#39;y&#39; or &#39;n&#39;): &quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>				<span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">16 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;y&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">17 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s a human.&quot;</span><span class="tok-o">);</span>
<span class="lineno">18 </span>				<span class="tok-k">else</span> <span class="tok-c1">//assume &quot;n&quot;</span>
<span class="lineno">19 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s a dolphin.&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>			<span class="tok-o">}</span>
<span class="lineno">21 </span>			<span class="tok-k">else</span> <span class="tok-o">{</span> <span class="tok-c1">//assume &quot;n&quot;</span>
<span class="lineno">22 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Does it fly? (&#39;y&#39; or &#39;n&#39;): &quot;</span><span class="tok-o">);</span>
<span class="lineno">23 </span>				<span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">24 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;y&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">25 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s an eagle.&quot;</span><span class="tok-o">);</span>
<span class="lineno">26 </span>				<span class="tok-k">else</span> <span class="tok-c1">//assume &quot;n&quot;</span>
<span class="lineno">27 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s a lizard.&quot;</span><span class="tok-o">);</span>
<span class="lineno">28 </span>			<span class="tok-o">}</span>
<span class="lineno">29 </span>		<span class="tok-o">}</span>
<span class="lineno">30 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;v&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Is it a fruit? (&#39;y&#39; or &#39;n&#39;): &quot;</span><span class="tok-o">);</span>
<span class="lineno">32 </span>			<span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">33 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;y&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">34 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span>
<span class="lineno">35 </span>					<span class="tok-s">&quot;Does it grown on a vine? (&#39;y&#39; or &#39;n&#39;): &quot;</span><span class="tok-o">);</span>
<span class="lineno">36 </span>				<span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">37 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;y&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">38 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s a tomato.&quot;</span><span class="tok-o">);</span>
<span class="lineno">39 </span>				<span class="tok-k">else</span> <span class="tok-c1">//assume &quot;n&quot;</span>
<span class="lineno">40 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s a peach.&quot;</span><span class="tok-o">);</span>
<span class="lineno">41 </span>			<span class="tok-o">}</span>
<span class="lineno">42 </span>			<span class="tok-k">else</span> <span class="tok-o">{</span> <span class="tok-c1">//assume &quot;n&quot;</span>
<span class="lineno">43 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Is it a tree? (&#39;y&#39; or &#39;n&#39;): &quot;</span><span class="tok-o">);</span>
<span class="lineno">44 </span>				<span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">45 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;y&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">46 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s a maple tree.&quot;</span><span class="tok-o">);</span>
<span class="lineno">47 </span>				<span class="tok-k">else</span> <span class="tok-c1">//assume &quot;n&quot;</span>
<span class="lineno">48 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s a potato.&quot;</span><span class="tok-o">);</span>
<span class="lineno">49 </span>			<span class="tok-o">}</span>
<span class="lineno">50 </span>		<span class="tok-o">}</span>
<span class="lineno">51 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span> <span class="tok-c1">//assume &quot;m&quot;</span>
<span class="lineno">52 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span>
<span class="lineno">53 </span>					<span class="tok-s">&quot;Is it the hardest mineral? (&#39;y&#39; or &#39;n&#39;): &quot;</span><span class="tok-o">);</span>
<span class="lineno">54 </span>				<span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">55 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;y&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">56 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s a diamond.&quot;</span><span class="tok-o">);</span>
<span class="lineno">57 </span>				<span class="tok-k">else</span> <span class="tok-c1">//assume &quot;n&quot;</span>
<span class="lineno">58 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;It&#39;s lead.&quot;</span><span class="tok-o">);</span>
<span class="lineno">59 </span>		<span class="tok-o">}</span>
<span class="lineno">60 </span>	<span class="tok-o">}</span>
<span class="lineno">61 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code in this example is straightforward, although even 10 items
makes for a lot of <code>if</code> and <code>else</code> blocks. Other than the <code>if</code>-<code>else</code>
statements, only simple input and output are needed to make the program
function. For proper <code>String</code> comparison, it is necessary to use the
<code>equals()</code> method to test if two <code>String</code> values are the same.</p>
</div>
<div class="paragraph">
<p>Note that we have added comments specifying what we assume is the case
for each <code>else</code> block. If we were being more careful, we should test for
the <code>"y"</code> and <code>"n"</code> cases and then give an error message when the user
inputs something unexpected, like <code>"x"</code> or <code>"149"</code> or even <code>"no"</code>.
Again, note that no braces are needed for the final <code>if</code>-<code>else</code> blocks
in which the guess is made, since each of these guesses requires only a
single line of code.</p>
</div>
<div class="paragraph">
<p>You might be curious how to make a real 20 Questions game that could
learn over time. To do so, many more programming tools are necessary:
repetition, data structures (so that you can organize the questions),
and file input and output (so that you can store new information
permanently). These concepts are covered in later chapters.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="subsection:switch_statements">4.3.3. <code>switch</code> statements</h4>
<div class="paragraph">
<p>The <code>if</code> statement is the workhorse of Java conditional execution. With
enough care, you can craft code that can make any fixed sequence of
decisions with arbitrary complexity. Even so, the <code>if</code> statement can be
a little clumsy because it only allows you to choose between two
alternatives. After all, a conditional can only be <code>true</code> or <code>false</code>.
Certainly, decisions can be nested, allowing for more than two
possibilities, but long lists of possibilities can be cumbersome.</p>
</div>
<div class="paragraph">
<p>For example, imagine that we want to create a program that determines
the appropriate gift for a wedding anniversary. Below is a table of
traditional categories of gifts based on the anniversary year.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Year</th>
<th class="tableblock halign-left valign-middle">Gift</th>
<th class="tableblock halign-center valign-middle">Year</th>
<th class="tableblock halign-left valign-middle">Gift</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Paper</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Lace</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Cotton</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Ivory</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Leather</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Crystal</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Fruit</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">China</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Wood</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Silver</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Candy / Iron</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Pearl</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Wool / Copper</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">35</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Coral</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Bronze / Pottery</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Ruby</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Pottery / Willow</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">45</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Sapphire</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Tin / Aluminum</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Gold</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Steel</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">55</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Emerald</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Silk / Linen</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Diamond</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Let <code>year</code> be a variable of type <code>int</code> containing the year in question.
A structure of <code>if</code>-<code>else</code> statements that can determine the appropriate
gift based on the year is below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">gift</span><span class="tok-o">;</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Paper&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">2</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Cotton&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">3</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Leather&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">4</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Fruit&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">5</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Wood&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">6</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Candy / Iron&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">7</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Wool / Copper&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">8</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Bronze / Pottery&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">9</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Pottery / Willow&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">10</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Tin / Aluminum&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">11</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Steel&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">12</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Silk / Linen&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">13</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Lace&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">14</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Ivory&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">15</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Crystal&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">20</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;China&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">25</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Silver&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">30</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Pearl&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">35</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Coral&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">40</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Ruby&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">45</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sapphire&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">50</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Gold&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">55</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Emerald&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">60</span> <span class="tok-o">)</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Diamond&quot;</span><span class="tok-o">;</span>
<span class="tok-k">else</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;No traditional gift&quot;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code stores the correct value in <code>gift</code>. Note that we are using the
feature of <code>if</code> statements that treats an entire <code>if</code> statement as one
statement. If we used braces to group things properly, the code would
become unreadable and unmanageably large.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">gift</span><span class="tok-o">;</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Paper&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
<span class="tok-k">else</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">2</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Cotton&quot;</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">3</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Leather&quot;</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-k">else</span> <span class="tok-o">{</span>
            <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">==</span> <span class="tok-mi">4</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Fruit&quot;</span><span class="tok-o">;</span>
            <span class="tok-o">}</span>
            <span class="tok-o">.</span>
            <span class="tok-o">.</span>
            <span class="tok-o">.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It appears that there is some kind of <code>else if</code> construct in Java, but
there is not. Still, careful use of the rules for braces allows us to
write code that nicely expresses a list of alternatives, even if the
true compiler interpretation looks a little different.</p>
</div>
<div class="paragraph">
<p>Another way of expressing a long sequence of choices is by using a
<code>switch</code> statement. A <code>switch</code> statement takes a single integer type
value (<code>int</code>, <code>long</code>, <code>short</code>, <code>byte</code>, <code>char</code>) or a <code>String</code> and jumps
to a case corresponding to the input. We can recode the anniversary gift
example using a <code>switch</code> statement as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">gift</span><span class="tok-o">;</span>
<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">case</span> <span class="tok-mi">1</span><span class="tok-o">:</span>  <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Paper&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">2</span><span class="tok-o">:</span>  <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Cotton&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">3</span><span class="tok-o">:</span>  <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Leather&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">4</span><span class="tok-o">:</span>  <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Fruit&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">5</span><span class="tok-o">:</span>  <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Wood&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">6</span><span class="tok-o">:</span>  <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Candy / Iron&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">7</span><span class="tok-o">:</span>  <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Wool / Copper&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">8</span><span class="tok-o">:</span>  <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Bronze / Pottery&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">9</span><span class="tok-o">:</span>  <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Pottery / Willow&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">10</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Tin / Aluminum&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">11</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Steel&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">12</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Silk / Linen&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">13</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Lace&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">14</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Ivory&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">15</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Crystal&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">20</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;China&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">25</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Silver&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">30</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Pearl&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">35</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Coral&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">40</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Ruby&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">45</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sapphire&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">50</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Gold&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">55</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Emerald&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">60</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Diamond&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-k">default</span><span class="tok-o">:</span> <span class="tok-n">gift</span> <span class="tok-o">=</span> <span class="tok-s">&quot;No traditional gift&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like an <code>if</code> statement, a <code>switch</code> statement always has parentheses
enclosing some argument. Unlike an <code>if</code>, the argument of a <code>switch</code> must
be some kind of data that can be expressed as an integer or a <code>String</code>,
not a <code>boolean</code>. For each of the possible values you want the <code>switch</code>
to handle, you write a <code>case</code> statement. A <code>case</code> statement consists of
the keyword <code>case</code> followed by a constant value, either a literal or a
named constant, then a colon. When executed, the JVM jumps to the
matching <code>case</code> label and starts executing code there. If there is no
matching <code>case</code> label, the JVM goes to the <code>default</code> label. If there is
no <code>default</code> label, the entire <code>switch</code> statement is skipped.</p>
</div>
<div class="paragraph">
<p>One unusual feature of <code>switch</code> statements is that execution <em>falls
through</em> <code>case</code> statements. This means that you can use many different
<code>case</code> statements for a single segment of executable code. The execution
of code in a <code>switch</code> statement jumps out when it hits a <code>break</code>
statement. However, <code>break</code> statements are not required, as shown in
this <code>switch</code> statement that gives location information for all of the
telephone area codes in New York state.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">code</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">case</span> <span class="tok-mi">917</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Cellular: &quot;</span><span class="tok-o">;</span>
    <span class="tok-k">case</span> <span class="tok-mi">212</span><span class="tok-o">:</span>
    <span class="tok-k">case</span> <span class="tok-mi">347</span><span class="tok-o">:</span>
    <span class="tok-k">case</span> <span class="tok-mi">646</span><span class="tok-o">:</span>
    <span class="tok-k">case</span> <span class="tok-mi">718</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;New York City&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

    <span class="tok-k">case</span> <span class="tok-mi">315</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Syracuse&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

    <span class="tok-k">case</span> <span class="tok-mi">516</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Nassau County&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

    <span class="tok-k">case</span> <span class="tok-mi">518</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Albany&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

    <span class="tok-k">case</span> <span class="tok-mi">585</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Rochester&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

    <span class="tok-k">case</span> <span class="tok-mi">607</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;South Central New York&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

    <span class="tok-k">case</span> <span class="tok-mi">631</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Suffolk County&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

    <span class="tok-k">case</span> <span class="tok-mi">716</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Buffalo&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

    <span class="tok-k">case</span> <span class="tok-mi">845</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Lower Hudson Valley&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

    <span class="tok-k">case</span> <span class="tok-mi">914</span><span class="tok-o">:</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Westchester County&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>

<span class="tok-nl">    default:</span>  <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Unknown Area Code&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, five different area codes are used by New York City. By
leaving out the <code>break</code> statements, values of <code>212</code>, <code>347</code>, <code>646</code>, and
<code>718</code> all have <code>"New York City"</code> stored into <code>location</code>. Area code 917
was originally designated for cellular phones and pagers although now it
has some landlines. By cleverly putting the statement for <code>917</code> ahead of
the other New York City entries, a value of <code>917</code> first stores
<code>"Cellular: "</code> into <code>location</code> and then falls through and appends
<code>"New York City"</code>. For each of these five area codes, execution in the
<code>switch</code> statement ends only when the <code>break</code> statement is reached.</p>
</div>
<div class="paragraph">
<p>The remaining nine area codes are by themselves. Each of them does a
single assignment and then breaks out of the <code>switch</code> block. Finally,
the <code>default</code> label is used if the area code is not one of the ones
specified. Note that we have ordered the (non-NYC) area codes in
ascending order for the sake of readability. As you can see with the
<code>917</code> example, there is no rule about the ordering of the labels. Even
the <code>default</code> label can occur anywhere in the <code>switch</code> block you want,
although it is common to put it at the end. Also, the <code>break</code> after the
<code>default</code> label is unnecessary because execution exits the <code>switch</code>
block anyway. Nevertheless, it is always wise to end on a <code>break</code>, in
the event that you add more cases in later.</p>
</div>
<div class="paragraph">
<p>Carelessness is always something to watch out for in <code>switch</code>
statements. Leaving out a <code>break</code> statement can cause disastrous and
difficult to discover bugs. The compiler does not warn you about missing
<code>break</code> statements, either. It is entirely your job to use them
appropriately. Because of the dangers involved, it is often better to
use <code>if</code>-<code>else</code> statements. Any <code>switch</code> statement can be rewritten as
some combination of <code>if</code>-<code>else</code> statements, but the reverse is not true.
The main benefit of <code>switch</code> statements is the ability to list many
alternatives clearly. Their drawbacks include the ease of making a
mistake, an inability to express ranges of data or most types (<code>double</code>,
<code>float</code>, or any reference type other than <code>String</code>), and limited
expressive power. They should be used only when their benefit of clearly
displaying a list of data outweighs the drawbacks. Note that Java 7
added <code>String</code> values as legal input to a <code>switch</code>. If you are coding in
Java 7 or later, you can use <code>String</code> literals for your cases, but then
your code is not be compatible with earlier versions.</p>
</div>
<div class="paragraph">
<p>Next we give a number of examples to help you get more familiar with
<code>switch</code> statements.</p>
</div>
<div class="exampleblock">
<div class="title">Example 54. Days in the month</div>
<div class="content">
<div class="paragraph">
<p>The use of <code>switch</code> statements is usually a little more special purpose
than <code>if</code> statements. Nevertheless, there are many problems where their
fall-through behavior can be useful. Imagine that you need to write a
program that gives the length of each month (assume that February always
has 28 days). Given the month as a number, we can easily write a program
that maps the number of the month to the number of days it contains.</p>
</div>
<div id="DaysInMonthProgram" class="listingblock">
<div class="title">Program 14. Computes the number of days in a given month.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DaysInMonth</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please a month number (1-12): &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">month</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">days</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">month</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>			<span class="tok-k">case</span> <span class="tok-mi">2</span><span class="tok-o">:</span>  <span class="tok-n">days</span> <span class="tok-o">=</span> <span class="tok-mi">28</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>			<span class="tok-k">case</span> <span class="tok-mi">4</span><span class="tok-o">:</span>
<span class="lineno">13 </span>			<span class="tok-k">case</span> <span class="tok-mi">6</span><span class="tok-o">:</span>
<span class="lineno">14 </span>			<span class="tok-k">case</span> <span class="tok-mi">9</span><span class="tok-o">:</span>
<span class="lineno">15 </span>			<span class="tok-k">case</span> <span class="tok-mi">11</span><span class="tok-o">:</span> <span class="tok-n">days</span> <span class="tok-o">=</span> <span class="tok-mi">30</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>			<span class="tok-k">case</span> <span class="tok-mi">1</span><span class="tok-o">:</span>
<span class="lineno">18 </span>			<span class="tok-k">case</span> <span class="tok-mi">3</span><span class="tok-o">:</span>
<span class="lineno">19 </span>			<span class="tok-k">case</span> <span class="tok-mi">5</span><span class="tok-o">:</span>
<span class="lineno">20 </span>			<span class="tok-k">case</span> <span class="tok-mi">7</span><span class="tok-o">:</span>
<span class="lineno">21 </span>			<span class="tok-k">case</span> <span class="tok-mi">8</span><span class="tok-o">:</span>
<span class="lineno">22 </span>			<span class="tok-k">case</span> <span class="tok-mi">10</span><span class="tok-o">:</span>
<span class="lineno">23 </span>			<span class="tok-k">case</span> <span class="tok-mi">12</span><span class="tok-o">:</span> <span class="tok-n">days</span> <span class="tok-o">=</span> <span class="tok-mi">31</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">24 </span>		<span class="tok-o">}</span>
<span class="lineno">25 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The month you entered has &quot;</span> <span class="tok-o">+</span>
<span class="lineno">26 </span>			<span class="tok-n">days</span> <span class="tok-o">+</span> <span class="tok-s">&quot; days.&quot;</span><span class="tok-o">);</span>
<span class="lineno">27 </span>	<span class="tok-o">}</span>
<span class="lineno">28 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program has a single label for February setting <code>days</code> to 28. Then,
there are labels for April, June, September, and November, months that
each have 30 days. Finally, the large block of January, March, May,
July, August, October, and December all set <code>days</code> to 31. It would be
easy to extend this code to prompt the user for a year so that you could
integrate the leap year code from above for the February case. Note also
that we do not have a <code>default</code> label. You might want to set <code>days</code> to
some special value (like <code>-1</code>) for invalid months.</p>
</div>
</div>
</div>
<div id="ordinalNumbersExample" class="exampleblock">
<div class="title">Example 55. Ordinal numbers</div>
<div class="content">
<div class="paragraph">
<p>The term <em>ordinal numbers</em> refers to numbers that are used for ordering
within a set of items: first, second, third, and so on. When writing
these numbers with numerals in English, it is common to append two
letters to the end of the numeral to give the reader a clue that these
numerals should be read with their ordinal names: 1st, 2nd, 3rd, and so
on.</p>
</div>
<div class="paragraph">
<p>Unlike most things in English, the rules for deciding which two letters
are relatively simple. If the number ends in a 1, the letters &#8220;st&#8221;
should generally be used. If the number ends in a 2, the letters &#8220;nd&#8221;
should generally be used. If the number ends in a 3, the letters &#8220;rd&#8221;
should generally be used. For most other numbers, the letters &#8220;th&#8221;
should be used. We can use a <code>switch</code> statement to write a program to
give the correct ordinal endings for most numbers as follows.</p>
</div>
<div id="OrdinalsProgram" class="listingblock">
<div class="title">Program 15. Appends the appropriate suffix to a numeral to make it an ordinal.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Ordinals</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a positive number: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-n">String</span> <span class="tok-n">ending</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">number</span> <span class="tok-o">%</span> <span class="tok-mi">10</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>			<span class="tok-k">case</span> <span class="tok-mi">1</span><span class="tok-o">:</span>  <span class="tok-n">ending</span> <span class="tok-o">=</span> <span class="tok-s">&quot;st&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">11 </span>			<span class="tok-k">case</span> <span class="tok-mi">2</span><span class="tok-o">:</span>  <span class="tok-n">ending</span> <span class="tok-o">=</span> <span class="tok-s">&quot;nd&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">12 </span>			<span class="tok-k">case</span> <span class="tok-mi">3</span><span class="tok-o">:</span>  <span class="tok-n">ending</span> <span class="tok-o">=</span> <span class="tok-s">&quot;rd&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">13 </span>			<span class="tok-k">default</span><span class="tok-o">:</span> <span class="tok-n">ending</span> <span class="tok-o">=</span> <span class="tok-s">&quot;th&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">14 </span>		<span class="tok-o">}</span>
<span class="lineno">15 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Its ordinal version is &quot;</span>
<span class="lineno">16 </span>			<span class="tok-o">+</span> <span class="tok-n">number</span> <span class="tok-o">+</span> <span class="tok-n">ending</span> <span class="tok-o">+</span> <span class="tok-s">&quot;.&quot;</span><span class="tok-o">);</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program prompts and then reads in an <code>int</code> from the user. We then
find the remainder of <code>number</code> when it is divided by 10, yielding its
last digit. Based on this digit, we can pick from the four possibilities
and output the correct ordinal number in most cases. Unfortunately, the
names for English numbers do not follow the normal pattern of tens place
name followed by ones place name between 11 and 19, inclusive, and the
ordinals for any number ending in 11, 12, or 13 will be given the wrong
suffix by our code. We leave a more complete solution as an exercise.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise4.12">Exercise 4.12</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 56. Astrology</div>
<div class="content">
<div class="paragraph">
<p>Many cultures practice astrology, a tradition that the time of a
person&#8217;s birth impacts his or her personality or future. One important
element of Chinese astrology is their zodiac, consisting of 12 animals.
Each consecutive year in a 12-year cycle corresponds to an animal.
Because this system repeats, the year one is born in modulo 12
identifies the animal. Below is a table giving these values. For
example, if you were born in 1979, \(1979 \mod 12 \equiv 11\),
and thus you would be a Ram. Note that this arrangement is based on
years in the Gregorian calendar. Chinese astrologers do not list the
Monkey as the first animal in the cycle.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-bottom">Animal</th>
<th class="tableblock halign-center valign-bottom">Year<br>
modulo 12</th>
<th class="tableblock halign-left valign-bottom">Animal</th>
<th class="tableblock halign-center valign-bottom">Year<br>
modulo 12</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Monkey</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Tiger</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Rooster</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Rabbit</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Dog</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Dragon</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Boar</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Snake</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Rat</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Horse</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Ox</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-bottom"><p class="tableblock">Ram</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">11</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Unfortunately, this table is not very accurate because it is based on
numbering from the Gregorian calendar. The years in question actually
start and end based on Chinese New Year, which occurs between January 21
and February 20. As a consequence, you may miscalculate your animal if
your birthday is early in the year. Let&#8217;s ignore this problem for the
moment and write a program using a <code>switch</code> statement designed to
correctly output the animal corresponding to an input birth year.</p>
</div>
<div id="ChineseZodiacProgram" class="listingblock">
<div class="title">Program 16. Determines a Chinese zodiac animal based on birth year.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ChineseZodiac</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a year: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">year</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-n">String</span> <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">%</span> <span class="tok-mi">12</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>			<span class="tok-k">case</span> <span class="tok-mi">0</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Monkey&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">11 </span>			<span class="tok-k">case</span> <span class="tok-mi">1</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Rooster&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">12 </span>			<span class="tok-k">case</span> <span class="tok-mi">2</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Dog&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">13 </span>			<span class="tok-k">case</span> <span class="tok-mi">3</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Boar&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">14 </span>			<span class="tok-k">case</span> <span class="tok-mi">4</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Rat&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">15 </span>			<span class="tok-k">case</span> <span class="tok-mi">5</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Ox&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">16 </span>			<span class="tok-k">case</span> <span class="tok-mi">6</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Tiger&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">17 </span>			<span class="tok-k">case</span> <span class="tok-mi">7</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Rabbit&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">18 </span>			<span class="tok-k">case</span> <span class="tok-mi">8</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Dragon&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">19 </span>			<span class="tok-k">case</span> <span class="tok-mi">9</span><span class="tok-o">:</span>  <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Snake&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">20 </span>			<span class="tok-k">case</span> <span class="tok-mi">10</span><span class="tok-o">:</span> <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Horse&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">21 </span>			<span class="tok-k">case</span> <span class="tok-mi">11</span><span class="tok-o">:</span> <span class="tok-n">animal</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Ram&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">22 </span>		<span class="tok-o">}</span>
<span class="lineno">23 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The Chinese zodiac animal for &quot;</span> <span class="tok-o">+</span>
<span class="lineno">24 </span>			<span class="tok-s">&quot;this year is: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">animal</span><span class="tok-o">);</span>
<span class="lineno">25 </span>	<span class="tok-o">}</span>
<span class="lineno">26 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sign</th>
<th class="tableblock halign-left valign-top">Symbol</th>
<th class="tableblock halign-left valign-top">Date Range</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Ram</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">March 21 to April 19</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taurus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Bull</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">April 20 to May 20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gemini</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Twins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May 21 to June 20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cancer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Crab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">June 21 to July 22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Lion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">July 23 to August 22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virgo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Virgin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">August 23 to September 22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Libra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Scales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">September 23 to October 22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scorpio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Scorpion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">October 23 to November 21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sagittarius</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Archer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">November 22 to December 21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capricorn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Sea-Goat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">December 22 to January 19</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aquarius</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Water Bearer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">January 20 to February 19</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pisces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Fishes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">February 20 to March 20</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In Western astrology, an important element associated with a person&#8217;s
birth is also called a zodiac sign. The dates for determining this kind
of zodiac sign are given by the preceding table.</p>
</div>
<div class="paragraph">
<p>If you want to implement the rules for this zodiac in code, a <code>switch</code>
statement is a good place to start, but you also have to put <code>if</code>
statements for each month to test the exact range of dates.</p>
</div>
<div id="WesternZodiacProgram" class="listingblock">
<div class="title">Program 17. Determines Western zodiac signs based on birth month and day.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WesternZodiac</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a month number (1-12): &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">month</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a day number in that month (1-31): &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">int</span> <span class="tok-n">day</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-n">String</span> <span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">month</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>			<span class="tok-k">case</span> <span class="tok-mi">1</span><span class="tok-o">:</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">20</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Capricorn&quot;</span><span class="tok-o">;</span>
<span class="lineno">14 </span>				<span class="tok-k">else</span>
<span class="lineno">15 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Aquarius&quot;</span><span class="tok-o">;</span>
<span class="lineno">16 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">17 </span>			<span class="tok-k">case</span> <span class="tok-mi">2</span><span class="tok-o">:</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">20</span> <span class="tok-o">)</span>
<span class="lineno">18 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Aquarius&quot;</span><span class="tok-o">;</span>
<span class="lineno">19 </span>				<span class="tok-k">else</span>
<span class="lineno">20 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Pices&quot;</span><span class="tok-o">;</span>
<span class="lineno">21 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">22 </span>			<span class="tok-k">case</span> <span class="tok-mi">3</span><span class="tok-o">:</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">20</span> <span class="tok-o">)</span>
<span class="lineno">23 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Pices&quot;</span><span class="tok-o">;</span>
<span class="lineno">24 </span>				<span class="tok-k">else</span>
<span class="lineno">25 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Aries&quot;</span><span class="tok-o">;</span>
<span class="lineno">26 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">27 </span>			<span class="tok-k">case</span> <span class="tok-mi">4</span><span class="tok-o">:</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">20</span> <span class="tok-o">)</span>
<span class="lineno">28 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Aries&quot;</span><span class="tok-o">;</span>
<span class="lineno">29 </span>				<span class="tok-k">else</span>
<span class="lineno">30 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Taurus&quot;</span><span class="tok-o">;</span>
<span class="lineno">31 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">32 </span>			<span class="tok-k">case</span> <span class="tok-mi">5</span><span class="tok-o">:</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">21</span> <span class="tok-o">)</span>
<span class="lineno">33 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Taurus&quot;</span><span class="tok-o">;</span>
<span class="lineno">34 </span>				<span class="tok-k">else</span>
<span class="lineno">35 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Gemini&quot;</span><span class="tok-o">;</span>
<span class="lineno">36 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">37 </span>			<span class="tok-k">case</span> <span class="tok-mi">6</span><span class="tok-o">:</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">21</span> <span class="tok-o">)</span>
<span class="lineno">38 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Gemini&quot;</span><span class="tok-o">;</span>
<span class="lineno">39 </span>				<span class="tok-k">else</span>
<span class="lineno">40 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Cancer&quot;</span><span class="tok-o">;</span>
<span class="lineno">41 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">42 </span>			<span class="tok-k">case</span> <span class="tok-mi">7</span><span class="tok-o">:</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">23</span> <span class="tok-o">)</span>
<span class="lineno">43 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Cancer&quot;</span><span class="tok-o">;</span>
<span class="lineno">44 </span>				<span class="tok-k">else</span>
<span class="lineno">45 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Leo&quot;</span><span class="tok-o">;</span>
<span class="lineno">46 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">47 </span>			<span class="tok-k">case</span> <span class="tok-mi">8</span><span class="tok-o">:</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">23</span> <span class="tok-o">)</span>
<span class="lineno">48 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Leo&quot;</span><span class="tok-o">;</span>
<span class="lineno">49 </span>				<span class="tok-k">else</span>
<span class="lineno">50 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Virgo&quot;</span><span class="tok-o">;</span>
<span class="lineno">51 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">52 </span>			<span class="tok-k">case</span> <span class="tok-mi">9</span><span class="tok-o">:</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">23</span> <span class="tok-o">)</span>
<span class="lineno">53 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Virgo&quot;</span><span class="tok-o">;</span>
<span class="lineno">54 </span>				<span class="tok-k">else</span>
<span class="lineno">55 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Libra&quot;</span><span class="tok-o">;</span>
<span class="lineno">56 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">57 </span>			<span class="tok-k">case</span> <span class="tok-mi">10</span><span class="tok-o">:</span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">23</span> <span class="tok-o">)</span>
<span class="lineno">58 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Libra&quot;</span><span class="tok-o">;</span>
<span class="lineno">59 </span>				<span class="tok-k">else</span>
<span class="lineno">60 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Scorpio&quot;</span><span class="tok-o">;</span>
<span class="lineno">61 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">62 </span>			<span class="tok-k">case</span> <span class="tok-mi">11</span><span class="tok-o">:</span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">22</span> <span class="tok-o">)</span>
<span class="lineno">63 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Scorpio&quot;</span><span class="tok-o">;</span>
<span class="lineno">64 </span>				<span class="tok-k">else</span>
<span class="lineno">65 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sagittarius&quot;</span><span class="tok-o">;</span>
<span class="lineno">66 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">67 </span>			<span class="tok-k">case</span> <span class="tok-mi">12</span><span class="tok-o">:</span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;</span> <span class="tok-mi">20</span> <span class="tok-o">)</span>
<span class="lineno">68 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sagittarius&quot;</span><span class="tok-o">;</span>
<span class="lineno">69 </span>				<span class="tok-k">else</span>
<span class="lineno">70 </span>					<span class="tok-n">sign</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Capricorn&quot;</span><span class="tok-o">;</span>
<span class="lineno">71 </span> 				<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">72 </span>		<span class="tok-o">}</span>
<span class="lineno">73 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The zodiac sign is: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sign</span><span class="tok-o">);</span>
<span class="lineno">74 </span>	<span class="tok-o">}</span>
<span class="lineno">75 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program is just slightly more complex than the program for the
Chinese zodiac. You still need to jump to 12 different cases (numbered
1-12 instead of 0-11), but additional day information is needed to pin
down the sign.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_monty_hall">4.4. Solution: Monty Hall</h3>
<div class="paragraph">
<p>We now return to the Monty Hall simulation described at the beginning of
the chapter. Recall that the <code>Random</code> class allows us to generate all
kinds of random values. To implement this simulation successfully, our
program must make all the decisions needed to set up the game for the
user as well as respond to the user&#8217;s input. We begin with the <code>import</code>
statement that is necessary to use both the <code>Scanner</code> and <code>Random</code> class
and then define the <code>MontyHall</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MontyHall</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>		<span class="tok-kt">int</span> <span class="tok-n">winner</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Choose a door (enter 0, 1, or 2): &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">int</span> <span class="tok-n">choice</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-kt">int</span> <span class="tok-n">alternative</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-kt">int</span> <span class="tok-n">open</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>main()</code> method we first decide which of the three doors is the
winner. To do so, we instantiate a <code>Random</code> object and use it to
generate a random number that is either 0, 1, or 2 by calling the
<code>nextInt()</code> method with an argument of <code>3</code>. We could have added 1 to
this value to get a random choice of 1, 2, or 3, but many counting
systems in computer science start with 0 instead of 1. You might as well
get used to it. Next, we prompt the user to pick from the three doors
and read the choice. Finally, we declare two more <code>int</code> values to keep
track of which door to open and which door is the alternative that the
user can choose to change over to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">choice</span> <span class="tok-o">==</span> <span class="tok-n">winner</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>			<span class="tok-kt">int</span> <span class="tok-n">low</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>			<span class="tok-kt">int</span> <span class="tok-n">high</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">choice</span> <span class="tok-o">==</span>  <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>				<span class="tok-n">low</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>				<span class="tok-n">high</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>			<span class="tok-o">}</span>
<span class="lineno"> 8 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">choice</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>				<span class="tok-n">low</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">10 </span>				<span class="tok-n">high</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno">11 </span>			<span class="tok-o">}</span>
<span class="lineno">12 </span>			<span class="tok-k">else</span> <span class="tok-o">{</span> <span class="tok-c1">//choice == 2</span>
<span class="lineno">13 </span>				<span class="tok-n">low</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">14 </span>				<span class="tok-n">high</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">15 </span>			<span class="tok-o">}</span>
<span class="lineno">16 </span>			<span class="tok-c1">//randomly choose between other two doors</span>
<span class="lineno">17 </span>			<span class="tok-kt">double</span> <span class="tok-n">threshold</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">18 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">threshold</span> <span class="tok-o">&lt;</span> <span class="tok-mf">0.5</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">19 </span>				<span class="tok-n">alternative</span> <span class="tok-o">=</span> <span class="tok-n">low</span><span class="tok-o">;</span>
<span class="lineno">20 </span>				<span class="tok-n">open</span> <span class="tok-o">=</span> <span class="tok-n">high</span><span class="tok-o">;</span>
<span class="lineno">21 </span>			<span class="tok-o">}</span>
<span class="lineno">22 </span>			<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>				<span class="tok-n">alternative</span> <span class="tok-o">=</span> <span class="tok-n">high</span><span class="tok-o">;</span>
<span class="lineno">24 </span>				<span class="tok-n">open</span> <span class="tok-o">=</span> <span class="tok-n">low</span><span class="tok-o">;</span>
<span class="lineno">25 </span>			<span class="tok-o">}</span>
<span class="lineno">26 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have to navigate a complicated series of decisions. In this
segment of code, we are tackling the possibility that the user happened
to choose the winning door. To obey the rules of the game, we must
randomly pick which of the two other doors to open. First, we determine
which are the other two doors and save them in <code>low</code> and <code>high</code>,
respectively. Then, we generated a random number. If the random number
is less than 0.5, we keep the lower numbered door as an alternative
choice for the user and open the higher numbered door. If the random
number is greater than or equal to 0.5, we do the opposite.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>			<span class="tok-n">alternative</span> <span class="tok-o">=</span> <span class="tok-n">winner</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">choice</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">winner</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>					<span class="tok-n">open</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>				<span class="tok-k">else</span>
<span class="lineno"> 7 </span>					<span class="tok-n">open</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>			<span class="tok-o">}</span>
<span class="lineno"> 9 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">choice</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">winner</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>					<span class="tok-n">open</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno">12 </span>				<span class="tok-k">else</span>
<span class="lineno">13 </span>					<span class="tok-n">open</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">14 </span>			<span class="tok-o">}</span>
<span class="lineno">15 </span>			<span class="tok-k">else</span> <span class="tok-o">{</span> <span class="tok-c1">//choice == 2</span>
<span class="lineno">16 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">winner</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">17 </span>					<span class="tok-n">open</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">18 </span>				<span class="tok-k">else</span>
<span class="lineno">19 </span>					<span class="tok-n">open</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">20 </span>			<span class="tok-o">}</span>
<span class="lineno">21 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>else</code> block covers the case that the player did not pick the
winning door the first time. Unlike the previous code segment, we no
longer have a choice of which door to open. This time, we must always
make the winner the alternative for the user to pick. Then, we simply
determine which door is leftover so that we can open it. Note that the
braces surrounding the blocks for each of the braces surrounding the
blocks for each of the three possible values of <code>choice</code> are not
necessary but are included for readability.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;We have opened Door &quot;</span> <span class="tok-o">+</span> <span class="tok-n">open</span> <span class="tok-o">+</span>
<span class="lineno"> 2 </span>			<span class="tok-s">&quot;, and there is junk behind it!&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Do you want to change to Door &quot;</span> <span class="tok-o">+</span>
<span class="lineno"> 4 </span>			<span class="tok-n">alternative</span> <span class="tok-o">+</span> <span class="tok-s">&quot; from Door &quot;</span> <span class="tok-o">+</span> <span class="tok-n">choice</span> <span class="tok-o">+</span>
<span class="lineno"> 5 </span>			<span class="tok-s">&quot;? (Enter &#39;y&#39; or &#39;n&#39;): &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">String</span> <span class="tok-n">change</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">change</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;y&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>			<span class="tok-n">choice</span> <span class="tok-o">=</span> <span class="tok-n">alternative</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You chose Door &quot;</span> <span class="tok-o">+</span> <span class="tok-n">choice</span><span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">choice</span> <span class="tok-o">==</span> <span class="tok-n">winner</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You win a pile of gold!&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-k">else</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You win a pile of junk.&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This final segment of code informs the user which door has been opened
and prompts the user to change his or her decision. Depending on the
final choice, the program says whether or not the user wins gold or
junk.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_selection">4.5. Concurrency: Selection</h3>
<div class="paragraph">
<p>The selection primitives (<code>if</code> and <code>switch</code> statements) seem to have
little to do with concurrency or parallelism. Selection allows you to
choose between alternatives while concurrency is about the interaction
between different threads of execution. As it turns out, there are two
reasons why selection and concurrency are deeply related to each other.</p>
</div>
<div class="paragraph">
<p>The first reason is that selection is one of the most basic tools in
Java. It is impossible to go more than a few lines of a code without
encountering a selection primitive, usually an <code>if</code> statement.
Concurrent programs are not exempt from this dependence on <code>if</code>
statements. Making decisions is at the heart of all programming
languages running on all computers.</p>
</div>
<div class="paragraph">
<p>The second reason is more troubling and is related to a problem with
some concurrent programs called a <em>race condition</em>, which is discussed
in great detail in <a href="#_synchronization">Chapter 14</a>. Remember, one of
the biggest challenges of programming a computer is thinking in a
completely sequential and logical way. Each line of code is executed one
after the other. Adding in <code>if</code> statements means that some code is
executed only if a condition is true and skipped otherwise. Consider the
following fragment of code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">matches</span><span class="tok-o">.</span><span class="tok-na">areLit</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-n">flyingSparks</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">storageRoom</span><span class="tok-o">.</span><span class="tok-na">enter</span><span class="tok-o">();</span>
    <span class="tok-n">dynamite</span><span class="tok-o">.</span><span class="tok-na">unpack</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this <code>if</code> statement, the imaginary agent only enters the storage room
and unpacks the dynamite if the matches are not lit and there are no
flying sparks. When execution reaches the first line inside the <code>if</code>
block, we are certain that <code>matches.areLit()</code> returned <code>false</code> and
<code>flyingSparks</code> is <code>false</code>. This is a one-time check. If the first thing
that happens inside the <code>if</code> block is code that lights the matches, Java
will <strong>not</strong> jump out of the <code>if</code> statement.</p>
</div>
<div class="paragraph">
<p>As always, the programmer is responsible for making an <code>if</code> statement
that makes sense. It is possible that entering the storage room or
unpacking the dynamite causes sparks to fly or matches to burst into
flames spontaneously, but it seems unlikely. If the <code>storageRoom</code> and
<code>dynamite</code> objects were written by other people, we would expect their
documentation to explain unusual side-effects of this kind. In a
sequential program, the programmer can be reasonably sure that it is
safe to unpack the dynamite.</p>
</div>
<div class="paragraph">
<p>Consider another fragment of code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">matches</span><span class="tok-o">.</span><span class="tok-na">light</span><span class="tok-o">();</span>
<span class="tok-n">flyingSparks</span> <span class="tok-o">=</span> <span class="tok-n">sparklers</span><span class="tok-o">.</span><span class="tok-na">light</span><span class="tok-o">(</span> <span class="tok-n">matches</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code appears to light the matches and uses the lit matches to set
some sparklers on fire. Presumably, if the process was successful,
<code>flyingSparks</code> will have the value <code>true</code>. This code is reasonable and
potentially helpful. If you were celebrating the 4<sup>th</sup> of July or needed
to signal a passing helicopter to rescue you from a desert island,
lighting sparklers could be a great idea. This sparkler-lighting code
could occur before the dynamite-unpacking code or after it, but the
protection of the <code>if</code> statement keeps our hero from being blown up if
he tries to unpack the dynamite with lit sparklers, in a sequential
program.</p>
</div>
<div class="paragraph">
<p>In a concurrent program, all bets are off. Another thread of execution
can be operating at the very same time. It&#8217;s as if our hero is trying to
unpack the dynamite while the villain is lighting sparklers and tossing
them into the storage room. If the thread of execution gets to the <code>if</code>
statement and makes sure that the matches aren&#8217;t lit and that there are
no flying sparks, it continues onward. If sparks start flying after that
check, it still continues onward, oblivious of the fact. Even though
this risk of explosion exists, it depends on the timing of the two (or
more) concurrent threads of execution. It might be possible to run a
program 1,000 times with no problem. But if the timing is wrong on the
1,001<sup>st</sup> time, <strong>BOOM!</strong></p>
</div>
<div class="paragraph">
<p>At this point, you do not need to worry about values inside your <code>if</code>
statements being changed by other segments of code, but that problem is
at the heart of why concurrent programming can be so difficult. Whether
or not you are programming concurrently, it is always important to keep
in mind the assumptions your code makes and the way different parts of
your program interact with each other.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_4">4.6. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise4.1"></a> Given that \(x\), \(y\), and \(z\) are
propositions in Boolean logic, make a truth table for the expression
\((\lnot(x \land \lnot y)
\oplus \lnot z)\).</p>
</li>
<li>
<p><a id="exercise4.2"></a> What is the value of the Boolean expression \(\lnot((T
\oplus F) \land \lnot(F \lor T))\)?</p>
</li>
<li>
<p><a id="exercise4.3"></a> The calculation to determine the leap year given in
<a href="#leapYearExample">Example 51</a> uses three <code>if</code> statements and three
<code>else</code> statements. Write the leap year calculation using a single <code>if</code>
and a single <code>else</code>. Feel free to use <code>boolean</code> connectors such as <code>||</code>
and <code>&amp;&amp;</code>.</p>
</li>
<li>
<p><a id="exercise4.4"></a> The XOR operator (<code>^</code>) is useful for combining <code>boolean</code> values, but
it can be replaced with a more commonly used <strong>relational</strong> operator in
Java. Which one?</p>
</li>
<li>
<p><a id="exercise4.5"></a> De Morgan&#8217;s laws are the following, which show that the process of
negating a clause changes an AND to an OR and vice versa.</p>
<div class="paragraph">
<p>\(\lnot(x \land y) = \lnot x \lor \lnot y\)
\(\lnot(x \lor y) = \lnot x \land \lnot y\)</p>
</div>
<div class="paragraph">
<p>Create truth tables to verify both of these statements.</p>
</div>
</li>
<li>
<p><a id="exercise4.6"></a> Use De Morgan&#8217;s laws given above to rewrite the following statement
in Java to an equivalent statement that contains no negations.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-o">!((</span><span class="tok-n">x</span> <span class="tok-o">!=</span> <span class="tok-mi">4</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">(</span><span class="tok-n">y</span> <span class="tok-o">&lt;</span> <span class="tok-mi">2</span><span class="tok-o">));</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise4.7"></a> Consider the following fragment of code.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">y</span> <span class="tok-o">&gt;</span> <span class="tok-mi">10</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">)</span> <span class="tok-o">&gt;</span> <span class="tok-mi">5</span> <span class="tok-o">)</span>
    <span class="tok-n">y</span><span class="tok-o">++;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;x: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">x</span><span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;y: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">y</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What is the output? Is the output changed if the condition of the <code>if</code>
statement is changed to<br>
<code>y &gt; 10 &amp; (x = 10) &gt; 5</code>? Why?</p>
</div>
</li>
<li>
<p><a id="exercise4.8"></a> Consider the following fragment of code.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">7</span><span class="tok-o">;</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">a</span><span class="tok-o">++</span> <span class="tok-o">==</span> <span class="tok-mi">7</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Seven&quot;</span><span class="tok-o">);</span>
<span class="tok-k">else</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Not seven&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What is the output? Is the output changed if the condition of the <code>if</code>
statement is changed to <code>++a == 7</code>? Why? Note: It is generally wise to
avoid increment, decrement, and assignment statements in the condition
of an <code>if</code> statement because of the confusion that can arise.</p>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise4.9"></a> This problem has two parts.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Write a program that reads in two <code>double</code> values and prints the
larger of the two of them.</p>
</li>
<li>
<p>Expand the ideas from the previous program into a program that reads
in <strong>three</strong> <code>double</code> values and prints the largest of the three out.
Note: You should use nested <code>if</code> statements.</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise4.10"></a> Write programs that:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Read an <code>int</code> value from the user specifying a certain number of
cents. Use <code>if</code> statements to print out the name of the corresponding
coin in U.S. currency according to the table below. If the value doesn&#8217;t
match any coin, print <code>no coin</code>.</p>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Cents</th>
<th class="tableblock halign-center valign-top">Coin</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">penny</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">nickel</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">dime</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">quarter</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">half-dollar</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">dollar</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Read a <code>String</code> value from the user that gives one of the 6 coin
names given in the table above. Use <code>if</code> statements to print out the
corresponding number of cents for the input. If the name doesn&#8217;t many
any coin, print <code>unknown coin</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise4.11"></a> Re-implement both parts from <a href="#exercise4.10">Exercise 4.10</a> using <code>switch</code> statements instead of <code>if</code> statements.</p>
</li>
<li>
<p><a id="exercise4.12"></a> Expand the program given in
<a href="#ordinalNumbersExample">Example 55</a> to give the correct suffixes (always
&#8220;th&#8221;) for numbers that end in 11, 12, and 13. Use the modulus operator
to find the last two digits of the number. Using either an <code>if</code>
statement, a <code>switch</code> statement, or a combination, check for those three
cases before going into the normal cases.</p>
</li>
<li>
<p><a id="exercise4.14"></a> At the bottom of &lt;&lt;`switch` statements&gt;&gt;, we use a
<code>switch</code> statement to determine the location of various area codes in
New York state. Write an equivalent fragment of code using <code>if</code>-<code>else</code>
statements instead.</p>
</li>
<li>
<p><a id="exercise4.14"></a> Every member of your secret club has an ID number. These ID numbers
are between 1 and 1,000,000 and have two special characteristics: They
are multiples of 7 and all end with a 3 in the one&#8217;s place. For example,
63 is the smallest such value, and 999,943 is the largest such value.
Write a program that prompts the user for an <code>int</code> value, read it in,
and then say whether or not it could be used as an ID number. Note: You
need to use the <code>%</code> operator in two different ways to test the value
correctly.</p>
</li>
<li>
<p><a id="exercise4.15"></a> According to the North American Numbering Plan (NANP) used by the
United States, Canada, and a number of smaller countries, a legal
telephone number takes the form <code>XYY-XYY-YYYY</code>, where <code>X</code> is any digit
2-9 and <code>Y</code> is any digit 0-9. Write a program that reads in a <code>String</code>
from the user and verifies that it is a legal NANP phone number. The
length of the entire <code>String</code> must be 12. The fourth and eight
characters in the <code>String</code> (with indexes <code>3</code> and <code>7</code>) must be hyphens
(<code>-</code>), and all the remaining digits must be in the correct range. Use
the <code>charAt()</code> method of the <code>String</code> class to get the <code>char</code> value at
each index. Note: There are several ways to structure the <code>if</code>
statements you need to use, but the number of conditions may become
large. (23 or more!)</p>
</li>
<li>
<p><a id="exercise4.16"></a> Re-implement the solution to the Monty Hall program given in
<a href="#_solution_monty_hall">Section 4.4</a> using <code>JOptionPane</code> to generate GUIs for
input and output.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repetition">5. Repetition</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Q-Tip:</strong> You on point, Phife?<br>
<strong>Phife Dawg:</strong> All the time, Tip.<br>
<strong>Q-Tip:</strong> You on point, Phife?<br>
<strong>Phife Dawg:</strong> All the time, Tip.<br>
<strong>Q-Tip:</strong> You on point, Phife?<br>
<strong>Phife Dawg:</strong> All the time, Tip.<br>
<strong>Q-Tip:</strong> Well, then grab the microphone and let your words rip.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; A Tribe Called Quest
</div>
</div>
<div class="sect2">
<h3 id="_problem_dna_searching">5.1. Problem: DNA searching</h3>
<div class="paragraph">
<p>The world of bioinformatics is the intersection between biology and
computer science. Mapping the human genome would have been impossible
without computers. Sequencing genomes, determining the function of
specific genes, the analysis and prediction of protein structures, and
biomedical imaging are just a few of the areas under the umbrella of
bioinformatics. Much fascinating research is being done in this area as
biologists become better programmers and computer scientists learn more
about biology.</p>
</div>
<div class="paragraph">
<p>Because of its fundamental importance and the incredible amount of
information involved, with tens or hundreds of millions of base pairs of
DNA in each human chromosome, DNA is a central focus of bioinformatics.
As you may know, a DNA strand is made up of a sequence of four
nucleotide bases: adenine, cytosine, guanine, and thymine. These bases
are usually abbreviated as A, C, G, and T, respectively.</p>
</div>
<div class="paragraph">
<p>Searching for a specific DNA subsequence within a larger sequence is a
common task for biologists to perform. Your goal is to write a program
that will search for a subsequence and report how many times it was
found within the sequence. For example, if you are given the sequence
ATTAGACCATATA and asked to search for CAT, your program should output 1,
since there is exactly 1 occurrence of CAT within ATTAGACCATATA. One
feature of this problem that makes it more interesting is that
occurrences can overlap. For example, given the sequence TATTATTAGATTA
and asked to search for TATTA, the correct answer is 2. The sequence
begins with a TATTA, but the third T in the sequence is also the first T
in a second instance of TATTA.</p>
</div>
<div class="paragraph">
<p>In <a href="#_selection">Chapter 4</a>, you learned tools that allow you to do
comparisons and make choices based on the results. These tools will
still be useful. For example, when you come across a <code>char</code> in the
sequence, you know how to compare it to a <code>char</code> in the subsequence you
are searching for. The tools you do not yet have are those that allow
repetition. Because this problem requires the program to process a DNA
sequence of arbitrary length, we will need some way to perform a
repetitive action.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_repetition">5.2. Concepts: Repetition</h3>
<div class="paragraph">
<p>You now know how to write choices into a Java program, but, so far, each
choice can only be made once. So, if you want the computer to do a lot
of things, you have to type a lot of things. One of the big
disadvantages of computers is that they have no intelligence: They can
follow instructions blindly, but they cannot do anything else. One of
the big advantages of computers is that they are fast. Modern computers
can perform mathematical operations billions of times faster than human
beings. So, we need to give it some instructions that allow it to do
tasks over and over. Such an instruction must have two components to be
useful: It must have a way to change the task slightly each time so that
each task is useful. It must also have a way to decide when to stop,
otherwise it will continue forever.</p>
</div>
<div class="paragraph">
<p>The first component is the more subtle one. Crafting a set of
instructions so that each repetition of the task does the appropriate
thing will be different for every problem. The second component is
easier to describe: We are going to rely on Boolean logic, just as we
did for conditional statements. The main tool for repetition in Java and
many other languages is called a <em>loop</em>. The body of a loop contains the
task to be performed by the loop. The rest of the loop, at the very
least, contains a condition. Every time we finish the task given in the
body of the loop, we will check the condition. If the condition is true,
we will do the task again. If the condition is false, we are done with
the loop and can move on to the code that comes afterward.</p>
</div>
<div class="paragraph">
<p>One of the difficulties of programming a computer is that we must be
very explicit. Even the most obvious tasks must be spelled out
meticulously. Let&#8217;s consider a simple task, one that we perform every
day. If we are in a room and we want to leave, we simply walk out of the
nearest door. Assuming there is only one door in the room, how can we
describe this process by breaking it down into the steps we (literally)
take? Perhaps we could say the following.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Walk toward the door until you reach it.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This statement is a little more specific than <em>Leave the room</em>, but it
does not conform nicely to the paradigm of a loop, that is, a clearly
separated task and a condition. The following is better.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>While you are not at the door,</em></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Take a step toward the door.</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now we have good separation between the work done and the condition for
repeating. What is the task performed in the body of this loop and what
is the condition? The task is taking a step towards the door. The
condition is <strong>not</strong> being at the door. It seems a little awkward to
include that &#8220;not,&#8221; but, in our definition of loops, the body is
executed as long as the condition is true.</p>
</div>
<div class="paragraph">
<p>In a loop, we call each execution of the body of the loop an
<em>iteration</em>. When we say that a program <em>iterates</em> over the statements
in a loop, we are referring to a single pass through the body of a loop.
In this case, the loop will iterate however many times there are steps
to the door from the starting position. It is even possible that the
loop will iterate zero times: The person following this set of
instructions might already be at the door.</p>
</div>
<div class="paragraph">
<p>It&#8217;s hard to get away from numbers in a computer program, especially
since everything is fundamentally stored as numbers inside of a
computer. So, the most common kind of loop is one that iterates a fixed
number of times. For example, your morning exercise routine might
include jumping rope 100 times. We could formulate a loop to do that
like so.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Set your counter to 0.</em><br>
<em>While your counter is less than 100,</em></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Jump rope.</em><br>
<em>Increase your counter by 1.</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This loop required some set up to make sure that the counter value
started at the right place. Then, the work done by the loop is the
actual rope jumping and the counter increment. The condition is the
counter being less than 100. Note that this is strictly <strong>less</strong> than 100.
After the first jump, the counter will be incremented to 1. After the
100<sup>th</sup> jump, the counter will be incremented to 100. Since 100 is <strong>not</strong>
less than 100, the loop will exit. If the condition was the counter
being less than or equal to 100, the person following the instructions
would jump 101 times.</p>
</div>
<div class="paragraph">
<p>Input can also be a factor in loop repetitions. For example, you might
be a soldier training in the U.S. Marine Corps. Perhaps your drill
sergeant has commanded you to do push-ups until he says you can stop. We
might formulate a loop to do this as follows.<br></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Do:</em></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Push-up.</em><br>
<em>Ask the drill sergeant if you can stop.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>While the answer is &#8220;no.&#8221;</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>As is the case with user input, you must often go into the loop at least
once to get the input. This loop requires the soldier to do at least one
push-up before asking to stop. Some systems might use input but have
other constraints. A more realistic version of this loop might be the
following.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Do:</em></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Push-up.</em><br>
<em>Ask the drill sergeant if you can stop.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>While the answer is &#8220;no&#8221; and you haven&#8217;t collapsed.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Remember, the condition for a loop should be a Boolean, and the loop
runs as long as the condition is true. However, there is no reason why
the Boolean cannot be a complicated expression using all the Boolean
logic we have come to know and love.</p>
</div>
<div class="paragraph">
<p>Of course it is possible to <em>nest</em> loops. Nesting loops means putting
one loop inside of another, similar to the way that conditional
statements could be nested inside of other conditional statements. Just
like any other statement, an inner loop will be run as many times as the
outer loop runs. Of course, the statements inside of the inner loop will
be run according to the conditions of that loop. So, if an outer loop
runs 10 times and an inner loop runs 50 times, a statement in the body
of an inner loop would run 500 times!</p>
</div>
<div class="paragraph">
<p>As an example, if you are working out, you might do several sets of
bench presses with a fixed number of reps in each set. If you did 3 sets
of 15 bench presses each, your workout program might look like this:<br></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Set your set counter to 0.</em><br>
<em>While your set counter is less than 3,</em><br></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Set your rep counter to 0.</em><br>
<em>While your rep counter is less than 15,</em></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Do a bench press.</em><br>
<em>Increase your rep counter by 1.</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Rest for 2 minutes.</em><br>
<em>Increase your set counter.</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This way of describing the work out program seems tedious. Most of the
description is structural: conditions for the loops and increments for
the counters. The only &#8220;real&#8221; activities are the bench press and the
resting. As you can see, the bench press is inside the inner rep loop
and will be executed 15 times each time for each complete execution of
the inner rep loop. Since the inner rep loop sits inside the outer set
loop, it will be executed 3 times, giving a grand total of 45 bench
presses. Resting, however, is after the inner rep loop but still
contained in the outer set loop and will be executed 3 times, totaling 6
minutes of rest.</p>
</div>
<div class="paragraph">
<p>As with conditionals, writing out loops in English is tedious and
imprecise. In the next section, we will discuss the tools for writing
loops in Java. Because Java was designed with loops as a central tool,
we can write loops much more succinctly than in English, squeezing a lot
of information into a small space. Because we pack so much information
into them, loops can look daunting at first. Remember that the syntax we
will introduce is only the formal Java way of expressing a condition and
a list of instructions to execute repeatedly.</p>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_loops_in_java">5.3. Syntax: Loops in Java</h3>
<div class="paragraph">
<p>The Java programming language contains three differently named kinds of
loops: <code>while</code> loops, <code>for</code> loops, and <code>do-while</code> loops. All of them
allow you to write code that will be executed repeatedly. In fact, any
program that uses one style of loops to solve a problem could be
converted to use either of the other two kinds. The three kinds are
provided in Java partly so that it is easy to code certain typical kinds
of repetition and partly because the C language, an ancestor of Java,
contained these three. We will begin by describing <code>while</code> loops because
they have the simplest form and then move on to the other two kinds. We
will then explain the syntax for nesting together multiple loops and
finally discuss several of the common pitfalls encountered by
programmers who are coding loops.</p>
</div>
<div class="sect3">
<h4 id="_code_while_code_loops">5.3.1. <code>while</code> loops</h4>
<div class="paragraph">
<p>Superficially, the syntax of a <code>while</code> loop resembles an <code>if</code> statement.
It starts with the keyword <code>while</code> followed by a <code>boolean</code> condition in
parentheses with a block of code surrounded by braces (<code>\{\}</code>)
afterward. This similarity is not accidental. The only difference
between the two is that the body of the <code>if</code> statement will run a only
single time, while the body of the <code>while</code> loop will run as long as the
condition remains <code>true</code>. <a href="#figure-while">Figure 20</a> shows the pattern of
execution for <code>while</code> loops.</p>
</div>
<div id="figure-while" class="imageblock text-center">
<div class="content">
<img src="chapters/05-repetition/images/while.svg" alt="while" width="75%">
</div>
<div class="title">Figure 20. If the condition is <code>true</code>, all of the statements in the body of the loop are executed, and then the condition is checked again. When the check is <code>false</code>, execution skips past the body of the loop.</div>
</div>
<div class="paragraph">
<p>If we assume that the <code>boolean</code> value <code>atDoor</code> says whether or not we
have reached the door and the method <code>walkTowardsDoor()</code> allows us to
take one step closer to the door, we could formulate our example from
the beginning of the previous section as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">atDoor</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">atDoor</span> <span class="tok-o">=</span> <span class="tok-n">walkTowardsDoor</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we assume that the <code>walkTowardsDoor()</code> method gives back a
<code>boolean</code> value that is <code>true</code> if we have reached the door and <code>false</code>
otherwise. Unless the <code>walkTowardsDoor()</code> method is able to change the
value of <code>atDoor</code>, the loop will repeat forever, a phenomenon known as
an <em>infinite loop</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Help me!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This loop is an example of an infinite loop. If you run this code inside
of a program, it will print out an endless succession of <code>Help me!</code>
messages. Be prepared to stop the program by typing <code>Ctrl-C</code> (hold down
the <code>Control</code> key and press <code>C</code>) because it will not end otherwise. Not
all infinite loops are this obvious. A programmer will not usually use
<code>true</code> as the condition of a loop, but doing so is not always wrong.
Some loops are expected to continue for quite some time with no definite
end. To leave a loop abruptly, you can use the <code>break</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Help me!&quot;</span><span class="tok-o">);</span>
    <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This loop will only print out a single <code>Help me!</code> before exiting. A
<code>break</code> command can be used with an <code>if</code> statement to make a loop that
repeats more than once.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;the loop &quot;</span><span class="tok-o">);</span>
    <span class="tok-n">counter</span><span class="tok-o">++;</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">counter</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">3</span> <span class="tok-o">)</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;is on fire!&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This loop will print out <code>the loop the loop the loop is on fire!</code> Of
course, the <code>break</code> statement unnecessarily complicates the code. We
could have written equivalent code as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">counter</span> <span class="tok-o">&lt;</span> <span class="tok-mi">3</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;the loop &quot;</span><span class="tok-o">);</span>
    <span class="tok-n">counter</span><span class="tok-o">++;</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;is on fire!&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we move on to a more complicated example that can print out the
binary equivalent of a number.</p>
</div>
<div class="exampleblock">
<div class="title">Example 57. Binary Conversion</div>
<div class="content">
<div class="paragraph">
<p>As we discussed in <a href="#_computer_basics">Chapter 1</a>, binary numbers
are the building blocks of every piece of data inside of a modern
computer&#8217;s memory. Integers are stored in binary. The representation of
floating point numbers is more complicated, but it also uses 1s and 0s.
Even the <code>char</code> data type and the <code>String</code> values built from them are
fundamentally stored as binary numbers. For this reason, computer
scientists tend to be familiar with the base 2 number system and how to
convert between it and base 10, our usual number system.</p>
</div>
<div class="paragraph">
<p>In base 10, the number 379 is equal to
3 · 100 + 7 · 10 + 9 · 1 = 3 · 10<sup>2</sup> + 7 · 10<sup>1</sup> + 9 · 10<sup>0</sup>.
Moving from right to left, the value of each place increases by a factor
of 10. A binary number is the same, except that the increase is by a
factor of 2 and no single digit is greater than 1. Thus, the number
101011<sub>2</sub> = 1 · 2<sup>5</sup> + 0 · 2<sup>4</sup> + 1 · 2<sup>3</sup> + 0 · 2<sup>2</sup> + 1 · 2 + 1 · 2<sup>0</sup> = 1 · 32 + 0 · 16 + 1 · 8 + 0 · 4 + 1 · 2 + 1 · 0 = 43.
In binary, the number 379 = 101111011<sub>2</sub>.</p>
</div>
<div class="paragraph">
<p>To convert a number \(n\) to binary, we first find the largest
power of 2 that is not larger than \(n\). Then, we begin a
repetitive process that stops when the power of 2 under consideration is
0. If 2 raised to the current power is bigger than \(n\), we
print out a 0 because that power is too big for \(n\).
Otherwise, we print out a 1, subtract 2 raised to that power from
\(n\), and move on to the next smaller power of 2. This
process will print a 0 for every power of 2 that is not in
\(n\) and a 1 for every one that is, giving exactly the
definition of a number written in base 2.</p>
</div>
<div id="DecimalToBinaryProgram" class="listingblock">
<div class="title">Program 18. Outputs a binary representation of a decimal number.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DecimalToBinary</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a base 10 number: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">power</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">power</span> <span class="tok-o">&lt;=</span> <span class="tok-n">number</span><span class="tok-o">/</span><span class="tok-mi">2</span> <span class="tok-o">)</span>
<span class="lineno">10 </span>			<span class="tok-n">power</span> <span class="tok-o">*=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">power</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">power</span> <span class="tok-o">&gt;</span> <span class="tok-n">number</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="lineno">14 </span>			<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">);</span>
<span class="lineno">16 </span>				<span class="tok-n">number</span> <span class="tok-o">-=</span> <span class="tok-n">power</span><span class="tok-o">;</span>
<span class="lineno">17 </span>			<span class="tok-o">}</span>
<span class="lineno">18 </span>			<span class="tok-n">power</span> <span class="tok-o">/=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno">19 </span>		<span class="tok-o">}</span>
<span class="lineno">20 </span>	<span class="tok-o">}</span>
<span class="lineno">21 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first <code>while</code> loop in this program doubles the value of <code>power</code>
until doubling it again would make it larger than <code>number</code>. We go up to
and including <code>number/2</code>, otherwise we would stop when <code>power</code> was
larger than <code>number</code>. After that loop, we begin repeatedly checking to
see if a given power of 2 is bigger than the value left in <code>number</code>. If
it is, we know that we do not use that power. If it is not, we do and
must remove that power from the value of <code>number</code>.</p>
</div>
<div class="paragraph">
<p>You may have been tempted to solve this problem by determining if a
given number is even or odd. If it is even, then you record a 0, and if
it is odd, then you record a 1. You could then divide the number by two
and repeat the process of determining whether it is even or odd. You
could continue this process until the number became 0. This procedure
requires only a single <code>while</code> loop and would give the digits of the
number in base 2. Unfortunately, you would get the digits in reverse
order. Because we write our numbers with the most significant digit on
the left, we had to use the code given above to first find the largest
value and work backwards, in order to determine the binary digits in the
correct sequence.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_for_code_loops">5.3.2. <code>for</code> loops</h4>
<div class="paragraph">
<p>Let&#8217;s return to our code that prints out
<code>the loop the loop the loop is on fire!</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">counter</span> <span class="tok-o">&lt;</span> <span class="tok-mi">3</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;the loop &quot;</span><span class="tok-o">);</span>
    <span class="tok-n">counter</span><span class="tok-o">++;</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;is on fire!&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code involves some initialization, a condition, and an update, as
many loops do. The initialization sets <code>counter</code> to <code>0</code>. The condition
checks to make sure that <code>counter</code> is less than <code>3</code>. The update
increments <code>counter</code> by 1 every iteration of the loop. These three
elements are so common that a special kind of loop called the <code>for</code> loop
was designed with them explicitly in mind. Most <code>for</code> loops are
dependent on a single counting variable. To make the loop easy to read,
the initialization, condition, and update, all of which relate to this
variable, are pulled into the header of the loop. We could code the
previous <code>while</code> loop example more cleanly, using a <code>for</code> loop, as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">3</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;the loop &quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;is on fire!&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The header of a <code>for</code> loop consists of those three parts: the
initialization, the condition, and the update, all separated by
semicolons. <a href="#figure-for">Figure 21</a> shows the pattern of execution for
<code>for</code> loops.</p>
</div>
<div id="figure-for" class="imageblock text-center">
<div class="content">
<img src="chapters/05-repetition/images/for.svg" alt="for" width="75%">
</div>
<div class="title">Figure 21. The loop is initialized. If the condition is <code>true</code>, all of the statements in the body of the loop are executed, followed by the increment step. Then the condition is checked again. When the check is <code>false</code>, execution skips past the body of the loop.</div>
</div>
<div class="paragraph">
<p>You may have noticed that we have changed the variable name used within
the loop from <code>counter</code> to <code>i</code>. Doing so does not change the function of
the code. We did so because using the variables <code>i</code>, <code>j</code>, and sometimes
<code>k</code> is a very common practice with <code>for</code> loops. By using variables named
like this, we are indicating that the variable is just a dummy counter
that we are using to make the loop work, not some variable with a
grander purpose. Also, with three uses of a single variable in the
header of a <code>for</code> loop, a long variable name will take up a lot of
space.</p>
</div>
<div class="paragraph">
<p><code>for</code> loops are used in Java programs more than the other two loops.
They work well when you know how many times you want to iterate through
the loop, which you often do. You can think of the first part of the
<code>for</code> loop header as the starting point, the second part as the ending
point, and the third part as how you get from the start to the end. Many
beginning programmers get stuck on the idea that every <code>for</code> loop starts
with <code>int i = 0</code> and ends with <code>i++</code>. While this pattern is often true,
there are many other ways to use a for loop. For example, we could print
the powers of 2 that are less than 1000.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">1000</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">*=</span> <span class="tok-mi">2</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This segment of code prints out <code>1</code>, <code>2</code>, <code>4</code>, <code>8</code>, <code>16</code>, <code>32</code>, <code>64</code>,
<code>128</code>, <code>256</code>, and <code>512</code> on separate lines, which are the powers of
\(2\) from \(2^0\) up to \(2^9\). As you
know from discussion about binary numbers, powers of two have a special
interest to computer scientists. Both of the examples of <code>for</code> loops we
have given have only had a single executable line in the body of the
loop. Like <code>if</code> statements, loops only require braces if their bodies
have more than one executable line. Many of the <code>while</code> loops from the
previous subsection could have been written without braces.</p>
</div>
<div class="paragraph">
<p>Just because a <code>for</code> loop already has a counting mechanism doesn&#8217;t mean
that we will not need other variables to perform useful tasks. For
example, given a <code>String</code>, we could try to find the letter of the
alphabet in the <code>String</code> which is closest to the end of the alphabet.
For the <code>String</code> <code>"Pluto is no longer a planet"</code>, the latest letter in
the alphabet is <code>'u'</code>. To write code that will do this job, we must use
the counting variable from the <code>for</code> loop as an <em>index</em> into the
<code>String</code>. Then, we must also have a temporary variable where we keep the
latest letter found so far. To get the \(i\)<sup>th</sup> <code>char</code> from a
<code>String</code>, we can use the <code>charAt()</code> method. The index of the first
<code>char</code> in a <code>String</code> is 0, and the index of the last <code>char</code> is one less
than the length of the <code>String</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-s">&quot;The quick brown fox jumps over the lazy dog.&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">lower</span> <span class="tok-o">=</span> <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="tok-kt">char</span> <span class="tok-n">latest</span> <span class="tok-o">=</span> <span class="tok-sc">&#39; &#39;</span><span class="tok-o">;</span>
<span class="tok-kt">char</span> <span class="tok-n">c</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">lower</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">c</span> <span class="tok-o">&gt;=</span> <span class="tok-sc">&#39;a&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">&lt;=</span> <span class="tok-sc">&#39;z&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">&gt;</span> <span class="tok-n">latest</span> <span class="tok-o">)</span>
        <span class="tok-n">latest</span> <span class="tok-o">=</span> <span class="tok-n">c</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The latest character in the alphabet &quot;</span> <span class="tok-o">+</span>
    <span class="tok-s">&quot;from your message is: &#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">latest</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;.&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first thing we do in this example is convert <code>s</code> to lower case, so
that we are comparing all <code>char</code> values in the same case. Next, we run
through <code>lower</code>, starting at index 0 and going until we reach the end of
the <code>String</code>. For each <code>char</code>, we check to see if it is an alphabetic
character and then if it is later in the alphabet than our current
latest. If it is, we store it into <code>latest</code>. After the loop, we print
out the value in <code>latest</code>. We have chosen the <code>char</code> <code>' '</code> because it is
numerically earlier than all the letters in the alphabet. If the output
is a space, we would know that none of the characters in <code>s</code> were
alphabetic.</p>
</div>
<div class="paragraph">
<p>For the example given, the latest character in the alphabet is <code>'z'</code>
because of the word <code>"lazy"</code>. One weakness in this code is that it will
always search through the entire <code>String</code>, even if the letter <code>'z'</code> has
already been found. For the <code>String</code>
<code>"The quick brown fox jumps over the lazy dog."</code>, we are not wasting too
much time. However, if the <code>String</code> were <code>"Zanzibar!"</code> followed by the
full text of <em>War and Peace</em>, we would be wasting thousands and
thousands of operations reading characters when we knew that <code>'z'</code> was
going to be the latest letter, no matter what. So, we can rewrite our
<code>for</code> loop so that it quits early if it reaches a <code>'z'</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">lower</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">c</span> <span class="tok-o">&gt;=</span> <span class="tok-sc">&#39;a&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">&lt;=</span> <span class="tok-sc">&#39;z&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">&gt;</span> <span class="tok-n">latest</span> <span class="tok-o">)</span>
        <span class="tok-n">latest</span> <span class="tok-o">=</span> <span class="tok-n">c</span><span class="tok-o">;</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">latest</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;z&#39;</span> <span class="tok-o">)</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of the <code>for</code> loop will break out immediately if the latest
is already a <code>'z'</code>. This code will work efficiently, but many
professional programmers discourage the use of <code>break</code> except when
absolutely necessary (like in a <code>switch</code> statement). If a <code>break</code> is
used to exit the loop, this logic can be encoded into the condition of
the loop. Thus, the same loop written with better style would be the
following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">lower</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">latest</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;z&#39;</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">c</span> <span class="tok-o">&gt;=</span> <span class="tok-sc">&#39;a&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">&lt;=</span> <span class="tok-sc">&#39;z&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">&gt;</span> <span class="tok-n">latest</span> <span class="tok-o">)</span>
        <span class="tok-n">latest</span> <span class="tok-o">=</span> <span class="tok-n">c</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For this final version of the loop, we have made the conditional portion
of the header more complex. The comparison using <code>&lt;</code> gives a <code>boolean</code>
that we combine using <code>\&amp;\&amp;</code> with the <code>boolean</code> from the comparison
using <code>!=</code>. As always, remember that the loop will continue iterating as
long as the condition is <code>true</code>. Since we need both parts of the
condition to be <code>true</code> to continue executing, we use the <code>\&amp;\&amp;</code> operator
to connect them.</p>
</div>
<div class="paragraph">
<p>We apologize to international readers for focusing on the Latin alphabet
used by English and many other Western European languages. It should be
possible to make a localized version of this example with any alphabet
by checking the return value of <code>Character.isLetter(c)</code>, which is valid
for all single-character Unicode values, although the idea of
alphabetical order does not really apply to some character systems like
the hanzi and kanji of Chinese and Japanese. Regardless, using the
<code>Character.isLetter()</code> method is recommended for almost all
applications, since it is more general and more readable.</p>
</div>
<div id="primalityTestingExample" class="exampleblock">
<div class="title">Example 58. Primality testing</div>
<div class="content">
<div class="paragraph">
<p>Prime numbers are numbers whose only factors are 1 and themselves. If
you have encountered prime numbers before, they probably seemed like a
mathematical curiosity and nothing more. In fact, prime numbers are the
basis of a very practical application of mathematics: cryptography. With
the use of some math and very large prime numbers, computer scientists
have devised techniques that make shopping online safer.</p>
</div>
<div class="paragraph">
<p>These techniques are beyond the scope of this book, but we can at least
write some code to determine if a number \(n\) is prime. To do
so, we can simply divide \(n\) by all the numbers between 2
and \(n - 1\). If none of the numbers divide it evenly, it
must be prime. Here is this basic solution.</p>
</div>
<div id="PrimalityTester0Program" class="listingblock">
<div class="title">Program 19. Gives a naive approach for testing if a number is prime.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PrimalityTester0</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a number: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">long</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLong</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">prime</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">long</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">number</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">prime</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">10 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">number</span> <span class="tok-o">%</span> <span class="tok-n">i</span>  <span class="tok-o">==</span>  <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>				<span class="tok-n">prime</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">prime</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">number</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is prime.&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>		<span class="tok-k">else</span>
<span class="lineno">15 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">number</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is not prime.&quot;</span><span class="tok-o">);</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span>
<span class="lineno">17 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program has a <code>for</code> loop that runs from <code>2</code> up to <code>number - 1</code>,
provided that we don&#8217;t find a number that evenly divides <code>number</code>. This
optimization means that the program will output the moment that it knows
that the number is not prime, but we will still have to wait for it to
check all the other possibilities before it is sure that the number is
prime.</p>
</div>
<div class="paragraph">
<p>One insight that we can use to make the program more efficient is that,
after checking 2, we don&#8217;t have to divide it by any even numbers. So, we
can do half the checking with a few simple modifications.</p>
</div>
<div id="PrimalityTester1Program" class="listingblock">
<div class="title">Program 20. Gives a slightly cleverer approach for testing if a number is prime.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PrimalityTester1</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a number: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">long</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLong</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">prime</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">number</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">!=</span> <span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">long</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">number</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">prime</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">+=</span> <span class="tok-mi">2</span>  <span class="tok-o">)</span>
<span class="lineno">10 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">number</span> <span class="tok-o">%</span> <span class="tok-n">i</span>  <span class="tok-o">==</span>  <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>				<span class="tok-n">prime</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">prime</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">number</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is prime.&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>		<span class="tok-k">else</span>
<span class="lineno">15 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">number</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is not prime.&quot;</span><span class="tok-o">);</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span>
<span class="lineno">17 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of the program sets the <code>boolean</code> variable <code>prime</code> to
<code>false</code> if <code>number</code> is divisible by 2 and <code>true</code> otherwise. Then, it
starts the search at 3 and continues in jumps of 2. Although we are
saving half the time, we can still do better. Note that if a number
\(n\) is divisible by 2, then it is also divisible by
\(\frac{n}{2}\). So, if a number is <strong>not</strong> divisible by 2, it
is not divisible by any number larger than \(\frac{n}{2}\). If
it is not divisible by 2 or 3, then it is not divisible by any number
larger than \(\frac{n}{3}\). If it is not divisible by 2 or 3
or 4, it is not divisible by any number larger than
\(\frac{n}{4}\), and so on. Thus, we do not have to check all
the way up to \(n - 1\). If we are checking to see if
\(n\) is divisible by \(x\) and learning that
\(n\) is not divisible by anything larger than
\(\frac{n}{x}\), the point where \(x = \frac{n}{x}\)
is when \(x = \sqrt{n}\). Thus, we only need to search up to
\(\sqrt{n}\), which will save even more time.</p>
</div>
<div id="PrimalityTester2Program" class="listingblock">
<div class="title">Program 21. Gives a much faster approach for testing if a number is prime.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PrimalityTester2</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a number: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">long</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLong</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">prime</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">number</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">!=</span> <span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">long</span> <span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">long</span><span class="tok-o">)</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-n">number</span><span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">long</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-n">root</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">prime</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">+=</span> <span class="tok-mi">2</span>  <span class="tok-o">)</span>
<span class="lineno">11 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">number</span> <span class="tok-o">%</span> <span class="tok-n">i</span>  <span class="tok-o">==</span>  <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">12 </span>				<span class="tok-n">prime</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">prime</span> <span class="tok-o">)</span>
<span class="lineno">14 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">number</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is prime.&quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>		<span class="tok-k">else</span>
<span class="lineno">16 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">number</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is not prime.&quot;</span><span class="tok-o">);</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note in this version of the program we do go up to and including <code>root</code>,
because there is the possibility that <code>number</code> is a perfect square.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise5.2">Exercise 5.2</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 59. DNA reverse complement</div>
<div class="content">
<div class="paragraph">
<p>DNA is usually double stranded, with each base paired to another
specific base, called its complementary base. The following table shows
the association between each base and its complementary base.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Base</th>
<th class="tableblock halign-center valign-top">Abbreviation</th>
<th class="tableblock halign-center valign-top">Complementary Base</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Adenine</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Cytosine</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">G</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Guanine</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">G</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Thymine</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A simple but common task is finding the reverse complement of a DNA
sequence. The reverse complement of a DNA sequence is its sequence of
complementary bases given in reverse order. For example, the reverse
complement of ACATGAG is CTCATGT. This sequence is found by first
finding the complement of ACATGAG, which is TGTACTC, and then reversing
its order.</p>
</div>
<div class="paragraph">
<p>We will write a program that finds the reverse complement of a DNA
sequence entered by a user. This sequence will be entered as a sequence
of characters made up of the four abbreviations for the bases: A, C, G,
and T. We will store this sequence as a <code>String</code> and perform some
manipulations on it to get the reverse complement.</p>
</div>
<div id="ReverseComplementProgram" class="listingblock">
<div class="title">Program 22. Finds the reverse complement of a DNA sequence.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ReverseComplement</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a DNA sequence: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">String</span> <span class="tok-n">sequence</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toUpperCase</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-n">String</span> <span class="tok-n">complement</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">10 </span>			<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-c1">//get complements</span>
<span class="lineno">11 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;A&#39;</span><span class="tok-o">:</span> <span class="tok-n">complement</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;T&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">12 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;C&#39;</span><span class="tok-o">:</span> <span class="tok-n">complement</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;G&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">13 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;G&#39;</span><span class="tok-o">:</span> <span class="tok-n">complement</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;C&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">14 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;T&#39;</span><span class="tok-o">:</span> <span class="tok-n">complement</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;A&quot;</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">15 </span>			<span class="tok-o">}</span>
<span class="lineno">16 </span>		<span class="tok-n">String</span> <span class="tok-n">reverseComplement</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="lineno">17 </span>		<span class="tok-c1">//reverse the complement</span>
<span class="lineno">18 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">complement</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">--</span> <span class="tok-o">)</span>
<span class="lineno">19 </span>			<span class="tok-n">reverseComplement</span> <span class="tok-o">+=</span> <span class="tok-n">complement</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno">20 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Reverse complement: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">21 </span>			<span class="tok-n">reverseComplement</span><span class="tok-o">);</span>
<span class="lineno">22 </span>	<span class="tok-o">}</span>
<span class="lineno">23 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example first creates a <code>String</code> filled with the complement of the
base pairs from the input <code>String</code>. Then, in a second step, it creates a
new <code>String</code> that is the reverse of the complement sequence. Note how
<code>complement</code> is created by appending the <code>char</code> corresponding to the
complementary base at the <strong>end</strong> of <code>complement</code>. If we inserted each
<code>char</code> at the beginning of <code>complement</code>, we would not need to reverse in
a separate step.</p>
</div>
<div id="CleverReverseComplementProgram" class="listingblock">
<div class="title">Program 23. More cleverly finds the reverse complement of a DNA sequence.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CleverReverseComplement</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Please enter a DNA sequence: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">String</span> <span class="tok-n">sequence</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toUpperCase</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-n">String</span> <span class="tok-n">reverseComplement</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">10 </span>			<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-c1">//get complements</span>
<span class="lineno">11 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;A&#39;</span><span class="tok-o">:</span> <span class="tok-n">reverseComplement</span> <span class="tok-o">=</span> <span class="tok-s">&quot;T&quot;</span> <span class="tok-o">+</span>
<span class="lineno">12 </span>					<span class="tok-n">reverseComplement</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">13 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;C&#39;</span><span class="tok-o">:</span> <span class="tok-n">reverseComplement</span> <span class="tok-o">=</span> <span class="tok-s">&quot;G&quot;</span> <span class="tok-o">+</span>
<span class="lineno">14 </span>					<span class="tok-n">reverseComplement</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">15 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;G&#39;</span><span class="tok-o">:</span> <span class="tok-n">reverseComplement</span> <span class="tok-o">=</span> <span class="tok-s">&quot;C&quot;</span> <span class="tok-o">+</span>
<span class="lineno">16 </span>					<span class="tok-n">reverseComplement</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">17 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;T&#39;</span><span class="tok-o">:</span> <span class="tok-n">reverseComplement</span> <span class="tok-o">=</span> <span class="tok-s">&quot;A&quot;</span> <span class="tok-o">+</span>
<span class="lineno">18 </span>					<span class="tok-n">reverseComplement</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">19 </span>			<span class="tok-o">}</span>
<span class="lineno">20 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Reverse complement: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">21 </span>			<span class="tok-n">reverseComplement</span><span class="tok-o">);</span>
<span class="lineno">22 </span>	<span class="tok-o">}</span>
<span class="lineno">23 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_do_while_code_loops">5.3.3. <code>do-while</code> loops</h4>
<div class="paragraph">
<p>Use this rule of thumb for deciding which kind of loop to use: If you
know how many times you want the loop to execute, use a <code>for</code> loop. If
you don&#8217;t know how many times you want it to execute, use a <code>while</code>
loop. Clearly, this rule is not iron-clad. In the previous example, we
used a <code>for</code> loop even though it would stop executing as soon as a <code>'z'</code>
was encountered. Nevertheless, it seems like we have covered all of the
possible situations with <code>while</code> and <code>for</code> loops. When should we use
<code>do-while</code> loops? The simple answer is: never.</p>
</div>
<div class="paragraph">
<p>You never <strong>have</strong> to use a <code>do-while</code> loop. With a little bit of effort,
you use a single kind of loop for every job. The key difference between
a <code>do-while</code> loop and a regular <code>while</code> loop is that a <code>do-while</code> loop
will always run at least once. Neither of the other two loops give you
that guarantee. The syntax for a <code>do-while</code> loop is a <code>do</code> at the top of
a loop body enclosed in braces, with a normal <code>while</code> header at the end,
including a condition in parentheses, followed by a semicolon.
<a href="#figure-do-while">Figure 22</a> shows the pattern of execution for <code>do-while</code>
loops.</p>
</div>
<div id="figure-do-while" class="imageblock text-center">
<div class="content">
<img src="chapters/05-repetition/images/dowhile.svg" alt="dowhile" width="75%">
</div>
<div class="title">Figure 22. The statements in the body of the loop are executed, and then the condition is checked. When the check is <code>false</code>, execution skips past the body of the loop. A <code>do-while</code> loop is guaranteed to run at least once.</div>
</div>
<div class="paragraph">
<p>We can use a <code>do-while</code> loop to print out the first 10 perfect squares
as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-k">do</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">x</span><span class="tok-o">*</span><span class="tok-n">x</span><span class="tok-o">);</span>
    <span class="tok-n">x</span><span class="tok-o">++;</span>
<span class="tok-o">}</span> <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">x</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">10</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This loop behaves exactly the same as the following loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">x</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">10</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">x</span><span class="tok-o">*</span><span class="tok-n">x</span><span class="tok-o">);</span>
    <span class="tok-n">x</span><span class="tok-o">++;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The time when a <code>do-while</code> loop is really going to shine is when your
program will work incorrectly if the loop doesn&#8217;t run at least once.
This situation often occurs with input, when the loop must run at least
once before checking the condition. For example, imagine that you want
to write a program that picks a random number between 1 and 100 and lets
the user guess what it is until the user gets it right. You need a loop
because it is a repetitive activity, but you need to let the user guess
at least once so that you can check to see if he or she was right. The
following program fragment does exactly that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="tok-kt">int</span> <span class="tok-n">guess</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-k">do</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;What is your guess? &quot;</span><span class="tok-o">);</span>
    <span class="tok-n">guess</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="tok-o">}</span> <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">guess</span> <span class="tok-o">!=</span> <span class="tok-n">number</span> <span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You got it! The number was &quot;</span> <span class="tok-o">+</span> <span class="tok-n">number</span> <span class="tok-o">+</span> <span class="tok-s">&quot;.&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could perform the same function with a <code>while</code> loop, but you will
need to get some input from the user before the loop starts. Using the
<code>do-while</code> loop is a little more elegant.</p>
</div>
</div>
<div class="sect3">
<h4 id="_nested_loops">5.3.4. Nested loops</h4>
<div class="paragraph">
<p>As with <code>if</code> statements, it is possible to nest loops inside of other
loops. In the simplest case, you may have some repetitive activity that
itself needs to be performed several times. For example, when you were
younger, you probably had to learn your multiplication tables. For each
number, a multiplication table gave the value of the product of that
number by every integer between 1 and 12. We can write code to print out
out the multiplication table for every number from 1 to 10 by simply
repeating the process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">number</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">number</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">factor</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">factor</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">12</span><span class="tok-o">;</span> <span class="tok-n">factor</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">number</span> <span class="tok-o">+</span> <span class="tok-s">&quot; x &quot;</span> <span class="tok-o">+</span> <span class="tok-n">factor</span> <span class="tok-o">+</span>
            <span class="tok-s">&quot; = &quot;</span> <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">number</span><span class="tok-o">*</span><span class="tok-n">factor</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The outer loop incrementing <code>number</code> will run 10 times. The inner loop
incrementing <code>factor</code> runs 12 times for each iteration of the outer
loop. So, the code in the inner loop will run a total of 120 times.
Every 12 iterations, the inner loop will stop, and an extra blank line
will be added by the <code>System.out.println()</code> method in the outer loop.</p>
</div>
<div class="exampleblock">
<div class="title">Example 60. Triangular numbers</div>
<div class="content">
<div class="paragraph">
<p>The sequence consisting of 1, 3, 6, 10, 15, and so on is known as the
triangular numbers. The \(i\)<sup>th</sup> triangular number is the sum
of the first \(i\) integers. They are called triangular
numbers because they can be drawn as equilateral triangles in a very
natural way, if you use a number of dots equal to the number.</p>
</div>
<div class="paragraph">
<p>We can use nested loops to print out the first \(n\)
triangular numbers, where \(n\) is specified by the user.</p>
</div>
<div id="TriangularNumbersProgram" class="listingblock">
<div class="title">Program 24. Prints out triangular numbers.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TriangularNumbers</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;How many triangular numbers? &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">sum</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>			<span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">11 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;=</span> <span class="tok-n">i</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">12 </span>				<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">j</span><span class="tok-o">;</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">sum</span><span class="tok-o">);</span>
<span class="lineno">14 </span>		<span class="tok-o">}</span>
<span class="lineno">15 </span>	<span class="tok-o">}</span>
<span class="lineno">16 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the outer loop iterates through each of the <code>n</code>
different triangular numbers. Then, the inner loop does the summation
needed to compute the given triangular number. Producing a sequence of
triangular numbers this way is, unfortunately, not the most efficient
way to do it. Nested loops are an effective way to solve many problems,
particularly certain types of problems using arrays, but we can generate
triangular numbers using only a single <code>for</code> loop. The key insight is
that we can keep track of the previous triangular number and add
\(i\) to it, as \(i\) increases.</p>
</div>
<div id="CleverTriangularNumbersProgram" class="listingblock">
<div class="title">Program 25. Prints out triangular numbers more cleverly.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CleverTriangularNumbers</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;How many triangular numbers? &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">triangular</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>			<span class="tok-n">triangular</span> <span class="tok-o">+=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="lineno">11 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">triangular</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-o">}</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By removing the inner <code>for</code> loop, the total amount of work needed is
greatly reduced.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="subsection:common_pitfalls">5.3.5. Common pitfalls</h4>
<div class="paragraph">
<p>With great power comes great responsibility. The power to repeat things
a large number of times means that we can also repeat our mistakes a
large number of times. Many classic bugs occur as a result of logical or
typographical errors in loops. Below we will list a few of the most
common.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Infinite loops</div>
<div class="paragraph">
<p>It is possible to create a loop that never terminates. Your program may
be taking a long time to finish, but if it takes much longer than you
expect, an infinite loop might be the culprit. Infinite loops might
occur because you forgot to include an appropriate statement to advance
a counter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">number</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">100</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">number</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code is presumably intended to print out the first 100 integers,
but there is no code that increases the value of <code>number</code>. As a
consequence, the number <code>1</code> will be printed out over and over until the
user stops the program from executing. Usually, the cause is more
subtle, as in the following code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">+=</span> <span class="tok-mf">0.5</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Half a step forward, half a step back...&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One might expect this code to print out 20 lines of output. However,
remember that <code>i</code> is an <code>int</code>. Adding <code>0.5</code> to <code>0</code> and then casting it
to an <code>int</code> gives <code>0</code> again. What is particularly insidious about this
loop is that it compiles without even a warning in Java. Usually
conversion from a <code>double</code> to an <code>int</code> requires an explicit cast, but
the <code>+=</code> operator (and other similar operators) behave a little
differently for technical reasons.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Almost infinite loops</div>
<div class="paragraph">
<p>Many loops are truly infinite; others take a really long time. For
example, if you intended to run a loop down from 10 to 0, but increment
your counter instead of decrementing it, overflow means that you will
eventually get to a number less than 0, but it will take more than 2
billion increments instead of the expected 10 decrements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Blast off!&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This loop will significantly slow your code. Everyone will be so tired
of waiting that they might leave the space shuttle launch. Of course,
another problem with almost infinite loops is that you are dealing with
the wrong values. No one expects to hear the number <code>2147483647</code> in a
countdown.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Fencepost errors</div>
<div class="paragraph">
<p>Perhaps the most common loop errors are fencepost errors, often known as
off-by-one errors. The name &#8220;fencepost&#8221; comes from a related mistake
that someone might make when putting up a fence. Imagine that you want
to erect a 10 meter long chain link fence and you need to have a support
post every meter, how many posts do you need? In fact, we have not given
you enough information to answer the question correctly. If your fence
is built in a straight line, then you will need 11 posts so that you
have a post at each end. However, if your fence is a rectangular
enclosure, say 3 meters by 2 meters, you will only need 10 posts.</p>
</div>
<div class="paragraph">
<p>In loops, fencepost errors are often due to zero-based counting. A <code>for</code>
loop that iterates 10 times is below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, sometimes we need one-based counting instead. After being
used to zero-based counting, a programmer might make the following loop
that incorrectly iterates 9 times.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The correct version that iterates 10 times is below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to iterate \(n\) times, start at 0 and go up to
but not including \(n\) or start at 1 and go up to and
including \(n\). To keep loop headers consistent, some
programmers always start at 0 and then adjust the values inside the
loop, printing out <code>i + 1</code> in this case.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Skipped loops</div>
<div class="paragraph">
<p>A loop runs as long as its condition is <code>true</code>. For <code>for</code> loops and
<code>while</code> loops, this could mean that the loop is never even entered.
Sometimes, that behavior is intended by the programmer. Sometimes, the
programmer made a mistake.</p>
</div>
<div class="paragraph">
<p>For example, we can write a program that will add any number of positive
values. When the user is finished using the adder, he or she enters a
negative number. This negative number, called a <em>sentinel value</em>, tells
the program to stop executing the loop. Below is an incorrect
implementation of such a program.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">number</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">number</span><span class="tok-o">;</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter the next number to add: &quot;</span><span class="tok-o">);</span>
    <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The total sum is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This loop will never be executed because <code>0</code> is not greater than <code>0</code>.
The program could be changed by making the condition of the <code>while</code> loop
<code>number &gt;= 0</code>. Doing so will allow the user to enter <code>0</code> as input, which
is fine since it does not change the value of the <code>sum</code>. If you want to
force the user to enter only numbers greater than zero, you could change
the loop into a <code>do-while</code> loop.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Misplaced semicolons</div>
<div class="paragraph">
<p>The idea of a statement in Java is often amorphous in the minds of
beginning programmers. An entire loop (with any number of loops nested
inside of it) is just one statement. An executable statement ending with
a semicolon is one statement as well, even when that executable
statement is empty. Thus, the following is a legal (but infinite) loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">);</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
    <span class="tok-n">i</span><span class="tok-o">--;</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Ready or not, here I come!&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code was supposed to count down from 100, just like in the game of
Hide and Seek; however, there is a semicolon after the condition of the
<code>while</code> loop. This semicolon is treated like an executable statement
that does nothing. As a consequence, the <code>while</code> loop does the single
statement, checks if the condition is <code>true</code> (which it is), and
continues to do the empty statement and check the condition, forever.
The extra braces enclose two statements unnecessarily, but Java allows
extra braces, as long as they are evenly matched.</p>
</div>
<div class="paragraph">
<p>This error is common especially for those new to loops and conditional
statements and are in the habit of putting semicolons after everything.
A misplaced semicolon does not always result in an infinite loop. Here
is the <code>for</code> loop version of the same code, also with a semicolon
inserted after the loop header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">--</span> <span class="tok-o">);</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Ready or not, here I come!&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of the code will execute similarly, except the decrement is
built into the header of the loop. So, the loop will execute the empty
statement, but it will also decrement <code>i</code>. This code will decrement <code>i</code>
100 times, then print out <code>0</code> exactly once, then print
<code>Ready or not, here I come!</code>.</p>
</div>
<div class="paragraph">
<p>There are some cases when an empty statement for a loop body is actually
useful, although it is never necessary. In future chapters, we will
point out situations in which you may wish to use an empty statement
this way.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_dna_searching">5.4. Solution: DNA searching</h3>
<div class="paragraph">
<p>Below we give a solution to the DNA searching problem posed at the
beginning of the second half of this chapter. Our solution prints out
the index within the main <code>String</code> when it finds a match with the
pattern it is looking for. Afterwards, it prints out the total number of
matches. Our code also does error checking to make sure that the user
only enters valid DNA sequences containing the letters A, C, G, and T.
We begin our code with the standard <code>import</code> statement and class
definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DNASearch</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno">6 </span>		<span class="tok-n">String</span> <span class="tok-n">sequence</span><span class="tok-o">,</span> <span class="tok-n">subsequence</span><span class="tok-o">;</span>
<span class="lineno">7 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">valid</span><span class="tok-o">;</span>
<span class="lineno">8 </span>		<span class="tok-kt">char</span> <span class="tok-n">c</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main()</code> method instantiates a <code>Scanner</code> object and declares both of
the <code>String</code> variables we&#8217;ll need to store the DNA sequences. The method
also declares a <code>boolean</code> and a <code>char</code> we will use for input checking.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-k">do</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span>
<span class="lineno"> 3 </span>				<span class="tok-s">&quot;Enter the DNA sequence you wish to search in: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 4 </span>			<span class="tok-n">sequence</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toUpperCase</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>			<span class="tok-n">valid</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>			<span class="tok-k">for</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">valid</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>				<span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">c</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;A&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;C&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;G&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;T&#39;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Invalid DNA sequence!&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>					<span class="tok-n">valid</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">11 </span>				<span class="tok-o">}</span>
<span class="lineno">12 </span>			<span class="tok-o">}</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span> <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">valid</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, the user is prompted for a DNA sequence to search in. This
<code>String</code> stored in <code>sequence</code> is converted to upper case just in case
the user is not being consistent. The inner <code>for</code> loop in this code is
checking each <code>char</code> inside of <code>sequence</code>. If any <code>char</code> is not an
<code>'A'</code>, <code>'C'</code>, <code>'G'</code>, or <code>'T'</code>, then <code>valid</code> is set to <code>false</code>. As a
result, the <code>for</code> loop terminates. Also, the <code>do-while</code> loop repeats the
prompt and gets a new <code>String</code> for <code>sequence</code> from the user. This outer
<code>do-while</code> loop continues as long as the user keeps entering invalid DNA
sequences.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-k">do</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span>
<span class="lineno"> 3 </span>				<span class="tok-s">&quot;Enter the subsequence you wish to search for: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 4 </span>			<span class="tok-n">subsequence</span>  <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toUpperCase</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>			<span class="tok-n">valid</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>			<span class="tok-k">for</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">valid</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>				<span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">c</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;A&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;C&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;G&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">c</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;T&#39;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Invalid DNA sequence!&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>					<span class="tok-n">valid</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">11 </span>				<span class="tok-o">}</span>
<span class="lineno">12 </span>			<span class="tok-o">}</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span> <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">valid</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code used to input <code>subsequence</code> while doing error checking is
virtually identical to the code to input <code>sequence</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-kt">int</span> <span class="tok-n">found</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span>
<span class="lineno"> 3 </span>			<span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>				<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">j</span><span class="tok-o">)</span> <span class="tok-o">!=</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-n">j</span><span class="tok-o">))</span>
<span class="lineno"> 6 </span>					<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">j</span> <span class="tok-o">==</span> <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">1</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-c1">//matches</span>
<span class="lineno"> 8 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Match found at index &quot;</span> <span class="tok-o">+</span> <span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>					<span class="tok-n">found</span><span class="tok-o">++;</span>
<span class="lineno">10 </span>				<span class="tok-o">}</span>
<span class="lineno">11 </span>			<span class="tok-o">}</span>
<span class="lineno">12 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual workhorse of the search is found in these nested <code>for</code> loops.
The outer loop iterates through every index in <code>sequence</code>, until it
comes to an index that is too late to be the start of a new subsequence
(since the subsequence would be too long to fit anymore). This happens
to be when the value of <code>i</code> is greater than or equal to
<code>sequence.length() - subsequence.length() + 1</code>. It may take some thought
to verify that this condition is the correct one. One way to think about
this problem is by noting that, when <code>sequence</code> and <code>subsequence</code> have
the same length, you need to check starting at index <code>0</code> of <code>sequence</code>
but not any later indexes. Also, if <code>subsequence</code> is one <code>char</code> longer
than <code>sequence</code>, there can never be a match. In that case, the value of
<code>sequence.length() - subsequence.length() + 1</code> would be <code>0</code>. Since <code>0</code>
is not less than <code>0</code>, the outer <code>for</code> loop would never execute.</p>
</div>
<div class="paragraph">
<p>The inner <code>for</code> loop iterates through the length of <code>subsequence</code>,
making sure that every <code>char</code> in <code>sequence</code>, starting at the appropriate
offset, exactly matches a <code>char</code> in <code>subsequence</code>. If, at any point, the
two <code>char</code> values do not match, the inner <code>for</code> loop will immediately
exit, using the <code>break</code> command. However, on the last iteration of the
inner <code>for</code> loop, when <code>j</code> is one less than the length of <code>subsequence</code>,
we know that all of <code>subsequence</code> matched a part of <code>sequence</code>. As a
result, we print out the index of <code>sequence</code> where <code>subsequence</code> started
and increment the <code>found</code> counter.</p>
</div>
<div class="paragraph">
<p>If you know the <code>String</code> class well, you can use the <code>indexOf()</code> method
to replace the inner <code>for</code> loop. We leave that approach as an exercise.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise5.8">Exercise 5.8</a></p>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">found</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
<span class="lineno">2 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;One match found.&quot;</span><span class="tok-o">);</span>
<span class="lineno">3 </span>		<span class="tok-k">else</span>
<span class="lineno">4 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">found</span> <span class="tok-o">+</span> <span class="tok-s">&quot; matches found.&quot;</span><span class="tok-o">);</span>
<span class="lineno">5 </span>	<span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we print out the total number of matches found. In order to
avoid awkward output like <code>1 matches found.</code>, we used an <code>if</code>-<code>else</code> to
customize the output based on the value of <code>found</code>.</p>
</div>
<div class="paragraph">
<p>The ideas needed to correctly implement the solution are not difficult,
but catching all the off-by-one errors and getting every detail right
takes care. There is also more than one way to code this solution. For
example, we could have written the nested loops that do the searching as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">found</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span>
    <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span>
        <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">j</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-n">j</span><span class="tok-o">);</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">j</span> <span class="tok-o">==</span> <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">1</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-c1">//matches</span>
            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Match found at index &quot;</span> <span class="tok-o">+</span> <span class="tok-n">i</span><span class="tok-o">);</span>
            <span class="tok-n">found</span><span class="tok-o">++;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This design is preferred by many since it removes the <code>break</code>. By using
an empty statement, it is possible to move the check to see if the
matching process is done outside of the inner <code>for</code> loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">found</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">j</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span>
    <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span>
        <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">j</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-n">sequence</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-n">j</span><span class="tok-o">);</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">);</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">j</span> <span class="tok-o">==</span> <span class="tok-n">subsequence</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-c1">//matches</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Match found at index &quot;</span> <span class="tok-o">+</span> <span class="tok-n">i</span><span class="tok-o">);</span>
        <span class="tok-n">found</span><span class="tok-o">++;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, note that we must declare <code>j</code> outside of the inner <code>for</code>
loop, since it will be used outside. This approach is more efficient
because we only need to perform the check once. Notice also that the
condition of the <code>if</code> statement has changed. Now, we know that all of
<code>subsequence</code> matches because the loop ran to completion. If the loop
did not run to completion, then <code>j</code> would be smaller than
<code>subsequence.length()</code> and the loop must have terminated because the two
<code>char</code> values did not match. Although more efficient, some programmers
would avoid this approach because it uses the confusing syntax in which
the body of the <code>for</code> loop is a single empty statement followed by a
semicolon. Likewise, the logic about exiting the loop and the condition
of the <code>if</code> statement is murkier.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_loops">5.5. Concurrency: Loops</h3>
<div class="paragraph">
<p>Many programmers use concurrency for speedup. They want their programs
to run faster. Most programs that run for a long time use loops to do
repetitive tasks. If these loops are doing the same operation to many
different pieces of data, we may be able to speed up the process by
splitting up the data and letting different threads operate on their own
segment of the data. Splitting up data this way is called <em>domain
decomposition</em> which allows us to achieve <em>data parallelism</em>. These
topics are discussed further in <a href="#_concepts_splitting_up_work">Section 13.3</a>.</p>
</div>
<div class="paragraph">
<p>Performing repetitive tasks is one of the great strengths of computers.
For most programs that run a long time, incredible amounts of
computation are being done inside of (usually nested) loops. Domain
decomposition will not work for all of these programs. Some cannot be
parallelized at all, but this book is about finding problems that can
have parallel and concurrent solutions.</p>
</div>
<div class="paragraph">
<p>In <a href="#_concurrent_programming">Chapter 13</a>, we will introduce tools
for writing a concurrent program with different threads of execution
running at the exactly the same time and potentially interacting. Using
only the power of loops, you can see parallelism in action now.</p>
</div>
<div id="parallelismWithoutThreadsExample" class="exampleblock">
<div class="title">Example 61. Parallelism without threads</div>
<div class="content">
<div class="paragraph">
<p>Consider the problem of computing the sum of the sines of a range of
integers. At its heart is a loop from the start of the range to the end.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">start</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-n">end</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sin</span><span class="tok-o">(</span><span class="tok-n">start</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to allow the user to specify the start and the end and print
out the sum, we need to make a program with a little bit of input and
output around this loop.</p>
</div>
<div id="SumSinesProgram" class="listingblock">
<div class="title">Program 26. Adds the sines of all integers in a range specified by the user.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SumSines</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter starting value: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter ending value: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">int</span> <span class="tok-n">end</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>		<span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">start</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-n">end</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>			<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sin</span><span class="tok-o">(</span><span class="tok-n">start</span><span class="tok-o">);</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Sum of sines: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span> <span class="tok-o">);</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span>
<span class="lineno">17 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you compile and run this program with <code>1</code> as the start value and
<code>100000000</code> as the end, the answer should be <code>1.7136493465700542</code>. One
hundred million values is a lot to find the sine for. Depending on your
machine, this task should take between 10 seconds and over a minute. Try
to time how long this takes as accurately as possible.</p>
</div>
<div class="paragraph">
<p>Now, open a total of four console windows and navigate them all to the
directory with <code>SumSines.class</code> in it. Run <code>SumSines</code> in each one. For
the first console, enter <code>1</code> as the start and <code>25000000</code> as the end. For
the second, enter <code>25000001</code> and <code>50000000</code>. For the third, enter
<code>50000001</code> and <code>75000000</code>. For the last, enter <code>75000000</code> and
<code>100000000</code>. Once they have run, you should get, respectively,
<code>1.4912473269134603</code>, <code>-0.6795491754132104</code>, <code>-0.2893142602684644</code>, and
<code>1.1912654553381272</code>. If you add these together using a calculator, you
should get <code>1.7136493465699127</code>, which is almost exactly the same answer
we got before. (Floating point rounding errors cause the slight
difference.)</p>
</div>
<div class="paragraph">
<p>If you try to start them computing at about the same time, you can try
to see how long it takes for all of them to complete. SDid it take less
time than before? If you have a single core processor, it might have
taken just as long or longer. If you have a dual-core processor, it
should have taken less time, and if you have a quad core processor, even
less. Since we are dividing the problem into four pieces, we will not
expect to see any improvement with more than four cores.</p>
</div>
<div class="paragraph">
<p>Most operating systems provide a graphical way of viewing the load on
each processor. If you examine your CPU usage while running those
programs, you should see it spike up when the programs start and then
come down when they finish. For multiple cores, how did we say which
core we wanted each program to run on? We didn&#8217;t. In general, it is
difficult to specify which core we want to run a program, process, or
thread on. The OS does the job of scheduling and picks a free processor
when it needs to run a program. It is even possible for programs and
threads to change from one core to another while running if the OS needs
to balance out the workload.</p>
</div>
<div class="paragraph">
<p>This sines example is similar to <a href="#arraySummationExample">Example 103</a>
which we will cover in in <a href="#_concurrent_programming">Chapter 13</a>. As
you may have noticed, running four programs is not convenient. You have
to open several windows, you have to type starting and ending points
very carefully, and you have to combine the answers at the end since
your programs cannot interact directly with each other. Features of Java
will make this job easier, allowing us to run more than one thread of
execution at a time without the need to run multiple programs by hand.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise5.15">Exercise 5.15</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_5">5.6. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise5.1"></a> If you have a <code>String</code> containing a long text and you want to count
the number of words in the text that begin with the letter <code>'m'</code>, which
of the three kinds of loops would you use, and why?</p>
</li>
<li>
<p><a id="exercise5.2"></a> In <a href="#primalityTestingExample">Example 58</a>,
our last version of the primality tester <code>PrimalityTester2</code> computes the
square root of the number being tested. Instead of computing this value
before the loop, how would performance be affected by changing the head
of the <code>for</code> loop to the following?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span><span class="tok-kt">long</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-n">number</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">prime</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">+=</span> <span class="tok-mi">2</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise5.3"></a> How many different DNA sequences of length \(n\) are
there?</p>
</li>
<li>
<p><a id="exercise5.4"></a> There are three different errors in the following loop intended to
print out the numbers 1 through 10. What are they?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">--</span> <span class="tok-o">);</span>
<span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise5.5"></a>  Consider the following code containing nested <code>for</code> loops.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;=</span> <span class="tok-n">i</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">count</span><span class="tok-o">++;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In terms of the value of <code>n</code>, how many times is <code>count</code> incremented? If
it is not immediately obvious, trace through the execution of the
program by hand or run the code for several different values of <code>n</code> and
try to detect a pattern.</p>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise5.6"></a> Write a program that converts base 10 numbers into base 3 numbers.
If you find that task too easy, write a program that will convert base
10 numbers to any base in the range 2 to 16. Hint: Use letters A through
F, in order, to represent digits larger than 9.</p>
</li>
<li>
<p><a id="exercise5.7"></a> The greatest common divisor (GCD) of two integers is the largest
integer that divides both of them evenly. The GCD for any two positive
integers is at least 1 and at most the smaller of the two numbers. Write
a program that prompts a user for two <code>int</code> values and finds their GCD.
Although there are more efficient methods, you can count down from
either number. If the counter ever divides <strong>both</strong> numbers evenly, it is
the GCD. The counter is guaranteed to divide them both if it reaches 1.</p>
</li>
<li>
<p><a id="exercise5.8"></a> In the solution to the DNA searching
problem given in <a href="#_solution_dna_searching">Section 5.4</a>, we used two <code>for</code>
loops to find occurrences of a DNA subsequence inside of a larger
sequence. Professional Java developers would have used a single <code>for</code>
loop and the <code>indexOf()</code> method in the <code>String</code> class. One version of
this method returns the index of a substring within a <code>String</code> object,
starting from a particular offset, as shown below.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-s">&quot;fun dysfunction&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">search</span> <span class="tok-o">=</span> <span class="tok-s">&quot;fun&quot;</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Location: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">indexOf</span><span class="tok-o">(</span><span class="tok-n">search</span><span class="tok-o">,</span> <span class="tok-mi">4</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will output <code>Location: 7</code> since the first occurrence of
<code>"fun"</code> from index <code>4</code> or later starts at index <code>7</code>. If there are no
more occurrences of the substring beyond the starting index, the method
will return <code>-1</code>. Rewrite the solution to the DNA searching problem,
replacing the inner searching <code>for</code> loop with the <code>indexOf()</code> method.</p>
</div>
</li>
<li>
<p><a id="exercise5.9"></a> Write a program that reads a number \(n\) from a user and
then prints all possible DNA sequences of length \(n\). Be
careful not to supply too large of a value when you run this program.
Hint: Represent the sequence as a <code>String</code>. On each iteration, focus on
the last <code>char</code> in the <code>String</code>. If it is an <code>'A'</code>, change it to a
<code>'C'</code>. If it is a <code>'C'</code>, change it to a <code>'G'</code>. If it is a <code>'G'</code>, change
it to a <code>'T'</code>. If it is a <code>'T'</code>, change it back to an <code>'A'</code>, but
&#8220;carry&#8221; the increment over to the next <code>char</code>, like a rolling
odometer. You will have to design loops that can deal with carries that
cascade across multiple indexes.</p>
</li>
<li>
<p><a id="exercise5.10"></a> Re-implement the solution to the DNA searching program given in
<a href="#_solution_dna_searching">Section 5.4</a> using <code>JOptionPane</code> to generate GUIs
for input and output.</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise5.11"></a> Using a <code>for</code> loop, record the Monty Hall simulation so that you can
run it 100 times, always choosing to switch doors. Keep a record of how
many times you win. Change your code again to run the Monty Hall
simulation 100 more times, always choosing to keep your initial choice.
Again, keep a record of how many times you win. Compare the two records.
Choosing to switch should perform roughly twice as well as keeping the
first door. Increase the number of iterations to 1,000 and then 10,000
times. Does the performance of switching get closer to twice the
performance of not switching?</p>
</li>
<li>
<p><a id="exercise5.12"></a> Write three nested <code>for</code> loops, each of which run 1,000 times.
Increment a counter in the innermost <code>for</code> loop. If that counter starts
at 0, its final value should be 1,000,000,000. Time how long your
program takes to run to completion using either a stopwatch or, if you
are on a Unix or Linux system, the <code>time</code> command. Feel free to increase
and decrease the amount that each loop runs to see the effect on the
time. However, if you increase the values of all three loops too much,
you may have to wait longer than you want.</p>
</li>
<li>
<p><a id="exercise5.13"></a> In <a href="#subsection:common_pitfalls">Section 5.3.5</a>, one of the common loop
mistakes we discuss is an almost infinite loop. Create your own almost
infinite loop that runs from <code>10</code> to <code>0</code>, incrementing instead of
decrementing. Time the execution of your program. Unlike our example, do
not use an output statement or your code will take too long to run. How
much longer would your code take to run if you used a <code>long</code> instead of
an <code>int</code>?</p>
</li>
<li>
<p><a id="exercise5.14"></a> In <a href="#primalityTestingExample">Example 58</a>, we gave three programs to
test a number for primality. Run each of these prime testers on a large
prime such as 982,451,653 and time them. Is there a significant
difference in the running time of <code>PrimalityTester0</code> and
<code>PrimalityTester1</code>? What about <code>PrimalityTester1</code> and
<code>PrimalityTester2</code>?</p>
</li>
<li>
<p><a id="exercise5.15"></a> In <a href="#parallelismWithoutThreadsExample">Example 61</a>, we ran four programs at the same time to solve a
problem in parallel. Use the same framework (combined with your
knowledge of primes from <a href="#primalityTestingExample">Example 58</a>) to write
a program that can see how many prime numbers are in a user specified
range of integers. Then, use it to find the total number of primes
between 2 and 500,000,000. Now, run two copies of the program with one
starting at 2 and going up to 250,000,000 and the other starting at
250,000,001 and going up to 500,000,000. If you add the numbers
together, do you get the same answer? (If not, there is a bug in your
program.) Now, divide the work into four pieces. How much quicker, if at
all, is running all four programs instead of one? Does one of the four
pieces run significantly faster or slower than the others?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_arrays">6. Arrays</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Too much of a good thing can be wonderful.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Mae West
</div>
</div>
<div class="sect2">
<h3 id="_introduction">6.1. Introduction</h3>
<div class="paragraph">
<p>With one exception, all of the types we have talked about in this book
have held a single value. For example, an <code>int</code> variable can only
contain a single <code>int</code> value. If you try to put a second <code>int</code> value
into a variable, it will overwrite the first.</p>
</div>
<div class="paragraph">
<p>The <code>String</code> type, of course, is the exception. <code>String</code> objects can
contain <code>char</code> sequences of any length from 0 up to a practically
limitless size (the theoretical maximum length of a Java <code>String</code> is
<code>Integer.MAX_INT</code>, more than 650 times the length of <em>War and Peace</em>).
As remarkable as <code>String</code> objects are, this chapter is about a more
general kind of list called an <em>array</em>. We can create arrays to hold a
list of any type of variable in Java.</p>
</div>
<div class="paragraph">
<p>The ability to work with lists expands the scope of problems that we can
solve. Beyond simple lists, we can use the same tools to create tables,
grids, and other structures to solve fascinating problems like the one
that comes next.</p>
</div>
</div>
<div class="sect2">
<h3 id="_problem_game_of_life">6.2. Problem: Game of Life</h3>
<div class="paragraph">
<p>Some physicists insist that the rules governing the universe are
horribly complicated. Some insist that the fundamental laws are simple
and only their overall interaction is complex. With the power to do
simulations quickly, computer scientists have shown that some systems
can exhibit very complex interactions using simple rules. Perhaps the
best known examples of these systems are <em>cellular automata</em>, of which
Conway&#8217;s Game of Life is the most famous.</p>
</div>
<div class="paragraph">
<p>The framework for Conway&#8217;s Game of Life is an infinite grid made up of
squares called cells. Some cells in the grid are black (or alive, to
give it a biological flavor), and the rest are white (or dead). Any
given cell has 8 neighbors as shown in the figure below.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/06-arrays/images/cell.svg" alt="cell" width="25%">
</div>
<div class="title">Figure 23. Cell (shown in gray) surrounded by 8 neighboring cells.</div>
</div>
<div class="paragraph">
<p>The pattern of living and dead cells at any given time on the grid is
called a <em>generation</em>. To determine the next generation, we use the
following rules.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If a living cell has fewer than two living neighbors, it dies from
loneliness.</p>
</li>
<li>
<p>If a living cell has more than three neighbors, it dies because of
overcrowding.</p>
</li>
<li>
<p>If a living cell has exactly two or three living neighbors, it lives
to the next generation.</p>
</li>
<li>
<p>If a dead cell has exactly three live neighbors, it becomes a living
cell.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These four simple rules allow for surprisingly complex interactions. The
patterns that emerge from applying these rules to a starting
configuration of living and dead cells strike a balance between complete
chaos and rigid order. As the name of the game implies, the similarity
to biological patterns of development can be surprising.</p>
</div>
<div class="paragraph">
<p>Your problem is to create a Life simulator of size \(n\) x
\(m\), specific values for which will be discussed below. The
program should simulate the process at a speed that is engaging to
watch, with a new generation every tenth of a second. The program should
begin by randomly making 10% of all the cells living and the rest dead.</p>
</div>
<div class="sect3">
<h4 id="_terminal_limitations">6.2.1. Terminal limitations</h4>
<div class="paragraph">
<p>One problem you might be worrying about is how to display the
simulation. In <a href="#_constructing_graphical_user_interfaces">Chapter 15</a> you will learn how to make a graphical user interface (GUI)
that can display a grid of cells in black and white and much more
interesting things as well. For now, the main tool that we can use for
output is still the terminal. The output method we recommend is printing
an asterisk (<code>'*'</code>) for a living cell and a space (<code>' '</code>) for a dead
one. In this way you can easily see the patterns form on the screen and
change over time.</p>
</div>
<div class="paragraph">
<p>The classic terminal is not very big. For this reason, we suggest that
you set the height of your simulation to 24 rows and the width of your
simulation to 80 columns. These dimensions conform to the most ancient
terminal sizes. If your terminal screen is much larger, you can change
the width and height later to have a larger simulation. The ideal form
of the game is infinite, as well. Because our size is so limited, we
must deal with the problem of a cell on the boundary. Anything beyond
the boundaries should be counted as dead. Thus, a cell right on the edge
of the simulation grid can have a maximum of 5 neighbors. A cell in one
of the four corners can only have 3 neighbors.</p>
</div>
<div class="paragraph">
<p>In order to give the appearance of smooth transitions, you need to print
out each new generation of cells quickly, and in the same locations as
the previous generation. Simply printing one set after another will not
achieve this effect unless your terminal screen is exactly 24 rows tall.
So, you will need to clear the screen each time. In an effort to be
platform independent, Java does not provide an easy way to clear the
terminal screen. A quick and simple hack is to simply print out 100
blank lines before printing the next generation. This hack will work as
long as your terminal is not significantly more than 100 rows in height.
If it is, you will need to print a larger number of blank rows.</p>
</div>
<div class="paragraph">
<p>Finally, you need to wait a short period of time between generations so
that the user can see each configuration before it is cleared away and
replaced by the next one. The simplest way to do this is by having your
program go to sleep for a short period of time, a tenth of a second as
we suggested before. The code to make your program sleep for that amount
of time is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We will explain this code in much greater detail in
<a href="#_concurrent_programming">Chapter 13</a>. The key item of importance
is the number passed into the <code>sleep()</code> method. This value is the number
of milliseconds you want your program to sleep. 100 milliseconds is, of
course, one tenth of a second.</p>
</div>
<div class="paragraph">
<p>In order to simulate the Game of Life, we need to store information,
namely the liveness or deadness of cells, in a grid. First, we need to
discuss the simpler task of storing data in a list.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_lists_of_data">6.3. Concepts: Lists of data</h3>
<div class="paragraph">
<p>Lists of data are of paramount importance in many different parts of
life: shopping lists, packing lists, lists of employees working at a
company, address books, top ten lists, and more. Lists are even more
important in programming. As you know, one of the great strengths of
computers is their speed. If we have a long list of data, we can use
that speed to perform some operation on all the data quickly. E-mail
contact lists, entries in a database, and cells in a spreadsheet are
just a few of the most obvious ways that lists come up in computer
applications.</p>
</div>
<div class="paragraph">
<p>Even in Java, there are many different ways to record a list of
information, but a list is only one form of <em>data structure</em>. As the
name implies, a data structure is a way to organize data, whether in a
list, in a tree, in sorted order, in some kind of hierarchy, or in any
other way that might be useful. We will only talk about the array data
structure in this chapter, but other data structures will be discussed
in <a href="#_dynamic_data_structures">Chapter 18</a>. Below we give a short
explanation of some of the attributes any given data structure might
have.</p>
</div>
<div class="sect3">
<h4 id="_data_structure_attributes">6.3.1. Data structure attributes</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Contents</dt>
<dd>
<p>Keeping only a single value in a data structure defeats the purpose of
a data structure. But, if we can store more than a single value, must
all of those values come from the same type? If a data structure can
hold several different types of data, we call it <em>heterogeneous</em>, but
if it can only hold one type of data, we call it <em>homogeneous</em>.</p>
</dd>
<dt class="hdlist1">Size</dt>
<dd>
<p>The size of a data structure may be something that is fixed when it is
created or it could change on the fly. If a data structure&#8217;s size or
length can change, we call it a <em>dynamic</em> data structure. If the data
structure has a size or length that can never change after it has been
created, we call it a <em>static</em> data structure.</p>
</dd>
<dt class="hdlist1">Element Access</dt>
<dd>
<p>One of the reasons that there are so many different data types is that
different ways of structuring data are better or worse for different
tasks. For example, if your task is to add a list of numbers, then you
are expecting to access every single element in the list. However, if
you are searching for a word in a dictionary, you do not want to check
every dictionary entry to find it.
+
Some data structures are optimized so that you can efficiently read,
insert, or delete only a single item, often the first (or last) item
in the data structure. Some data structures only allow you to move
through the structure sequentially, one item after another. Such a
data structure has what is called <em>sequential access</em>. Still others
allow you to jump randomly to any point you want inside the data
structure efficiently. These data structures have what is called
<em>random access</em>. Advanced programmers take into account many different
factors before deciding which data structure is best suited to their
problem.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_characteristics_of_an_array">6.3.2. Characteristics of an array</h4>
<div class="paragraph">
<p>Now that we&#8217;ve defined these attributes, we can say that an array is a
homogeneous, static data structure with random access. An array is
homogeneous because it can only hold a list of a single type of data,
such as <code>int</code>, <code>double</code>, or <code>String</code>. An array is static because it has
a fixed length that is set only when the array is instantiated. An array
also has random access because jumping to any element in the array is
very fast and takes about the same amount of time as jumping to any
other.</p>
</div>
<div class="paragraph">
<p>An array is a list of a specific type of elements that has length
\(n\), a length specified when the array is created. Each of
the \(n\) elements is indexed using a number between 0 and
\(n - 1\). Once again, zero-based counting rears its ugly
head. Consider the following list of items: {9, 4, 2, 1, 6, 8, 3 \}</p>
</div>
<div class="paragraph">
<p>If this list is stored in an array, the first element, 9,
would have index 0, 4 would have index
1, and so on, finishing at 3 with an index
of 6, although the total number of items is
7. Not all languages use zero-based counting for array
indexes, but many do, including C, C++, and Java. The reason that
languages like C originally used zero-based counting for indexes is that
the variable corresponding to the array is an address inside the
computer&#8217;s memory giving the first element in the array. Thus, an index
of 0 is 0 times the size of an element added to the starting address,
and an index of 5 is 5 times the size of an element added to the
starting address. So, zero based indexes gave a quick way for the
program to compute where in memory a given element of an array is.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_arrays_in_java">6.4. Syntax: Arrays in Java</h3>
<div class="paragraph">
<p>The idea of a list is not mysterious. Indexing each element of the list
using numbers is natural, even if the numbers start at 0 instead of 1.
Even so, arrays are the source of many errors that cause Java programs
to crash. Below we explain the basics of creating arrays, indexing into
arrays, and using arrays with loops. Then there is an extra subsection
explaining how to send data from a file to a program as if the file were
being typed in by a user. Using this technique can save you a lot of
time when you are experimenting with arrays.</p>
</div>
<div class="sect3">
<h4 id="_array_declaration_and_instantiation">6.4.1. Array declaration and instantiation</h4>
<div class="paragraph">
<p>To create an array, you usually need to create an array variable first.
Remember that an array is a homogeneous data structure, meaning that it
can only store elements of a single type. When you create an array
variable, you have to specify what that type is. To declare an array
variable, you use the type it is going to hold, followed by square
brackets (<code>[]</code>), followed by the name of the variable. For example, if
you want to create an array called <code>numbers</code> that can hold integers, you
would type the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">numbers</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have some C or C++ programming experience, you might be used to
the brackets being on the other side of the variable, like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">numbers</span><span class="tok-o">[];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, both declarations are perfectly legal and equivalent. However,
the first declaration is preferred from a stylistic perspective. It
follows the pattern of using the type (an array of <code>int</code> values in this
case) followed by the variable name as the syntax for a declaration.</p>
</div>
<div class="paragraph">
<p>As we said, arrays are also static data structures, meaning that their
length is fixed at the time of their creation. Yet we did not specify a
length above. This declaration has not yet created an array, just a
variable that can point at an array. In the second half of this chapter,
we will further discuss this difference between the way an array is
created and the way an <code>int</code> or any other variable of primitive type is
created. To actually create the array, we need to use another step,
involving the keyword <code>new</code>. Here is how we instantiate an array of
<code>int</code> type with 10 elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">numbers</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the keyword <code>new</code>, followed by the type of element, followed by
the number of elements the array can hold in square brackets. This new
array is stored into <code>numbers</code>. In other words, the variable <code>numbers</code>
is now a name for the array. Commonly, the two steps of declaring and
instantiating an array will be combined into one line of code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">numbers</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is always possible to separate the two steps. In some cases, a single
variable might be used to point at an array of one particular length,
then changed to point at an array of another length, and so on, as
below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">numbers</span><span class="tok-o">;</span>
<span class="tok-n">numbers</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">];</span>
<span class="tok-n">numbers</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-n">numbers</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">1000</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the variable <code>numbers</code> starts off pointing at no array. Next, it
is made to point at a new array with 10 elements. Then, it is made to
point at a new array with 100 elements, ignoring the 10 element array.
Finally, it is made to point at an array with 1,000 elements, ignoring
the 100 element array. Remember, the arrays themselves are static; their
lengths cannot change. The array type variables, however, can point at
different arrays with different lengths, provided that they are still
the right type (in this case <code>int</code>).</p>
</div>
<div class="paragraph">
<p>What values are inside the array when it is first created? Let&#8217;s return
to the case where <code>numbers</code> points at a new array with 10 elements. Each
of those elements contains the <code>int</code> value <code>0</code>, as shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/06-arrays/images/array.svg" alt="array" width="100%">
</div>
<div class="title">Figure 24. Array elements showing index values.</div>
</div>
<div class="paragraph">
<p>Whenever an array is instantiated, each of its \(n\) elements
is set to some default value. For <code>int</code>, <code>long</code>, <code>short</code>, and <code>byte</code>
this value is <code>0</code>. For <code>double</code> and <code>float</code>, this value is <code>0.0</code>. For
<code>char</code>, this value is <code>'\0'</code>, a special unprintable character. For
<code>boolean</code>, this value is <code>false</code>. For <code>String</code> or any other reference
type, this value is <code>null</code>, a special value that means there is no
object at that address.</p>
</div>
<div class="paragraph">
<p>It is also possible to use a list to initialize an array. For example,
we can create an array of type <code>double</code> that contains the values <code>0.5</code>,
<code>1.0</code>, <code>1.5</code>, <code>2.0</code>, and <code>2.5</code> using the following code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">increments</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-mf">0.5</span><span class="tok-o">,</span> <span class="tok-mf">1.0</span><span class="tok-o">,</span> <span class="tok-mf">1.5</span><span class="tok-o">,</span> <span class="tok-mf">2.0</span><span class="tok-o">,</span> <span class="tok-mf">2.5</span><span class="tok-o">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This line of code is equivalent to using the <code>new</code> keyword to create a
<code>double</code> array with 5 elements and then setting each to the values
shown.</p>
</div>
</div>
<div class="sect3">
<h4 id="_indexing_into_arrays">6.4.2. Indexing into arrays</h4>
<div class="paragraph">
<p>To use a value in an array, you must <em>index</em> into the array, using the
square brackets once again. Returning to the example of the <code>int</code> array
<code>numbers</code> with length 10, we can read the value at index 4 from the
array and print it out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">numbers</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the value of <code>numbers[4]</code> is <code>0</code> and so <code>0</code> is all that will
be printed out. We can set the value at <code>numbers[4]</code> to <code>17</code> as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">numbers</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">17</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, if we try to print out <code>numbers[4]</code>, <code>17</code> will be printed. The
contents of the <code>numbers</code> array will look like this.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/06-arrays/images/array2.png" alt="array2">
</div>
<div class="title">Figure 25. Array showing contents of elements.</div>
</div>
<div class="paragraph">
<p>The key thing to understand about indexing into an array is that it
gives you an element of the specified type. In other words, <code>numbers[4]</code>
<strong>is</strong> an <code>int</code> variable in every possible sense. You can read its value.
You can change its value. You can pass it into a method. It can be used
anywhere a normal <code>int</code> can be used, as in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">numbers</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">];</span>
<span class="tok-kt">double</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-n">numbers</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">])</span> <span class="tok-o">+</span> <span class="tok-n">numbers</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">];</span>
<span class="tok-n">numbers</span><span class="tok-o">[</span><span class="tok-mi">9</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)(</span><span class="tok-n">y</span><span class="tok-o">*</span><span class="tok-n">x</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Executing this code will store <code>17</code> into <code>x</code> and <code>17.0</code> into <code>y</code>. Then,
the product of those two, <code>289</code>, will be stored into <code>numbers[9]</code>.
Remember, in Java, the type on the left and the type on the right of the
assignment operator (<code>=</code>) must match, except in cases of automatic
casting, like storing an <code>int</code> value into a <code>double</code> variable. Since
they have the same type, it makes sense to store an element of an <code>int</code>
array like <code>numbers[4]</code> into an <code>int</code> variable like <code>x</code>. However, an
array of <code>int</code> values cannot be stored into an <code>int</code> type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">numbers</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will cause a compiler error. What would it mean? You can&#8217;t put
a list of variables into a single variable. And the converse is true as
well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">numbers</span> <span class="tok-o">=</span> <span class="tok-mi">31</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will also cause a compiler error. A single value cannot be
stored into a whole list. You have to specify an index where it can be
stored. Furthermore, you must be careful to specify a legal index. No
negative index will ever be legal, and neither will an index greater
than or equal to the number of elements in the array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">numbers</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">99</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will compile correctly. If you remember, we instantiated the
array that <code>numbers</code> points at to have 10 elements, numbered 0 through
9. Thus, we are trying to store <code>99</code> into the element that is one index
<strong>after</strong> the last legal element. As a result, Java will cause an error
called an <code>ArrayIndexOutOfBoundsException</code> to happen, which will crash
your program.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_loops_with_arrays">6.4.3. Using loops with arrays</h4>
<div class="paragraph">
<p>One reason to use arrays is to avoid declaring 10 separate variables
just to have 10 <code>int</code> values to work with. But once you have the array,
you will often need an automated way to process it. Any of the three
kinds of loops provides a powerful tool for performing operations on any
array, but the <code>for</code> loop is an especially good match. Here is an
example of a <code>for</code> loop that sets the values in an array to their
indexes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">values</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This sample of code shows how easy it is to iterate over every element
in an array with a <code>for</code> loop, but it has a flaw in its style. Note that
the number <code>100</code> is used twice: once in the instantiation of the array
and a second time in the termination condition of the <code>for</code> loop. This
fragment of code works fine, but if the programmer changes the length of
<code>values</code> to be <code>50</code> or <code>500</code>, the bounds of the <code>for</code> loop will also
need to change. Furthermore, the length of the array might be determined
by user input.</p>
</div>
<div class="paragraph">
<p>To make the code both more robust and readable, we can use the <code>length</code>
field of the <code>values</code> array for the bound of the <code>for</code> loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">values</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>length</code> field gives the length of the array that <code>values</code> points
to. If the programmer wants to instantiate the array with a different
length, that&#8217;s fine. The <code>length</code> field will always reflect the correct
value. Whenever possible, use the <code>length</code> field of arrays in your code.
Note that the <code>length</code> field is read-only. If you try to set
<code>values.length</code> to a specific value, your code will not compile.</p>
</div>
<div class="paragraph">
<p>Setting the values in an array is only one possible task you can perform
with a loop. Let&#8217;s assume that an array of type <code>double</code> named <code>data</code>
has been declared, instantiated, and filled with user input. We could
sum all its elements using the following code. A more elegant way to do
the same summation is discussed in <a href="#subsection:The_for-each_loop">Section 6.9.1</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">data</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The sum of your data is: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So far, we have only discussed operations on the values in an array. It
is important to realize that the <strong>order</strong> of those values can be equally
important. We are going to create an array of <code>char</code> type named
<code>letters</code>, initialized with some values, and then reverse the order of
the array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">char</span><span class="tok-o">[]</span> <span class="tok-n">letters</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-sc">&#39;b&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;y&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;z&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;a&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;n&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;t&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;i&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;n&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;e&#39;</span><span class="tok-o">};</span>
<span class="tok-kt">int</span> <span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">end</span> <span class="tok-o">=</span> <span class="tok-n">letters</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-kt">char</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">start</span> <span class="tok-o">&lt;</span> <span class="tok-n">end</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">letters</span><span class="tok-o">[</span><span class="tok-n">start</span><span class="tok-o">];</span>
    <span class="tok-n">letters</span><span class="tok-o">[</span><span class="tok-n">start</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">letters</span><span class="tok-o">[</span><span class="tok-n">end</span><span class="tok-o">];</span>
    <span class="tok-n">letters</span><span class="tok-o">[</span><span class="tok-n">end</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
    <span class="tok-n">start</span><span class="tok-o">++;</span>
    <span class="tok-n">end</span><span class="tok-o">--;</span>
<span class="tok-o">}</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">letters</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-n">letters</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will print out <code>enitnazyb</code>. After initializing the <code>letters</code>
array, we declare <code>start</code> and <code>end</code>, giving them the values <code>0</code>, the
first index of <code>letters</code>, and <code>letters.length - 1</code>, the last valid index
of <code>letters</code>, respectively. Then, the <code>while</code> loop continues as long as
the <code>start</code> is less than the <code>end</code>. The first three lines of each
iteration of the <code>while</code> loop will swap the <code>char</code> at index <code>start</code> with
the <code>char</code> at index <code>end</code>. The two lines after that will increment and
decrement <code>start</code> and <code>end</code>, respectively. When the two meet in the
middle, the entire array has been reversed. The simple <code>for</code> loop at the
end prints out each <code>char</code> in <code>letters</code>. Of course, we could have
printed out the array elements in reverse order without changing their
order, but we wanted to reverse them, perhaps because we will need them
reversed in the future.</p>
</div>
</div>
<div class="sect3">
<h4 id="_redirecting_input">6.4.4. Redirecting input</h4>
<div class="paragraph">
<p>With arrays and loops, we can process a lot of data, but testing
programs that process a lot of data can be tedious. Instead of typing
data into the terminal, we can read data from a file. In Java, file I/O
is a messy process that involves several objects and method calls. We&#8217;re
going to talk about it in depth in <a href="#_file_i_o">Chapter 20</a>, but for
now we can use a quick and easy workaround.</p>
</div>
<div class="paragraph">
<p>If you create a text file using a simple text editor, you can <em>redirect</em>
the file as input to a program. Everything you have written in the text
file is treated as if it were being typed into the command line by a
person. To do so, you type the command using <code>java</code> to run your class
file normally, type the <code>&lt;</code> sign, and then type the name of the file you
want to use as input. For example, if you have a text file called
<code>numbers.txt</code> that you want to use as input to a program stored in
<code>Summer.class</code>, you could do so as follows.</p>
</div>
<div class="paragraph">
<p><code>java Summer &lt; numbers.txt</code></p>
</div>
<div class="paragraph">
<p>Redirecting input this way is not a part of Java. Instead, it is a
feature of the terminal running under your OS. Not all operating systems
support input redirection, but virtually every flavor of Linux and Unix
do, as well as the Windows command line and the Mac OS X terminal. We
could write the program mentioned above and give it the simple task of
summing all the numbers it gets as input.</p>
</div>
<div id="SummerProgram" class="listingblock">
<div class="title">Program 27. Sums a list of numbers given as input.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Summer</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;How many numbers do you want to add? &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter next number: &quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>			<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">12 </span>		<span class="tok-o">}</span>
<span class="lineno">13 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The sum of the numbers is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span><span class="tok-o">);</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can type out a file with a list of numbers in it and save it as
<code>numbers.txt</code>. To conform with the program we wrote, we should also put
the total count of numbers as the first value in the file. You can put
each number on a separate line or just leave a space between each one.
As long as they are separated by white space, the <code>Scanner</code> object will
take care of the rest. You will have to type the numbers into the file
once, but then you can test your program over and over with that file.</p>
</div>
<div class="paragraph">
<p>If you do run the program with the file you&#8217;ve created, you&#8217;ll notice
that the program still prompts you once for the total count of numbers
and then prompts you many times to enter the next number. With
redirected input, all that text runs together in a bizarre way. All the
input is coming from <code>numbers.txt</code>. If you expect a program to read
strictly from redirected input, you can design your code a little
differently. For one thing, you don&#8217;t need to have explicit prompts for
the user. For another, you can use a number of special methods from the
<code>Scanner</code> class. The <code>Scanner</code> class has a several methods like
<code>hasNextInt()</code> and <code>hasNextDouble()</code>. These methods will examine the
input and see if there is another legal <code>int</code> or <code>double</code> and return
<code>true</code> or <code>false</code> accordingly. If you expect a file to have only a long
sequence of <code>int</code> values, you can use <code>hasNextInt()</code> to determine if you
have reached the end of the file or not. Using <code>hasNextInt()</code>, we can
simplify the program and remove the expectation that the first number
gives the total count of numbers.</p>
</div>
<div id="QuietSummerProgram" class="listingblock">
<div class="title">Program 28. Sums a list of numbers given as input without prompting the user.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">QuietSummer</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextInt</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>			<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The sum of the numbers is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span><span class="tok-o">);</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the other hand, you might be interested in the output of a program.
The output could be very long or it might take a lot of time to produce
or you might want to store it permanently. For these situations, it is
possible to <em>redirect output</em> as well. Instead of printing to the
screen, you can send the output to a file of your choosing. The syntax
for this operation is just like the syntax for input redirection except
that you use the <code>&gt;</code> sign instead of <code>&lt;</code>. To run <code>QuietSummer</code> with
input from <code>numbers.txt</code> and output to <code>sum.txt</code>, we could do the
following.</p>
</div>
<div class="paragraph">
<p><code>java QuietSummer &lt; numbers.txt &gt; sum.txt</code></p>
</div>
<div class="paragraph">
<p>You would be free to examine <code>sum.txt</code> at any time with your text editor
of choice. When using output redirection, it makes more sense run to
<code>QuietSummer</code> than <code>Summer</code>. If we had run <code>Summer</code>, all of that
unnecessary output prompting the user to enter numbers would be saved in
<code>sum.txt</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_array_usage">6.5. Examples: Array usage</h3>
<div class="paragraph">
<p>Here are a few examples of practical array usage. We are going to
discuss some techniques useful mostly for searching and sorting.
Searching for values in a list seems mundane, but it is one of the most
practical tasks that a computer scientist routinely carries out. By
making a computer do the work, it saves human beings countless hours of
tedious searching and checking. Another important task is sorting.
Sorting a list can make future searches faster and is the simplest way
to find the median of a list of values. Sorting is a fundamental part of
countless real world problems.</p>
</div>
<div class="paragraph">
<p>In the examples below, we will first discuss finding the largest (or
smallest) value in a list, move on to sorting lists, and then talk about
a task that searches for words, like a dictionary look up.</p>
</div>
<div id="kingOfTheHillExample" class="exampleblock">
<div class="title">Example 62. King of the hill</div>
<div class="content">
<div class="paragraph">
<p>Finding the largest value input by a user is not difficult. Applying
that knowledge to an array is pretty straightforward as well. This
simple task is also a building block of the sorting algorithm we will
discuss below. The key to finding the largest value in any list is to
keep a temporary variable that records the largest value found so far.
As we go along, we update the variable if we find a larger value. The
only trick is initializing the variable to some appropriate starting
value. We could initialize it to zero, but what if entire list of
numbers is negative? Then, our answer would be larger than any of the
numbers in the list. If our list of numbers is of type <code>int</code>, we could
initialize our variable to <code>Integer.MIN_VALUE</code>, the smallest possible
<code>int</code>. This approach works, but you have to remember the name of the
constant and it does not improve the readability of the code.</p>
</div>
<div class="paragraph">
<p>When working with an array, the best way to find the largest value in
the list is by setting your temporary variable to the first element
(index <code>0</code>) in the array. Below is a short snippet of code that finds
the largest value in an <code>int</code> array named <code>values</code> in exactly this way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">largest</span> <span class="tok-o">=</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">&gt;</span> <span class="tok-n">largest</span> <span class="tok-o">)</span>
        <span class="tok-n">largest</span> <span class="tok-o">=</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The largest value is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">largest</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>for</code> loop starts at <code>1</code> not <code>0</code>. Because <code>largest</code> is
initialized to be <code>values[0]</code>, there is no reason to repeat that value.
Doing so would still give the correct answer, but it wastes a tiny
amount of time.</p>
</div>
<div class="paragraph">
<p>What is the feature of this code that makes it find the largest value?
The key is the <code>&gt;</code> operator. With the change of a single character, we
could find the smallest value instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">smallest</span> <span class="tok-o">=</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">&lt;</span> <span class="tok-n">smallest</span> <span class="tok-o">)</span>
        <span class="tok-n">smallest</span> <span class="tok-o">=</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The smallest value is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">smallest</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the necessary change from <code>&gt;</code> to <code>&lt;</code>, we also changed the
output and the name of the variable to avoid confusion. Now we will show
how repeatedly finding the smallest value in an array can be used to
sort it. The largest value could be used equally well, but we will use
the smallest.</p>
</div>
</div>
</div>
<div id="selectionSortExample" class="exampleblock">
<div class="title">Example 63. Selection sort</div>
<div class="content">
<div class="paragraph">
<p>Sorting is the bread and butter of computer scientists. Much research
has been devoted to finding the fastest ways to sort a list of data. The
rest of the world assumes that sorting a list of data is trivial because
computer scientists have done such a good job solving this problem. The
name of the sorting algorithm we are going to describe below is
<em>selection sort</em>. It is <strong>not</strong> one of the fastest ways to sort data, but
it is simple and easy to understand.</p>
</div>
<div class="paragraph">
<p>The idea behind selection sort is to find the smallest element in an
array and put it at index <code>0</code> of the array. Then, from the remaining
elements, find the smallest element and put it at index <code>1</code> of the
array. The process continues, filling the array up from the beginning
with the smallest values until the entire array is sorted. If the length
of the array is \(n\), we will need to look for the smallest
element in the array \(n - 1\) times. By putting the code that
searches for the smallest value inside of an outer loop, we can write a
program that does selection sort of <code>int</code> values input by the user as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SelectionSort</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">values</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">];</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">smallest</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">int</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>			<span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program is not very long, but there&#8217;s a lot going on. After
instantiating a <code>Scanner</code>, we read in the total number of values the
list will hold. We cannot rely on the <code>hasNextInt()</code> method to tell us
when to stop reading values. We need to know up front how many values we
are going to store so that we can instantiate our array with the
appropriate length. Then, we read each value into the array using the
first <code>for</code> loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>			<span class="tok-n">smallest</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="lineno">3 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">4 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">smallest</span><span class="tok-o">]</span> <span class="tok-o">)</span>
<span class="lineno">5 </span>					<span class="tok-n">smallest</span> <span class="tok-o">=</span> <span class="tok-n">j</span><span class="tok-o">;</span>
<span class="lineno">6 </span>			<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">smallest</span><span class="tok-o">];</span>
<span class="lineno">7 </span>			<span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">smallest</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno">8 </span>			<span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">9 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next <code>for</code> loop is where the actual sort happens. We start at index
<code>0</code> and then try to find the smallest value to be put in that spot.
Then, we move on to index <code>1</code>, and so on, just as we described before.
Note that we only go up to <code>n - 2</code>. We don&#8217;t need to find the value to
put in index <code>n - 1</code>, because the rest of the list has the <code>n - 1</code>
smallest numbers in it and so the last number must already be the
largest. If you look carefully, you will notice that the inner <code>for</code>
loop has the same overall shape as the loop used to find the smallest
value in the previous example; however, there is one key difference.
Instead of storing the <strong>value</strong> of the smallest number in <code>smallest</code>, we
now store the <strong>index</strong> of the smallest number. We need to store the index
of the smallest number so that, in the next step, we can swap the
corresponding element with the element at <code>i</code>, the spot in the array we
are trying to fill. The three lines after the inner <code>for</code> loop are a
simple swap to do exactly that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;The sorted list is: &quot;</span><span class="tok-o">);</span>
<span class="lineno">2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">3 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span><span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After all the sorting is done, the final <code>for</code> loop prints out the newly
sorted list. This program gives no prompts for user input, so it is well
designed for input redirection. If you are going to make a file
containing numbers you want to sort with this program, make sure that
the first number is the total count of numbers in the file.</p>
</div>
<div class="paragraph">
<p>Again, this program sorts the list in ascending order (from smallest to
largest). If you wanted to sort the list in descending order, you would
only need to change the <code>&lt;</code> to a <code>&gt;</code> in the comparison of the inner
<code>for</code> loop, although other changes are recommended for the sake of
readability.</p>
</div>
</div>
</div>
<div id="wordSearchExample" class="exampleblock">
<div class="title">Example 64. Word search</div>
<div class="content">
<div class="paragraph">
<p>In this example, we will read in a list of words and a long passage of
text and keep track of the number of times each word in the list occurs
in the passage. This kind of text searching has many applications.
Similar ideas are used in a spell checker that needs to look up words in
a dictionary. The incredibly valuable find and replace tools in modern
word processors use some of the same techniques.</p>
</div>
<div class="paragraph">
<p>To make this program work, however, we need to read in a (potentially
long) list of words and then a lot of text. We are forced to use input
redirection (or some other file input) because typing this text in
multiple times would be tedious. When we get to <a href="#_file_i_o">Chapter 20</a>, we will talk about ways to read from multiple files at the same
time. Right now, we can only redirect input from a single file and so we
are forced to put the list of words at the top of the file, followed by
the text we want to search through.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WordCount</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>		<span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">words</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">];</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">counts</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">];</span>
<span class="lineno"> 9 </span>		<span class="tok-n">String</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">words</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>			<span class="tok-n">words</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As in the last example, this program begins by reading in the length of
the list of words. Then, it instantiates the <code>String</code> array <code>words</code> to
hold these words. It also instantiates an array <code>counts</code> of type <code>int</code>
to keep track of the number of times each word is found. By default,
each element in <code>counts</code> is initialized to <code>0</code>. The first <code>for</code> loop in
the program reads in each word and stores it into the array <code>words</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNext</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>			<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">3 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">4 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span> <span class="tok-n">words</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">))</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>					<span class="tok-n">counts</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]++;</span>
<span class="lineno">6 </span>					<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">7 </span>				<span class="tok-o">}</span>
<span class="lineno">8 </span>		<span class="tok-o">}</span>
<span class="lineno">9 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The word counts are: &quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>while</code> loop reads in each word from the text following the list and
stores it in a variable called <code>temp</code>. Then, it loops through <code>words</code>
and tests to see if <code>temp</code> matches any of the elements in the list. If
it does, it increases the value of the element of <code>counts</code> that has the
same index and breaks out of the inner <code>for</code> loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">words</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">2 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">words</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">counts</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]);</span>
<span class="lineno">3 </span>	<span class="tok-o">}</span>
<span class="lineno">4 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After all the words in the text have been processed, the final <code>for</code>
loop prints out each word from the list, along with its counts.</p>
</div>
<div class="paragraph">
<p>This program uses two different arrays for bookkeeping: <code>words</code> contains
the words we are searching for and <code>counts</code> contains the number of times
each word has been found. These two arrays are separate data structures.
The only link between them is the code we wrote to maintain the
correspondence between their elements.</p>
</div>
<div class="paragraph">
<p>To give a clear picture of how this program should behave, here is a
sample input file with two paragraphs from the beginning of <em>The Counte
of Monte Cristo</em> by Alexandre Dumas.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>7
and
at
bridge
for
pilot
vessel
walnut
On the 24th of February, 1815, the look-out at Notre-Dame de la Garde
signalled the three-master, the Pharaon from Smyrna, Trieste, and
Naples.

As usual, a pilot put off immediately, and rounding the Chateau d'If,
got on board the vessel between Cape Morgion and Rion island.
Immediately, and according to custom, the ramparts of Fort Saint-Jean
were covered with spectators; it is always an event at Marseilles for a
ship to come into port, especially when this ship, like the Pharaon, has
been built, rigged, and laden at the old Phocee docks, and belongs to an
owner of the city.</pre>
</div>
</div>
<div class="paragraph">
<p>And here is the output one should get from running <code>WordCount</code> with
input redirected from the file given above.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>The word counts are:
and 6
at 3
bridge 0
for 1
pilot 1
vessel 1
walnut 0</pre>
</div>
</div>
<div class="paragraph">
<p>For this example, the program works fine. However, our program would
have given incorrect output if <code>ship</code>, <code>spectators</code>, or several other
words in the text had been on the word list. You see, the <code>next()</code>
method in the <code>Scanner</code> class reads in <code>String</code> values separated by
white space. The word <code>ship</code> appears twice in the text, but the second
instance is followed by a comma. Since the words are separated by white
space only, the <code>String</code> <code>"ship,"</code> does not match the <code>String</code> <code>"ship"</code>.
Dealing with punctuation is not difficult, but it would increase the
length of the code, and we leave it as an exercise.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise6.8">Exercise 6.8</a></p>
</div>
</div>
</div>
<div id="statisticsExample" class="exampleblock">
<div class="title">Example 65. Statistics</div>
<div class="content">
<div class="paragraph">
<p>Imagine that you are a teacher who has just given an exam. You want to
produce statistics for the class so that the students have some idea how
well they have done. You want to write a Java program to help you
produce the statistics, to save time now and in the future.</p>
</div>
<div class="paragraph">
<p>The statistics you want to collect are listed in the following table.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Statistic</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum score</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum score</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Average of all the scores</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard Deviation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sample standard deviation of the scores</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Median</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Middle value of the scores when ordered</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#kingOfTheHillExample">Example 62</a> covered how to find the maximum and
minimum scores in a list. The mean is simply the sum of all the scores
divided by the total number of scores. Standard deviation is a little
bit trickier. It gives a measurement of how spread out the data is. Let
\(n\) be the number of data points, label each data point
\(x_i\), where \(1 \leq i \leq n\), and let
\(\bar{x}\) be the mean of all the data points. Then, the
formula for the sample standard deviation is as follows.</p>
</div>
<div class="paragraph">
<p>\(\sigma = \sqrt{\frac{1}{n - 1}\sum_{i = 1}^n (x_i - \bar{x})^2}\)</p>
</div>
<div class="paragraph">
<p>Finally, if you sort a list of numbers in order, the median is the
middle value in the list, or the average of the two middle values, if
the list has an even length.</p>
</div>
<div class="paragraph">
<p>These kinds of statistical operations are very useful and are packaged
into many important business applications such as Microsoft Excel. This
version will have a simple interface whose input comes from the command
line. First, the total number of scores will be entered. Then, each
score should be entered one by one. After all the data has been entered,
the program should compute and output the five values.</p>
</div>
<div class="paragraph">
<p>Below we give the solution to this statistics problem. Several different
tasks are combined here, but each of them should be reasonably easy to
solve after the previous examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Statistics</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno">6 </span>		<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">7 </span>		<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">scores</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">];</span>
<span class="lineno">8 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">9 </span>			<span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In our solution, the <code>main()</code> method begins by reading in the total
number of scores and declaring an <code>int</code> array of that length named
<code>scores</code>. Then, we read in each of the scores and store them into
<code>scores</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-kt">int</span> <span class="tok-n">max</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">];</span>
<span class="lineno"> 2 </span>		<span class="tok-kt">int</span> <span class="tok-n">min</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">];</span>
<span class="lineno"> 3 </span>		<span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">];</span>
<span class="lineno"> 4 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">&gt;</span> <span class="tok-n">max</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>				<span class="tok-n">max</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno"> 7 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">&lt;</span> <span class="tok-n">min</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>				<span class="tok-n">min</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno"> 9 </span>			<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno">10 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we declare variables <code>max</code>, <code>min</code>, and <code>sum</code> to hold, respectively,
the maximum, minimum, and sum of the elements in the array. Then, we set
all three variables to the value of the first element of the array.
These initializations make the following code work. In a single <code>for</code>
loop, we find the maximum, minimum, and sum of all the values in the
array. We could have done so with three separate loops, but this
approach is more efficient. Setting <code>max</code> and <code>min</code> to <code>scores[0]</code>
follows the pattern we have used before, but setting <code>sum</code> to the same
value is also necessary in this case. Because the loop iterates from <code>1</code>
up to <code>scores.length - 1</code>, we must include the value at index <code>0</code> in
<code>sum</code>. Alternatively, we could have set <code>sum</code> to <code>0</code> and started the
<code>for</code> loop at <code>i = 0</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-kt">double</span> <span class="tok-n">mean</span> <span class="tok-o">=</span> <span class="tok-o">((</span><span class="tok-kt">double</span><span class="tok-o">)</span><span class="tok-n">sum</span><span class="tok-o">)/</span><span class="tok-n">n</span><span class="tok-o">;</span>
<span class="lineno">2 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Maximum:\t\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">max</span><span class="tok-o">);</span>
<span class="lineno">3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Minimum:\t\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">min</span><span class="tok-o">);</span>
<span class="lineno">4 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Mean:\t\t\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">mean</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this short snippet of code, we compute the mean, being careful to
store it into a variable of type <code>double</code>, and then print out the three
statistics we have already computed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-kt">double</span> <span class="tok-n">variance</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">3 </span>			<span class="tok-n">variance</span> <span class="tok-o">+=</span> <span class="tok-o">(</span><span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">-</span> <span class="tok-n">mean</span><span class="tok-o">)*(</span><span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">-</span> <span class="tok-n">mean</span><span class="tok-o">);</span>
<span class="lineno">4 </span>		<span class="tok-n">variance</span> <span class="tok-o">/=</span> <span class="tok-o">(</span><span class="tok-n">n</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
<span class="lineno">5 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Standard Deviation:\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-n">variance</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, we use the mean we have already computed to find the
sample standard deviation. Following the formula for sample standard
deviation, we subtract the mean from each score, square the result, and
add it to a running total. Although the formula for sample standard
deviation uses the bounds \(1\) to \(n\), we
translate them to 0 to <code>n - 1</code> because of zero-based array numbering.
Dividing the total by <code>n - 1</code> gives the sample variance. Then, the
square root of the variance is the standard deviation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-kt">int</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>			<span class="tok-n">min</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">&lt;</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">min</span><span class="tok-o">]</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>					<span class="tok-n">min</span> <span class="tok-o">=</span> <span class="tok-n">j</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>			<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">min</span><span class="tok-o">];</span>
<span class="lineno"> 8 </span>			<span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">min</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno"> 9 </span>			<span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-o">}</span>
<span class="lineno">11 </span>		<span class="tok-kt">double</span> <span class="tok-n">median</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">n</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>			<span class="tok-n">median</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">/</span><span class="tok-mi">2</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">])/</span><span class="tok-mf">2.0</span><span class="tok-o">;</span>
<span class="lineno">14 </span>		<span class="tok-k">else</span>
<span class="lineno">15 </span>			<span class="tok-n">median</span> <span class="tok-o">=</span> <span class="tok-n">scores</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-o">];</span>
<span class="lineno">16 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Median:\t\t\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">median</span><span class="tok-o">);</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To find the median, we use our selection sort code. Note that we have
reused the variable <code>min</code> to hold the smallest value found so far,
instead of declaring a new variable such as <code>smallest</code>. Some programmers
might object to doing so, since we run the risk of interpreting the
variable as the minimum value in the entire array, as it was before.
Either approach is fine. If you worry about confusing people reading
your code, add a comment.</p>
</div>
<div class="paragraph">
<p>After the array has been sorted, we need to do a quick check to see if
its length is odd or even. If its length is even, we need to find the
average of the two middle elements. If its length is odd, we can report
the value of the single middle element.</p>
</div>
<div class="paragraph">
<p>Note that some of the statistics we found, such as the maximum, minimum,
or mean, could be computed using loops without an array for storage.
However, the last two tasks need to store all of the values at once in
order to work. Finding the sample standard deviation of a list of values
requires its mean. At least two passes over the data are needed to
compute the sample standard deviation: one to find the mean and another
to apply the equation for sample standard deviation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_multidimensional_lists">6.6. Concepts: Multidimensional lists</h3>
<div class="paragraph">
<p>In the previous half of the chapter, we focused on lists of data and how
to store them in Java in arrays. The arrays we have discussed already
are <em>one-dimensional</em> arrays. That is, each element in the array has a
single index that refers to it. Given a specific index, an element will
have that index, come before it, or come after it. These kinds of arrays
can be used to solve a huge number of problems involving lists or
collections of data.</p>
</div>
<div class="paragraph">
<p>Sometimes, the data needs to be represented with more structure. One way
to provide this structure is with a <em>two-dimensional</em> array. You can
think of a two-dimensional array as a table of data. Instead of using a
single index, a two-dimensional array has two indexes. Usually, we think
about these dimensions as rows and columns. Below is a table of
information that gives the distances in miles between the five largest
cities in the United States.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"></th>
<th class="tableblock halign-center valign-middle">New York</th>
<th class="tableblock halign-center valign-middle">Los Angeles</th>
<th class="tableblock halign-center valign-middle">Chicago</th>
<th class="tableblock halign-center valign-middle">Houston</th>
<th class="tableblock halign-center valign-middle">Phoenix</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">New York</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2,791</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">791</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,632</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2,457</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Los Angeles</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2,791</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2,015</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,546</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">373</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Chicago</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">791</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2,015</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,801</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,181</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Houston</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,632</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,546</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,801</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,176</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Phoenix</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2,457</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">373</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,181</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,176</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The position of each number in the table is a fundamental part of its
usefulness. We know that the distance from Chicago to Houston is 1,801
miles because that number is in the Chicago row and the Houston column.
A two-dimensional array shares almost all of its properties with a
one-dimensional array. It is still a homogeneous, static data structure
with random access. If the example above were made into a Java array,
the numbers themselves would be the elements of the array. The names of
the cities would need to be stored separately, perhaps in an array of
type <code>String</code>.</p>
</div>
<div class="paragraph">
<p>There is no reason to confine the idea of a two-dimensional list to a
table of values. Many games are played on a two-dimensional grid. One of
the most famous such games is chess. As with so many other things in
computer science, we must come up with an abstraction that mirrors
reality and allows us to store the information inside of a computer. For
chess, we will need an 8 × 8 two-dimensional array. We can represent
each piece in the board with a <code>char</code>, using the encoding given below.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Piece</th>
<th class="tableblock halign-center valign-top">Encoding</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Pawn</p></td>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>'P'</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Knight</p></td>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>'N'</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Bishop</p></td>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>'B'</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Rook</p></td>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>'R'</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Queen</p></td>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>'Q'</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">King</p></td>
<td class="tableblock halign-center valign-top"><div class="literal"><pre>'K'</pre></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Using upper case characters for black pieces and lower case characters
for white pieces, we could represent a game of chess after a classic
king&#8217;s pawn open by white as shown.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"></th>
<th class="tableblock halign-center valign-middle">0</th>
<th class="tableblock halign-center valign-middle">1</th>
<th class="tableblock halign-center valign-middle">2</th>
<th class="tableblock halign-center valign-middle">3</th>
<th class="tableblock halign-center valign-middle">4</th>
<th class="tableblock halign-center valign-middle">5</th>
<th class="tableblock halign-center valign-middle">6</th>
<th class="tableblock halign-center valign-middle">7</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">0</p></th>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'R'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'N'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'B'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'Q'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'K'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'B'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'N'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'R'</pre></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">1</p></th>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'P'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'P'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'P'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'P'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'P'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'P'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'P'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'P'</pre></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">2</p></th>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">3</p></th>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">4</p></th>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">5</p></th>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'p'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">6</p></th>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'p'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'p'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'p'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'p'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre></pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'p'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'p'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'p'</pre></div></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">7</p></th>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'r'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'n'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'b'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'q'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'k'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'b'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'n'</pre></div></td>
<td class="tableblock halign-center valign-middle"><div class="literal"><pre>'r'</pre></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Observe that, just as with one-dimensional arrays, the indexes for rows
and columns in two-dimensional arrays also use zero-based counting.</p>
</div>
<div class="paragraph">
<p>After the step from one-dimensional arrays to two-dimensional arrays, it
is natural to wonder if there can be arrays of even higher dimension. We
can visualize a two-dimensional array as a table, but a
three-dimensional array is harder to visualize. Nevertheless, there are
uses for three-dimensional arrays.</p>
</div>
<div class="paragraph">
<p>Consider a professor who is taking a survey of students in her course.
She wants to know how many students there are in each of three
categories: gender, class level, and major. If she treats each of these
as a dimension and assigns an index to each possible value, she could
store the results in a three-dimensional array. For gender she could
pick male = 0 and female = 1. For class level she could pick freshman =
0, sophomore = 1, junior = 2, senior = 3, and other = 4. Assuming it is
a computer science class, for major she could pick computer science = 0,
math = 1, other science = 2, engineering = 3, humanities = 4. Using this
system she could compactly store the number of students in any
combination of categories she was interested in. For example, the total
number of female sophomore engineering students would be stored in the
cell with gender index 1, class level index 1, and major index 3.</p>
</div>
<div class="paragraph">
<p>Three dimensions is usually the practical limit when programming in
Java. If you find an especially good reason to use four or higher
dimensions, feel free to do so, but it should happen infrequently. The
Java language has no set limit on array dimensions, but most virtual
machines have the absurdly high limitation of 255 different dimensions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_advanced_arrays_in_java">6.7. Syntax: Advanced arrays in Java</h3>
<div class="paragraph">
<p>Now that we have discussed the value of storing data in multidimensional
lists, we will describe the Java language features that allow you to do
so. The changes needed to go from one-dimensional arrays to
two-dimensional and higher arrays are quite simple. First, we will
describe how to declare, instantiate, and index into two-dimensional
arrays. Then, we will discuss some of the ways in which arrays (both
one-dimensional and higher) are different from primitive data types.
Next, we will explain how it is possible make make two-dimensional
arrays in Java where the rows are not all the same length. Finally, we
will cover some of the most common mistakes programmers make with
arrays.</p>
</div>
<div class="sect3">
<h4 id="_multidimensional_arrays">6.7.1. Multidimensional arrays</h4>
<div class="paragraph">
<p>When declaring a two-dimensional array, the main difference from a
one-dimensional array is an extra pair of brackets. If we wish to
declare a two-dimensional array of type <code>int</code> in which we could store
values like the table of distances above, we would do so as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[][]</span> <span class="tok-n">distances</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with one-dimensional arrays, it is legal to put the brackets on the
other side of the variable identifier or, even more bizarrely, have a
pair on each side.</p>
</div>
<div class="paragraph">
<p>Once the array is declared, it must still be instantiated using the
<code>new</code> keyword before it can be used. This time we will use two pairs of
brackets, with the number in the first pair specifying the number of
rows and the number in the second pair specifying the number of columns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">distances</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">][</span><span class="tok-mi">5</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the instantiation, we will have 5 rows and 5 columns, giving a
total of 25 locations where <code>int</code> values can be stored. Indexing these
locations is done by specifying row and column values in the brackets.
So, to fill up the table with the distances between cities given above
we can use the following tedious code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">//New York</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">2791</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">791</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1632</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">2457</span><span class="tok-o">;</span>
<span class="tok-c1">//Los Angeles</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">2791</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">2015</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1546</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">373</span><span class="tok-o">;</span>
<span class="tok-c1">//Chicago</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">791</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">2015</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1801</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1181</span><span class="tok-o">;</span>
<span class="tok-c1">//Houston</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1632</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1546</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1801</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1176</span><span class="tok-o">;</span>
<span class="tok-c1">//Phoenix</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">2457</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">373</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1181</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">][</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1176</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will notice that we did not specify values for <code>distances[0][0]</code>,
<code>distances[1][1]</code>, <code>distances[2][2]</code>, <code>distances[3][3]</code>, or
<code>distances[4][4]</code>, since each of these already has the default value of
<code>0</code>.</p>
</div>
<div class="paragraph">
<p>Much more often, multidimensional array manipulation will use nested
<code>for</code> loops. For example, we could create an array with 3 rows and 4
columns, and then assign values to those locations such that they were
numbered increasing across each row.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[][]</span> <span class="tok-n">values</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">4</span><span class="tok-o">];</span>
<span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">number</span><span class="tok-o">;</span>
        <span class="tok-n">number</span><span class="tok-o">++;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code would result in an array filled up like the following table.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The bounds for the outer <code>for</code> loop in this example uses
<code>values.length</code>, giving the total number of rows. Then, the inner <code>for</code>
loops uses <code>values[0].length</code>, which is the length (number of columns)
of the first row. In this case, all the rows of the array have the same
number of columns, but this is not always true, as we will discuss
later.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reference_types_2">6.7.2. Reference types</h4>
<div class="paragraph">
<p>All array variables are <em>reference</em> type variables, not simple values
like most of the types we have discussed so far. A reference variable is
a name for an object. You might recall that we described the difference
between reference types and primitive types in
<a href="#_concepts_types">Section 3.2</a>, but the only reference type we have
considered in detail is <code>String</code>.</p>
</div>
<div class="paragraph">
<p>More than one reference variable can point at the same object. When one
object has more than one name, this is called <em>aliasing</em>. The <code>String</code>
type is immutable, meaning that an object of type <code>String</code> cannot change
its contents. Arrays, however, are mutable, which means that aliasing
can cause unexpected results. Here is a simple example with
one-dimensional array aliasing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array1</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">array1</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array2</span> <span class="tok-o">=</span> <span class="tok-n">array1</span><span class="tok-o">;</span>
<span class="tok-n">array2</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">17</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">array1</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Surprisingly, the value printed out will be <code>17</code>. The variables <code>array1</code>
and <code>array2</code> are references to the same fundamental array. Unlike
primitive values, the complete contents of <code>array1</code> are not copied to
<code>array2</code>. Only one array exists because only one array has been created
by the <code>new</code> keyword. So, when index 3 of <code>array2</code> is updated, index 3
of <code>array1</code> changes as well, because the two variables are simply two
names for one array.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/06-arrays/images/array3.png" alt="array3">
</div>
<div class="title">Figure 26. Two array references pointing to a single array object.</div>
</div>
<div class="paragraph">
<p>Sometimes this reference feature of Java allows us to write code that is
confusing or has unexpected consequences. However, the benefit is that
we can assign one array to another without incurring the expense of
copying the entire array. If you had created an array with 1,000,000
elements, copying that array several times could get very expensive in
terms of program running time.</p>
</div>
<div class="paragraph">
<p>The best rule of thumb for understanding reference types is that there
is only one actual object for every call to <code>new</code>. The primary exception
to this rule is that uses of <code>new</code> can be hidden from the user when they
are in method calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">greeting</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">(</span><span class="tok-s">&quot;Hello&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">pronoun</span> <span class="tok-o">=</span> <span class="tok-n">greeting</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At the end of this code, the reference <code>pronoun</code> will point to an object
containing the <code>String "He"</code>. The <code>substring()</code> method invokes <code>new</code>
internally, generating a new <code>String</code> object completely separate from
the <code>String</code> referenced by <code>greeting</code>. This code may look unusual
because we are explicitly using <code>new</code> to make a <code>String</code> object
containing <code>"Hello"</code>. The <code>String</code> class is different from every other
class because it can be instantiated without using the <code>new</code> keyword.
The line<br>
<code>String greeting = "Hello";</code> implicitly calls <code>new</code> to create an object
containing the <code>String "Hello"</code> and functions nearly the same as the
similar line above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ragged_arrays">6.7.3. Ragged arrays</h4>
<div class="paragraph">
<p>We are ashamed to say that we have lied to you. In Java, there is no
such thing as a multidimensional array. Instead, the examples of
two-dimensional and three-dimensional arrays we have given above are
actually arrays of arrays (of arrays). Thinking about multidimensional
arrays in this way can give the programmer more flexibility.</p>
</div>
<div class="paragraph">
<p>If we return to the definition of the two-dimensional array with 3 rows
and 4 columns, we can instantiate each row separately instead of as a
block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[][]</span> <span class="tok-n">values</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][];</span>
<span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">];</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">values</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">number</span><span class="tok-o">;</span>
            <span class="tok-n">number</span><span class="tok-o">++;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code is functionally equivalent to the earlier code that
instantiated all 12 locations at once. The same could be done with a
three-dimensional array or higher. We can specify the length of each row
independently, and, more bizarrely, we can give each row a different
length. A multidimensional array whose rows have different lengths is
called a <em>ragged array</em>.</p>
</div>
<div class="paragraph">
<p>A ragged array is usually unnecessary. The main reason to use a ragged
array is to save space, when you have tabular data in which the lengths
of each row varies a great deal. If the lengths of the rows vary only a
little, it is probably not worth the extra hassle. However, if some rows
have 10 elements and others have 1,000,000, the space saved can be
significant.</p>
</div>
<div class="paragraph">
<p>We can apply the idea of ragged arrays to the table of distances between
cities. If you examine this table, you will notice that about half the
data in it is repeated, because the distance from Chicago to Los Angeles
is the same as the distance from Los Angeles to Chicago, and so on. We
can store the data in a triangular shape to keep only the unique
distance information.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle"></th>
<th class="tableblock halign-center valign-middle">New York</th>
<th class="tableblock halign-center valign-middle">Los Angeles</th>
<th class="tableblock halign-center valign-middle">Chicago</th>
<th class="tableblock halign-center valign-middle">Houston</th>
<th class="tableblock halign-center valign-middle">Phoenix</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">New York</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle" colspan="4"></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Los Angeles</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2,791</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle" colspan="3"></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Chicago</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">791</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2,015</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle" colspan="2"></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Houston</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,632</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,546</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,801</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle"></td>
</tr>
<tr>
<th class="tableblock halign-center valign-middle"><p class="tableblock">Phoenix</p></th>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2,457</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">373</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,181</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1,176</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We could create this table in code by doing the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">distances</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">][];</span>
<span class="tok-c1">//New York</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">];</span>
<span class="tok-c1">//Los Angeles</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">];</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">2791</span><span class="tok-o">;</span>
<span class="tok-c1">//Chicago</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">];</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">791</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">2015</span><span class="tok-o">;</span>
<span class="tok-c1">//Houston</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">];</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1632</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1546</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1801</span><span class="tok-o">;</span>
<span class="tok-c1">//Phoenix</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">];</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">2457</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">373</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1181</span><span class="tok-o">;</span>
<span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">][</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1176</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this table a user cannot simply type in <code>distances[0][4]</code> and hope
to get the distance from New York to Phoenix. Instead, we have to be
careful to make sure that the index of the first city is never larger
than the index of the second city. If we are reading in the indexes of
the cities from a user, we can write some code to do this check. Let
<code>city1</code> and <code>city2</code>, respectively, contain the indexes of the cities the
user wants to use to find the distances between.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">city1</span> <span class="tok-o">&gt;</span> <span class="tok-n">city2</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">city1</span><span class="tok-o">;</span>
    <span class="tok-n">city1</span> <span class="tok-o">=</span> <span class="tok-n">city2</span><span class="tok-o">;</span>
    <span class="tok-n">city2</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The distance is: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">distances</span><span class="tok-o">[</span><span class="tok-n">city1</span><span class="tok-o">][</span><span class="tok-n">city2</span><span class="tok-o">]</span> <span class="tok-o">+</span>
    <span class="tok-s">&quot; miles&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to be even cleverer, we could eliminate the zero entries
from the table, but then the ragged array would have one fewer row than
the original two-dimensional array.</p>
</div>
</div>
<div class="sect3">
<h4 id="_common_pitfalls">6.7.4. Common pitfalls</h4>
<div class="paragraph">
<p>Even one-dimensional arrays make many new errors possible. Below we list
two of the most common mistakes made with both one-dimensional and
multidimensional arrays.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Array out of bounds</div>
<div class="paragraph">
<p>The length of an array is determined at runtime. Sometimes the number is
specified in the source code, but it is always possible for an array to
be instantiated based on user input. The Java compiler does not do any
checking to see if you are in the right range. If your program tries to
access an illegal element, it will crash with an
<code>ArrayIndexOutOfBoundsException</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a classic example. By iterating through the loop one too many
times, the program will try to store <code>100</code> into <code>array[100]</code>, when the
last index of the array is <code>99</code>. In C and C++, pointer arithmetic
allowed a negative index to be valid for an array in some cases. In
Java, a negative index will always throw an
<code>ArrayIndexOutOfBoundsException</code>.</p>
</div>
<div class="paragraph">
<p>There are other less common causes for going outside of array bounds.
Imagine that you are scanning through a file that has been redirected to
input, keeping a count of the occurrences of each letter of the alphabet
in the file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">counts</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">26</span><span class="tok-o">];</span>
<span class="tok-n">String</span> <span class="tok-n">word</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNext</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">word</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">word</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">counts</span><span class="tok-o">[</span><span class="tok-n">word</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">-</span> <span class="tok-sc">&#39;a&#39;</span><span class="tok-o">]++;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This segment of code does a decent job of counting the occurrences of
each letter. The <code>while</code> loop continues to execute as long as there is
another <code>String</code> worth of data to read in the file. The inner <code>for</code> loop
iterates through each <code>char</code> in the <code>String</code> and increments the
appropriate element of the <code>counts</code> array. By subtracting the value
<code>'a'</code>, we normalize the <code>char</code> values <code>'a'</code> through <code>'z'</code> to <code>0</code> through
<code>25</code>. However, if there is any punctuation in the file, simply
subtracting <code>'a'</code> will not work. The Unicode value of <code>'.'</code>, for
example, is 46. The Unicode value of <code>'a'</code> is 97. Subtracting 97 from 46
will make this code try to increment index <code>-51</code> of the array. An
additional check should be put into this code to make sure that the
<code>char</code> value being examined is a letter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Uninitialized reference arrays</div>
<div class="paragraph">
<p>Another problem only comes up with arrays of reference types. Whenever
the elements of an array are primitive data types, memory for that type
is allocated. Whenever the elements of the array are reference types,
only references to objects, initialized to <code>null</code> are allocated. Because
it&#8217;s an array of primitive values, the following code works fine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">primitives</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-n">primitives</span><span class="tok-o">[</span><span class="tok-mi">67</span><span class="tok-o">]++;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code, however, will cause a <code>NullPointerException</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">references</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">references</span><span class="tok-o">[</span><span class="tok-mi">67</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Arrays of reference types must initialize each element before using it.
The<br>
<code>NullPointerException</code> could be avoided as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">references</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">references</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">references</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">();</span>
<span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">references</span><span class="tok-o">[</span><span class="tok-mi">67</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, there would be no error, although
<code>references[67].length()</code> would still be <code>0</code>, and that is probably not
what the programmer intended.</p>
</div>
<div class="paragraph">
<p>A similar error can happen with multidimensional arrays.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[][]</span> <span class="tok-n">table</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">][];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">table</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">table</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because an array is itself a reference type, the <code>table</code> array contains
<code>10</code> references to <code>null</code> for each of its <code>10</code> rows. Unless those rows
are instantiated, the JVM will again throw a <code>NullPointerException</code> when
attempting to access an <code>int</code> value in the table. This error confuses
many beginner programmers because no reference types appear to be
involved.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_two_dimensional_arrays">6.8. Examples: Two-dimensional arrays</h3>
<div class="paragraph">
<p>Below we give some examples where two-dimensional arrays can be helpful.
We start with a very simple calendar example, move on to matrix and
vector multiplication useful in math, and finish with a game.</p>
</div>
<div class="exampleblock">
<div class="title">Example 66. Calendar</div>
<div class="content">
<div class="paragraph">
<p>We are going to create a calendar that can be printed to the console to
show which day of the week each day lands on. Our program will prompt
the user for the day of the week the month starts on and for the total
number of days in the month. Our program will print out labels for the
seven days of the week, followed by numbering starting at the
appropriate place, and wrapping such that each numbered day of the month
falls under the appropriate day of the week.</p>
</div>
<div id="CalendarProgram" class="listingblock">
<div class="title">Program 29. Prints a calendar for a given month, formatted week by week.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Calendar</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">String</span><span class="tok-o">[][]</span> <span class="tok-n">squares</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-mi">7</span><span class="tok-o">][</span><span class="tok-mi">7</span><span class="tok-o">];</span>
<span class="lineno"> 6 </span>		<span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sun&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Mon&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>		<span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Tue&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Wed&quot;</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Thu&quot;</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">5</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Fri&quot;</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">6</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sat&quot;</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">squares</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">14 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">15 </span>				<span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s">&quot; &quot;</span><span class="tok-o">;</span>
<span class="lineno">16 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno">17 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Which day does your month start on?&quot;</span>
<span class="lineno">18 </span>				<span class="tok-o">+</span> <span class="tok-s">&quot; (0 - 6) &quot;</span><span class="tok-o">);</span>
<span class="lineno">19 </span>		<span class="tok-kt">int</span> <span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span> <span class="tok-c1">//read starting day</span>
<span class="lineno">20 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;How many days does your month have?&quot;</span>
<span class="lineno">21 </span>				<span class="tok-o">+</span> <span class="tok-s">&quot; (28 - 31) &quot;</span><span class="tok-o">);</span>
<span class="lineno">22 </span>		<span class="tok-kt">int</span> <span class="tok-n">days</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>  <span class="tok-c1">//read days in month</span>
<span class="lineno">23 </span>		<span class="tok-kt">int</span> <span class="tok-n">day</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">24 </span>		<span class="tok-kt">int</span> <span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">25 </span>		<span class="tok-kt">int</span> <span class="tok-n">column</span> <span class="tok-o">=</span> <span class="tok-n">start</span><span class="tok-o">;</span>
<span class="lineno">26 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">day</span> <span class="tok-o">&lt;=</span> <span class="tok-n">days</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-c1">//fill calendar</span>
<span class="lineno">27 </span>			<span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">day</span><span class="tok-o">;</span>
<span class="lineno">28 </span>			<span class="tok-n">day</span><span class="tok-o">++;</span>
<span class="lineno">29 </span>			<span class="tok-n">column</span><span class="tok-o">++;</span>
<span class="lineno">30 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">column</span> <span class="tok-o">&gt;=</span> <span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">].</span><span class="tok-na">length</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>				<span class="tok-n">column</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">32 </span>				<span class="tok-n">row</span><span class="tok-o">++;</span>
<span class="lineno">33 </span>			<span class="tok-o">}</span>
<span class="lineno">34 </span>		<span class="tok-o">}</span>
<span class="lineno">35 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">squares</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">36 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">37 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-n">squares</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">);</span>
<span class="lineno">38 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">();</span>
<span class="lineno">39 </span>		<span class="tok-o">}</span>
<span class="lineno">40 </span>	<span class="tok-o">}</span>
<span class="lineno">41 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First, our code creates a 7 × 7 array of type
<code>String</code> called <code>squares</code>. The array needs 7 rows so that it can start
with a row to label the days and then output up to 6 rows to cover the
weeks. (Months with 31 days span parts of 6 different weeks if they
start on a Friday or a Saturday.) The number of columns corresponds to
the seven days of the week. Next, we initialize the first row of the
array to abbreviations for each day of the week. Then, we initialize the
rest of the array to be a single space.</p>
</div>
<div class="paragraph">
<p>Our program then prompts the user for the day the month starts on, using
a <code>for</code> loop to print out the choices that have already been saved in
<code>squares</code>. The program also prompts the user for the total number of
days in the month.</p>
</div>
<div class="paragraph">
<p>The main work of the program is done by the <code>while</code> loop, which fills
each square with a steadily increasing day number for each column,
moving on to the next row when a row is filled. Finally, the two nested
<code>for</code> loops at the end print out the contents of <code>squares</code>, putting a
tab (<code>'\t'</code>) between each column and starting a new line for each row.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 67. Matrix-vector multiplication</div>
<div class="content">
<div class="paragraph">
<p>Arrays give a natural way to represent vectors and matrices. In 3D
graphics and video game design, we can represent a point in 3D space as
a vector with three elements: \(x\), \(y\), and
\(z\). If we want to rotate the three-dimensional point
represented by this vector, we can multiply it by a matrix. For example,
to rotate a point around the \(x\)-axis by
\(\theta\) degrees, we could use the following matrix.</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp; \cos \theta &amp; -\sin \theta \\
0 &amp; \sin \theta  &amp; \cos \theta \\
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p>Given an \(m\times n\) matrix \(A\), let
\(A_{ij}\) be the element in the \(i\)<sup>th</sup> row,
\(j\)<sup>th</sup> column. Given a vector \(v\) of length
\(n\), let \(v_i\) be the \(i\)<sup>th</sup>
element in the vector. To multiply \(A\) by \(v\),
we use the following equation to find the \(i\)<sup>th</sup> element of
the resulting vector \(v'\).</p>
</div>
<div class="paragraph">
<p>\(v'_i = \sum_{j = 1}^n A_{ij}\cdot v_j\)</p>
</div>
<div class="paragraph">
<p>By transforming this equation to Java code, we can write a program that
can read in a three-dimensional point and rotate it around the
\(x\)-axis by the amount specified by the user.</p>
</div>
<div id="MatrixRotateProgram" class="listingblock">
<div class="title">Program 30. Uses matrix multiplication to rotate a point in three-dimensional space.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MatrixRotate</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">point</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">];</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;What point do you want to rotate?&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;x: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-n">point</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;y: &quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-n">point</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">12 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;z: &quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>		<span class="tok-n">point</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">14 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;What angle around the x-axis? &quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>		<span class="tok-kt">double</span> <span class="tok-n">theta</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">toRadians</span><span class="tok-o">(</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">());</span>
<span class="lineno">16 </span>		<span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-n">rotation</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">3</span><span class="tok-o">];</span>
<span class="lineno">17 </span>		<span class="tok-n">rotation</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">18 </span>		<span class="tok-n">rotation</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">cos</span><span class="tok-o">(</span><span class="tok-n">theta</span><span class="tok-o">);</span>
<span class="lineno">19 </span>		<span class="tok-n">rotation</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sin</span><span class="tok-o">(</span><span class="tok-n">theta</span><span class="tok-o">);</span>
<span class="lineno">20 </span>		<span class="tok-n">rotation</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sin</span><span class="tok-o">(</span><span class="tok-n">theta</span><span class="tok-o">);</span>
<span class="lineno">21 </span>		<span class="tok-n">rotation</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">cos</span><span class="tok-o">(</span><span class="tok-n">theta</span><span class="tok-o">);</span>
<span class="lineno">22 </span>		<span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">rotatedPoint</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">];</span>
<span class="lineno">23 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">rotatedPoint</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">24 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">point</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">25 </span>				<span class="tok-n">rotatedPoint</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">+=</span> <span class="tok-n">rotation</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]*</span><span class="tok-n">point</span><span class="tok-o">[</span><span class="tok-n">j</span><span class="tok-o">];</span>
<span class="lineno">26 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Rotated point: [&quot;</span> <span class="tok-o">+</span> <span class="tok-n">rotatedPoint</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">+</span>
<span class="lineno">27 </span>			<span class="tok-s">&quot;,&quot;</span> <span class="tok-o">+</span> <span class="tok-n">rotatedPoint</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;,&quot;</span> <span class="tok-o">+</span> <span class="tok-n">rotatedPoint</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;]&quot;</span><span class="tok-o">);</span>
<span class="lineno">28 </span>	<span class="tok-o">}</span>
<span class="lineno">29 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program begins by declaring a array of type <code>double</code> to hold the
vector and then reading three values from the user into it. Then, the
program reads in the angle of rotation in degrees and converts it to
radians. Next, we use the <code>Math</code> class to calculate the values in the
rotation matrix. Note that we do not change the values that need to be
zero. Finally, we use a <code>for</code> loop to perform the matrix-vector
multiplication and then print out the answer. Again, the summing done by
our calculations uses the fact that all elements of <code>rotatedPoint</code> are
initialized to <code>0.0</code>.</p>
</div>
</div>
</div>
<div id="ticTacToeExample" class="exampleblock">
<div class="title">Example 68. Tic Tac Toe</div>
<div class="content">
<div class="paragraph">
<p>Almost every child knows the game of Tic Tac Toe. Its playing area is a
3 \(\times\) 3 grid. Players take turns placing X&#8217;s and O&#8217;s,
trying to get three in a row. Strategically, it is not the most
interesting game since two players who make no mistakes will always tie.
Still, we present a program that allows two human players to play the
game because the manipulations of a two-dimensional array in the program
are similar to those for more complicated games such as Connect Four,
checkers, chess, or Go. Our program will catch any attempt to play on a
location that has already been played and will determine the winner, if
there is one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TicTacToe</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-kt">char</span><span class="tok-o">[][]</span> <span class="tok-n">board</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">char</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">][</span><span class="tok-mi">3</span><span class="tok-o">];</span>
<span class="lineno"> 7 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">board</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>				<span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-sc">&#39; &#39;</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">turn</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">gameOver</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-kt">int</span> <span class="tok-n">row</span><span class="tok-o">,</span> <span class="tok-n">column</span><span class="tok-o">,</span> <span class="tok-n">moves</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-kt">char</span> <span class="tok-n">shape</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Games often give rise to complex programs, since rules that are
intuitively obvious to humans may be difficult to state explicitly in
Java. Our program begins by setting up quite a few variables and
objects. First, we create a <code>Scanner</code> to read in data. Then, we declare
and instantiate our 3 \(\times\) 3 playing board as a
two-dimensional array of type <code>char</code>. We want any unplayed space on the
grid to be the <code>char</code> for a space, so we fill the array with <code>' '</code>.
Next, we declare a <code>boolean</code> value to keep track of whose turn it is and
another to keep track of whether the game is over or not. Finally, we
declare variables to hold the row, the column, the number of moves that
have been made so far and the current shape (<code>'X'</code> or <code>'O'</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">gameOver</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>			<span class="tok-n">shape</span> <span class="tok-o">=</span> <span class="tok-n">turn</span> <span class="tok-o">?</span> <span class="tok-sc">&#39;X&#39;</span> <span class="tok-o">:</span> <span class="tok-sc">&#39;O&#39;</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">shape</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;s turn.  Enter row(0-2): &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 4 </span>			<span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter column(0-2): &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>			<span class="tok-n">column</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39; &#39;</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Illegal move&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>			<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>				<span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">shape</span><span class="tok-o">;</span>
<span class="lineno">11 </span>				<span class="tok-n">moves</span><span class="tok-o">++;</span>
<span class="lineno">12 </span>				<span class="tok-n">turn</span> <span class="tok-o">=</span> <span class="tok-o">!</span><span class="tok-n">turn</span><span class="tok-o">;</span>
<span class="lineno">13 </span>				<span class="tok-c1">//print board</span>
<span class="lineno">14 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;|&quot;</span>
<span class="lineno">15 </span>						 <span class="tok-o">+</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;|&quot;</span> <span class="tok-o">+</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]);</span>
<span class="lineno">16 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;-----&quot;</span><span class="tok-o">);</span>
<span class="lineno">17 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;|&quot;</span>
<span class="lineno">18 </span>						 <span class="tok-o">+</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;|&quot;</span> <span class="tok-o">+</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]);</span>
<span class="lineno">19 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;-----&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;|&quot;</span>
<span class="lineno">21 </span>						 <span class="tok-o">+</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;|&quot;</span> <span class="tok-o">+</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-s">&quot;\n&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The core of the game is a <code>while</code> loop that runs until <code>gameOver</code>
becomes <code>true</code>. The first line of the body of this loop is an obscure
Java shortcut often referred to as the <em>ternary operator</em>. This line is
really shorthand for the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">turn</span> <span class="tok-o">)</span>
    <span class="tok-n">shape</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;X&#39;</span><span class="tok-o">;</span>
<span class="tok-k">else</span>
    <span class="tok-n">shape</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;0&#39;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ternary operator works with a condition followed by a question mark
and then two values separated by a colon. If the condition is <code>true</code>,
the first value is assigned, otherwise the second value is assigned. It
is perfect for situations like this where one value is needed when
<code>turn</code> is <code>true</code> and another is needed when <code>turn</code> is <code>false</code>. The
ternary operator is a useful trick, but it should not be overused.</p>
</div>
<div class="paragraph">
<p>After assigning the appropriate value to <code>shape</code>, our code reads in the
row and column values for the current player&#8217;s next move. If the row and
column selected correspond to a spot that has already been taken, the
program gives an error message. Otherwise, the program sets
<code>board[row][column]</code> to the appropriate symbol, increments <code>moves</code>, and
changes the value of <code>turn</code>. Then, it prints out the board. We point out
that our program does not do any bounds checking on <code>row</code> and <code>column</code>.
If a user tries to place a move at row 5 column 3, our program will try
to do so and crash. Four additional clauses in the <code>if</code> statement could
be used to add bounds checking.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>				<span class="tok-c1">//check rows</span>
<span class="lineno"> 2 </span>				<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">board</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 3 </span>					<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span>
<span class="lineno"> 4 </span>						<span class="tok-o">&amp;&amp;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>						<span class="tok-n">gameOver</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>				<span class="tok-c1">//check columns</span>
<span class="lineno"> 7 </span>				<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>					<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span>
<span class="lineno"> 9 </span>						<span class="tok-o">&amp;&amp;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span> <span class="tok-o">)</span>
<span class="lineno">10 </span>						<span class="tok-n">gameOver</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">11 </span>				<span class="tok-c1">//check diagonals</span>
<span class="lineno">12 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span>
<span class="lineno">13 </span>					<span class="tok-o">&amp;&amp;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span> <span class="tok-o">)</span>
<span class="lineno">14 </span>					<span class="tok-n">gameOver</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">15 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">][</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">][</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span>
<span class="lineno">16 </span>					<span class="tok-o">&amp;&amp;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">][</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-n">shape</span> <span class="tok-o">)</span>
<span class="lineno">17 </span>					<span class="tok-n">gameOver</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">18 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">gameOver</span> <span class="tok-o">)</span>
<span class="lineno">19 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">shape</span> <span class="tok-o">+</span> <span class="tok-s">&quot; wins!&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>				<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">moves</span> <span class="tok-o">==</span> <span class="tok-mi">9</span> <span class="tok-o">){</span>
<span class="lineno">21 </span>					<span class="tok-n">gameOver</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">22 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Tie game!&quot;</span><span class="tok-o">);</span>
<span class="lineno">23 </span>				<span class="tok-o">}</span>
<span class="lineno">24 </span>			<span class="tok-o">}</span>
<span class="lineno">25 </span>		<span class="tok-o">}</span>
<span class="lineno">26 </span>	<span class="tok-o">}</span>
<span class="lineno">27 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>listing (lines 36-62) not available.*</p>
</div>
<div class="paragraph">
<p>Perhaps the trickiest part of our Tic Tac Toe program is checking for a
win. First we check each row to see if it contains three in a row. Then,
we check each column. Finally, we check the two diagonals. If any of
those checks ended the game, we announce a winner. Otherwise, if the
number of moves has reached 9 with no winner, it must be a tie game. In
a larger game (such as Connect Four, we would want to find better ways
to automate checking rows, columns, and diagonals. For one thing, a very
large board we mean that we would not want to check the entire thing
each move. Instead, we could focus only on rows, columns, and diagonals
affected by the last move.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise6.11">Exercise 6.11</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_special_array_tools_in_java">6.9. Advanced: Special array tools in Java</h3>
<div class="paragraph">
<p>Arrays are fundamental data structures in many programming languages.
There are often special syntactical tools or libraries designed to make
them easier to use. In this section, we explore two advanced tools, the
for-each loop and the <code>Arrays</code> utility class.</p>
</div>
<div class="sect3">
<h4 id="subsection:The_for-each_loop">6.9.1. The for-each loop</h4>
<div class="paragraph">
<p>In <a href="#_repetition">Chapter 5</a> we describe three loops: <code>while</code>
loops, <code>for</code> loops, and <code>do-while</code> loops. Although these are the only
three loops in Java, there is a special form of the <code>for</code> loop designed
for use with arrays (and some other data structures). This construct is
usually called a <em>for-each loop</em>.</p>
</div>
<div class="paragraph">
<p>A for-each loop does not have the three-part header of a regular <code>for</code>
loop. Instead, it is designed to iterate over the contents of an array.
Inside its parentheses is a declaration of a variable with the same type
of the elements of the array, then a colon (<code>:</code>), then the name of the
array. Consider the following example of a for-each loop used to sum the
values of an array of <code>int</code> values called <code>array</code>. As with all loops in
Java, braces are optional if there is only one executable statement in
the loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">:</span> <span class="tok-n">array</span> <span class="tok-o">)</span>
    <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">value</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code functions in exactly the same way as the traditional <code>for</code>
loop we would use to solve the same problem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The advantage of the for-each loop is that it is shorter and clearer.
There is also no worry about being off by one with your indexes. The
for-each loop iterates over every element in the array, no indexes
needed!</p>
</div>
<div class="paragraph">
<p>For-each loops can be nested or used inside of other loops. Consider the
following nested for-each loops that print out all of the kinds of chess
pieces, in both black and white colors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">colors</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-s">&quot;Black&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;White&quot;</span><span class="tok-o">};</span>
<span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">pieces</span> <span class="tok-o">=</span>
    <span class="tok-o">{</span><span class="tok-s">&quot;King&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Queen&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Rook&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Bishop&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Knight&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Pawn&quot;</span><span class="tok-o">};</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">color</span> <span class="tok-o">:</span> <span class="tok-n">colors</span> <span class="tok-o">)</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">piece</span> <span class="tok-o">:</span> <span class="tok-n">pieces</span> <span class="tok-o">)</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">color</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">piece</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For-each loops do have a few drawbacks. They are designed for iterating
through an entire array. It is ugly to try to make them stop early, and
it is impossible to make them go back to previous values. They are also
only designed for <strong>read</strong> access, not write access. The variable in the
header of the for-each loop takes on each value in the array in turn,
but assigning values to that variable have no effect on the underlying
array. Consider the following <code>for</code> loop that assigns <code>5</code> to every value
in <code>array</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This kind of assignment is impossible in a for-each loop. The
&#8220;equivalent&#8221; for-each loop does nothing. It assigns <code>5</code> to the local
variable <code>value</code> but never changes <code>array</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">:</span> <span class="tok-n">array</span> <span class="tok-o">)</span>
    <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Although for-each loops are great for arrays, they can also be used for
any other data structures that implements the <code>Iterable</code> interface. We
discuss interfaces in <a href="#_interfaces">Chapter 10</a> and dynamic data
structures in <a href="#_dynamic_data_structures">Chapter 18</a> and
<a href="#_recursion">Chapter 19</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_code_arrays_code_class">6.9.2. The <code>Arrays</code> class</h4>
<div class="paragraph">
<p>The designers of the Java API knew that arrays were important and added
a special <code>Arrays</code> class to manipulate them.</p>
</div>
<div class="paragraph">
<p>This class has a number of static methods that can be used to search for
values in arrays, make copies of arrays, copy selected ranges of arrays,
test arrays for equality, fill arrays with specific values, sort arrays,
convert an entire array into a <code>String</code> representation, and more. The
signatures of the methods below are given for <code>double</code> arrays, but most
methods are overloaded to work with all primitive types and reference
types.</p>
</div>
<table class="tableblock frame-all grid-all spread center">
<colgroup>
<col style="width: 45%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>binarySearch(double[] array, double value)</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns index of <code>value</code>
inside <code>array</code> or a negative number if it cannot be found. Adding 1 to
the negative number and then negating it will give the index where the
value would have been.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>copyOf(double[] array, int length)</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a copy of <code>array</code> with
length <code>length</code>, either truncated or padded if it doesn&#8217;t match the
length of <code>array</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>copyOfRange(double[] array, int from, int to)</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a copy of
<code>array</code> from the range starting at <code>from</code> and going up to but not
including <code>to</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>equals(double[] array1, double[] array2)</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>true</code> if <code>array1</code>
and <code>array2</code> have the same number of elements, each pair of which is
equal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>fill(double[] array, double value)</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fills <code>array</code> with copies of
<code>value</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>sort(double[] array)</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts <code>array</code> using natural ordering. This
method can fail for <code>Object</code> arrays in which the objects are not
comparable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>toString(double[] a)</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a <code>String</code> containing representations
of each element separated with commas.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Consult the API for more information. Even though tasks like <code>fill()</code>
are simple, it is worth using the method from <code>Arrays</code> instead of
writing your own. The methods in the Java API have often been tuned for
speed and use special commands that are not accessible to regular Java
programmers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_game_of_life">6.10. Solution: Game of Life</h3>
<div class="paragraph">
<p>Here we present our solution to the Conway&#8217;s Game of Life simulation.
Our program is designed to run the simulation with 24 rows and 80
columns, although it would be easy to change those dimensions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Life</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">ROWS</span> <span class="tok-o">=</span> <span class="tok-mi">24</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">COLUMNS</span> <span class="tok-o">=</span> <span class="tok-mi">80</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">GENERATIONS</span> <span class="tok-o">=</span> <span class="tok-mi">500</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-kt">boolean</span><span class="tok-o">[][]</span> <span class="tok-n">board</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[</span><span class="tok-n">ROWS</span><span class="tok-o">][</span><span class="tok-n">COLUMNS</span><span class="tok-o">];</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">boolean</span><span class="tok-o">[][]</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[</span><span class="tok-n">ROWS</span><span class="tok-o">][</span><span class="tok-n">COLUMNS</span><span class="tok-o">];</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">boolean</span><span class="tok-o">[][]</span> <span class="tok-n">swap</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">row</span> <span class="tok-o">&lt;</span> <span class="tok-n">ROWS</span><span class="tok-o">;</span> <span class="tok-n">row</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">10 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">column</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">column</span> <span class="tok-o">&lt;</span> <span class="tok-n">COLUMNS</span><span class="tok-o">;</span> <span class="tok-n">column</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>				<span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-mf">0.9</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main()</code> method of our program starts by defining <code>ROWS</code>, <code>COLUMNS</code>,
and <code>GENERATIONS</code> as named constants using the <code>final</code> keyword. Next, we
create <strong>two</strong> arrays with <code>ROWS</code> rows and <code>COLUMNS</code> columns. The <code>board</code>
array will hold the current generation. The <code>temp</code> array will be used to
fill in the next generation. Then, <code>temp</code> will be copied into <code>board</code>,
and the process will repeat. The <code>swap</code> variable is just a reference we
will use to swap <code>board</code> and <code>temp</code>. We randomly fill the board, making
10% of the cells living. Again, you may wish to play with this number to
see how the patterns in the simulation are affected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-kt">int</span> <span class="tok-n">total</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">generation</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">generation</span> <span class="tok-o">&lt;</span> <span class="tok-n">GENERATIONS</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>			<span class="tok-n">generation</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">row</span> <span class="tok-o">&lt;</span> <span class="tok-n">ROWS</span><span class="tok-o">;</span> <span class="tok-n">row</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>				<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">column</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">column</span> <span class="tok-o">&lt;</span> <span class="tok-n">COLUMNS</span><span class="tok-o">;</span> <span class="tok-n">column</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>					<span class="tok-n">total</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>					<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">max</span><span class="tok-o">(</span><span class="tok-n">row</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>						 <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span><span class="tok-n">row</span> <span class="tok-o">+</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">ROWS</span><span class="tok-o">);</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>						<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">max</span><span class="tok-o">(</span><span class="tok-n">column</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="lineno">10 </span>							<span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span><span class="tok-n">column</span><span class="tok-o">+</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">COLUMNS</span><span class="tok-o">);</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>							<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">!=</span> <span class="tok-n">row</span> <span class="tok-o">||</span> <span class="tok-n">j</span> <span class="tok-o">!=</span> <span class="tok-n">column</span> <span class="tok-o">)</span>
<span class="lineno">12 </span>								<span class="tok-o">&amp;&amp;</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>								<span class="tok-n">total</span><span class="tok-o">++;</span>
<span class="lineno">14 </span>					<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">)</span>
<span class="lineno">15 </span>						<span class="tok-n">temp</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">total</span> <span class="tok-o">==</span> <span class="tok-mi">2</span> <span class="tok-o">||</span>
<span class="lineno">16 </span>						<span class="tok-n">total</span> <span class="tok-o">==</span> <span class="tok-mi">3</span><span class="tok-o">);</span>
<span class="lineno">17 </span>					<span class="tok-k">else</span>
<span class="lineno">18 </span>						<span class="tok-n">temp</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">total</span> <span class="tok-o">==</span> <span class="tok-mi">3</span><span class="tok-o">);</span>
<span class="lineno">19 </span>				<span class="tok-o">}</span>
<span class="lineno">20 </span>			<span class="tok-n">swap</span> <span class="tok-o">=</span> <span class="tok-n">board</span><span class="tok-o">;</span>
<span class="lineno">21 </span>			<span class="tok-n">board</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">22 </span>			<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">swap</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>for</code> loop at the beginning of this segment of code runs once for
each generation we simulate. The two nested <code>for</code> loops examine each
cell in <code>board</code>. The two <code>for</code> loops nested inside of those loops do the
calculations to determine if a cell will be living or dead in the next
generation. These inner loops start one row before the current row and
finish one row after the current row. They do the same for columns. The
<code>Math.max()</code> and <code>Math.min()</code> methods are used to keep the loops from
going out of bounds of the array. When backing up a row or a column, the
<code>Math.max()</code> methods make sure that we do not generate an index smaller
than 0. When going forward a row or a column, the <code>Math.min()</code> methods
make sure that we do not generate an index greater than <code>ROWS - 1</code> or
<code>COLUMNS - 1</code>.</p>
</div>
<div class="paragraph">
<p>After these two innermost <code>for</code> loops have counted the total of living
cells around the cell in question, we decide the fate of the cell for
the next generation. If the cell is living and has exactly 2 or 3 living
neighbors, it will continue to be living. If a cell is dead, it will
come to life only if it has exactly 3 living neighbors. After we have
stored the state of each cell in the next generation into <code>temp</code>, we
swap <code>board</code> and <code>temp</code>, using the <code>swap</code> variable. We could have thrown
out the old array stored in <code>board</code> instead of swapping it with <code>temp</code>,
but then we would have to create a new array for <code>temp</code> each time, which
is less efficient.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 2 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">();</span>
<span class="lineno"> 3 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">row</span> <span class="tok-o">&lt;</span> <span class="tok-n">ROWS</span><span class="tok-o">;</span> <span class="tok-n">row</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>				<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">column</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">column</span> <span class="tok-o">&lt;</span> <span class="tok-n">COLUMNS</span><span class="tok-o">;</span> <span class="tok-n">column</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>					<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">board</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>						<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;*&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>					<span class="tok-k">else</span>
<span class="lineno"> 8 </span>						<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot; &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">();</span>
<span class="lineno">10 </span>			<span class="tok-o">}</span>
<span class="lineno">11 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">12 </span>			<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first <code>for</code> loop in this segment prints 100 blank lines to clear the
screen, as we explained earlier. The two nested <code>for</code> loops print out
the state of the current generation, with a <code>*</code> for each living cell and
a blank space for each dead one. After the output, the code sleeps for
100 milliseconds to give the effect of an animation. We will discuss
exceptions in general in <a href="#_exceptions">Chapter 12</a> and give more
information about the <code>Thread.sleep()</code> method in <a href="#_concurrent_programming">Chapter 13</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_arrays">6.11. Concurrency: Arrays</h3>
<div class="paragraph">
<p>Arrays are critical to concurrent programming in Java. In
<a href="#_concurrent_programming">Chapter 13</a>, we will explain how to
create independent threads of execution, each of which is tied to a
<code>Thread</code> object. If you have a dual, quad, or higher core computer, you
might want to use two or four threads to solve a problem, but some
programs can use hundreds. How can you keep track of all those <code>Thread</code>
objects? In many cases, you will hold references to them in an array.</p>
</div>
<div class="paragraph">
<p>Arrays also hold large lists of data. It is common for threaded programs
to share a single array which each thread reads and writes to. In this
way, memory costs are kept low because there is only one copy of all the
data. In the simplest case, each thread works on some portion of the
array without interacting with the rest. Even then, how do you assign
parts of the array to the different threads?</p>
</div>
<div class="paragraph">
<p>We will assume that each element of the array needs to be processed in
some way. For example, we might want to record whether or not each
<code>long</code> in an array is prime or not. If you have \(k\) threads
and an array of length \(n\) where \(n\) happens to
be a multiple of \(k\), then it&#8217;s easy: Each thread gets
exactly \(n/k\) items to work on. For example, the first
thread will work on indexes 0 through \(\frac{n}{k} - 1\), the
second thread will work on indexes \(\frac{n}{k}\) through
\(\frac{2n}{k} - 1\), and so on, with the last thread working
on indexes \(\frac{(k
- 1)n}{k}\) through \(n  - 1\). Not every element in the array
will require the same amount of computation, but we often assume that
they do because it can be difficult to guess which elements will take
more time to process.</p>
</div>
<div class="paragraph">
<p>What if the number of elements in the array is not a multiple of the
number of threads? We still want to assign the work the work as fairly
as possible. New programmers are sometimes tempted to use the same
arithmetic from the case in which the threads evenly divide the length
of the array: Each thread gets \(\frac{n}{k}\) (using integer
division) elements, and we stick the last thread with the leftovers. How
bad can that be?</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise6.7">Exercise 6.7</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>This assignment of work can be very poorly balanced. Consider a case
with 10 threads and 28 pieces of data. \(\frac{28}{10} = 2\),
using integer division. Thus, the first nine threads have 2 units of
work to do, but the last thread is stuck with 10! Not only is this
unfair, it is inefficient. The person writing the program probably wants
to minimize the total amount of time needed to finish the job. In this
case, the time from when the first thread starts to when the last thread
finishes is called the task&#8217;s <em>makespan</em>. With this division of work,
the makespan is 10 units of work.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/06-arrays/images/split1.svg" alt="split1" width="60%">
</div>
<div class="title">Figure 27. Units of work per thread using a naive strategy.</div>
</div>
<div class="exampleblock">
<div class="title">Example 69. Fairly assigning work</div>
<div class="content">
<div class="paragraph">
<p>A simple way to fix this problem is to look at the value
\(n \mod k\), the leftovers when you divide \(n\) by
\(k\). We want to spread those out over the first few threads.
We know that any remainder will be smaller than \(k\). If the
index of the thread (starting at 0, of course) is less than the
remainder, we add an extra element to its work. In this way, 28 units of
work spread over 10 threads will give 3 elements to the first 8 threads
and 2 elements to the rest. Using this strategy, the makespan becomes 3
units of work, a huge improvement over 10. Finding a way to spreading
work across multiple threads to improve efficiency is a form of <em>load
balancing</em>, a broad term for dividing work across computing resources.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/06-arrays/images/split2.svg" alt="split2" width="60%">
</div>
<div class="title">Figure 28. Units of work per thread using a fair strategy.</div>
</div>
<div id="AssigningWorkProgram" class="listingblock">
<div class="title">Program 31. Reads the length of an array and the number of threads from the user and then prints out the amount of work for each one. You should be able to adapt the ideas in it to your own multi-threaded programs in <a href="#Concurrent Programming">[Concurrent Programming]</a>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AssigningWork</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;How long is your array? &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;How many threads do you have? &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">int</span> <span class="tok-n">k</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-kt">int</span> <span class="tok-n">quotient</span> <span class="tok-o">=</span> <span class="tok-n">n</span> <span class="tok-o">/</span> <span class="tok-n">k</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-kt">int</span> <span class="tok-n">remainder</span> <span class="tok-o">=</span> <span class="tok-n">n</span> <span class="tok-o">%</span> <span class="tok-n">k</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-kt">int</span> <span class="tok-n">next</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">k</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>			<span class="tok-kt">int</span> <span class="tok-n">work</span> <span class="tok-o">=</span> <span class="tok-n">quotient</span><span class="tok-o">;</span>
<span class="lineno">15 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">remainder</span> <span class="tok-o">)</span>
<span class="lineno">16 </span>				<span class="tok-n">work</span><span class="tok-o">++;</span>
<span class="lineno">17 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Thread &quot;</span> <span class="tok-o">+</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-s">&quot; does &quot;</span> <span class="tok-o">+</span> <span class="tok-n">work</span>
<span class="lineno">18 </span>				<span class="tok-o">+</span> <span class="tok-s">&quot; units of work, starting at index &quot;</span> <span class="tok-o">+</span> <span class="tok-n">next</span>
<span class="lineno">19 </span>				<span class="tok-o">+</span> <span class="tok-s">&quot; and ending at index &quot;</span> <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">next</span> <span class="tok-o">+</span> <span class="tok-n">work</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">));</span>
<span class="lineno">20 </span>			<span class="tok-n">next</span> <span class="tok-o">+=</span> <span class="tok-n">work</span><span class="tok-o">;</span>
<span class="lineno">21 </span>		<span class="tok-o">}</span>
<span class="lineno">22 </span>	<span class="tok-o">}</span>
<span class="lineno">23 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_6">6.12. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise6.1"></a> Why can&#8217;t an array be used to hold an arbitrarily long list of
numbers entered by a user? What are strategies that can be used to
overcome this problem?</p>
</li>
<li>
<p><a id="exercise6.2"></a> In future chapters, we will introduce a data structure called a
<em>linked list</em>. A linked list is a homogeneous, dynamic data structure,
with sequential access (unlike an array, which has random access). You
can instantly jump to any place in an array, but you have to step
through each element of a linked list to get to the one you want, even
if you know its position in the list exactly. On the other hand,
inserting values into the beginning of a linked list can be done in one
step, while an array would need to be resized and have its contents
copied over. List some tasks for which an array would be better than a
linked list and vice versa.</p>
</li>
<li>
<p><a id="exercise6.3"></a> Given the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">array1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[</span><span class="tok-mi">50</span><span class="tok-o">];</span>
<span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">array2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[</span><span class="tok-mi">50</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array1</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">array1</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
    <span class="tok-n">array2</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array2</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
<span class="tok-n">array2</span> <span class="tok-o">=</span> <span class="tok-n">array1</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array1</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">array1</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array1</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-n">array1</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What is the value in <code>array2[array2.length - 1]</code> after this code is
executed?</p>
</div>
</li>
<li>
<p><a id="exercise6.4"></a> What error will be caused by the following code, and why?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-mi">99</span><span class="tok-o">].</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">+</span>
           <span class="tok-s">&quot; is the first letter of the last String.&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise6.5"></a> An array of length \(n\) in Java typically takes
\(n\) times the number of bytes for each element plus an
additional 16 bytes of overhead. Since an <code>int</code> uses 4 bytes of storage,
an array of 100 <code>int</code> elements would take 416 bytes. Consider the
following three-dimensional array declaration and allocation.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[][][]</span> <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">][</span><span class="tok-mi">5</span><span class="tok-o">][</span><span class="tok-mi">20</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>How many bytes are allocated for this array? Remember that the 16 byte
overhead will occur repeatedly, since Java creates a three-dimensional
array as an array of arrays of arrays.</p>
</div>
</li>
<li>
<p><a id="exercise6.6"></a> Our original table of city distances allocates
5 · 5 = 25 <code>int</code> elements to store all the distances
between the five cities, including repeats. How many <code>int</code> elements are
allocated for the triangular, ragged array version of the city distance
table? If we used the normal table style, \(n\) cities would
require \(n^2\) <code>int</code> elements. How many elements would the
triangular, ragged array version allocate for \(n\) cities?</p>
</li>
<li>
<p><a id="exercise6.7"></a> Consider the naive method of dividing
an array of length \(n\) among \(k\) threads that
was discussed in <a href="#_concurrency_arrays">Section 6.11</a>: Each thread gets
\(n/k\) (rounded down because of integer division) elements,
and the last thread gets any extras. What mathematical expression
describes how many extra elements are allocated to the last thread? Can
you come up with an example in which the last element gets <strong>all</strong> the
elements? What should have happened in this case using the other, more
fair scheme for assigning the data to threads?</p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise6.8"></a> In <a href="#wordSearchExample">Example 64</a>,
our code did not count <code>ship,</code> as an occurrence of <code>ship</code> because of the
comma.</p>
<div class="paragraph">
<p>Rewrite the code from <a href="#wordSearchExample">Example 64</a> to remove
punctuation from the beginning and end of a word. Use a loop that runs
as long as the character at the beginning of a word is not a letter,
replacing the word with a substring of itself that does not include the
first character. Use a second loop to remove non-letters from the end of
a word. Be careful to stop if the length of the <code>String</code> becomes 0, as
with text that is entirely composed of non-letters.</p>
</div>
</li>
<li>
<p><a id="exercise6.9"></a> In <a href="#wordSearchExample">Example 64</a>, we
wrote a program that counts the occurrences of each word from a list
within a text. If the list of words to search within is long, it can
take quite some time to search through the entire list. If the list of
words were sorted, we could do a trick that would allow us to search
much faster. We could play a &#8220;high-low&#8221; game, searching through the
list by checking the middle word in the array. If that word is too late
in the alphabet, repeat the search on the first half of the list. If it
is too early in the alphabet, repeat the search on the second half of
the list. By repeatedly dividing the list in half, until you either find
the word you&#8217;re looking for or narrow your search down to a single
incorrect word, you can search much faster. This kind of searching is
called <em>binary search</em> and uses around \(\log n\) comparisons
to find an element in a list. In contrast, looking through the list one
element at a time takes about \(n\) comparisons.</p>
<div class="paragraph">
<p>Rewrite the code from <a href="#wordSearchExample">Example 64</a> to use binary
search, after applying selection sort from <a href="#selectionSortExample">Example 63</a>. Although selection sort will take some extra time, you should
more than make up the difference with such a fast search. To implement
binary search, keep variables for the start, middle, and end of the
list. Keep adjusting the three variables until the middle index has the
word you are looking for or start and end reach each other. Remember to
use the <code>compareTo()</code> method from the <code>String</code> class to compare words.</p>
</div>
</li>
<li>
<p><a id="exercise6.10"></a> In <a href="#statisticsExample">Example 65</a>, we gave a program that finds the
maximum, minimum, mean, standard deviation, and median of a list of
values. Another statistic that is sometimes important is the <em>mode</em>, or
most commonly occurring element. For example, in the list
{1, 2, 3, 3, 3, 5, 6, 6, 10}, the mode is 3. Write a
program that can determine the mode of a given list of <code>int</code> values. A
list can have multiple modes if more than one element occurs with
maximum frequency. For our purposes, we will consider any list with
multiple modes to have no modes. You may wish to sort the list before
starting the process of counting the frequency of each value.</p>
</li>
<li>
<p><a id="exercise6.11"></a> We used the example of Tic Tac Toe in
<a href="#ticTacToeExample">Example 68</a> because a more complex game would have
taken too much space to solve. The game of Connect Four (or the
Captain&#8217;s Mistress, as it was originally called) pits two players
against each other on a 6 × 7 vertical board. One
player uses red checkers while the other uses black. The two players
take turns dropping their checkers into columns of the board in which
the checkers will drop to the lowest empty row, due to gravity. The goal
of the game is to be the first to make four in a row of your color.</p>
<div class="paragraph">
<p>Implement a version of Connect Four for two human players, similar to
the version of Tic Tac Toe we created. Many of the ideas are the same,
but the details are more complicated. First, a player will only choose a
particular column. Your program must then find which row a checker
dropped into that column will fall to. Then, the process of counting
four in a row is more difficult than the three in a row of Tic Tac Toe.
You will need more loops to automate the process fully.</p>
</div>
</li>
<li>
<p><a id="exercise6.12"></a> Once you have mastered the material in
<a href="#_constructing_graphical_user_interfaces">Chapter 15</a>, adapt the
solution to Conway&#8217;s Game of Life from <a href="#_solution_game_of_life">Section 6.10</a>
to display on a graphical user interface. You can use a
<code>GridLayout</code> to arrange a large number of <code>JLabel</code> objects in a grid and
update their background colors to <code>Color.BLACK</code> and <code>Color.WHITE</code> as
needed, using the <code>setBackground()</code> method. (To make these colors
visible, you will also need to call the <code>setOpaque()</code> method once on
each <code>JLabel</code> with an argument of <code>true</code>.) The Game of Life is much more
compelling with a real GUI instead of an improvised command line
representation.</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise6.13"></a> Creating arrays with longer and longer lengths requires more
processor time, since the all of those elements must be initialize to
some default value. Using an OS <code>time</code> command, determine the amount of
time it takes to create an <code>int</code> array of length 10, 10,000, and
10,000,000. In all likelihood, the amount of time that instantiation of
the array takes is a small part of the program, and you should see very
little difference in those three times. However, time is not the only
important resource. When you run a JVM, it has a default heap size that
limits the amount of space you can use to create new objects, including
arrays. When you exceed this size, your program will crash with an
<code>OutOfMemoryError</code>. Experiment with different sizes of arrays until you
can estimate the size of your heap within 5MB or so.</p>
<div class="paragraph">
<p>This estimate will be very rough, since the JVM uses other memory in the
background. For a more accurate picture, you can use the<br>
<code>Runtime.getRuntime().maxMemory()</code> method to determine the maximum JVM
memory size and the<br>
<code>Runtime.getRuntime().totalMemory()</code> method to determine the total JVM
memory being used.</p>
</div>
</li>
<li>
<p><a id="exercise6.14"></a> Run the implementation of the word search program using the binary
search improvement from <a href="#exercise6.9">Exercise 6.9</a>. Use the OS
<code>time</code> command to time the difference between the regular and binary
search versions of the program with a long list of words. You may see
very little difference on small input, but you can easily find a list of
the 1,000 most commonly used words in English on the Internet along with
long, copyright free texts from Project Gutenberg
(<a href="http://www.gutenberg.org/" class="bare">http://www.gutenberg.org/</a>). Combining these two into a single input
should see a significant increase in speed for the binary search version
relative to the regular version.</p>
</li>
<li>
<p><a id="exercise6.15"></a> Generate input files consisting of 1,000,
10,000, and 100,000 random <code>int</code> values.
Time our implementation of selection sort from
<a href="#selectionSortExample">Example 63</a> running on each of these input files
and redirecting output to output files. What is the behavior of the
running time as the input length increases by a factor of 10? As a
function of \(n\), how many times does the body of the inner
<code>for</code> loop run during selection sort? Does this function closely
parallel the increase in running time?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_simple_graphical_user_interfaces">7. Simple Graphical User Interfaces</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>To a true artist only that face is beautiful which, quite apart from its exterior, shines with the
truth within the soul.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Mahatma Gandhi
</div>
</div>
<div class="sect2">
<h3 id="_problem_codon_extractor">7.1. Problem: Codon extractor</h3>
<div class="paragraph">
<p>Recall from <a href="#_repetition">Chapter 5</a> that we can record DNA as a
sequence of nucleotide bases A, C, G, and T. Using this idea, we can
represent any sequence of DNA using a <code>String</code> made up of those four
letters, such as <code>"ATGGAAGTATTTAAATAG"</code>.</p>
</div>
<div class="paragraph">
<p>This particular sequence contains 18 bases and six <em>codons</em>. A codon is
a three-base subsequence in DNA. Biologists are interested in dividing
DNA into codons because a single codon usually maps to the production of
a specific amino acid. Amino acids, in turn, are the building blocks of
proteinS. The DNA sequence above contains the six codons ATG, GAA, GTA,
TTT, AAA, and TAG.</p>
</div>
<div class="paragraph">
<p>We want to write a program that extracts codons in order from DNA
sequences entered by the user. The program must detect and inform the
user of invalid DNA sequences (those containing letters other than the
four bases). If the user enters a DNA sequence whose length is not a
multiple of three, the final codon should be written with one or two
asterisks (<code>*</code>), representing the missing bases.</p>
</div>
<div class="paragraph">
<p>With your knowledge of <code>String</code> manipulation and loops, this problem
should be easy. However, we want to solve it with a <em>graphical user
interface</em>, not with the command line interaction we have emphasized in
previous chapters. That is, the input step should be done with a window
that looks similar to the following.</p>
</div>
<div id="codoninput" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/codoninput.png" alt="codoninput" width="50%">
</div>
</div>
<div class="paragraph">
<p>And the corresponding output should look very much like this.</p>
</div>
<div id="codonoutput" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/codonoutput.png" alt="codonoutput" width="50%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="GUIBasicsIntroductionSection">7.2. Concepts: User interaction</h3>
<div class="paragraph">
<p>Many computer programs communicate with a human user. There are at least
two ways in which this communication can happen. One way is to use
command line input and output. In this case, a program prompts the user
for an input and the user responds through the keyboard, usually
completing the response by pressing the <code>&lt;return&gt;</code> or <code>&lt;enter&gt;</code> key.
Another way to communicate is to use a graphical user interface or GUI.
(Some people pronounce &#8220;GUI&#8221; to sound like &#8220;gooey,&#8221; but others say
&#8220;G-U-I.&#8221;) In this case, the program displays a window consisting of
one or more <em>widgets</em>, such as a button labeled &#8220;OK&#8221; or a text box in
which the user can type some text. Widgets (also known as controls) can
include buttons, labels, text areas, check boxes, menus, and many other
pre-defined objects for user interaction. While the program waits for
the user or does something in the background, the user has the option of
using a combination of the keyboard and the mouse to respond to the
program. While command line interfaces were dominant until the mid-70s,
GUIs have become the prime mode of communication between a program and a
human user. This chapter focuses on the design of simple GUIs using a
few built-in Java classes. <a href="#_constructing_graphical_user_interfaces">Chapter 15</a> introduces more advanced tools for constructing complex
GUIs.</p>
</div>
<div class="exampleblock">
<div class="title">Example 70. User interaction</div>
<div class="content">
<div class="paragraph">
<p><a href="#applicationInterfaceFigure">Figure 29</a>(a) shows a Java application
interacting with a user through a command line interface. The
application asks the user for a temperature value in degrees Fahrenheit,
converts it to the equivalent Celsius, displays it, and prompts the user
to enter another value. <a href="#applicationInterfaceFigure">Figure 29</a>(b) shows a
similar application interacting with the user through a GUI. In this
case, the application creates a window with five widgets (two text boxes
and three buttons). The user enters a temperature value in the text box
below either the Centigrade label or the Fahrenheit label and presses
the appropriate Convert button. In turn the application displays the
equivalent temperature in the other text box.</p>
</div>
<div id="applicationInterfaceFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/applicationInterface.svg" alt="applicationInterface" width="100%">
</div>
<div class="title">Figure 29. User interaction with a Java application (a) through a command line interface and (b) through a graphical user interface.</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We describe the GUIs we will introduce in this chapter as simple because
several aspects of GUI creation are hidden by the methods we will use.
For example, these GUIs do not require the programmer to handle the
details of events such as a user pressing an &#8220;OK&#8221; button or typing
text into a text box and pressing the <code>&lt;enter&gt;</code> key. These events will
be handled automatically by the tools we will introduce in this chapter.
<a href="#_constructing_graphical_user_interfaces">Chapter 15</a> discusses the
creation of more complex GUIs that require the programmer to program
event handling explicitly.</p>
</div>
</div>
<div class="sect2">
<h3 id="syntax:Dialogs_and_the_JOptionPane_class">7.3. Syntax: Dialogs and the <code>JOptionPane</code> class</h3>
<div class="paragraph">
<p><code>JOptionPane</code> is a utility class for creating GUIs consisting most often
of a single dialog. It offers a variety of ways to create useful dialogs
quickly and easily and is part of the larger Java Swing GUI library. In
this chapter, we will show you how to use the static methods and
constants in <code>JOptionPane</code> to construct useful dialogs. Specifically,
you will learn how to construct the following four types of dialogs.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Information</dt>
<dd>
<p>An information, or message, dialog displays a message to the user.
Static method <code>showMessageDialog()</code> creates such a dialog. See
<a href="#simpleMessageFigure">Figure 30</a> for an example of a message dialog.</p>
</dd>
<dt class="hdlist1">Confirm</dt>
<dd>
<p>A confirm dialog asks a user to confirm a statement. Static method<br>
<code>showConfirmDialog()</code> creates such a dialog. This dialog may return
user input as <code>YES_OPTION</code>, <code>NO_OPTION</code>, <code>OK_OPTION</code>, or
<code>CANCEL_OPTION</code>. See <a href="#yes-noDialogFigure">Figure 32</a> for an example of
a Yes-No dialog.</p>
</dd>
<dt class="hdlist1">Option</dt>
<dd>
<p>An option dialog asks the user to select one from an arbitrary set of
options. Static method <code>showOptionDialog()</code> creates such a dialog. See
<a href="#selectCapitalDialogFigure">Figure 33</a> for an example.</p>
</dd>
<dt class="hdlist1">Input</dt>
<dd>
<p>An input dialog is useful for obtaining data provided by the user.
Static method <code>showInputDialog()</code> creates such a dialog. The user can
input a <code>String</code> that might represent a number, a name, or any
arbitrary piece of text. See <a href="#inputDialogFigure">Figure 35</a> for an
example.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>JOptionPane</code> class can be used to create both <em>modal</em> and
<em>non-modal</em> dialogs. A modal dialog is one that forces the user to
interact with the dialog before the program can continue. Thus, the
dialog is dismissed and the program execution resumes only after the
user has responded. Modal dialogs are useful in situations where user
input is required for the program to proceed further.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise7.8">Exercise 7.8</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A non-modal dialog is one that is displayed on the screen and does not
require the user to interact with it for the underlying program to
proceed. It is easy to create a modal dialog using the static methods in
the <code>JOptionPane</code> class mentioned earlier. Creation of non-modal dialogs
requires a bit more effort and is not covered in this chapter. In the
remainder of this chapter we show how to use <code>JOptionPane</code> to create
various types of modal dialogs.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise7.2">Exercise 7.2</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="informationMessageDialog">7.3.1. Generating an information dialog</h4>
<div class="paragraph">
<p>Often programs need to generate a message for the user and request a
response. The message might be a short piece of information, and the
only response might be &#8220;OK.&#8221; The message might be more complex and
require a more thoughtful response. In this section, we show how the
Java utility class <code>JOptionPane</code> can generate a simple dialog whose sole
purpose is to inform the user that a task has been completed. The next
example shows how to generate such a dialog.</p>
</div>
<div class="exampleblock">
<div class="title">Example 71. Simple dialog</div>
<div class="content">
<div class="paragraph">
<p><a href="#SimpleDialogProgram">Program 32</a> creates a dialog to inform the user
that the task it was assigned to perform is now complete.
<a href="#simpleMessageFigure">Figure 30</a> shows the dialog generated by this
program.</p>
</div>
<div id="SimpleDialogProgram" class="listingblock">
<div class="title">Program 32. Generates a simple dialog.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span><span class="tok-cm">/*@\label{importSwing}@*/</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SimpleDialog</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span> <span class="tok-kc">null</span><span class="tok-o">,</span><span class="tok-cm">/*@\label{showMessageDialogLine}@*/</span>
<span class="lineno"> 6 </span>        	<span class="tok-s">&quot;Task completed. Click OK to exit&quot;</span><span class="tok-o">,</span>
<span class="lineno"> 7 </span>            <span class="tok-s">&quot;Simple Dialog&quot;</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Done.&quot;</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{displayMessageLine}@*/</span>
<span class="lineno"> 9 </span>    <span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s dissect <a href="#SimpleDialogProgram">Program 32</a>. Line <a href="#importSwing">[importSwing]</a> is
needed to import classes used in this program. The <code>swing</code> package
contains a number of classes needed to create a GUI, and <code>JOptionPane</code>
is one such class. If you try to compile the program without
line <a href="#importSwing">[importSwing]</a>, it will fail.</p>
</div>
<div id="simpleMessageFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/simpleMessageFigure.svg" alt="simpleMessageFigure" width="80%">
</div>
<div class="title">Figure 30. A simple dialog generated using <code>JOptionPane</code>.</div>
</div>
<div class="paragraph">
<p>In <a href="#simpleMessageFigure">Figure 30</a> the dialog titled &#8220;Simple Dialog&#8221;
includes an icon, a message and a button labeled &#8220;OK.&#8221; This dialog is
actually a <em>frame</em>, which is what windows are called in Java. We will
discuss frames in greater detail in <a href="#_syntax_guis_in_java">Section 15.3</a>.</p>
</div>
<div class="paragraph">
<p>Note that the appearance of the dialog may be different on your
computer. Even though Java is platform independent, GUIs are customized
based on the OS you are running. Each OS has a default <em>look and feel</em>
(L &amp; F) manager that specifies how widgets look and behave in your
program. You can change the L&amp;F manager, but not all managers are
available on all operating systems.</p>
</div>
<div class="paragraph">
<p>Line <a href="#showMessageDialogLine">[showMessageDialogLine]</a> and the next two lines use a static
method to create a modal dialog. <code>JOptionPane</code> is a utility class and
<code>showMessageDialog()</code> is a static method in this class. This method,
along with the other three <code>JOptionPane</code> methods we discuss in this
chapter is a <em>factory method</em>, meaning that it creates a new object (in
this case some kind of dialog object) on the fly with specific
attributes. In this example, the program is informing the user that a
task has been completed. The method has the following four parameters.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Component</dt>
<dd>
<p>The parent component in which the dialog is displayed. We use <code>null</code>
in this example, which causes a default frame to be used, centering
the dialog in the screen.</p>
</dd>
<dt class="hdlist1">Message</dt>
<dd>
<p>The message to be displayed. In this example, we have<br>
<code>"Task completed. Click OK to exit."</code></p>
</dd>
<dt class="hdlist1">Title</dt>
<dd>
<p>The title string used to decorate the dialog. In this example, it is
<code>"A Simple Dialog"</code>.</p>
</dd>
<dt class="hdlist1">Message Type</dt>
<dd>
<p>The type of the message to be displayed. In this example, we use the
constant <code>INFORMATION_MESSAGE</code>.</p>
</dd>
<dt class="hdlist1">Icon</dt>
<dd>
<p>The icon to be displayed in the dialog. If you have an object of type
<code>Icon</code>, you can use it to customize your dialog. The
<code>showMessageDialog()</code> is an overloaded method that can take several
different sets of parameters. In this example, we used a version of
the method that does not specify an icon.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Line <a href="#displayMessageLine">[displayMessageLine]</a> displays a message on the console which is
not needed in this program but illustrates an interesting point. When
you run <code>SimpleDialog</code>, you will notice that the <code>"Done."</code> message
displays on the console only after you have clicked the &#8220;OK&#8221; button in
the dialog box. This is the modal behavior we mentioned earlier. The
dialog blocks execution of the thread that generated it.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above example, we have displayed a message of type
<code>INFORMATION_MESSAGE</code>. These are additional message types that could be
used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ERROR_MESSAGE</code></p>
</li>
<li>
<p><code>PLAIN_MESSAGE</code></p>
</li>
<li>
<p><code>QUESTION_MESSAGE</code></p>
</li>
<li>
<p><code>WARNING_MESSAGE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When used as parameters in <code>showMessageDialog()</code>, the constants above
cause different default icons to be displayed in the dialog box.
<a href="#iconsInMessageDialogsFigure">Figure 31</a> shows dialogs generated by
<code>showMessageDialog()</code> when using <code>JOptionPane.ERROR_MESSAGE</code>, (left)
and <code>JOptionPane.WARNING_MESSAGE</code> (right). Note the difference in the
icons displayed towards the top left of the two dialogs.</p>
</div>
<div id="iconsInMessageDialogsFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/iconsInMessageDialogsFigure.png" alt="iconsInMessageDialogsFigure" width="100%">
</div>
<div class="title">Figure 31. Two dialogs generated using the <code>showMessageDialog()</code> method. The left dialog uses <code>JOptionPane.ERROR_MESSAGE</code>, and the right uses <code>JOptionPane.WARNING_MESSAGE</code>. The only difference is the icon displayed.</div>
</div>
</div>
<div class="sect3">
<h4 id="yes-noDialog">7.3.2. Generating a Yes-No confirm dialog</h4>
<div class="paragraph">
<p>There are situations when a program needs to obtain a binary answer from
the user, a &#8220;yes&#8221; or a &#8220;no.&#8221; The next example shows how to generate
such a dialog and how to get the user&#8217;s response.</p>
</div>
<div id="yes-NoDialogExample" class="exampleblock">
<div class="title">Example 72. Yes-No dialog</div>
<div class="content">
<div class="paragraph">
<p>Consider a program that checks whether a student understands the
difference between odd and even integers. The program generates a random
integer \(x\), presents it to the user, and asks the question,
&#8220;Is \(x\) an odd integer?&#8221; The answer given by the user is
checked for correctness, and the user is informed accordingly.
<a href="#OddEvenTestProgram">Program 33</a> shows how to use the <code>JOptionPane</code> class
to generate a dialog for such an interaction.</p>
</div>
<div id="OddEvenTestProgram" class="listingblock">
<div class="title">Program 33. Tests knowledge of odd and even integers with a Yes-No dialog.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">OddEvenTest</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>        <span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>		<span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Odd Even Test&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>        <span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">);</span> <span class="tok-c1">//Random int from 0 to 9</span>
<span class="lineno"> 9 </span>        <span class="tok-n">String</span> <span class="tok-n">question</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-s">&quot; an odd integer?&quot;</span><span class="tok-o">;</span>
<span class="lineno">10 </span>        <span class="tok-kt">int</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showConfirmDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span><span class="tok-cm">/*@\label{yes-noDialogLine}@*/</span>
<span class="lineno">11 </span>        		<span class="tok-n">question</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">YES_NO_OPTION</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-n">String</span> <span class="tok-n">message</span><span class="tok-o">;</span>
<span class="lineno">13 </span>        <span class="tok-c1">// Response is YES_OPTION for Yes, NO_OPTION for No.</span>
<span class="lineno">14 </span>        <span class="tok-k">if</span><span class="tok-o">((</span><span class="tok-n">response</span><span class="tok-o">==</span><span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">YES_OPTION</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">x</span><span class="tok-o">%</span><span class="tok-mi">2</span> <span class="tok-o">!=</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">||</span>
<span class="lineno">15 </span>        	<span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">==</span><span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">NO_OPTION</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">x</span><span class="tok-o">%</span><span class="tok-mi">2</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">))</span>
<span class="lineno">16 </span>			<span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;You&#39;re right!&quot;</span><span class="tok-o">;</span> <span class="tok-cm">/*@\label{correctAnswerLine}@*/</span>
<span class="lineno">17 </span>        <span class="tok-k">else</span>
<span class="lineno">18 </span>			<span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sorry, that&#39;s incorrect.&quot;</span><span class="tok-o">;</span> <span class="tok-cm">/*@\label{incorrectAnswerLine}@*/</span>
<span class="lineno">19 </span>        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
<span class="lineno">20 </span>        	<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">21 </span>    <span class="tok-o">}</span>
<span class="lineno">22 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#OddEvenTestProgram">Program 33</a> begins by declaring a random number
generator named <code>random</code>. It then generates a random number and presents
it to the user in a dialog created at line <a href="#yes-noDialogLine">[yes-noDialogLine]</a>. Note
the use of <code>JOptionPane.YES_NO_OPTION</code> as the last parameter in the
<code>showConfirmDialog()</code> method at line <a href="#yes-noDialogLine">[yes-noDialogLine]</a>. The generated
dialog is shown in <a href="#yes-noDialogFigure">Figure 32</a>(a). A second dialog is
shown with a message dependent on whether the user gives the correct
answer. The two different versions of this dialog are shown in
<a href="#yes-noDialogFigure">Figure 32</a>(b) and (c). Note that a call to
<code>showConfirmDialog()</code> at line <a href="#yes-noDialogLine">[yes-noDialogLine]</a> returns the
<code>JOptionPane.YES_OPTION</code> or the <code>JOptionPane.NO_OPTION</code> value
depending on whether the user clicked the &#8220;Yes&#8221; or &#8220;No&#8221; button.</p>
</div>
<div id="yes-noDialogFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/yes-noDialogFigure.svg" alt="yes noDialogFigure" width="100%">
</div>
<div class="title">Figure 32. (a) A Yes-No dialog generated using <code>JOptionPane</code>. (b) Dialog in response to correct answer. (c) Dialog in response to incorrect answer.</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Because we used <code>YES_NO_OPTION</code>, the dialog in
<a href="#yes-NoDialogExample">Example 72</a> automatically generates two buttons
labeled &#8220;Yes&#8221; and &#8220;No.&#8221; Dialogs can also use the
<code>YES_NO_CANCEL_OPTION</code> to generate a dialog with &#8220;Yes,&#8221; &#8220;No,&#8221; and
&#8220;Cancel&#8221; options. The return value from <code>showConfirmDialog()</code> is
<code>CANCEL_OPTION</code> if the user presses the &#8220;Cancel&#8221; button.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise7.7">Exercise 7.7</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generating_a_dialog_with_a_list_of_options">7.3.3. Generating a dialog with a list of options</h4>
<div class="paragraph">
<p>The <code>JOptionPane</code> class can also be used to generate an arbitrary set of
options as shown in the next example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 73. Capital dialog</div>
<div class="content">
<div class="paragraph">
<p>Consider a program that asks the user to select the correct capital of a
country from a given list of capitals. It shows three options and asks
the user to select one from among the three. It then checks the user
response for correctness and displays a suitable message.
<a href="#CapitalQuizProgram">Program 34</a> performs these tasks. In this program,
we call the <code>showOptionDialog()</code> method at line <a href="#multipleOptionsLine">[multipleOptionsLine]</a>
to create a dialog with multiple options. In our case, the options are
three names of capitals, and only one of them is correct.
<a href="#selectCapitalDialogFigure">Figure 33</a> shows the dialog created.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise7.3">Exercise 7.3</a><br>
<a href="#exercise7.4">Exercise 7.4</a><br>
<a href="#exercise7.10">Exercise 7.10</a></p>
</div>
</div>
</div>
<div id="CapitalQuizProgram" class="listingblock">
<div class="title">Program 34. Generates a dialog with programmer-defined options.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CapitalQuiz</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>        <span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Capital Quiz&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>        <span class="tok-n">String</span> <span class="tok-n">country</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Azerbaijan&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>        <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">capitals</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-s">&quot;Bujumbura&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Baku&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Moroni&quot;</span><span class="tok-o">};</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">correct</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-c1">//Baku is the correct answer</span>
<span class="lineno"> 9 </span>        <span class="tok-n">String</span> <span class="tok-n">question</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Select the capital of &quot;</span> <span class="tok-o">+</span> <span class="tok-n">country</span><span class="tok-o">;</span>
<span class="lineno">10 </span>        <span class="tok-kt">int</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showOptionDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-cm">/*@\label{multipleOptionsLine}@*/</span>
<span class="lineno">11 </span>        	<span class="tok-n">question</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">PLAIN_MESSAGE</span><span class="tok-o">,</span>
<span class="lineno">12 </span>        	<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">capitals</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
<span class="lineno">13 </span>        <span class="tok-c1">// Response is 0, 1, or 2 for the three options</span>
<span class="lineno">14 </span>		<span class="tok-n">String</span> <span class="tok-n">message</span><span class="tok-o">;</span>
<span class="lineno">15 </span>        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">response</span> <span class="tok-o">==</span> <span class="tok-n">correct</span><span class="tok-o">)</span>
<span class="lineno">16 </span>			<span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;You&#39;re right!&quot;</span><span class="tok-o">;</span>
<span class="lineno">17 </span>		<span class="tok-k">else</span>
<span class="lineno">18 </span>			<span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sorry, the capital of &quot;</span> <span class="tok-o">+</span> <span class="tok-n">country</span> <span class="tok-o">+</span>
<span class="lineno">19 </span>			<span class="tok-s">&quot; is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">capitals</span><span class="tok-o">[</span><span class="tok-n">correct</span><span class="tok-o">];</span>
<span class="lineno">20 </span>        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
<span class="lineno">21 </span>        	<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">22 </span>    <span class="tok-o">}</span>
<span class="lineno">23 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="selectCapitalDialogFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/selectCapitalDialogFigure.png" alt="selectCapitalDialogFigure" width="50%">
</div>
<div class="title">Figure 33. A dialog with programmer-defined options generated by <a href="#CapitalQuizProgram">Program 34</a>.</div>
</div>
<div class="paragraph">
<p>The <code>showOptionDialog()</code> method creates an options dialog, which is the
most complicated (but also the most flexible) of all the dialogs. The
array of <code>String</code> values provided as the second to last parameter to
<code>showOptionDialog()</code> gives the labels for the buttons.</p>
</div>
<div class="paragraph">
<p>There are three <code>null</code> values passed into the method on
line <a href="#multipleOptionsLine">[multipleOptionsLine]</a> in <a href="#CapitalQuizProgram">Program 34</a>. The
first one functions like the <code>null</code> used in
<a href="#OddEvenTestProgram">Program 33</a>, specifying that the default frame
should be used. The second specifies that the default icon should be
used. In the next section, we will show how to specify a custom icon.
The last parameter indicates the default button, which will have focus
when the dialog is created. If the user hits <code>&lt;enter&gt;</code> instead of
clicking, the button with focus is the button that will be pressed.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise7.9">Exercise 7.9</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="customIconDialog">7.3.4. Generating a dialog with a custom icon</h4>
<div class="paragraph">
<p>A custom icon can be included in any dialog. Each of the methods in
<code>JOptionPane</code> introduced earlier can take an icon as a parameter. The
next example illustrates how to do so.</p>
</div>
<div class="exampleblock">
<div class="title">Example 74. Custom icon</div>
<div class="content">
<div class="paragraph">
<p><a href="#CustomIconDialogProgram">Program 35</a> shows how to use
<code>showMessageDialog()</code> to generate a message dialog with a custom icon.
Note the last parameter at line <a href="#customIconLine">[customIconLine]</a>. This parameter
creates a new <code>ImageIcon</code> object from the <code>file</code> <code>String</code> (<code>"bat.png"</code>
in this case). The resulting dialog appears in
<a href="#customIconDialogFigure">Figure 34</a>. Dialogs illustrated in earlier
examples can also use an icon parameter to include a custom icon.</p>
</div>
<div id="customIconDialogFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/customIconDialogFigure.png" alt="customIconDialogFigure" width="50%">
</div>
<div class="title">Figure 34. A dialog with a custom icon generated by <a href="#CustomIconDialogProgram">[CustomIconDialogProgram]</a>.</div>
</div>
<div id="CustomIconDialogProgram" class="listingblock">
<div class="title">Program 35. Generates a dialog with a custom icon.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomIconDialog</span><span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
<span class="lineno"> 5 </span>		<span class="tok-n">String</span> <span class="tok-n">file</span> <span class="tok-o">=</span> <span class="tok-s">&quot;bat.png&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Custom Icon&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Some bats eat 3,000 mosquitoes a night.&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>		<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
<span class="lineno"> 9 </span>			<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">ImageIcon</span><span class="tok-o">(</span><span class="tok-n">file</span><span class="tok-o">));</span><span class="tok-cm">/*@\label{customIconLine}@*/</span>
<span class="lineno">10 </span>    <span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the icon shown above will not appear when you run this code
unless you have a copy of <code>bat.png</code> in the same directory.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generating_an_input_dialog">7.3.5. Generating an input dialog</h4>
<div class="paragraph">
<p>An input dialog can read text data from the user. The
<code>showInputDialog()</code> method in the <code>JOptionPane</code> class allows us to
create such a dialog. We introduced the <code>showInputDialog()</code> method in
<a href="#_syntax_java_basics">Section 2.3</a>, but we give two more examples here to
emphasize its similarity to the other <code>JOptionPane</code> factory methods and
to show off some of its additional features.</p>
</div>
<div id="inputDialogExample" class="exampleblock">
<div class="title">Example 75. Input dialog</div>
<div class="content">
<div class="paragraph">
<p>We want to write a program that asks a question about basic chemistry.
<a href="#ChemistryQuizOneProgram">Program 36</a> shows how to display a question,
obtain an answer from the user, check for the correctness of the answer,
and report back to the user. At line <a href="#chemistryInputDialogLineOne">[chemistryInputDialogLineOne]</a>,
the <code>showInputDialog()</code> method is used to generate the dialog shown in
<a href="#chemistryQuizFigure">[chemistryQuizFigure]</a>(a). This method returns a <code>String</code> named
<code>response</code> containing the text entered by the user in the dialog box. At
line <a href="#chemistryConvertToIntegerLineOne">[chemistryConvertToIntegerLineOne]</a>, this <code>String</code> is converted to
an <code>int</code> and saved into variable <code>answer</code>. This value is checked against
the correct answer, and the <code>showMessageDialog()</code> method informs the
user whether or not the answer is correct.</p>
</div>
<div class="paragraph">
<p>It is important to note that the user could type any sequence of
characters in the dialog box. Try running
<a href="#ChemistryQuizOneProgram">Program 36</a> and see what happens when you type
&#8220;two,&#8221; instead of the number &#8220;2,&#8221; into the dialog box and press the
&#8220;OK&#8221; button. The program will generate an exception indicating that
the input <code>String</code> cannot be converted to an integer.
<a href="#exercise7.15">Exercise 7.15</a> asks you to modify
<a href="#ChemistryQuizOneProgram">Program 36</a> so it gracefully handles such
exceptions.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise7.15">Exercise 7.15</a></p>
</div>
</div>
</div>
<div id="ChemistryQuizOneProgram" class="listingblock">
<div class="title">Program 36. Generates a dialog to input data as text.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ChemistryQuizOne</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>        <span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Atoms in Water&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>        <span class="tok-n">String</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-s">&quot;How many atoms are in a molecule of water?&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>        <span class="tok-n">String</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span><span class="tok-cm">/*@\label{chemistryInputDialogLineOne}@*/</span>
<span class="lineno"> 8 </span>        	<span class="tok-n">query</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>        <span class="tok-kt">int</span> <span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{chemistryConvertToIntegerLineOne}@*/</span>
<span class="lineno">10 </span>		<span class="tok-n">String</span> <span class="tok-n">message</span><span class="tok-o">;</span>
<span class="lineno">11 </span>        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">answer</span> <span class="tok-o">==</span> <span class="tok-mi">3</span><span class="tok-o">)</span>
<span class="lineno">12 </span>			<span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Good! That&#39;s correct!&quot;</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-k">else</span>
<span class="lineno">14 </span>			<span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sorry, that&#39;s incorrect.&quot;</span><span class="tok-o">;</span>
<span class="lineno">15 </span>        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
<span class="lineno">16 </span>        	<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">17 </span>    <span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="inputDialogFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/inputDialogFigure.svg" alt="inputDialogFigure" width="50%">
</div>
<div class="title">Figure 35. (a) A dialog requesting input as text. (b) A dialog requesting a selection from a list of choices. These dialogs are generated by <a href="#ChemistryQuizOneProgram">Program 36</a> and <a href="#ChemistryQuizTwoProgram">[ChemistryQuizTwoProgram]</a>, respectively.</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 76. Input dialog with a list</div>
<div class="content">
<div class="paragraph">
<p>In <a href="#inputDialogExample">Example 75</a> the user is required to enter a
single value. To reduce input errors, we can restrict the user to
picking from a predefined list. We can create this list by generating an
array and supplying it as a parameter to the <code>showInputDialog()</code> method.</p>
</div>
<div class="paragraph">
<p><a href="#ChemistryQuizTwoProgram">Program 37</a> displays a list of chemical
elements and asks the user to select the heaviest.
Line <a href="#chemistryInputDialogListLineTwo">[chemistryInputDialogListLineTwo]</a> passes an array of four
<code>String</code> values to the <code>showInputDialog()</code> method. Note that the last
parameter to this method is <code>null</code> indicating that no specific item on
the list should be selected by default. (In this case, the first item in
the list is initially selected.) The generated dialog is shown in
<a href="#chemistryQuizFigure">[chemistryQuizFigure]</a>(b). The four elements are contained in a
drop down list.</p>
</div>
<div id="ChemistryQuizTwoProgram" class="listingblock">
<div class="title">Program 37. Generates a dialog to input a choice from a list.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ChemistryQuizTwo</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">String</span> <span class="tok-n">title</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Heaviest Element&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>        <span class="tok-n">String</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Which is the heaviest element?&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">elements</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-s">&quot;Iron&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Uranium&quot;</span><span class="tok-o">,</span>	<span class="tok-s">&quot;Copernicium&quot;</span><span class="tok-o">,</span>
<span class="lineno"> 8 </span>			<span class="tok-s">&quot;Nitrogen&quot;</span><span class="tok-o">};</span>
<span class="lineno"> 9 </span>        <span class="tok-n">String</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span><span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-cm">/*@\label{chemistryInputDialogListLineTwo}@*/</span>
<span class="lineno">10 </span>        	<span class="tok-n">query</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">QUESTION_MESSAGE</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">,</span>
<span class="lineno">11 </span>        	<span class="tok-n">elements</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-n">String</span> <span class="tok-n">message</span><span class="tok-o">;</span>
<span class="lineno">13 </span>        <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;Copernicium&quot;</span><span class="tok-o">))</span>
<span class="lineno">14 </span>			<span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;You&#39;re right!&quot;</span><span class="tok-o">;</span>
<span class="lineno">15 </span>        <span class="tok-k">else</span>
<span class="lineno">16 </span>			<span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Sorry, correct answer: Copernicium.&quot;</span><span class="tok-o">;</span>
<span class="lineno">17 </span>		<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-n">title</span><span class="tok-o">,</span>
<span class="lineno">18 </span>			<span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span>
<span class="lineno">19 </span>    <span class="tok-o">}</span>
<span class="lineno">20 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike <a href="#inputDialogExample">Example 75</a>, the return value from
<code>showInputDialog()</code> is now of type <code>Object</code>, not of type <code>String</code>. The
type of the list required by the method is <code>Object</code> array. (You can pass
a <code>String</code> array to a method that wants an <code>Object</code> array due to
inheritance, which is further discussed in
<a href="#_inheritance">Chapter 11</a> and <a href="#_polymorphism">Chapter 17</a>.) The
return value is the specific object from the array that was passed in.
In our case, it <strong>has</strong> to be a <code>String</code>, but Java is not smart enough to
figure that out. For this reason, we cast the object to a <code>String</code>
before using the <code>equals()</code> method.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 77. Input dialog with a long list</div>
<div class="content">
<div id="inputDialogListManyItemsFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/07-gui-basics/images/inputDialogListManyItemsFigure.png" alt="inputDialogListManyItemsFigure" width="50%">
</div>
<div class="title">Figure 36. A dialog requesting user to select one item from a list of 20 data items. Note the use of a scroll down list to display the items.</div>
</div>
<div class="paragraph">
<p>When the number of elements in the list supplied to the
<code>showInputDialog()</code> is 20 or more, a <code>JList</code> object is automatically
used to display the items as shown in
<a href="#inputDialogListManyItemsFigure">Figure 36</a>.</p>
</div>
<div class="paragraph">
<p>Other than a longer list, the code in this example is virtually
identical to the code for <a href="#inputDialogWithAListExample">[inputDialogWithAListExample]</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_codon_extractor">7.4. Solution: Codon extractor</h3>
<div class="paragraph">
<p>Here we give the solution to the codon extractor problem posed at the
beginning of the chapter. As we have done throughout this chapter, we
start with the import needed for GUIs built on the Swing framework. Next
we begin the <code>CodonExtractor</code> class and its <code>main()</code> method. For
readability, the solution to this problem is divided into methods that
each do a specific task. We hope that the way a method works is
intuitively clear to you. If not, the next chapter explains them in
detail.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CodonExtractor</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-kt">int</span> <span class="tok-n">continueProgram</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>        <span class="tok-k">do</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>        	<span class="tok-c1">// Read DNA sequence</span>
<span class="lineno"> 8 </span>            <span class="tok-n">String</span> <span class="tok-n">input</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showInputDialog</span><span class="tok-o">(</span>
<span class="lineno"> 9 </span>            		<span class="tok-s">&quot;Enter a DNA sequence&quot;</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{DNAInputLine}@*/</span>
<span class="lineno">10 </span>            <span class="tok-n">input</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-o">.</span><span class="tok-na">toUpperCase</span><span class="tok-o">();</span> <span class="tok-c1">// Make upper case</span>
<span class="lineno">11 </span>			<span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Do you want to continue?&quot;</span><span class="tok-o">;</span>
<span class="lineno">12 </span>            <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">isValid</span><span class="tok-o">(</span><span class="tok-n">input</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-c1">// Check for validity</span>
<span class="lineno">13 </span>                <span class="tok-n">displayCodons</span><span class="tok-o">(</span><span class="tok-n">input</span><span class="tok-o">);</span> <span class="tok-c1">// Find codons</span>
<span class="lineno">14 </span>            <span class="tok-k">else</span>
<span class="lineno">15 </span>				<span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Invalid DNA Sequence.\n&quot;</span> <span class="tok-o">+</span> <span class="tok-n">message</span><span class="tok-o">;</span>
<span class="lineno">16 </span>			<span class="tok-n">continueProgram</span> <span class="tok-o">=</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showConfirmDialog</span><span class="tok-o">(</span>
<span class="lineno">17 </span>				<span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span> <span class="tok-s">&quot;Alert&quot;</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">YES_NO_OPTION</span><span class="tok-o">);</span>
<span class="lineno">18 </span>        <span class="tok-o">}</span> <span class="tok-k">while</span><span class="tok-o">(</span><span class="tok-n">continueProgram</span> <span class="tok-o">==</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">YES_OPTION</span><span class="tok-o">);</span>
<span class="lineno">19 </span>        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span>
<span class="lineno">20 </span>        	<span class="tok-s">&quot;Thanks for using the Codon Extractor!&quot;</span><span class="tok-o">);</span>
<span class="lineno">21 </span>    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main()</code> method contains a <code>do-while</code> loop that allows the user to
enter sequences repeatedly. The <code>showInputDialog()</code> method makes an
input dialog and returns the <code>String</code> the user enters. The
<code>toUpperCase()</code> method converts the <code>String</code> to upper case, allowing us
to read input in either case.</p>
</div>
<div class="paragraph">
<p>We then call the <code>isValid()</code> method to make sure that the user entered a
valid DNA sequence. If it is valid, we use <code>displayCodons()</code> to display
the codons in the sequence. Either way, we use a <code>showConfirmDialog()</code>
method to creating a confirm dialog, asking the user if he or she wants
to continue entering sequences. The loop will continue as long as the
return value is <code>JOptionPane.YES_OPTION</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isValid</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">DNA</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>        <span class="tok-n">String</span> <span class="tok-n">validBases</span> <span class="tok-o">=</span> <span class="tok-s">&quot;ACGT&quot;</span><span class="tok-o">;</span>
<span class="lineno">3 </span>        <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>			<span class="tok-kt">char</span> <span class="tok-n">base</span> <span class="tok-o">=</span> <span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno">5 </span>            <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">validBases</span><span class="tok-o">.</span><span class="tok-na">indexOf</span><span class="tok-o">(</span> <span class="tok-n">base</span> <span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-o">-</span><span class="tok-mi">1</span> <span class="tok-o">)</span>
<span class="lineno">6 </span>				<span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span> <span class="tok-c1">//base not in &quot;ACGT&quot;</span>
<span class="lineno">7 </span>        <span class="tok-o">}</span>
<span class="lineno">8 </span>        <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">9 </span>    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>isValid()</code> method checks to see if the DNA contains only the
letters representing the four bases. To do this, we use the Java
<code>String</code> library cleverly: We loop through the characters in our input,
checking to see where they can be found in <code>"ACGT"</code>. If the index
returned is -1, the character was not found, and the DNA is invalid.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">displayCodons</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">DNA</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>        <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>		<span class="tok-c1">// Get as many complete codons as possible</span>
<span class="lineno"> 4 </span>        <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">2</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">+=</span> <span class="tok-mi">3</span><span class="tok-o">)</span>
<span class="lineno"> 5 </span>            <span class="tok-n">message</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;\n&quot;</span> <span class="tok-o">+</span> <span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">,</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">3</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-c1">// 1-2 bases might be left over</span>
<span class="lineno"> 7 </span>        <span class="tok-kt">int</span> <span class="tok-n">remaining</span> <span class="tok-o">=</span> <span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">%</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">remaining</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>            <span class="tok-n">message</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;\n&quot;</span><span class="tok-o">+</span> <span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">,</span>
<span class="lineno">10 </span>            	<span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">())</span> <span class="tok-o">+</span> <span class="tok-s">&quot;**&quot;</span><span class="tok-o">;</span>
<span class="lineno">11 </span>        <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">remaining</span> <span class="tok-o">==</span> <span class="tok-mi">2</span> <span class="tok-o">)</span>
<span class="lineno">12 </span>            <span class="tok-n">message</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;\n&quot;</span><span class="tok-o">+</span> <span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">2</span><span class="tok-o">,</span>
<span class="lineno">13 </span>            	<span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">())</span> <span class="tok-o">+</span> <span class="tok-s">&quot;*&quot;</span><span class="tok-o">;</span>
<span class="lineno">14 </span>        <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;DNA length: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">DNA</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">+</span>
<span class="lineno">15 </span>        	<span class="tok-s">&quot;\n\nCodons: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">message</span><span class="tok-o">;</span>
<span class="lineno">16 </span>        <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">showMessageDialog</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">,</span>
<span class="lineno">17 </span>        	<span class="tok-s">&quot;Codons in DNA&quot;</span><span class="tok-o">,</span> <span class="tok-n">JOptionPane</span><span class="tok-o">.</span><span class="tok-na">INFORMATION_MESSAGE</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{codonDisplayLine2}@*/</span>
<span class="lineno">18 </span>    <span class="tok-o">}</span>
<span class="lineno">19 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>displayCodons()</code> method, we display the individual codons to the
user. We build a large <code>String</code> with newlines separating each codon. To
do so, we loop through the input, jumping ahead three characters each
time. If the input length is not a multiple of three, we pad with
asterisks. Finally, we use the <code>showMessageDialog()</code> method to display
an information dialog with the list of codons.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_simple_guis">7.5. Concurrency: Simple GUIs</h3>
<div class="paragraph">
<p>Many GUI frameworks (including Swing) are built on a multi-threaded
model. Swing uses threads to redraw widgets and listen for user input
while the main thread can continue processing other data.</p>
</div>
<div class="paragraph">
<p>In this chapter, the impact of these threads is minimal because we used
only <strong>modal</strong> dialogs. Every time we called a <code>JOptionPane</code> method, the
execution of the program&#8217;s main thread had to wait until the method
returned. As it turns out, several threads are created when
<code>showInputDialog()</code> or any of the others dialog methods are called, but
they do not interact with the main thread since it has been blocked.</p>
</div>
<div class="paragraph">
<p>The situation is more complicated with a non-modal dialog, which is one
of the reasons we did not go into them. In a non-modal dialog, the
threads that redraw the dialog and handle its events (like a user
clicking on a button) are running at the same time as the thread that
created the dialog. Since many threads are running, it is possible for
them to write to the same data at the same time. Doing so can lead to
inconsistencies such as the ones we will describe in
<a href="#_synchronization">Chapter 14</a>.</p>
</div>
<div class="paragraph">
<p>The GUIs we will create in <a href="#_constructing_graphical_user_interfaces">Chapter 15</a>, however, will be more than dialogs. They will be fully
functional windows, known as frames in Java. Like a non-modal dialog,
the creation of a frame does not block the thread that created it.</p>
</div>
<div class="paragraph">
<p>Many applications launch a frame and then end their main thread. If no
other threads are created, life is relatively easy. However, complex
applications may create multiple frames or launch threads to work on
tasks in the background. Another common problem is caused by performing
complicated tasks in the event handler for a GUI. If a task takes too
long, the GUI can freeze or become unresponsive, as you have probably
experienced. The fact that this problem happens so frequently even in
the latest operating systems should hint at the difficulty of managing
GUI threads.</p>
</div>
<div class="paragraph">
<p>When we describe how to create fully featured GUIs in
<a href="#_constructing_graphical_user_interfaces">Chapter 15</a>, we will also
give some techniques to help with avoiding unresponsive GUIs in a
multi-threaded environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_4">7.6. Summary</h3>
<div class="paragraph">
<p>In this chapter we have introduced a way to create simple GUIs. These
GUIs are created using various methods available in the <code>JOptionPane</code>
class. While the interfaces created this way are simple in nature, they
are often adequate for input and output in short Java programs.
Construction of more complex GUIs is the subject of
<a href="#_constructing_graphical_user_interfaces">Chapter 15</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_7">7.7. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise7.1"></a> In which situations would it be better to use a command-line
interface instead of a GUI? When is it better to use a GUI over a
command-line interface?</p>
</li>
<li>
<p><a id="exercise7.2"></a> Explain the difference
between a modal and a non-modal dialog. Give an example of when you
would prefer a modal over non-modal dialog, and another example of when
you would prefer a non-modal to a modal dialog.</p>
</li>
<li>
<p><a id="exercise7.3"></a> Give one example each when
you would use the five different message type constants in
<code>showMessageDialog()</code> method (see page  for a listing of the five
constants).</p>
</li>
<li>
<p><a id="exercise7.4"></a> In <a href="#OddEvenTestProgram">Program 33</a>,
we could have coded line <a href="#yes-noDialogLine">[yes-noDialogLine]</a> as follows without
changing the program behavior.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-n">response</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">x</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">!=</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">||</span>
    <span class="tok-o">(</span><span class="tok-n">response</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">x</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Yet another option is below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span> <span class="tok-o">!=</span> <span class="tok-n">x</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which of these three implementations is best? Why?</p>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise7.5"></a> Modify the program in <a href="#yes-NoDialogExample">Example 72</a> such that it
tests the user several times, say 25 times, whether a randomly generated
integer is odd or even. The program should keep a score indicating the
number of correct answers. At the end of the test the score is displayed
using a suitable dialog.</p>
</li>
<li>
<p><a id="exercise7.6"></a> Modify the program in <a href="#yes-NoDialogExample">Example 72</a> such that it
displays a dialog that asks the user &#8220;Do you wish to continue?&#8221; and
offers options &#8220;Yes&#8221; and &#8220;No.&#8221; The program exits the loop when the
&#8220;No&#8221; option is selected and displays the score using a suitable
dialog.</p>
</li>
<li>
<p><a id="exercise7.7"></a> Rewrite
<a href="#OddEvenTestProgram">Program 33</a> so that the confirmatory dialog
generated offers the &#8220;Yes,&#8221; &#8220;No,&#8221; and &#8220;Cancel&#8221; options to the
user. The program exits with a message dialog saying &#8220;Thank You&#8221; when
the user selects the &#8220;Cancel&#8221; option.</p>
</li>
<li>
<p><a id="exercise7.8"></a> Modify
<a href="#CapitalQuizProgram">Program 34</a> to create and administer a test wherein
the user is asked capitals of 10 countries in a sequence. The program
must keep count of the score, i.e., the number of correct answers.
Inform the user of the score at the end of the test using a suitable
dialog.</p>
</li>
<li>
<p><a id="exercise7.9"></a> Modify line <a href="#multipleOptionsLine">[multipleOptionsLine]</a>
in <a href="#CapitalQuizProgram">Program 34</a> so that the button labeled &#8220;Baku&#8221;
has focus.</p>
</li>
<li>
<p><a id="exercise7.10"></a> <a href="#_solution_three_card_poker">Section 8.5</a> gives a method called <code>shuffle()</code> that is used to randomize an
array representing a deck of cards. Adapt this code and modify
<a href="#CapitalQuizProgram">Program 34</a> so that the order of the capitals is
randomized. Note that you will have to record which index contains the
correct answer.</p>
</li>
<li>
<p><a id="exercise7.11"></a> Re-implement the solution to the college cost calculator problem
given in <a href="#_solution_college_cost_calculator">Section 3.5</a> so that it uses
GUIs constructed with <code>JOptionPane</code> for input and output.</p>
</li>
<li>
<p><a id="exercise7.12"></a> Re-implement the solution to the Monty Hall problem given in
<a href="#_solution_monty_hall">Section 4.4</a> so that it uses GUIs constructed with
<code>JOptionPane</code> for input and output.</p>
</li>
<li>
<p><a id="exercise7.13"></a> Re-implement the solution to the DNA searching problem given in
<a href="#_solution_dna_searching">Section 5.4</a> so that it uses GUIs constructed with
<code>JOptionPane</code> for input and output.</p>
</li>
<li>
<p><a id="exercise7.14"></a> Write a program that creates an input dialog that prompts and reads
a file name of an image from the user. Then, create an information
dialog that displays the file as a custom icon. In this way, you can
construct a simple image viewer.</p>
</li>
<li>
<p><a id="exercise7.15"></a> <strong>Note: You should attempt
this exercise only if you are familiar with exceptions in Java.
Exceptions are covered in <a href="#_exceptions">Chapter 12</a>.</strong><br>
Use the <code>try-catch</code> block and modify
<a href="#ChemistryQuizOneProgram">Program 36</a> so that it handles an exception
generated when the user enters a string that cannot be converted to an
integer. In the event such an exception is raised, pop up a message
dialog box informing the user to try again and type an integer value.
When the user responds by clicking the &#8220;OK&#8221; button on this message
box, the input dialog box should appear once again and offer the user
another chance at the answer. Write two versions of the modified
program. In one version, your program should give only one chance for
input after an incorrect string has been typed. In another version, your
program should remain in a loop until the user enters a valid integer
(note that a valid integer might not be the correct answer to the
question asked).</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_methods">8. Methods</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Polonius (Aside): Though this be madness, yet there is method in &#8217;t.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; William Shakespeare
</div>
</div>
<div class="sect2">
<h3 id="_problem_three_card_poker">8.1. Problem: Three card poker</h3>
<div class="paragraph">
<p>Gambling has held a fascination for humankind since its invention. As
long as there have been mathematicians, they have studied the underlying
mechanisms of probability and statistics that drive games of chance. A
classic game of both statistics and strategy is poker. The problem we
want to solve is programming one of the many variations of poker, called
three card poker. Instead of bluffing, a player competes only with the
house according to fixed rules without any room for psychology. A player
is dealt three cards. If the player&#8217;s hand contains a pair or better, he
or she wins a payoff greater than or equal to the money bet. If the
player does not have a pair or better, he or she loses the money bet.
Below is a table giving one possible set of payoffs for each possible
hand.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Hand</th>
<th class="tableblock halign-center valign-top">Payoff</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Straight Flush</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">40</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Three of a Kind</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Straight</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Flush</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Pair</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Nothing</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you are unfamiliar with poker rules or card games in general, here is
a quick explanation of the various hands. A traditional English or
American deck of cards is made up of 52 cards, organized into four
suits: spades, hearts, diamonds, and clubs. In each suit, there are 13
ranks: two, three, four, five, six, seven, eight, nine, ten, jack,
queen, king, and ace.</p>
</div>
<div class="paragraph">
<p>In three card poker, a straight is when the three cards can be arranged
so that their ranks (ignoring suit) are in order. For example, a hand
consisting of a Four of Diamonds, a Five of Spades, and a Six of Clubs
would constitute a straight. An ace can serve as either the highest rank
card (coming after a king) or the lowest rank card (coming before a two)
and can help form a straight in either role (but not both at the same
time). A flush is when all three cards have the same suit. For example,
a Three of Hearts, a Seven of Hearts, and a Jack of Hearts would
constitute a flush in three card poker. A straight flush, the highest
hand, is made up of cards that form both a straight (by rank ordering)
and a flush (by uniformity of suit). A three of a kind occurs when all
three cards have the same rank, and a pair occurs when two of the cards
have the same rank. When none of these conditions hold, the hand has no
special designation in three card poker, and the bet is lost.</p>
</div>
<div class="paragraph">
<p>Your task is to write a program that serves as a computerized version of
the game. You must create a deck of 52 cards, thoroughly randomize them
to simulate shuffling, and select the first three cards as a hand. You
must then determine the highest designation that applies to the hand of
cards and the corresponding winnings (if any).</p>
</div>
<div class="paragraph">
<p>Any reasonable solution to this problem uses arrays, discussed in the
previous chapter. Using only that knowledge, you should be able to
create a three card poker game. However, the focus of this chapter is
<em>methods</em>, which can be used to break the solution to a problem into
logical pieces. By dividing the solution in this way, we will be able to
solve the three card poker problem in a relatively short, elegant, and
easy to read way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_dividing_work_into_segments">8.2. Concepts: Dividing work into segments</h3>
<div class="paragraph">
<p>You should notice that the solutions to problems we have been working on
have become increasingly complex as the book progresses. Partly, this
tendency is due to the fact that interesting problems tend to have
complex solutions. Partly, it is due to the fact that more advanced
features in Java are generally designed to tackle more complicated
problems.</p>
</div>
<div class="paragraph">
<p>The tools we introduce in this chapter do not allow you to solve a
problem you could not solve before. Instead, the tools in this chapter
and in the next one make solving a problem easier and less susceptible
to errors. A relatively long, complicated list of Java statements was
necessary to solve problems like the statistics program or Conway&#8217;s Game
of Life. Instead of solving those problems as a single monolithic
segment of code, we can break our solutions into units called <em>static
methods</em>.</p>
</div>
<div class="sect3">
<h4 id="_reasons_for_code_static_code_methods">8.2.1. Reasons for <code>static</code> methods</h4>
<div class="paragraph">
<p>A static method is a short, named segment of code that has been packaged
up so that it can be <em>called</em> from other parts of the program. Whenever
the task performed by this method is needed, the execution of the
program jumps to the code in the method, does the work it is supposed
to, and then returns to whatever it was doing before.</p>
</div>
<div class="paragraph">
<p>The reasons for using static methods can be boiled down to three
essentials:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Modularity</dt>
<dd>
<p>Very little software development is done by individuals. Commercial
software can have tens or even hundreds of programmers involved in
designing, implementing, testing, and maintaining code. When the code
is divided into individual methods, those methods can be written and
tested by different people with minimal interference. It is much
harder to work together on one giant block of code.</p>
</dd>
<dt class="hdlist1">Readability</dt>
<dd>
<p>Methods are <strong>named</strong> segments of code. When a method is called, its
name is used. If a meaningful name is chosen, the line in the code
that calls the method helps document the code by explaining what is
happening. For example, if a method called <code>sort()</code> is used, a reader
instantly understands that something is being sorted. If, instead of a
separate <code>sort()</code> method, the code for selection sort were pasted into
the same location, a reader might have to devote a few moments to
understanding the meaning of those lines of code, particularly without
comments.</p>
</dd>
<dt class="hdlist1">Reusability</dt>
<dd>
<p>The fact that a method can be called from anywhere in the code makes
it reusable. To use the <code>sort()</code> example again, we might have to sort
several different arrays in one program. Without methods, we would
have to keep copying and pasting code over and over again. With
methods, the total amount of source code can be smaller. In fact, if
you find yourself copying and pasting code, it is often an indication
that a method would be useful.
+
This idea of reusability stretches beyond individual programs. A
static method can be called from a different program entirely. If you
create a method that is really useful, you are free to use it in other
programs you may write. By doing so, you only have to makes changes in
one place if you discover errors or want to increase its
functionality.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_parallel_to_mathematical_functions">8.2.2. Parallel to mathematical functions</h4>
<div class="paragraph">
<p>We have been discussing the usefulness of static methods without saying
exactly what they are. One way to get insight into methods is by
acknowledging their similarity to functions from mathematics. In
procedural (non-object oriented) languages like C, the equivalent of
static methods are usually referred to as functions, in fact. Like
functions in mathematics, a static method takes some number of inputs
(though, as few as zero) and usually produces some output.</p>
</div>
<div class="paragraph">
<p>You have already used several static methods from the <code>Math</code> class, such
as <code>Math.sqrt()</code>. The expression \(f(x) = \sqrt{x}\) defines
what \(f(x)\) does in the same way that the code inside of
<code>Math.sqrt()</code> does. When you want to use \(f(x)\) for a
specific value, you can set \(y = f(5)\) in the same way that
you might type the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the statement \(f(5)\), the value of \(x\) is
replaced by \(5\). In the same way, some variable inside of
<code>Math.sqrt()</code> takes on the value <code>5</code> when the method is called.</p>
</div>
<div class="paragraph">
<p>It is important to understand this similarity between methods and
mathematical functions because the designers of many programming
languages have been directly influenced by the older notation. However,
there are many differences between the two concepts as well.
Mathematical functions can take more than one input, and so can Java
methods. Methods can also take no input, while the whole point of a
mathematical function is to map some input value(s) to some output
value. Java methods do not necessarily even have output values. They may
just <strong>do</strong> something.</p>
</div>
</div>
<div class="sect3">
<h4 id="_control_flow">8.2.3. Control flow</h4>
<div class="paragraph">
<p>We have discussed selection statements such as <code>if</code> and <code>switch</code> as well
as three different looping structures, <code>for</code>, <code>while</code>, and <code>do-while</code>.
Each of these Java language features is used for control flow. The
selection statements allow your program to choose which code to execute.
The loops allow your code to repeatedly execute certain code. Methods
also affect control flow. When a method is called, the execution of the
program jumps into the method, does all the work it needs to there, and
then returns to the code that called it. Recall the very simple example
from above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The JVM has allocated a variable of type <code>double</code> and is preparing to
assign a value to it. Suddenly, the execution of the JVM jumps into the
code inside of the <code>Math.sqrt()</code> method. It takes some non-trivial
amount of work to compute the square root of a number. After that
computation is finished, the flow of execution returns to the assignment
that has been waiting all that time. Just like a mathematical function,
we can treat the method call <code>Math.sqrt(5)</code> as if it were &#8220;magically&#8221;
replaced by a <code>double</code> approximating the square root of 5.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_methods">8.3. Syntax: Methods</h3>
<div class="paragraph">
<p>By now, you should have a good feel for the concepts behind calling and
even creating static methods and are probably getting impatient to use
them. There are a number of issues of method syntax in Java you should
be aware of. First, we describe how you can create your own static
methods, then discuss the finer points of calling static methods, and
finally explain how <em>class variables</em> can be used from many different
methods.</p>
</div>
<div class="sect3">
<h4 id="_defining_methods">8.3.1. Defining methods</h4>
<div class="paragraph">
<p>A very simple method that the <code>Math</code> class provides is the <code>Math.max()</code>
method. This method selects the larger of two values that you give it as
input.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">maximum</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">max</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the value stored into <code>maximum</code> is <code>10</code>. Despite its
simplicity, we demonstrated how useful this method could be in our
solution to Conway&#8217;s Game of Life from <a href="#_arrays">Chapter 6</a>. If we
wanted to write this method ourselves, the code would be as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">max</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">&gt;=</span> <span class="tok-n">b</span> <span class="tok-o">)</span>
        <span class="tok-k">return</span> <span class="tok-n">a</span><span class="tok-o">;</span>
    <span class="tok-k">else</span>
        <span class="tok-k">return</span> <span class="tok-n">b</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even in such a small method, there are a lot of pieces of syntax to
worry about. The first line of this method is called the <em>method
header</em>. The <code>public</code> keyword in this header is used to denote that any
code, even code from a different class, can call this method. We discuss
restricting access to methods and variables more in the later part of
this chapter. For now, assume that every method is <code>public</code>.</p>
</div>
<div class="paragraph">
<p>The keyword <code>static</code> indicates that this method is static. Although we
have used the term <em>static method</em> many times, we have not yet defined
it. A static method is linked to a whole class, not to a specific object
of that class–that is, a static method can be called without referencing
an object of the class. Again, we discuss the finer points of objects
and classes in the next chapter. For now, all methods are <code>static</code>.</p>
</div>
<div class="paragraph">
<p>The third keyword in the method header is the familiar <code>int</code>, giving the
return type of the method. Wherever this method is called, it can be
treated like an <code>int</code> value, because that is what it gives back. In this
case, the return type is obvious: The maximum of two <code>int</code> values must
also be an <code>int</code> value. Any type can be used as a return value including
all the primitive types and any reference or array types. The only
limitation is that a method can only return a single item, but, since
that item can be an array, this limitation is usually not important. It
is also possible for a method to return nothing. In that case, the
keyword <code>void</code> is used for the return type.</p>
</div>
<div class="paragraph">
<p>Next in the method header is the identifier <code>max</code>, which is the name of
the method. Any legal identifier that you can use for a variable name is
valid for a method name as well. It is important to pick a name that is
readable and gives a reader a clear idea about what the method does. A
common convention is to name a method using a verb phrase, indicating
the operation that is being done by that method (e.g., <code>computeTax</code>).
Like variable names, the Java standard is to use camel notation,
starting with a lowercase letter and capitalizing the first letter of
each new word in the name.</p>
</div>
<div class="paragraph">
<p>After the name of the method is the list of the <em>parameters</em>, separated
by commas. In this case, each parameter has the <code>int</code> type. You are free
to name your parameters whatever you want, though they should be
meaningful. You can have as few as zero parameters, but there is an
upper limit imposed by the JVM, usually 255. The body of the method
follows the header of the method, surrounded by braces (<code>\{\}</code>). Unlike
<code>if</code> statements and loops, the braces for methods are required.</p>
</div>
<div class="paragraph">
<p>Inside the body of a method, the usual rules for Java control flow
apply. Each line is executed line by line unless there are selection
statements or loops. Calling methods inside of methods is allowed as
well. In the <code>max()</code> method, we use an <code>if-else</code> construction to find
the larger of <code>a</code> and <code>b</code>. A <code>return</code> statement immediately stops
execution of the method, transfers execution back to the calling code,
and gives back the value that comes after it. In this case, the value of
<code>a</code> is returned if it is equal or larger, and the value of <code>b</code> is
returned otherwise. Because a <code>return</code> statement immediately jumps out
of a method, we could have written the method with one fewer line of
code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">max</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">&gt;=</span> <span class="tok-n">b</span> <span class="tok-o">)</span>
        <span class="tok-k">return</span> <span class="tok-n">a</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-n">b</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The only way that the line <code>return b;</code> can be reached is if <code>a</code> had not
already been returned.</p>
</div>
<div class="sect4">
<h5 id="_the_code_main_code_method">The <code>main()</code> method</h5>
<div class="paragraph">
<p>If some of this syntax seems eerily familiar, remember that you have
been coding static methods since your very first Java program. The
<code>main()</code> method is just another static method, special only because the
JVM chooses to start execution there. Let&#8217;s look at the <code>main()</code> method
from a standard Hello, World! program.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Hello, world!&quot;</span><span class="tok-o">);</span>
    <span class="tok-k">return</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like the <code>max()</code> method, the header for <code>main()</code> starts with
<code>public static</code>. Then, the return type for <code>main()</code> is <code>void</code> because
the JVM is not expecting to get any answer back. The <code>main()</code> method has
a single parameter, an array of type <code>String</code>. In this program, we do
not use the <code>args</code> parameter, but it is available. For the <code>main()</code>
method, this declaration is fine, because <code>main()</code> has to be uniform
across all programs. However, when designing your own methods, you
should not include unnecessary parameters.</p>
</div>
<div class="paragraph">
<p>The final executable line in this <code>main()</code> method is a <code>return</code>
statement. Because <code>main()</code> has a <code>void</code> return type, the <code>return</code>
statement has no value to return. For <code>void</code> methods, a <code>return</code>
statement is optional. You can use it to leave a method early, if
desired. For a value-returning method, execution must reach a <code>return</code>
statement with a valid value no matter what the input of the method is.
If Java finds a way that execution could reach the end of a value
returning method without reaching a <code>return</code> statement, it causes a
compiler error.</p>
</div>
</div>
<div class="sect4">
<h5 id="subsubsection:Overloaded_methods">Overloaded methods</h5>
<div class="paragraph">
<p>Since this declaration is in another class, it is OK to create a <code>max()</code>
method even though there is already one in the <code>Math</code> class. However, it
is possible to create more than one method with the same name in the
same class, provided that their <em>signatures</em> are not the same. Two
methods have the same <em>signature</em> if they have the same name and
parameter types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">max</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">b</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">c</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">max</span><span class="tok-o">(</span><span class="tok-n">max</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">b</span><span class="tok-o">),</span> <span class="tok-n">c</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we have created yet another <code>max()</code> method, but this
one takes three parameters instead of two. This method even calls the
two parameter version of <code>max()</code>. Creating more than one method with the
same name is called <em>overloading</em> those methods. Overloading methods is
useful because it allows you to use the same method name for similar
functionality, even when there are some underlying differences in the
implementation. For example, the <code>Math</code> class provides four different,
overloaded versions of the <code>max()</code> method, specialized for <code>int</code>,
<code>long</code>, <code>float</code>, and <code>double</code> values, respectively.</p>
</div>
<div class="paragraph">
<p>There are limitations on creating overloaded methods, of course. The
compiler must be able to determine which method you intend to use. Thus,
the signatures have to vary by type or number of parameters. A different
return type is not enough.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calling_methods">8.3.2. Calling methods</h4>
<div class="paragraph">
<p>After a method has been defined, it must be called before it does
anything. You have plenty of experience calling static methods like
<code>Math.sqrt()</code> and <code>Math.max()</code>. An example of the appropriate syntax was
given earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">maximum</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">max</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Formally, the call starts with the name of the class (<code>Math</code>), followed
by a dot, followed by the name of the method (<code>max</code>), followed by the
list of <em>arguments</em> inside parentheses. These arguments are the values
you want to <em>pass</em> into the method. Some books use the term <em>formal
parameters</em> to describe the variables defined in the method signature
and <em>actual parameters</em> to describe the values passed into the methods,
but we stick with the simpler terms parameters and arguments.</p>
</div>
<div class="paragraph">
<p>Of course, the number of arguments must match the number of parameters
defined by the method, and the types must match as well. Java performs
automatic casting when no precision is lost. Thus, you can always supply
an <code>int</code> argument for a <code>double</code> parameter, but not the reverse.
Arguments can be literal values, variables, or even other method calls
that return the appropriate type.</p>
</div>
<div class="paragraph">
<p>Using the <code>max()</code> method defined before, we could rewrite our simple
example without a class name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">maximum</span> <span class="tok-o">=</span> <span class="tok-n">max</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever you call a static method from code that is inside the same
class, you can leave out the class name.</p>
</div>
<div class="sect4">
<h5 id="_binding">Binding</h5>
<div class="paragraph">
<p>Many new programmers are confused about the relationship between
arguments and parameters. The process of supplying an argument to be
used as a parameter is called <em>binding</em>. Through binding, a value or
variable from the calling code is given a new name inside of a method.
Consider the following method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">add</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">b</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This absurdly short method adds two numbers together and returns the
result, approximating the functionality of the <code>+</code> operator. We could
call the method in the following context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the method, the value of <code>x</code> is bound to the variable <code>a</code>, and
the value of <code>y</code> is bound to the variable <code>b</code>. The <code>add()</code> method has
its own <em>scope</em>. Scope means the area where a variable name is visible
(or meaningful). Thus, <code>x</code> and <code>y</code> do not exist inside of the <code>add()</code>
method, only the variables <code>a</code> and <code>b</code> do. Since methods have their own
scope, variables in one method can have the same names as variables in
another method without the compiler (or the programmer!) becoming
confused. Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">b</span><span class="tok-o">,</span> <span class="tok-n">a</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the variables <code>a</code> and <code>b</code> exist in both the calling code and inside
the method, but the names are independent. The value of <code>a</code> in the
calling code happens to be bound to a variable called <code>b</code> inside the
method, but the JVM has no confusion about which <code>a</code> is which. Herein
lies the value of methods: They are largely independent of whatever else
is going on in the code, allowing the programmer to focus on a small,
manageable task.</p>
</div>
<div class="paragraph">
<p>Another important feature of Java is that the process of binding
variables is <em>pass by value</em>, meaning that only the <strong>value</strong> of the
argument is bound to the parameter. Whenever a method is called, the
method creates a new variable for each parameter and copies the value of
its argument into it. In practice, this approach means that a method
cannot directly change the value of an argument. Consider the following
method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">increment</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">counter</span><span class="tok-o">++;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This method takes the value of its argument and copies it into the new
variable <code>counter</code>. Then, it increments <code>counter</code>, but the original
argument is unchanged. Thus, the following fragment is an infinite loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span> <span class="tok-o">)</span>
    <span class="tok-n">increment</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>i</code> remains fixed at <code>0</code> for the entire program. The copy
of <code>i</code> bound to <code>counter</code> increases to <code>1</code> every time <code>increment()</code> is
called, but <code>i</code> remains unaffected.</p>
</div>
<div class="paragraph">
<p>This is not to say that a method cannot affect the variables outside of
itself. The primary way that it can do so is by using <code>return</code>
statements. We can rewrite <code>increment()</code> to achieve this effect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">increment</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">counter</span><span class="tok-o">++;</span>
    <span class="tok-k">return</span> <span class="tok-n">counter</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, we need to adjust the loop so that it stores the returned value
instead of dropping it on the floor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span> <span class="tok-o">)</span>
    <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">increment</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A second way that methods can affect the values of outside variables is
more indirect. In Java, every argument is passed by value, even arrays
and objects. Practically, this means that, if a reference to an array is
passed into a method, you cannot change which array it is pointing at.
Since references are not values but names pointing at a particular
location in memory, you can directly change the contents of that memory
with a method, even if you can&#8217;t change which locations are being
referenced. For example, the following method does <strong>not</strong> reverse the
order of an array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">badReverseArray</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">];</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">temp</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">];</span>
    <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Although this code does store a reversed version of <code>array</code> in <code>temp</code>,
the last line of the method is meaningless: The array passed into the
method still points to the original location in memory. We can rewrite
the method to do the reversal <em>in place</em>, meaning that the values of the
array are shuffled around, but the array still occupies the same memory
locations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">goodReverseArray</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">/</span> <span class="tok-mi">2</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
        <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">];</span>
        <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this version of the method, we swap the first element of the array
with the last, the second with the second to last, and so on. We only go
up to the halfway point of the array, otherwise we undo the reversal
process. The values of the array are reversed, but they still occupy the
same chunk of memory. It is possible to write a correct method more in
the style of <code>badReverseArray()</code> which creates a temporary array, copies
the original values into it, and then copies them back to the original
array in reverse order, but it is less efficient to create the extra
array and perform two copies.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_class_variables">8.3.3. Class variables</h4>
<div class="paragraph">
<p>According to the rules we have given so far, the only legal variables in
the scope of a static method are the parameters and any other <em>local</em>
variables declared inside the method. However, it is possible to create
a variable that exists outside of static methods yet is visible inside
all of them. These kinds of variables are called <em>class variables</em> (or
sometimes <em>static fields</em> or <em>global variables</em>). These variables
persist <strong>between</strong> method calls. The syntax for creating such a variable
is to declare it outside of all methods (but inside the class) with an
access modifier such as <code>public</code> or <code>private</code>, and the keyword <code>static</code>.
For example, the following class includes a method called <code>record()</code>
that increases the class variable <code>counter</code> every time it is called.</p>
</div>
<div id="BookkeeperProgram" class="listingblock">
<div class="title">Program 38. Keeps track of the number of times the <code>record()</code> method is called.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Bookkeeper</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-mf">0.001</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>			<span class="tok-n">record</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Record was called &quot;</span> <span class="tok-o">+</span> <span class="tok-n">counter</span> <span class="tok-o">+</span>
<span class="lineno"> 9 </span>			<span class="tok-s">&quot; times.&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">record</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>		<span class="tok-n">counter</span><span class="tok-o">++;</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, this program calls the <code>record()</code> method some random number of
times, and the variable <code>counter</code> keeps track of the number. Because
both <code>main()</code> and <code>record()</code> are static methods, the value of <code>counter</code>
is accessible to each of them. Many programmers frown on the use of
class variables precisely because they are visible to many different
methods. The idea of a method is to isolate pieces of code so that the
complexity of a program can be divided into simple units. In the case of
a public class variable, even code in other classes can modify its
value. So many different pieces of code can modify the value that it may
be difficult to keep the variable from being changed in an unexpected
way. If another method used the <code>counter</code> variable to record the number
of times it was called, the final value of <code>counter</code> would be the sum of
the number of times the two methods were called. There might be some
reason to keep track of such information, but it would be impossible to
reconstruct what fraction of the value in <code>counter</code> came from one method
and what fraction came from the other.</p>
</div>
<div class="paragraph">
<p>Class variables have their uses, but they should generally be avoided.
One exception to this rule is constants. Since a constant never changes,
a class variable is a great place to store it, making the value
available to any code that uses it. An example you have already used is
<code>Math.PI</code>. As with static methods, a static field from another class can
be accessed by using the class name, then a dot, then the name of the
static field. Again, when the code using the field is in the same class,
the class name can be dropped. A class constant is declared like a class
variable, but with the addition of the <code>final</code> keyword. The following
class allows a user to compute the one-dimensional force due to gravity,
given by the equation \(F =
\frac{Gm_1m_2}{r^2}\), where \(m_1\) is the mass of one
object, \(m_2\) is the mass of another, \(r\) is the
distance between their centers, and \(G\) is the gravitational
constant,
\(6.673 \times 10^{-11}\mbox{ N}\cdot\mbox{m}^2\cdot\mbox{kg}^{-2}\).</p>
</div>
<div id="GravityProgram" class="listingblock">
<div class="title">Program 39. Calculates the attraction due to gravity between two masses.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Gravity</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">G</span> <span class="tok-o">=</span> <span class="tok-mf">6.673e-11</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-kt">double</span> <span class="tok-n">m1</span><span class="tok-o">,</span> <span class="tok-n">m2</span><span class="tok-o">,</span> <span class="tok-n">r</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;What is the first mass?&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-n">m1</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;What is the second mass?&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-n">m2</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">11 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;What is the distance between them?&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">13 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The force of gravity is &quot;</span> <span class="tok-o">+</span>
<span class="lineno">14 </span>			<span class="tok-n">force</span><span class="tok-o">(</span> <span class="tok-n">m1</span><span class="tok-o">,</span> <span class="tok-n">m2</span><span class="tok-o">,</span> <span class="tok-n">r</span> <span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; N&quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>	<span class="tok-o">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span> <span class="tok-nf">force</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">m1</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">m2</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">r</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>		<span class="tok-k">return</span> <span class="tok-n">G</span><span class="tok-o">*</span><span class="tok-n">m1</span><span class="tok-o">*</span><span class="tok-n">m2</span><span class="tok-o">/(</span><span class="tok-n">r</span><span class="tok-o">*</span><span class="tok-n">r</span><span class="tok-o">);</span>
<span class="lineno">19 </span>	<span class="tok-o">}</span>
<span class="lineno">20 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use named constants this way whenever you can. You can use the <code>public</code>
modifier if you want all classes to have access to your constant
(<code>Gravity.G</code> is a good example). You can use the <code>private</code> modifier if
you want the constant to be accessible only inside your class, if it has
no use outside, or if it contains secret information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_defining_methods">8.4. Examples: Defining methods</h3>
<div class="paragraph">
<p>Any large problem should be broken down into methods. Because the
technique is useful in so many circumstances, it is difficult to give a
set of examples that covers all the bases. Instead, our examples are
short, easy to understand methods, focusing on Euclidean distance,
testing for palindromes, and converting a <code>String</code> representation of an
<code>int</code> to an <code>int</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 78. Euclidean distance</div>
<div class="content">
<div class="paragraph">
<p>The Euclidean distance between two points is the length of a straight
line connecting them. It plays an important role in 3D graphics and
games and is the basis for many other practical applications involving
spatial relationships. Unfortunately, the real world is complicated
enough that, even if the shortest distance between two points is a
straight line, we can seldom travel along it.</p>
</div>
<div class="paragraph">
<p>Given a two points in 3D space \((x_1, y_1, z_1)\) and
\((x_2,
y_2, z_2)\), we can compute the Euclidean distance between them with the
equation: \(d = \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2 + (z_1
- z_2)^2}\) The following method applies this equation directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span> <span class="tok-nf">distance</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">x1</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">y1</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">z1</span><span class="tok-o">,</span>
                  <span class="tok-kt">double</span> <span class="tok-n">x2</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">y2</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">z2</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">double</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">x1</span> <span class="tok-o">-</span> <span class="tok-n">x2</span><span class="tok-o">;</span>
    <span class="tok-kt">double</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">y1</span> <span class="tok-o">-</span> <span class="tok-n">y2</span><span class="tok-o">;</span>
    <span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">=</span> <span class="tok-n">z1</span> <span class="tok-o">-</span> <span class="tok-n">z2</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span> <span class="tok-n">x</span><span class="tok-o">*</span><span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">y</span><span class="tok-o">*</span><span class="tok-n">y</span> <span class="tok-o">+</span> <span class="tok-n">z</span><span class="tok-o">*</span><span class="tok-n">z</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This calculation is a good choice for a static method since it might be
necessary to do this calculation many times and it does not depend on
any other variables or program state.</p>
</div>
</div>
</div>
<div id="palindromeTestingExample" class="exampleblock">
<div class="title">Example 79. Palindrome testing</div>
<div class="content">
<div class="paragraph">
<p>A palindrome is a word or phrase (or even a number) that is the same
spelled forwards and backwards. &#8220;Racecar,&#8221; &#8220;Madam, I&#8217;m Adam,&#8221; and
&#8220;Satan, oscillate my metallic sonatas&#8221; are examples in English.
Typically, spaces and punctuation are ignored. We are going to write a
function that, given a <code>String</code>, returns <code>true</code> if it is a palindrome
and <code>false</code> otherwise. To simplify the problem, we are <strong>not</strong> going to
ignore spaces and punctuation. Thus, with our method, &#8220;racecar&#8221; counts
as a palindrome, but neither of the other two examples would.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isPalindrome</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">text</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">/</span> <span class="tok-mi">2</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">!=</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">))</span>
            <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because our method returns <code>true</code> or <code>false</code>, its return type must be
<code>boolean</code>. Many methods that return a <code>boolean</code> value have a name
starting with <code>is</code>, like our method. The first line of the body of our
method changes <code>text</code> to lower case. The <code>String</code> method <code>toLowerCase()</code>
creates a lower case copy of the <code>String</code> it is called on, in this case
<code>text</code>. Then, we point the reference variable <code>text</code> at that new, lower
case <code>String</code>. On the outside of this function, the <code>String</code> passed in
does not change because the name <code>text</code> is passed by value.</p>
</div>
<div class="paragraph">
<p>The loop iterates through the first half of <code>text</code>, comparing it to the
second half. This loop reflects the asymmetry of these kinds of tests:
You can&#8217;t be sure that <code>text</code> is a palindrome until you have checked the
entire thing, but you immediately know that it is not if even a single
pair of characters does not match. If the test in that <code>if</code> statement
ever shows that the two <code>char</code> values are not equal, the <code>return false</code>
statement jumps out of the method without completing the loop.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise8.11">Exercise 8.11</a></p>
</div>
</div>
</div>
<div id="parsingANumberExample" class="exampleblock">
<div class="title">Example 80. Parsing a number</div>
<div class="content">
<div class="paragraph">
<p>When you read in a number using an object of the <code>Scanner</code> class, it
converts (or <em>parses</em>) the text entered by the user into the appropriate
type. For example, the <code>nextDouble()</code> method reads in some text and
convert it into a <code>double</code>. When you use a <code>JOptionPane</code> method to read
in input, it comes in as a <code>String</code>. If you want to use that data as a
<code>double</code>, you must convert it using the <code>Double.parseDouble()</code> static
method. Some Java programmer had to write this method. We are going to
recreate a similar method to convert the <code>String</code> representation of a
floating point number into a <code>double</code>. Our simple method ignores
scientific notation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span> <span class="tok-nf">parseDouble</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-kt">boolean</span> <span class="tok-n">negative</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
    <span class="tok-kt">double</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
    <span class="tok-kt">double</span> <span class="tok-n">fraction</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;-&#39;</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">negative</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
        <span class="tok-n">i</span><span class="tok-o">++;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;+&#39;</span> <span class="tok-o">)</span>
        <span class="tok-n">i</span><span class="tok-o">++;</span>
    <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;.&#39;</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">temp</span> <span class="tok-o">*=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
        <span class="tok-n">temp</span> <span class="tok-o">+=</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">-</span> <span class="tok-sc">&#39;0&#39;</span><span class="tok-o">;</span>
        <span class="tok-n">i</span><span class="tok-o">++;</span>
    <span class="tok-o">}</span>
    <span class="tok-n">i</span><span class="tok-o">++;</span> <span class="tok-c1">//move past decimal point (if there)</span>
    <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">temp</span> <span class="tok-o">+=</span> <span class="tok-o">(</span><span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">-</span> <span class="tok-sc">&#39;0&#39;</span><span class="tok-o">)</span> <span class="tok-o">/</span> <span class="tok-n">fraction</span><span class="tok-o">;</span>
        <span class="tok-n">fraction</span> <span class="tok-o">*=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
        <span class="tok-n">i</span><span class="tok-o">++;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">negative</span> <span class="tok-o">)</span>
        <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-n">temp</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After declaring a few variables, this method first checks index <code>0</code> in
the input <code>String</code> <code>value</code> to see if it is a <code>'-'</code> or a <code>'+'</code>. If it is
a <code>'-'</code>, it sets <code>negative</code> to <code>true</code> and moves on. If it is a <code>'+'</code>, it
simply moves on. Then, the method loops through <code>value</code> until it reaches
the end or reaches a decimal point. As it iterates, it multiplies the
current value of <code>temp</code> by 10 and adds in the next digit from <code>value</code>
(after subtracting <code>'0'</code> so that the range is is from 0 to 9). This
repetitive multiplication by 10 accounts for the increasing powers of 10
in the base 10 number system. Since <code>temp</code> starts with a value of <code>0.0</code>,
the first multiplication has no effect, as intended.</p>
</div>
<div class="paragraph">
<p>After the first <code>while</code> loop, the index <code>i</code> is incremented once, to skip
the decimal point, if there is one. If there is no decimal point, the
loop must have exited because the end of <code>value</code> had been reached. The
second <code>while</code> loop runs to the end of <code>value</code>, this time adding in each
digit value divided by <code>fraction</code>, which is increased by a factor of 10
each time. Doing so allows us to add smaller and smaller fractional
digits to the total. We set <code>temp</code> to its opposite if the flag
<code>negative</code> was set earlier and finally return <code>temp</code>.</p>
</div>
<div class="paragraph">
<p>You should note that the real <code>Double.parseDouble()</code> method not only
accepts <code>String</code> values in scientific notation but also does a great
deal of error checking. Our code either crashes or gives inaccurate
results on an empty <code>String</code>, a <code>String</code> containing non-numerical
characters, or a <code>String</code> with more than one decimal point. Furthermore,
this code does not use the best approach for minimizing floating-point
precision errors.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_three_card_poker">8.5. Solution: Three card poker</h3>
<div class="paragraph">
<p>Here we present our solution to the three card poker problem. We explain
each method individually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ThreeCardPoker</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">SUITS</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-s">&quot;Spades&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Hearts&quot;</span><span class="tok-o">,</span>
<span class="lineno"> 3 </span>		<span class="tok-s">&quot;Diamonds&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Clubs&quot;</span><span class="tok-o">};</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">RANKS</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-s">&quot;2&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;3&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;4&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;5&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;6&quot;</span><span class="tok-o">,</span>
<span class="lineno"> 5 </span>		<span class="tok-s">&quot;7&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;8&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;9&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;10&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Jack&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Queen&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;King&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Ace&quot;</span><span class="tok-o">};</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">STRAIGHT_FLUSH</span> <span class="tok-o">=</span> <span class="tok-mi">40</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">THREE_OF_A_KIND</span> <span class="tok-o">=</span> <span class="tok-mi">30</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">STRAIGHT</span> <span class="tok-o">=</span> <span class="tok-mi">6</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">FLUSH</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">PAIR</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">NOTHING</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Before our <code>main()</code> method even begins, we have declared a number of
class constants. Two constant arrays of <code>String</code> values provide us with
an easy way to represent suits and ranks. The remaining six <code>int</code>
constants are used to allocate a winning payoff to each possible
outcome. Note that these constants can be declared anywhere inside the
class, provided that they are outside of all methods. However, it is
typical (and good style) to declare them at the top of the class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">deck</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">52</span><span class="tok-o">];</span>
<span class="lineno"> 3 </span>		<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">hand</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">];</span>
<span class="lineno"> 4 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">deck</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>			<span class="tok-n">deck</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-n">shuffle</span><span class="tok-o">(</span> <span class="tok-n">deck</span> <span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">hand</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>			<span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">deck</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">int</span> <span class="tok-n">winnings</span> <span class="tok-o">=</span> <span class="tok-n">score</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Hand: &quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-n">print</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">winnings</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You win nothing.&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>		<span class="tok-k">else</span>
<span class="lineno">15 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You win &quot;</span> <span class="tok-o">+</span> <span class="tok-n">winnings</span> <span class="tok-o">+</span>
<span class="lineno">16 </span>			<span class="tok-s">&quot; times your bet.&quot;</span><span class="tok-o">);</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>main()</code> method, an array representing a deck of 52 cards is
created first, followed by an array representing the 3 cards to be
dealt. The deck is filled sequentially and then shuffled with a method.
Next, the first 3 cards of the deck are copied into the array
representing the hand of cards. The score of the hand is determined, and
then the hand is printed out. We print the hand after determining the
score because the hand is sorted in the process of determining the
score, making the output easier to read. Finally, we print the
appropriate output, depending on the score.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">shuffle</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">deck</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>		<span class="tok-kt">int</span> <span class="tok-n">index</span><span class="tok-o">,</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">3 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">deck</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>			<span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)((</span><span class="tok-n">deck</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-n">i</span><span class="tok-o">)*</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">());</span>
<span class="lineno">5 </span>			<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">deck</span><span class="tok-o">[</span><span class="tok-n">index</span><span class="tok-o">];</span>
<span class="lineno">6 </span>			<span class="tok-n">deck</span><span class="tok-o">[</span><span class="tok-n">index</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">deck</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno">7 </span>			<span class="tok-n">deck</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">8 </span>		<span class="tok-o">}</span>
<span class="lineno">9 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This method shuffles the deck. Its approach is to swap the first element
in the array of cards with one of the elements that follow, chosen
randomly. Then, it swaps the second element in the array with any of the
elements that follow it, and so on. If <code>Math.random()</code> truly gives us a
uniformly generated random number in the range \([0,1)\), the
final shuffled deck should be any one of the \(52!\) possible
decks with equal probability.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">hand</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">hand</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">3 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">RANKS</span><span class="tok-o">[</span><span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">])]</span> <span class="tok-o">+</span> <span class="tok-s">&quot; of &quot;</span>
<span class="lineno">4 </span>			<span class="tok-o">+</span> <span class="tok-n">SUITS</span><span class="tok-o">[</span><span class="tok-n">getSuit</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">])]);</span>
<span class="lineno">5 </span>	<span class="tok-o">}</span>
<span class="lineno">6 </span>
<span class="lineno">7 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">getRank</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">value</span> <span class="tok-o">%</span> <span class="tok-mi">13</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">8 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">getSuit</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">value</span> <span class="tok-o">/</span> <span class="tok-mi">13</span><span class="tok-o">;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first of these methods prints out a human readable version of each
card in an array (instead of 0 - 51). It does so using the second and
third methods as helper methods. Method <code>getRank()</code> computes the rank of
a card from its number, and method <code>getSuit()</code> computes the suit of a
card from its number. The indexes obtained from these methods are used
to index into the <code>RANKS</code> and <code>SUITS</code> arrays.</p>
</div>
<div class="paragraph">
<p>In the C language, calling a method from a method defined earlier
required a special declaration step called <em>prototyping</em> before both
methods. Java does not have this complication, and the <code>getRank()</code> and
<code>getSuit()</code> methods compile and function perfectly if they are written
above <code>print()</code> or below it inside the class definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">score</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">hand</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-n">sortByRank</span><span class="tok-o">(</span> <span class="tok-n">hand</span> <span class="tok-o">);</span>
<span class="lineno"> 3 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">hasStraight</span><span class="tok-o">(</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">hasFlush</span><span class="tok-o">(</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno"> 4 </span>			<span class="tok-k">return</span> <span class="tok-n">STRAIGHT_FLUSH</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">hasThree</span><span class="tok-o">(</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>			<span class="tok-k">return</span> <span class="tok-n">THREE_OF_A_KIND</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">hasStraight</span><span class="tok-o">(</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>			<span class="tok-k">return</span> <span class="tok-n">STRAIGHT</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">hasFlush</span><span class="tok-o">(</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">10 </span>			<span class="tok-k">return</span> <span class="tok-n">FLUSH</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">hasPair</span><span class="tok-o">(</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">12 </span>			<span class="tok-k">return</span> <span class="tok-n">PAIR</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-k">return</span> <span class="tok-n">NOTHING</span><span class="tok-o">;</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This method computes the score by first sorting the hand and then
testing progressively worse outcomes, starting with the best, a straight
flush. As it moves down the list of outcomes, it calls appropriate
methods to determine if a hand has a certain characteristic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">sortByRank</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-kt">int</span> <span class="tok-n">smallest</span><span class="tok-o">,</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">hand</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			<span class="tok-n">smallest</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">hand</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-n">j</span><span class="tok-o">])</span> <span class="tok-o">&lt;</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-n">smallest</span><span class="tok-o">])</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>					<span class="tok-n">smallest</span> <span class="tok-o">=</span> <span class="tok-n">j</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>			<span class="tok-o">}</span>
<span class="lineno"> 9 </span>			<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-n">smallest</span><span class="tok-o">];</span>
<span class="lineno">10 </span>			<span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-n">smallest</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno">11 </span>			<span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-o">}</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code is an implementation of selection sort packaged into a method.
Note that this method does actually change the values inside of the
array <code>hand</code> even though it cannot change the array that <code>hand</code> points
to. The array itself is passed by value, but its contents are
effectively passed by reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasPair</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-k">return</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])</span> <span class="tok-o">||</span>
<span class="lineno"> 3 </span>		       <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]);</span>
<span class="lineno"> 4 </span>	<span class="tok-o">}</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasThree</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-k">return</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])</span> <span class="tok-o">&amp;&amp;</span>
<span class="lineno"> 8 </span>		       <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]);</span>
<span class="lineno"> 9 </span>	<span class="tok-o">}</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasFlush</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>		<span class="tok-k">return</span> <span class="tok-n">getSuit</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-n">getSuit</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])</span> <span class="tok-o">&amp;&amp;</span>
<span class="lineno">13 </span>		       <span class="tok-n">getSuit</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-n">getSuit</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]);</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasStraight</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">hand</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>		<span class="tok-k">return</span> <span class="tok-o">(</span><span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
<span class="lineno">18 </span>				<span class="tok-o">&amp;&amp;</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">||</span> <span class="tok-c1">//ace low</span>
<span class="lineno">19 </span>		       <span class="tok-o">(</span><span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">])</span> <span class="tok-o">+</span> <span class="tok-mi">1</span> <span class="tok-o">&amp;&amp;</span>
<span class="lineno">20 </span>		        <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">])</span> <span class="tok-o">==</span> <span class="tok-n">getRank</span><span class="tok-o">(</span><span class="tok-n">hand</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">])</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
<span class="lineno">21 </span>	<span class="tok-o">}</span>
<span class="lineno">22 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These four methods do the actual work of determining the attributes of a
hand. They are all similar and would be more complex for five- or
seven-card poker hands. Methods <code>hasPair()</code> and <code>hasStraight()</code> depend
on the array being sorted previously. The code in <code>hasPair()</code> works by
checking to see if the first and second or second and third cards have
the same rank. The code in <code>hasThree()</code> checks to see if all the ranks
are the same. The code in <code>hasFlush()</code> is the same as <code>hasThree()</code>
except that it checks for suit instead of rank. Finally, <code>hasStraight()</code>
checks to see if the ranks are all in ascending order, with an extra
case to deal with the possibility of the ace counting as low.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_methods">8.6. Concurrency: Methods</h3>
<div class="paragraph">
<p>In Java, it is impossible to have concurrency without methods. Methods
are the way we break a large program into manageable pieces but are also
part of the syntax that Java uses to create threads of execution. Each
thread of execution is associated with a <code>Thread</code> object, but creating
the object is not enough to start a new thread of execution running.
Only when the <code>start()</code> method is called on the <code>Thread</code> object does the
new thread start running.</p>
</div>
<div class="paragraph">
<p>Hopefully, you have begun to visualize the execution of Java programs as
an arrow that sits next to each line of code as it is executed. This
arrow can jump to a choice and skip over other code using <code>if</code> and
<code>switch</code> statements. Using loops, the arrow can jump backwards and
repeatedly execute code it has just executed. As we have discussed in
this chapter, it can jump into a method, execute the code in that
method, and then return to its caller, going back right to where it left
off before the call.</p>
</div>
<div class="paragraph">
<p>When the <code>start()</code> method is called on a <code>Thread</code> object, however, the
arrow returns to the caller, but it also splits itself into a second
arrow that then executes the corresponding <code>run()</code> method and any
methods it calls. Note that we are talking about a method called on a
<code>Thread</code> object, not a static method called on the class as a whole.
Calling <code>start()</code> is an instance method, which we discuss in
<a href="#_classes">Chapter 9</a>. Unlike the static methods we have discussed
in this chapter, an instance method is tied to a particular object, but
most of what you have learned about methods still applies.</p>
</div>
<div class="paragraph">
<p>Methods are supposed to make programming easier by breaking programs
into chunks small enough to think about. One of the only real dangers of
methods is using class variables, as discussed in
<a href="#_class_variables">Section 8.3.3</a>. This problem becomes worse with
multiple threads. With a single thread, two or more different methods
can all affect the same class variable, perhaps in conflicting ways.
With multiple threads, even the <strong>same</strong> method can interfere with itself.</p>
</div>
<div class="exampleblock">
<div class="title">Example 81. LCG without thread safety</div>
<div class="content">
<div class="paragraph">
<p>A linear congruential generator (LCG) allows you to create a sequence of
pseudorandom numbers using the equation
\(x_i=(ax_{i-1}+b)\mod m\), deriving the next number from the
previous one, and so on.</p>
</div>
<div id="UnsafeRandomProgram" class="listingblock">
<div class="title">Program 40. Implements an LCG similar to one sometimes used in the function <code>rand()</code> used in the C language.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UnsafeRandom</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">next</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kd">final</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">A</span> <span class="tok-o">=</span> <span class="tok-mi">1103515245</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kd">final</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">B</span> <span class="tok-o">=</span> <span class="tok-mi">12345</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kd">final</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">M</span> <span class="tok-o">=</span> <span class="tok-mi">32768</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">nextInt</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-k">return</span> <span class="tok-n">next</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">A</span><span class="tok-o">*</span><span class="tok-n">next</span> <span class="tok-o">+</span> <span class="tok-n">B</span><span class="tok-o">)</span> <span class="tok-o">%</span> <span class="tok-n">M</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>	<span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>UnsafeRandom</code> program listed above always generates the same
sequence of pseudorandom numbers, which can be very useful for debugging
a program. However, if two or more threads are calling <code>nextInt()</code>, they
probably are getting different sequences. One thread picks up some of
the numbers, and the other picks up the missing numbers in between. If
each thread wants to generate the same sequence of numbers, the method
should be rewritten so that it takes in the previous number in the
sequence. In that way, there is no shared state. Remember that using a
(non-final) static field (class variable) should be avoided whenever
possible.</p>
</div>
<div id="SafeRandomProgram" class="listingblock">
<div class="title">Program 41. Implements the same LCG safely by requiring the caller to supply the previous random number.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SafeRandom</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">final</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">A</span> <span class="tok-o">=</span> <span class="tok-mi">1103515245</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">private</span> <span class="tok-kd">final</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">B</span> <span class="tok-o">=</span> <span class="tok-mi">12345</span><span class="tok-o">;</span>
<span class="lineno">4 </span>	<span class="tok-kd">private</span> <span class="tok-kd">final</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">M</span> <span class="tok-o">=</span> <span class="tok-mi">32768</span><span class="tok-o">;</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">nextInt</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">previous</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">7 </span>		<span class="tok-k">return</span> <span class="tok-o">(</span><span class="tok-n">A</span><span class="tok-o">*</span><span class="tok-n">previous</span> <span class="tok-o">+</span> <span class="tok-n">B</span><span class="tok-o">)</span> <span class="tok-o">%</span> <span class="tok-n">M</span><span class="tok-o">;</span>
<span class="lineno">8 </span>	<span class="tok-o">}</span>
<span class="lineno">9 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 82. Unpredictable methods</div>
<div class="content">
<div class="paragraph">
<p>By forcing each thread to carry its own state, we fixed the previous
problem. In <a href="#_synchronization">Chapter 14</a> we talk about the much
nastier problem of two threads executing a method at exactly the same
time. When that happens, very curious effects are possible. Consider the
following program:</p>
</div>
<div id="AlwaysEvenProgram" class="listingblock">
<div class="title">Program 42. The <code>print()</code> method always prints <code>"Even"</code> when run with a single thread but can sometimes print <code>"Odd"</code> if called repeatedly with multiple threads.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AlwaysEven</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">value</span><span class="tok-o">++;</span>
<span class="lineno"> 6 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Even&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-k">else</span>
<span class="lineno"> 9 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Odd&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-n">value</span><span class="tok-o">++;</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span>
<span class="lineno">12 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With a single thread running, <code>value</code> always goes up to an even number
before printing and then increments to the next odd number afterwards.
If two or more threads are calling the <code>print()</code> method, <code>value</code> could
be changed by one right before the other executes the <code>if</code> statements.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_8">8.7. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise8.1"></a> Describe three advantages of dividing long segments of code into
static methods.</p>
</li>
<li>
<p><a id="exercise8.2"></a> Can you think of any disadvantages of dividing code into methods?
Are there situations where using a method is unwise?</p>
</li>
<li>
<p><a id="exercise8.3"></a> If you wanted to declare a static method that would compute the
mean, median, and standard deviation of an input array of <code>double</code>
values, how would you return those three answers?</p>
</li>
<li>
<p><a id="exercise8.4"></a> Consider the following method definition.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">twice</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">2</span> <span class="tok-o">*</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>How many times does the following loop run, and why?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">x</span> <span class="tok-o">&lt;</span> <span class="tok-mi">128</span> <span class="tok-o">)</span>
    <span class="tok-n">twice</span><span class="tok-o">(</span><span class="tok-n">x</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise8.5"></a> Consider the following signatures of two overloaded methods.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">magic</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">rabbit</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">hat</span> <span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">magic</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">wand</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">spell</span> <span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which method would be invoked by the following call?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">magic</span><span class="tok-o">(</span> <span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">16</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What about the following?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-n">magic</span><span class="tok-o">(</span> <span class="tok-mf">3.2</span><span class="tok-o">,</span> <span class="tok-mf">16.4</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use a compiler to check your answers.</p>
</div>
</li>
<li>
<p><a id="exercise8.6"></a> The following class generates a sequence of even numbers. Each time
the <code>next()</code> method is called, the next even number in the sequence is
returned. What is the design problem with using a static field to keep
track of the next value in the sequence?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EvenNumbers</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">next</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">counter</span> <span class="tok-o">+=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
        <span class="tok-k">return</span> <span class="tok-n">counter</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise8.7"></a> Write a static method called <code>cube()</code> that takes a single <code>double</code>
value as a parameter and returns its value cubed. Do not use the
<code>Math.pow()</code> method.</p>
</li>
<li>
<p><a id="exercise8.8"></a> Implement a static method that takes a single <code>int</code> value as a
parameter and prints its digits in reverse. For example, if <code>103</code> was
passed into this method, it would print <code>301</code> to the screen.</p>
<div class="paragraph">
<p>You can find out what digit is in the ones place of a number by taking
its remainder modulus 10. Then, you can remove the digit in the ones
place by dividing by 10. Do not convert the <code>int</code> value into a <code>String</code>.</p>
</div>
</li>
<li>
<p><a id="exercise8.9"></a> Write a static method that takes an array of <code>int</code> values as a
parameter and returns <code>true</code> if the array is in ascending order and
<code>false</code> otherwise. Compare each element of the array to the next element
of the array. If the current element is ever larger than the next
element, the array is not sorted in ascending order. Note that you can
only be sure that the array is in ascending order after you have checked
all neighboring pairs.</p>
</li>
<li>
<p><a id="exercise8.10"></a> Write a static method that finds the
\(\lfloor\log_2(n)\rfloor\) of an integer \(n\).
Note that if \(\log_2 n = x\), it is also true that
\(n = 2^x\). In other words, the \(\log_2\) operator
tells you what power of \(2\) a number is. One way to define
the \(\log_2 n\) is the number of times you have to divide
\(n\) by \(2\) to get \(1\). Use this
definition to make a loop that finds the value without using any calls
to the <code>Math</code> library.</p>
<div class="paragraph">
<p>Here are some examples of the return values your method should give for
various input values of \(n\).</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">\(n\)</th>
<th class="tableblock halign-center valign-top">Return Value</th>
<th class="tableblock halign-center valign-top">\(n\)</th>
<th class="tableblock halign-center valign-top">Return Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">512</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><a id="exercise8.11"></a> Write a method that tests palindromes like
the method from <a href="#palindromeTestingExample">Example 79</a> but also ignores
punctuation and spaces. Thus, <code>"A man, a plan, a canal: Panama"</code> should
be counted as a palindrome by this new method.</p>
</li>
<li>
<p><a id="exercise8.12"></a> Re-implement the solution from <a href="#_solution_three_card_poker">Section 8.5</a>
so that it uses a GUI constructed with <code>JOptionPane</code> to display the hand
and the winnings.</p>
</li>
<li>
<p><a id="exercise8.13"></a> Five card poker is a much more common version of poker than the
three card version we discussed in <a href="#_problem_three_card_poker">Section 8.1</a>.
Using static methods, implement a two-player game of poker in which the
deck is shuffled and then dealt into two hands of five cards each. Then,
state which player&#8217;s hand wins. With five cards, determining which hand
wins is a more complicated process. The rankings of the various possible
hands from best to worst are as follows.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>All five cards belong to the same suit and have ranks in sequential
order (with either ace high or low). If two people both have straight
flushes, the higher ranked one wins. If they both have the same ranks,
it is a tie.</p>
</li>
<li>
<p>Four of the five cards have the same rank. If two people have four
of a kind, the higher rank set of four wins.</p>
</li>
<li>
<p>Three of the five cards have the same rank and the other two share
another rank. If two people have a full house, the higher ranked set of
three wins.</p>
</li>
<li>
<p>All five cards have the same suit. If two people have flushes, the
one with the highest card wins. If the highest card is a tie, the next
highest is the tie breaker, and so on. If the two flushes have exactly
the same ranks, the two flushes tie.</p>
</li>
<li>
<p>All five cards have ranks in sequential order (with either ace high
or low). If two people both have straight flushes, the higher ranked one
wins. If they both have the same ranks, it is a tie.</p>
</li>
<li>
<p>Three of the cards have the same rank. If two people have three of a
kind, the higher ranked set of three wins.</p>
</li>
<li>
<p>A pair of cards have the same rank and another pair of cards share
another rank. If two people both have two pairs, the higher ranked pair
is a tiebreaker. If the higher ranked pair is the same, the lower ranked
pair is a tiebreaker. If the lower ranked pair is the same, the final
unpaired card is the tiebreaker. If all the ranks of both hands match,
it is a tie.</p>
</li>
<li>
<p>A pair of cards has the same rank. If two people have pairs, the
rank of the pair is a tiebreaker. If the pairs have the same rank, the
remaining cards in each hand are tiebreakers, in descending rank order.</p>
</li>
<li>
<p>If none of the other cases hold, the high card determines the value
of the hand. If two people have the same highest card, the remaining
cards in each hand are used as tiebreakers, in descending rank order.</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise8.14"></a> In terms of time, there is a small overhead associated with calling
a method and returning a value, but it is very hard to measure. Write a
program with two <code>int</code> variables, <code>a</code> and <code>b</code>, where <code>a</code> starts with a
value of <code>1</code> and <code>b</code> starts with a value of <code>2</code>. Run a <code>for</code> loop
100,000,000 times. On each iteration first increase the value of <code>a</code> by
the value of <code>b</code> and then increase the value of <code>b</code> by <code>a</code>. Time this
loop with <code>System.nanoTime()</code> and then print out the time taken and the
value of <code>a</code>. The value of <code>a</code> is not important, but the compiler will
optimize away the math done with <code>a</code> and <code>b</code> unless we output the value.
We recommend that you run this program repeatedly to get a sense of the
average running time.</p>
<div class="paragraph">
<p>Now, instead of using the <code>+</code> operator to add <code>a</code> and <code>b</code>, use the
following method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">add</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">b</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, run your program repeatedly with this modification. What is the
difference in running time between the version that uses a method and
the version that does addition directly?</p>
</div>
<div class="paragraph">
<p>Depending on your JVM, it&#8217;s quite possible that there&#8217;s almost no
difference. The JVM does a lot of optimizations including <em>inlining</em>,
which replaces a call to a method with the actual code inside the
method.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_classes">9. Classes</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Luminous beings are we, not this crude matter.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Yoda
</div>
</div>
<div class="sect2">
<h3 id="_problem_nested_expressions">9.1. Problem: Nested expressions</h3>
<div class="paragraph">
<p>How does the compiler check the Java code that you write and find
errors? Syntax checking and type checking are involved processes that
are key parts of compiler design. Compilers are some of the most complex
programs of any kind, and building one is beyond the scope of the
material covered in this book. However, we can get insight into some
problems faced by compiler designers by considering the problem of
correctly nested expressions.</p>
</div>
<div class="paragraph">
<p>There are many rules for forming correct Java code, but it is always the
case that grouping symbols (<code>(</code>, <code>)</code>, <code>[</code>, <code>]</code>, <code>{</code>, <code>}</code>) are correctly
nested. Ignoring other symbols, we may find a section of code that
contains the sequence <code>"( ) [ ]"</code>, but correctly written code never
contains <code>"( [ ) ]"</code>.</p>
</div>
<div class="paragraph">
<p>To be correctly nested, left and right parentheses must be balanced,
left and right square brackets must be balanced, and left and right
curly braces must be balanced. Furthermore, a correctly balanced set of
parentheses can be nested inside of a correctly balanced set of square
brackets or curly braces (and vice versa), but they cannot intersect as
they do at the end of the previous paragraph. The table below shows more examples of correctly and incorrectly nested
expressions.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Correctly Nested</th>
<th class="tableblock halign-left valign-top">Incorrectly Nested</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>""</pre></div></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>"("</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>"(){}"</pre></div></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>"}{"</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>"((abc)){x}"</pre></div></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>"( a { b ) c }"</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>"({[z]})"</pre></div></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>"{abc("</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>"({xyz})({ijk}[123])"</pre></div></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>"{(333)888(})"</pre></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>But how can we examine an expression to see if it is correctly nested?
The key to solving this problem is the idea of a <em>stack</em>. A stack is a
simple data structure with three operations: <em>push</em>, <em>pop</em>, and <em>top</em>.
The data structure is meant to behave like a stack of books or cups or
any other physical objects. When you use the push operation, you are
moving something to the top of the stack. When you use the pop
operation, you are taking something off the top of the stack. The top
operation is used to read what is at the top of the stack. In a stack,
you can only read that very topmost item, as if all the other items were
buried underneath it. A stack is known as a FILO (first in, last out) or
a LIFO (last in, first out) data structure because, if you push a series
of items onto the stack and then pop them all off the stack, they come
off the stack in the reverse order from how they were added.</p>
</div>
<div class="paragraph">
<p>Armed with an understanding of the stack, it is straightforward to see
if an expression is nested correctly. Scan through each character in the
input and follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If it is a left parenthesis, left square bracket, or left curly
brace, put it on the stack.</p>
</li>
<li>
<p>If it is a right parenthesis, right square bracket, or right curly
brace, check that the top of the stack is its matching left half. If it
is, pop the left half off the stack. If it isn&#8217;t (or if the stack is
empty), the grouping symbols are either unbalanced or intersecting.
Print an error and quit.</p>
</li>
<li>
<p>For any character that isn&#8217;t a grouping symbol, ignore it and move
on.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you reach the end of input without an error, check to see if the
stack is empty. If it is, then all of the left grouping symbols have
been matched up with right grouping symbols. If not, there are left
symbols left on the stack, and the expression isn&#8217;t correctly nested.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_object_oriented_programming">9.2. Concepts: Object-oriented programming</h3>
<div class="paragraph">
<p>To solve the nested expressions problem, we need to create a stack data
structure. Each element of the stack should be able to hold a <code>char</code>
value term from an expression, where a term is an operator, operand, or
a parenthesis (bracket or curly brace). Although we could get by using
only the static methods we introduced in the previous chapter, a better
tool can make programming easier.</p>
</div>
<div class="paragraph">
<p>We are introducing these topics in a progression: First, all of our
programs were a series of sequential instructions inside of a <code>main()</code>
method. We added in selection statements and loops to solve more
difficult problems. As our programs became more complicated, we started
using additional static methods to divide the program into logical
segments. Now, we are moving to fully object-oriented programming (OOP)
in which data as well as code can be packaged into objects that interact
with each other.</p>
</div>
<div class="paragraph">
<p>OOP has been a controversial topic, particularly in the computer science
education community. The most important thing to remember is that we are
not throwing away any of the ideas we used before. We are continuing on
a path toward making code safer and more reusable. Several other
chapters in this book touch on important ideas in OOP such as
inheritance and polymorphism. Below, we are going to focus on the
basics, including the fundamentals of objects, encapsulation of data,
and instance (non-static) methods.</p>
</div>
<div class="sect3">
<h4 id="_objects">9.2.1. Objects</h4>
<div class="paragraph">
<p>You have already used objects, perhaps without realizing it. Every time
you use a <code>String</code>, you are using an object. So far, we have created a
class every time we have written a program. A class is a way to organize
static methods, but a class is something more: a template for objects.
Whenever you write a class, the potential to create specific objects
exists.</p>
</div>
<div class="paragraph">
<p>For a conceptual example, you can think of Human as a class and Albert
Einstein as an object (or an <em>instance</em>) of that class. The class
defines certain characteristics that all human beings have: name, date
of birth, height, and so on. Then, the object has specific values for
each one of those characteristics, such as Albert Einstein, March 14,
1879, 175, and so on.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/09-classes/images/class.svg" alt="class" width="100%">
</div>
<div class="title">Figure 37. Example of a class serving as a template for an object.</div>
</div>
<div class="paragraph">
<p>This idea of a class as a template is key because it means that an
object of a given type (from a given class) can be used anywhere that is
appropriate for another object of that type. Later in the chapter, we
create an object that performs the work of a stack, storing a number of
other objects. If we design a library of code that can manipulate or use
stack objects, we should be able to use this library countless times for
countless different stack objects without changing the code. This kind
of code reuse is one of the main goals of OOP.</p>
</div>
</div>
<div class="sect3">
<h4 id="_encapsulation">9.2.2. Encapsulation</h4>
<div class="paragraph">
<p>In order to guarantee that objects can be used in many different
contexts safely, the data inside of the object must be protected. Java
provides access modifiers so that code without appropriate permission
cannot change or even read the data inside of an object.</p>
</div>
<div class="paragraph">
<p>This feature is called <em>encapsulation</em>. One programmer may write the
class file defining a type of object while another or many others write
code that uses those objects. The programmers who use objects written by
others do not need to understand the inner workings of those objects.
Instead, they can treat each object as a &#8220;black box&#8221; with a list of
actions that the object can do. Each action has a certain specified
input and a certain specified output, but the internal functioning of
the object is hidden.</p>
</div>
</div>
<div class="sect3">
<h4 id="_instance_methods">9.2.3. Instance methods</h4>
<div class="paragraph">
<p>These &#8220;actions&#8221; are methods, but not static ones. Static methods did
not need an object in order to be called. Regular (instance) methods
should be thought of as an action performed on (or by) a specific
object. This action could be asking a question, such as inquiring what
the name of an object of type <code>Human</code> is. This action could be telling the
object to change itself, such as the case of pushing something onto a
stack.</p>
</div>
<div class="paragraph">
<p>One of the broadest definitions of an object is a collection of data and
methods to access that data. We call the data inside of an object its
<em>fields</em> or instance data and the methods to access them <em>instance
methods</em>. Static methods are used primarily to modularize large blocks
of code into smaller functional units. However, instance methods are
tightly coupled to the fields of an object and perform tasks that change
the object or get information from it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_classes_in_java">9.3. Syntax: Classes in Java</h3>
<div class="paragraph">
<p>OOP concepts such as encapsulation may seem esoteric until you see them
in practice. Remember, we just want to create some private data and then
define a few carefully controlled ways that the data can be manipulated.
First, we&#8217;ll describe how to declare fields, then explain how to write
instance methods to manipulate that data, and finally give more details
about protecting its privacy.</p>
</div>
<div class="sect3">
<h4 id="_fields">9.3.1. Fields</h4>
<div class="paragraph">
<p>Fields in an object must be declared like any other data in Java. The
type of a piece of data can be a primitive or reference type. Fields are
also sometimes called member variables. You declare fields just like you
would class variables, except without the <code>static</code> keyword. Here&#8217;s an
example with the <code>Human</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Human</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">DOB</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">height</span><span class="tok-o">;</span> <span class="tok-c1">//in cm</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this definition, a <code>Human</code> object has three attributes: <code>name</code>,
<code>DOB</code>, and <code>height</code>. Because the access modifier for each field is
<code>private</code>, code outside of this class cannot change or even read the
values. Note that this class cannot do anything yet. Also, note that
this class does not contain a <code>main()</code> method. There is no way to run
this class, but that&#8217;s fine. We can add a <code>main()</code> method, of course.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Human</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">DOB</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">height</span><span class="tok-o">;</span> <span class="tok-c1">//in cm</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Albert Einstein&quot;</span><span class="tok-o">;</span>
        <span class="tok-n">DOB</span> <span class="tok-o">=</span> <span class="tok-s">&quot;March 14, 1879&quot;</span><span class="tok-o">;</span>
        <span class="tok-n">height</span> <span class="tok-o">=</span> <span class="tok-mi">175</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have added a <code>main()</code> method, but our code does not compile.
Since the <code>main()</code> method is a static method, it is not associated with
any particular object. When we tell the <code>main()</code> method to change the
fields, it does not know what object we are talking about. If we
actually want to use an object, we&#8217;ll have to create one.</p>
</div>
<div id="HumanProgram" class="listingblock">
<div class="title">Program 43. Class encapsulating the attributes of a human being.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Human</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">DOB</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">height</span><span class="tok-o">;</span> <span class="tok-c1">//in cm</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-n">Human</span> <span class="tok-n">einstein</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Human</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-n">einstein</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Albert Einstein&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-n">einstein</span><span class="tok-o">.</span><span class="tok-na">DOB</span> <span class="tok-o">=</span> <span class="tok-s">&quot;March 14, 1879&quot;</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-n">einstein</span><span class="tok-o">.</span><span class="tok-na">height</span> <span class="tok-o">=</span> <span class="tok-mi">175</span><span class="tok-o">;</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span>
<span class="lineno">12 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code compiles because we have used the <code>new</code> keyword to create
an object of type <code>Human</code> saved in a reference variable called
<code>einstein</code>. With a <code>Human</code> object, we can set its fields using
dot notation. With static methods and static variables, we used the name
of the <strong>class</strong> followed by a dot, for instance methods and instance
variables, we use the name of the <strong>object</strong> followed by a dot. Even
though each of these fields is private, we can access them from <code>main()</code>
because <code>main()</code> is inside the <code>Human</code> class. Code inside of another
class could create a new <code>Human</code> object, but it could not change its
fields.</p>
</div>
<div class="paragraph">
<p>This juxtaposition of static and non-static fields and methods inside of
a single class is confusing to many new Java programmers. The confusion
seems to stem from the fact that the class (such as <code>Human</code>) is a
template for objects but it is also a place to house other related code,
such as static methods, including <code>main()</code>.</p>
</div>
<div class="paragraph">
<p>Although the practice is discouraged, we mentioned in
<a href="#_class_variables">Section 8.3.3</a> that class variables can be
stored in the class itself. Every object has a distinct copy of each
field, but there is only a single copy of each class variable that they
all share. By using the keyword <code>static</code>, we could add a class variable
called <code>population</code> to our <code>Human</code> class, since that is information
connected to humans as a whole, not to any individual human being.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Human</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">DOB</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">height</span><span class="tok-o">;</span> <span class="tok-c1">//in cm</span>
    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span> <span class="tok-n">population</span> <span class="tok-o">=</span> <span class="tok-mf">7.023E9</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are using a <code>double</code> to represent the world&#8217;s population since the
value is too big to fit in an <code>int</code> and is easily expressed in
scientific notation. If several <code>Human</code> objects were created, they would
have their own <code>name</code>, <code>DOB</code>, and <code>height</code> values, but the value for
<code>population</code> would only be stored in the class.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/09-classes/images/staticvalue.svg" alt="staticvalue" width="100%">
</div>
<div class="title">Figure 38. Class variables (static fields) are stored with the class, not with individual objects.</div>
</div>
</div>
<div class="sect3">
<h4 id="_constructors">9.3.2. Constructors</h4>
<div class="paragraph">
<p>To create a new object, you have to invoke a <em>constructor</em>, a special
kind of method that can initialize the object. A constructor allows sets
up the values inside an object when it is first created. Let&#8217;s consider
a simple <code>Rectangle</code> class with only two fields: <code>length</code> and <code>width</code>,
both of type <code>int</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Rectangle</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">length</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">width</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One possible constructor for the class is given below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-nf">Rectangle</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">l</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">w</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">length</span> <span class="tok-o">=</span> <span class="tok-n">l</span><span class="tok-o">;</span>
        <span class="tok-n">width</span> <span class="tok-o">=</span> <span class="tok-n">w</span><span class="tok-o">;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This constructor lets us set the width and length when the object is
created. To do so, code could invoke the constructor using the <code>new</code>
keyword.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Rectangle</span> <span class="tok-n">rectangle</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Rectangle</span><span class="tok-o">(</span><span class="tok-mi">50</span><span class="tok-o">,</span> <span class="tok-mi">20</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code creates a new <code>Rectangle</code> object, with length 50 and width 20.
Constructors are almost always <code>public</code>, otherwise it would be
impossible for code outside of the <code>Rectangle</code> class to create a
<code>Rectangle</code> object. Notice that the definition of the <code>Rectangle</code>
constructor does not have a return type. A constructors is the only kind
of method that does not have a return type. It is possible to have more
than one constructor as well, just as other methods can be overloaded.
For more information about overloaded methods, refer back to
<a href="#subsubsection:Overloaded_methods">Section 8.3.1.2</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-nf">Rectangle</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">length</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
        <span class="tok-n">width</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the very same class, we could have this second constructor, allowing
us to quickly and easily create a square. All classes have constructors,
but some are not written explicitly. If you don&#8217;t type out a constructor
for a class, a default one is automatically created. The default
constructor takes no parameters and sets all the values inside the new
object to defaults such as <code>null</code> and <code>0</code>. Once you do create a
constructor, the default one is no longer provided. Thus, since our
definition of the <code>Rectangle</code> class already contains two constructors,
the following line would cause a compiler error if someone tries to use
it in their code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Rectangle</span> <span class="tok-n">defaultRectangle</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Rectangle</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another important thing to consider with all instance methods is scope.
Fields are visible inside of instance methods, but they can be hidden by
parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-nf">Rectangle</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">length</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">width</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">length</span> <span class="tok-o">=</span> <span class="tok-n">length</span><span class="tok-o">;</span>
        <span class="tok-n">width</span> <span class="tok-o">=</span> <span class="tok-n">width</span><span class="tok-o">;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of the two parameter <code>Rectangle</code> constructor compiles, but
it does not properly initialize the values of the fields <code>length</code> and
<code>width</code>. Instead, the parameters <code>length</code> and <code>width</code> are copied back
into themselves for no reason. The designers of Java anticipated that it
would be useful to refer to fields even in the presence of other
variables with the same name. To do so, the <code>this</code> keyword can be used.
Any field (or method) can be referred to by its object name, followed by
a dot, followed by the name of that field or method. Since you don&#8217;t
have a variable name to reference the object when you&#8217;re inside of it,
the <code>this</code> keyword acts as a reference to the object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-nf">Rectangle</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">length</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">width</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">=</span> <span class="tok-n">length</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">width</span> <span class="tok-o">=</span> <span class="tok-n">width</span><span class="tok-o">;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of the code functions correctly, since we have explicitly
told Java to store the argument <code>length</code> into the field <code>length</code> inside
the object pointed at by <code>this</code> and to do similarly for <code>width</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_methods_2">9.3.3. Methods</h4>
<div class="paragraph">
<p>Objects do not really come to life until you add instance methods. With
the <code>Rectangle</code> class described above, any <code>Rectangle</code> objects created
are not useful in other classes because it is impossible to access their
data. Instead, we want to create a clear and usable relationship between
the fields and the methods.</p>
</div>
<div class="paragraph">
<p>There are many different kinds of methods, but two of the most important
are accessors and mutators.</p>
</div>
<div class="sect4">
<h5 id="_accessors">Accessors</h5>
<div class="paragraph">
<p>We often want to read the data inside of various the objects. With our
current definition of <code>Rectangle</code>, no code from an outside class can
find out the length or width of the rectangle we are representing.</p>
</div>
<div class="paragraph">
<p><em>Accessor methods</em> (or simply <em>accessors</em>) are designed for this task.
By definition, an accessor allows us to read some data or get some
information out of an object without making any changes to its fields.
Accessors can be thought of as asking the object a question. The names
of accessors often start with the word <code>get</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getLength</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">length</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getWidth</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">width</span><span class="tok-o">;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are two accessors methods that we would expect in the <code>Rectangle</code>
class. The first returns the value of <code>length</code>, and the second returns
the value of <code>width</code>. These methods only report information. They do not
change the value of either variable. Their syntax should be
self-explanatory. Each is declared to be <code>public</code> so that anyone can
read the length and width of a rectangle. Both methods have a return
type of <code>int</code> because that is the type used to store <code>length</code> and
<code>width</code> inside a <code>Rectangle</code> object. Neither method has any parameters.
An accessor does not have to be so simple. An accessor could return a
value that needs to be computed from the underlying field data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getArea</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">length</span><span class="tok-o">*</span><span class="tok-n">width</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getPerimeter</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">length</span> <span class="tok-o">+</span> <span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">width</span><span class="tok-o">;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These accessors compute the area and perimeter, respectively, of the
rectangle in question, even though that data is not stored directly in
the <code>Rectangle</code> object.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mutators">Mutators</h5>
<div class="paragraph">
<p>Some objects, such as <code>String</code> values, are <em>immutable</em> objects, meaning
that the data stored inside them cannot be changed after they have been
created with a constructor. If you have ever thought that you were
changing a <code>String</code>, you were actually creating a new <code>String</code> with the
appropriate modifications. Most objects are mutable, however, and we use
methods called <em>mutator methods</em> (or simply <em>mutators</em>) to change their
fields.</p>
</div>
<div class="paragraph">
<p>Like accessors, mutators have no special syntax. The term is used to
describe any methods that change the data inside of an object. For the
<code>Rectangle</code> class, the only internal data we have is the <code>length</code> and
<code>width</code> variables. Mutators for these might look as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setLength</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">length</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">=</span> <span class="tok-n">length</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setWidth</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">width</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">width</span> <span class="tok-o">=</span> <span class="tok-n">width</span><span class="tok-o">;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as the names for many accessors begin with <code>get</code>, the names for
many mutators begin with <code>set</code>. Mutators often have a <code>void</code> return type
because they are changing the object, not getting information back. Some
mutators might have a return type that gives information about an error
that occurred while trying to make a change. Note that we used the
<code>this</code> keyword once again to distinguish each field from the method
argument with the same name.</p>
</div>
<div class="paragraph">
<p>You may have noticed that we use the machinery of a method to both get
and set the <code>length</code> field, for example. Perhaps doing so seems
needlessly complex. After all, if the <code>length</code> variable had been
declared with the <code>public</code> modifier instead of the <code>private</code> modifier,
we could get and set its value directly, without using methods. In
response, let&#8217;s improve the mutators that set <code>length</code> and <code>width</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setLength</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">length</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">length</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">=</span> <span class="tok-n">length</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setWidth</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">width</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">width</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">width</span> <span class="tok-o">=</span> <span class="tok-n">width</span><span class="tok-o">;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With these better mutators, we can prevent a user from setting the
values of <code>length</code> and <code>width</code> to negative numbers or zero, values that
don&#8217;t make sense for dimensions of a rectangle. For more complicated
objects, it becomes even more important to protect the values of the
fields from malicious or mistaken users.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="subsection:Access_modifiers">9.3.4. Access modifiers</h4>
<div class="paragraph">
<p>Hiding data is at the heart of the Java OOP model. There are four
different levels of access that can be applied to fields and methods,
whether static or not. They are <code>public</code>, <code>private</code>, <code>protected</code>, and
package-private.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>public</code> modifier</dt>
<dd>
<p>The <code>public</code> access modifier states that a variable or method can be
accessed by any code, no matter what class contains it. Most methods
should be <code>public</code> so that they can be used freely to interact with
their object. Virtually no fields should be <code>public</code>. Constants (static
or otherwise) are the most significant exception to this rule. Making
constants <code>public</code> is usually not a problem since they cannot be changed
by outside code anyway. In the <code>Rectangle</code> class, variables <code>length</code> and
<code>width</code> are so simple that making them <code>public</code> is not unreasonable. If
you have a field that can be changed at any time by any code to any
value, you can leave that field <code>public</code>.</p>
</dd>
<dt class="hdlist1"><code>private</code> modifier</dt>
<dd>
<p>This modifier states that a variable or method cannot be accessed by any
code unless the code is contained in the same class. It is important to
realize that the restriction is based on the <strong>class</strong>, not on the
<strong>object</strong>. Code inside any <code>Rectangle</code> object can modify <code>private</code> values
inside of any other <code>Rectangle</code> object or class. Most fields should be
<code>private</code> so that outside code cannot modify them. Methods can be
<code>private</code>, but these methods should be helper or utility methods used
inside the class or object to divide up work.</p>
</dd>
<dt class="hdlist1"><code>protected</code> modifier</dt>
<dd>
<p>This modifier states that a variable or method cannot be accessed by any
code unless the code is contained in the same class, a subclass, or is
in the same package. This level of access is more restrictive than
<code>public</code> but less restrictive than <code>private</code> or default access. We
discuss it further in the context of subclasses and inheritance in
<a href="#_inheritance">Chapter 11</a>.</p>
</dd>
<dt class="hdlist1">Package-private (no explicit modifier)</dt>
<dd>
<p>If you do not type an access modifier when you declare a field or
method, that field or method is not <code>public</code>. Instead, it has the
default or package-private access modifier applied to it. Fields or
methods with this modifier can be accessed by any code that is in the
same <em>package</em> or directory. A package is yet another layer of
organization that Java provides to group classes together. When you use
an <code>import</code> statement, you can import an entire package of classes.
There is no keyword for this access modifier. It is useful if you are
designing a package containing classes that must be able to access each
other&#8217;s fields or methods. For now, you should always give your fields
and methods an explicit <code>public</code> or <code>private</code> (or sometimes <code>protected</code>)
modifier.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>From least restrictive to most restrictive, the modifiers are <code>public</code>,
<code>protected</code>, package-private, and <code>private</code>. Each additional level of
restriction removes a single category of access. All fields and methods
can be accessed by code from the same class. The following table gives
the contexts outside the class that can access a field or method marked
with each modifier.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-bottom">Modifier</th>
<th class="tableblock halign-center valign-bottom">Package</th>
<th class="tableblock halign-center valign-bottom">Subclass</th>
<th class="tableblock halign-center valign-bottom">Unrelated<br>
Classes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-bottom"><p class="tableblock"><code>public</code></p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-bottom"><p class="tableblock"><code>protected</code></p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-bottom"><p class="tableblock">Package-private</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">No</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-bottom"><p class="tableblock"><code>private</code></p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">No</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">No</p></td>
<td class="tableblock halign-center valign-bottom"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_examples_classes">9.4. Examples: Classes</h3>
<div class="paragraph">
<p>Although large and complex programs are needed to see the real benefits
of OOP in Java, here are two short examples showing, respectively, how
objects can be used to make a roster of students and compute the value
of an expression in postfix notation.</p>
</div>
<div class="exampleblock">
<div class="title">Example 83. Student roster</div>
<div class="content">
<div class="paragraph">
<p>We are going to create a <code>Student</code> class so that we can store objects
containing student roster information. Then, we&#8217;re going to create a
client program that reads data from a user to create <code>Student</code> objects,
sort them by GPA, and then print them out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Student</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">YEARS</span> <span class="tok-o">=</span>
<span class="lineno">3 </span>	<span class="tok-o">{</span><span class="tok-s">&quot;Freshman&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Sophomore&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Junior&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Senior&quot;</span><span class="tok-o">};</span>
<span class="lineno">4 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno">5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">year</span><span class="tok-o">;</span>
<span class="lineno">6 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">GPA</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We start by defining the <code>Student</code> class. First, there is a constant
array of type <code>String</code>, giving the names of each of the four years.
Next, the fields in the <code>Student</code> class store the name, year, and GPA of
the student.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Student</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">year</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">GPA</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>		<span class="tok-n">setName</span><span class="tok-o">(</span> <span class="tok-n">name</span> <span class="tok-o">);</span>
<span class="lineno">3 </span>		<span class="tok-n">setYear</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>		<span class="tok-n">setGPA</span><span class="tok-o">(</span> <span class="tok-n">GPA</span> <span class="tok-o">);</span>
<span class="lineno">5 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have one constructor for this class, which takes in a <code>String</code>, an
<code>int</code>, and a <code>double</code> corresponding to the name, year, and GPA of the
student. The constructor then internally uses mutator methods to store
the values into the fields. By doing so, we automatically take advantage
of the error checking in the GPA mutator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setName</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setYear</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">year</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">year</span> <span class="tok-o">=</span> <span class="tok-n">year</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setGPA</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">GPA</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">GPA</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">GPA</span> <span class="tok-o">&lt;=</span> <span class="tok-mf">4.0</span> <span class="tok-o">)</span>
<span class="lineno">6 </span>			<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">GPA</span> <span class="tok-o">=</span> <span class="tok-n">GPA</span><span class="tok-o">;</span>
<span class="lineno">7 </span>		<span class="tok-k">else</span>
<span class="lineno">8 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Invalid GPA: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">GPA</span><span class="tok-o">);</span>
<span class="lineno">9 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These are the mutators corresponding to each of the three fields. The
input for the name and year mutators are not checked, but the GPA
mutator checks to make sure that the GPA value is in the proper range.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">};</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getYear</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">year</span><span class="tok-o">;</span> <span class="tok-o">};</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getGPA</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">GPA</span><span class="tok-o">;</span> <span class="tok-o">};</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">6 </span>		<span class="tok-k">return</span> <span class="tok-n">name</span> <span class="tok-o">+</span> <span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">YEARS</span><span class="tok-o">[</span><span class="tok-n">year</span><span class="tok-o">]</span> <span class="tok-o">+</span>
<span class="lineno">7 </span>			<span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">GPA</span><span class="tok-o">;</span>
<span class="lineno">8 </span>	<span class="tok-o">}</span>
<span class="lineno">9 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, these accessors allow the user to find out the name, year, or
GPA of a given student. Every class in Java automatically has a
<code>toString()</code> method that is called whenever an object is being printed
out directly. We have changed this method to return the information in
<code>Student</code> formatted as a <code>String</code>.</p>
</div>
<div class="paragraph">
<p>Creating the <code>Student</code> class is only half the battle. We also must
create client code to use it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">StudentRoster</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">Student</span><span class="tok-o">[]</span> <span class="tok-n">roster</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Student</span><span class="tok-o">[</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">()];</span>
<span class="lineno"> 7 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">roster</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>			<span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>			<span class="tok-n">roster</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Student</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">(),</span>
<span class="lineno">10 </span>				<span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(),</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-o">}</span>
<span class="lineno">12 </span>		<span class="tok-n">sort</span><span class="tok-o">(</span><span class="tok-n">roster</span><span class="tok-o">);</span>
<span class="lineno">13 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">roster</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">14 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">roster</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]);</span>
<span class="lineno">15 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main()</code> method in the <code>StudentRoster</code> class begins by reading in
the total number of students. Next, it makes an array of type <code>Student</code>
of that length. Then, it repeatedly reads in a name, year, and GPA,
creates a new <code>Student</code> object with those values, and stores it into the
array. After creating all the <code>Student</code> objects, it sorts them with a
method call and prints them out.</p>
</div>
<div class="paragraph">
<p>One oddity in this code is the seemingly superfluous <code>in.nextLine()</code> in
the first <code>for</code> loop. This line of code consumes a trailing newline
character from previous input. Take it out and see how quickly the
program malfunctions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">sort</span><span class="tok-o">(</span><span class="tok-n">Student</span><span class="tok-o">[]</span> <span class="tok-n">roster</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">roster</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>			<span class="tok-kt">int</span> <span class="tok-n">smallest</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">roster</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>				<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">roster</span><span class="tok-o">[</span><span class="tok-n">j</span><span class="tok-o">].</span><span class="tok-na">getGPA</span><span class="tok-o">()</span> <span class="tok-o">&lt;</span> <span class="tok-n">roster</span><span class="tok-o">[</span><span class="tok-n">smallest</span><span class="tok-o">].</span><span class="tok-na">getGPA</span><span class="tok-o">())</span>
<span class="lineno"> 6 </span>					<span class="tok-n">smallest</span> <span class="tok-o">=</span> <span class="tok-n">j</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>			<span class="tok-n">Student</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">roster</span><span class="tok-o">[</span><span class="tok-n">smallest</span><span class="tok-o">];</span>
<span class="lineno"> 8 </span>			<span class="tok-n">roster</span><span class="tok-o">[</span><span class="tok-n">smallest</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">roster</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno"> 9 </span>			<span class="tok-n">roster</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-o">}</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span>
<span class="lineno">12 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>sort()</code> method is similar to others that you have seen. It
implements selection sort in ascending order based on GPA.</p>
</div>
<div class="paragraph">
<p>If you run this program, you will notice that it does not prompt the
user for any input. This version of the code is designed for redirected
input from a file. A more user friendly, interactive version should
prompt the user clearly.</p>
</div>
<div class="paragraph">
<p>Using OOP is not necessary to solve this problem. Instead of objects, we
could have used three separate arrays holding the name, year, and GPA of
each student, respectively. However, coordinating these arrays together
would become tedious, particularly when sorting.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_nested_classes">9.5. Advanced: Nested classes</h3>
<div class="paragraph">
<p>Inside of a class, you can define fields and methods, but what about
other classes? Yes! Doing so creates a <em>nested class</em>. When you define a
class inside of an outer class, it can access fields and methods in the
outer class, even if they are marked <code>private</code>. Java allows a number of
different ways to define a nested class. They are all useful, but each
is subtly different. Some nested classes are tied to a specific object
of the outer class while others are not.</p>
</div>
<div class="sect3">
<h4 id="_static_nested_classes">9.5.1. Static nested classes</h4>
<div class="paragraph">
<p>If you mark a nested class with the <code>static</code> keyword, you are creating a
class whose objects are independent of any particular outer class
object. Such a class is called a <em>static nested class</em>. Consider the
following class definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Outer</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">y</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Nested</span> <span class="tok-o">{</span>
        <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">z</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A static nested class is similar to a normal, top-level class with two
differences. First, the full name of a nested class is the name of the
outer class followed by a dot followed by the nested class name. Second,
when given an outer class object, code in a static nested class can
access and modify <code>private</code> (and <code>protected)</code>) data in the outer class
object.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/09-classes/images/nested.svg" alt="nested" width="80%">
</div>
<div class="title">Figure 39. A static nested class object is allowed to access data from outer class objects even though there is no direct relationship between them.</div>
</div>
<div class="paragraph">
<p>Static nested classes can be used when the class you need is only useful
in connection with the outer class. Thus, nesting the class groups it
with its outer class. We can create an instance of the nested class
above as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Outer</span><span class="tok-o">.</span><span class="tok-na">Nested</span> <span class="tok-n">nested</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Outer</span><span class="tok-o">.</span><span class="tok-na">Nested</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because it is a static nested class, we do not need an instance of type
<code>Outer</code> to create an instance of type <code>Outer.Nested</code>. If you compile
<code>Outer.java</code>, it will create two files, <code>Outer.class</code> and
<code>Outer$Nested.class</code>. The dollar sign (<code>$</code>) separates the names of each
level of nested class in the file name. It is possible to nest classes
inside of nested classes, producing another <code>.class</code> file with another
dollar sign and the new class name appended.</p>
</div>
<div class="paragraph">
<p>Note that static nested classes can be marked <code>public</code>, <code>private</code>,
<code>protected</code>, or package-private (no explicit modifier). These access
modifiers control which code can access or instantiate static nested
classes using the sames access rules for fields and methods.</p>
</div>
<div class="exampleblock">
<div class="title">Example 84. Static nested class for testing</div>
<div class="content">
<div class="paragraph">
<p>One application for static nested classes is testing. You can write code
that tests the functionality of your outer class, fiddling with its
fields if needed. Then, because a separate <code>.class</code> file is created, you
can deliver only the <code>.class</code> file for the outer class to your customer.</p>
</div>
<div class="paragraph">
<p>Consider the <code>Square</code> class, similar to the <code>Rectangle</code> class given
earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Square</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">side</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Square</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">side</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">side</span> <span class="tok-o">=</span> <span class="tok-n">side</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getArea</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">side</span><span class="tok-o">*</span><span class="tok-n">side</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could add a static nested class called <code>Test</code> to <code>Square</code> to test
that its <code>getArea()</code> and <code>getPerimeter()</code> methods are working properly.
The final code might be as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Square</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">side</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Square</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">side</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">side</span> <span class="tok-o">=</span> <span class="tok-n">side</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getArea</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">side</span><span class="tok-o">*</span><span class="tok-n">side</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Test</span> <span class="tok-o">{</span>
        <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">Square</span> <span class="tok-n">square</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Square</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">);</span>
            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Test 1: &quot;</span><span class="tok-o">);</span>
            <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">square</span><span class="tok-o">.</span><span class="tok-na">getArea</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">25</span> <span class="tok-o">)</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Passed&quot;</span><span class="tok-o">);</span>
            <span class="tok-k">else</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Failed&quot;</span><span class="tok-o">);</span>

            <span class="tok-n">square</span><span class="tok-o">.</span><span class="tok-na">side</span> <span class="tok-o">=</span> <span class="tok-mi">7</span><span class="tok-o">;</span>
            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Test 2: &quot;</span><span class="tok-o">);</span>
            <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">square</span><span class="tok-o">.</span><span class="tok-na">getArea</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">49</span> <span class="tok-o">)</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Passed&quot;</span><span class="tok-o">);</span>
            <span class="tok-k">else</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Failed&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To run the tests, you would compile <code>Square.java</code> and then run the
nested class by invoking <code>java Square$Test</code>. It is unwise to use the
nested class to change the private fields in <code>square</code>, but we did so to
show that it is allowed by Java. A better test would create a second
<code>Square</code> object with a side of length 7.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inner_classes">9.5.2. Inner classes</h4>
<div class="paragraph">
<p>Another kind of nested class is an <em>inner class</em>. Unlike static nested
classes, the objects of inner classes are associated with a particular
object of the outer class. You can think of an inner class object living
<strong>inside</strong> an outer class object. It is impossible to instantiate an inner
class object without having an outer class object first. Consider the
following class definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Outer</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Inner</span> <span class="tok-o">{</span>
        <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">b</span><span class="tok-o">;</span>
        <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">c</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Every instance of <code>Inner</code> must be associated with an instance of
<code>Outer</code>. To instantiate an inner class, you use the name of an outer
class object, followed by a dot, followed by the <code>new</code> keyword, and then
the name of the inner class. We can create an instance of the inner
class above as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Outer</span> <span class="tok-n">outer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Outer</span><span class="tok-o">();</span>
<span class="tok-n">Outer</span><span class="tok-o">.</span><span class="tok-na">Inner</span> <span class="tok-n">inner</span> <span class="tok-o">=</span> <span class="tok-n">outer</span><span class="tok-o">.</span><span class="tok-na">new</span> <span class="tok-nf">Inner</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This syntax looks confusing, but it makes <code>inner</code> an object that exists
inside of <code>outer</code>. Thus, if there were methods defined in <code>Inner</code>, they
could refer to field <code>a</code>, because every instance of <code>Inner</code> would be
inside of an instance of <code>Outer</code> with a copy of <code>a</code>.</p>
</div>
<div class="paragraph">
<p>The relationship between outer and inner objects is one to many. We can
instantiate any number of inner class objects that all live inside of
the same outer class object.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/09-classes/images/inner.svg" alt="inner" width="80%">
</div>
<div class="title">Figure 40. An inner class object is always associated with a specific outer class object.</div>
</div>
<div class="paragraph">
<p>Another issue with inner classes (as opposed to static nested classes)
is that they cannot contain static fields (except for constants) or
methods. Since each instance of an inner class is tied to an instance of
an outer class, the designers of Java thought that static fields and
methods for an inner class really belong in the outer class.</p>
</div>
<div class="paragraph">
<p>It is even possible to define a class <strong>inside</strong> a method, if that class
is only referred to in the method. Such a class is called a <em>local
class</em>. It is possible to create an unnamed local class on the fly as
well. Such a class is called an <em>anonymous class</em>. Both local and
anonymous classes are special kinds of inner classes. Because of the way
they are created and used, we discuss them in <a href="#_advanced_local_and_anonymous_classes">Section 10.4</a></p>
</div>
<div class="exampleblock">
<div class="title">Example 85. Inner class objects as iterators</div>
<div class="content">
<div class="paragraph">
<p>If you create a data structure for other programmers to use, a useful
feature is the ability to retrieve each item from the data structure in
order. Different threads or methods might need to process these elements
independently from each other. Each piece of code can be given an inner
class object called an <em>iterator</em> that can repeatedly get the next item
in the data structure. Since instances of an inner class can read
private data of the outer class, iterators can keep track of where they
are inside the data structure. If outside code were allowed access to
the data structure&#8217;s internals, it would violate encapsulation.
Iterators are a very common application of inner classes.</p>
</div>
<div class="paragraph">
<p>We can create a <code>SafeArray</code> class that only allows data to be written to
its internal array if it falls in the legal range of indexes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SafeArray</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">data</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">SafeArray</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">size</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[</span><span class="tok-n">size</span><span class="tok-o">];</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">set</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">index</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">index</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">index</span> <span class="tok-o">&lt;</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">)</span>
            <span class="tok-n">data</span><span class="tok-o">[</span><span class="tok-n">index</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could add an inner class called <code>Iterator</code> to <code>SafeArray</code> that allows
us to process all the array values without knowing how many there are.
This kind of behavior is useful for many dynamic data structures, as
discussed in <a href="#_dynamic_data_structures">Chapter 18</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SafeArray</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">data</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">SafeArray</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">size</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[</span><span class="tok-n">size</span><span class="tok-o">];</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">set</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">index</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">index</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">index</span> <span class="tok-o">&lt;</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">)</span>
            <span class="tok-n">data</span><span class="tok-o">[</span><span class="tok-n">index</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Iterator</span> <span class="tok-o">{</span>
        <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>

        <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasNext</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-o">(</span> <span class="tok-n">index</span> <span class="tok-o">&lt;</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">);</span>
        <span class="tok-o">}</span>

        <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getNext</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">index</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">index</span> <span class="tok-o">&lt;</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">)</span>
                <span class="tok-k">return</span> <span class="tok-n">data</span><span class="tok-o">[</span><span class="tok-n">index</span><span class="tok-o">++];</span>
            <span class="tok-k">else</span>
                <span class="tok-k">return</span> <span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">NaN</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following method uses the iterator we have defined to find the sum
of the values in a <code>SafeArray</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-nf">findSum</span><span class="tok-o">(</span> <span class="tok-n">SafeArray</span> <span class="tok-n">array</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-n">SafeArray</span><span class="tok-o">.</span><span class="tok-na">Iterator</span> <span class="tok-n">iterator</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">new</span> <span class="tok-nf">Iterator</span><span class="tok-o">();</span>

    <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">iterator</span><span class="tok-o">.</span><span class="tok-na">hasNext</span><span class="tok-o">()</span> <span class="tok-o">)</span>
        <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">iterator</span><span class="tok-o">.</span><span class="tok-na">getNext</span><span class="tok-o">();</span>

    <span class="tok-k">return</span> <span class="tok-n">sum</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_nested_expressions">9.6. Solution: Nested expressions</h3>
<div class="paragraph">
<p>We now have enough knowledge to solve the nested expressions problem
from the beginning of the chapter. Classes help us divide up the work of
solving the problem. First, we need a stack class that can hold <code>char</code>
values.</p>
</div>
<div id="SymbolStackProgram" class="listingblock">
<div class="title">Program 44. Simple stack class to hold symbols from an input expression.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SymbolStack</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">char</span><span class="tok-o">[]</span> <span class="tok-n">symbols</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">size</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">SymbolStack</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">maxSize</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-n">symbols</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">char</span><span class="tok-o">[</span><span class="tok-n">maxSize</span><span class="tok-o">];</span>
<span class="lineno"> 7 </span>		<span class="tok-n">size</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span> <span class="tok-kt">char</span> <span class="tok-n">symbol</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">symbols</span><span class="tok-o">[</span><span class="tok-n">size</span><span class="tok-o">++]</span> <span class="tok-o">=</span> <span class="tok-n">symbol</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">pop</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-n">size</span><span class="tok-o">--;</span> <span class="tok-o">}</span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kt">char</span> <span class="tok-nf">top</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">symbols</span><span class="tok-o">[</span><span class="tok-n">size</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">];</span> <span class="tok-o">}</span>
<span class="lineno">13 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">size</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">14 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SymbolStack</code> class allows us to perform the push, pop, and top
stack operations with methods of the same names. Its constructor takes a
maximize size for the stack and allocates an array of that size. It also
sets the <code>size</code> field to <code>0</code> so that we can keep track of how many
things are in the stack (and consequently where the top is).</p>
</div>
<div class="paragraph">
<p>The <code>push()</code> method stores an input <code>char</code> into the stack at location
<code>size</code> and then increments <code>size</code>. The <code>pop()</code> method simply decrements
<code>size</code>. It has no error checking to prevent a user from popping the
stack once it is already empty. Finally, the <code>top()</code> method returns the
value at the top of the stack, whose location is <code>size - 1</code>.
<code>SymbolStack</code> also defines an <code>isEmpty()</code> method so that we can see if
the stack is empty.</p>
</div>
<div class="paragraph">
<p>Now we need the client code that read the input and interacts with the
stack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">NestedExpressions</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno">6 </span>		<span class="tok-n">String</span> <span class="tok-n">input</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno">7 </span>		<span class="tok-n">SymbolStack</span> <span class="tok-n">stack</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SymbolStack</span><span class="tok-o">(</span><span class="tok-n">input</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">());</span>
<span class="lineno">8 </span>		<span class="tok-kt">char</span> <span class="tok-n">symbol</span><span class="tok-o">;</span>
<span class="lineno">9 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">correct</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main()</code> method of this class reads in the input and creates a
<code>SymbolStack</code> called <code>stack</code> with a maximum size of the input length. We
know that the stack never needs to hold more than the total input. It
also creates a <code>boolean</code> named <code>correct</code> to keep track of whether or not
the input is correctly nested. We start by assuming that it is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">input</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">correct</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>			<span class="tok-n">symbol</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno"> 3 </span>			<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">symbol</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;(&#39;</span><span class="tok-o">:</span>
<span class="lineno"> 5 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;[&#39;</span><span class="tok-o">:</span>
<span class="lineno"> 6 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;{&#39;</span><span class="tok-o">:</span>
<span class="lineno"> 7 </span>					<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-n">symbol</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>					<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;)&#39;</span><span class="tok-o">:</span>
<span class="lineno">10 </span>					<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">||</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">()</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;(&#39;</span><span class="tok-o">)</span>
<span class="lineno">11 </span>						<span class="tok-n">correct</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">12 </span>					<span class="tok-k">else</span>
<span class="lineno">13 </span>						<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
<span class="lineno">14 </span>					<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">15 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;]&#39;</span><span class="tok-o">:</span>
<span class="lineno">16 </span>					<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">||</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">()</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;[&#39;</span><span class="tok-o">)</span>
<span class="lineno">17 </span>						<span class="tok-n">correct</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">18 </span>					<span class="tok-k">else</span>
<span class="lineno">19 </span>						<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
<span class="lineno">20 </span>					<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">21 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;}&#39;</span><span class="tok-o">:</span>
<span class="lineno">22 </span>					<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">||</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">()</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;{&#39;</span><span class="tok-o">)</span>
<span class="lineno">23 </span>						<span class="tok-n">correct</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">24 </span>					<span class="tok-k">else</span>
<span class="lineno">25 </span>						<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
<span class="lineno">26 </span>					<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">27 </span>			<span class="tok-o">}</span>
<span class="lineno">28 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>for</code> loop runs through each <code>char</code> in the input. If it is a left
parenthesis, left square bracket, or left curly brace, it pushes the
symbol onto the stack. If it is a right parenthesis, right square
bracket, or right curly brace, it checks to see if the stack is empty.
Because of short-circuit evaluation, the code does not even look at the
top of the stack if it is empty. However, if the stack is not empty, it
checks to see if the top matches the current symbol. If the stack is
empty or its top does not match, <code>correct</code> is set to <code>false</code>. For
efficiency, the loop stops early if <code>correct</code> is no longer <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-c1">//unmatched left symbols</span>
<span class="lineno">2 </span>			<span class="tok-n">correct</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">correct</span> <span class="tok-o">)</span>
<span class="lineno">5 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The input is correctly nested!&quot;</span><span class="tok-o">);</span>
<span class="lineno">6 </span>		<span class="tok-k">else</span>
<span class="lineno">7 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The input is incorrectly nested!&quot;</span><span class="tok-o">);</span>
<span class="lineno">8 </span>	<span class="tok-o">}</span>
<span class="lineno">9 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the input has been examined, we check to see if the stack is
empty. If it isn&#8217;t, there must be some left symbols that were not
matched with right symbols. In that case, we set <code>correct</code> to <code>false</code>.
Finally, we print out whether the input is correctly or incorrectly
nested based on the value of <code>correct</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise9.9">Exercise 9.9</a><br>
<a href="#exercise9.14">Exercise 9.14</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_objects">9.7. Concurrency: Objects</h3>
<div class="paragraph">
<p>Nearly everything in Java is an object: arrays, lists, <code>String</code> values,
colors, and even exceptions, which form Java&#8217;s error-handling system and
is discussed in <a href="#_exceptions">Chapter 12</a>. Some critics of Java
point out that <code>int</code>, <code>double</code>, and the other primitive types are not
objects, forcing the programmer to adopt two different programming
models. Regardless, threads are stored as objects as well. In
<a href="#_concurrent_programming">Chapter 13</a>, we discuss how to create
threads and the various methods that can be used to interact with them.</p>
</div>
<div class="paragraph">
<p>However, objects of type <code>Thread</code> are not the only ones you deal with
when writing concurrent programs. As we have just noted, most data in
Java is encapsulated in an object. One of the deep reasons for using OOP
is safety: We want the private data inside of an object to stay in a
consistent state. Due to their inexplicable ability to get out of tight
situations, one tradition holds that cats have nine lives. Because of
their inquisitive nature, another tradition holds that curiosity killed
the cat. Consider the class below that keeps track of the lives a cat
has, losing one every time it becomes curious.</p>
</div>
<div class="exampleblock">
<div class="title">Example 86. Thread safety</div>
<div class="content">
<div id="CatProgram" class="listingblock">
<div class="title">Program 45. Records the number of lives a cat has left. Each <code>Cat</code> object starts with 9, but loses one each time it uses its curiosity. If no more lives remain, an error message is output.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cat</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">lives</span> <span class="tok-o">=</span> <span class="tok-mi">9</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">useCuriosity</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">lives</span> <span class="tok-o">&gt;</span> <span class="tok-mi">1</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-cm">/*@\label{life check}@*/</span>
<span class="lineno"> 6 </span>			<span class="tok-n">lives</span><span class="tok-o">--;</span>
<span class="lineno"> 7 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Down to life &quot;</span> <span class="tok-o">+</span> <span class="tok-n">lives</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>			<span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-o">}</span>
<span class="lineno">10 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;No more lives left!&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the relationship between curiosity and mortality is the only feature
of a cat you are trying to model, this class appears to function well.
If the <code>useCuriosity()</code> method is invoked, it removes a life or prints
an error message if the cat has run out of lives. In a single-threaded
situation, this object would work perfectly. No cat would be able to
lose more than 9 lives.</p>
</div>
<div class="paragraph">
<p>In a multi-threaded situation, there is no telling when a thread might
pause in executing the <code>useCuriosity()</code> method. If 100 threads all
called <code>useCuriosity()</code>, each one might successfully pass the <code>if</code>
statement on line <a href="#life_check">[life_check]</a> before any had decremented <code>lives</code>.
Once past the check, nothing would prevent them from continuing on and
decrementing <code>lives</code>, resulting in a cat who lost 100 lives, resulting
in a total of -91 lives. Such a scenario makes no sense.</p>
</div>
<div class="paragraph">
<p>In <a href="#_synchronization">Chapter 14</a>, we discuss how to prevent this
problem, using the <code>synchronized</code> keyword to allow only a single thread
at a time to execute the body of a method. The goal is to make
<code>useCuriosity()</code> <em>thread-safe</em>, meaning that its behavior is consistent
and correct no matter how many threads try to execute it at the same
time.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>As you work through this book and begin to write your own concurrent
programs, we discuss ways to make them thread-safe. However, you are
also a consumer of code written by other people. In multi-threaded
environments, you may need to use library classes that are thread-safe.
For example, <code>AtomicInteger</code> is a thread-safe class designed to store
and manipulate <code>int</code> values. In <a href="#_dynamic_data_structures">Chapter 18</a>, we talk about the <code>ArrayList</code> and <code>Vector</code> classes, which
are both used to hold variable length lists of objects. One of the few
differences between them is that <code>ArrayList</code> is not thread-safe while
<code>Vector</code> is. There is even the <code>Collections.synchronizedCollection()</code>
method (and other similar methods), which takes a collection that is not
thread-safe and returns a version of it that is.</p>
</div>
<div class="paragraph">
<p>Java was intended to be multi-threaded from the very beginning, but
concurrency was never the most important feature in the language. For
that reason, the documentation does not clearly mark which methods are
thread-safe. Usually, some of the paragraphs of description above the
list of methods say that a class is &#8220;synchronized&#8221; if it is
thread-safe. If it is not, the documentation may not mention anything.
Careful attention is needed to be sure which classes and APIs are
thread-safe.</p>
</div>
<div class="paragraph">
<p>You may wonder why all classes are not thread-safe, but everything comes
with a price. If a class is thread-safe, its methods are usually marked
with the <code>synchronized</code> keyword. The JVM is relatively efficient about
how it enforces that keyword, but the computational expense is not zero.
Learn the libraries well, and use the right tools for the right job.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_9">9.8. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise9.1"></a> Explain the relationship between a class and an object.</p>
</li>
<li>
<p><a id="exercise9.2"></a> What is the difference between a static method and an instance
method?</p>
</li>
<li>
<p><a id="exercise9.3"></a> What is the purpose of a constructor? Why is it impossible for a
constructor to return a value? Why is it impossible for a constructor to
be called multiple times on the same object?</p>
</li>
<li>
<p><a id="exercise9.4"></a> A static method can be called directly from a instance method, but
an instance method cannot be called directly from a static method. Why?</p>
</li>
<li>
<p><a id="exercise9.5"></a> Describe the uses of accessor and mutator methods. Is it possible to
create a method that is both an accessor and a mutator? Why or why not?</p>
</li>
<li>
<p><a id="exercise9.6"></a> Why do we usually mark fields with the <code>private</code> keyword when it
would be easier to make all fields <code>public</code>?</p>
</li>
<li>
<p><a id="exercise9.7"></a> What is the meaning of the <code>this</code> keyword? When is it necessary to
use it? When can it be ignored?</p>
</li>
<li>
<p><a id="exercise9.8"></a> Consider the following class definitions.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">A</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">get</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">a</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">increment</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">a</span><span class="tok-o">++;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">B</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">b</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">B</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">A</span> <span class="tok-nf">generate</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">A</span> <span class="tok-n">object</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">A</span><span class="tok-o">();</span>
        <span class="tok-n">object</span><span class="tok-o">.</span><span class="tok-na">a</span> <span class="tok-o">=</span> <span class="tok-n">b</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The field <code>a</code> is used three times in the previous code. Which of these
uses cause a compiler error and why?</p>
</div>
</li>
<li>
<p><a id="exercise9.9"></a> In <a href="#_solution_nested_expressions">Section 9.6</a>, we gave a definition of
<code>SymbolStack</code> that implements a simple stack using two fields, defined
as followed:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span> <span class="tok-kt">char</span><span class="tok-o">[]</span> <span class="tok-n">symbols</span><span class="tok-o">;</span>
<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">size</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By calling the <code>top()</code> or <code>pop()</code> methods on an empty stack, it is
possible to cause a program to crash. What additional problems could
happen if <code>symbols</code> and <code>size</code> were declared <code>public</code> and malicious or
poorly written code had access to the object?</p>
</div>
</li>
<li>
<p><a id="exercise9.10"></a> Consider the following class definition.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">GroceryItem</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">price</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">GroceryItem</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">text</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">money</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-n">text</span><span class="tok-o">;</span>
        <span class="tok-kt">double</span> <span class="tok-n">price</span> <span class="tok-o">=</span> <span class="tok-n">money</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPrice</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">price</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class compiles, but its constructor does not function properly. Why
not?</p>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise9.11"></a> OOP is often used when the data inside the object must maintain
special relationships. Consider a clock with hours, minutes, and
seconds. When the number of seconds reaches 60, the number of minutes is
increased by 1, and the number of seconds is reset to 0. When the number
of minutes reaches 60, the numer of hours is increased by 1, and the
number of seconds is reset to 0. When the number of hours reaches 13, it
is reset to 1. AM and PM switch whenever the number of hours reaches 12.</p>
<div class="paragraph">
<p>Define a <code>Clock</code> class with private <code>int</code> fields <code>hours</code>, <code>minutes</code>, and
<code>seconds</code> and a <code>boolean</code> field <code>PM</code>. Write a constructor that
initializes <code>hours</code> to <code>12</code>, <code>minutes</code> and <code>seconds</code> to <code>0</code>, and <code>PM</code> to
<code>false</code>. Write a mutator <code>increment()</code> that adds <code>1</code> to <code>seconds</code>. This
mutator should correctly handle all the clock behavior described above.
Write an accessor called <code>toString()</code> that returns a nicely formatted
version of the time as a <code>String</code>. For example, the initial time would
be returned as <code>"12:00:00 AM"</code>. Make sure you pad the output for
<code>seconds</code> and <code>minutes</code> with an extra <code>"0"</code> if they are less than <code>10</code>.</p>
</div>
</li>
<li>
<p><a id="exercise9.12"></a> Draw on any of your hobbies to come up with a collection of items,
whether those items are books you like to read, athletes you follow,
music you collect, or anything else that is easy to classify. First
create a class that can describe one of these items with three to five
attributes. For example, the important attributes of a book might be
author, title, genre, and page count. Each of these attributes should be
stored as a <code>private</code> field and manipulated with <code>public</code> accessor and
mutator methods.</p>
<div class="paragraph">
<p>Using an array, create a database of these objects. Write methods that
print out all objects that have a particular value for an attribute.
Using the book example, your database program should let the user input
that he or she is looking for all books whose author is
<code>Alexandre Dumas</code>. You may wish to use input redirection so that you do
not have to enter data about your objects repetitively.</p>
</div>
</li>
<li>
<p><a id="exercise9.13"></a> The <code>java.awt</code> package defines a class called <code>Point</code> that can be
used to manipulate an \((x,y)\) pair in programs involving the
Cartesian coordinate system. Create your own <code>Point</code> class with <code>int</code>
values <code>x</code> and <code>y</code> as fields.</p>
<div class="paragraph">
<p>Create one constructor that allows the user to specify values for <code>x</code>
and <code>y</code> and a default constructor that takes no arguments and sets both
<code>x</code> and <code>y</code> to <code>0</code>. Create accessors and mutators for <code>x</code> and <code>y</code>.</p>
</div>
<div class="paragraph">
<p>Finally, create a method with the signature
<code>public double distance( Point p )</code> that uses the distance formula
\(\sqrt{(x_1 - x_2)^2+(y_1 - y_2)^2}\) to find the distance
between the current <code>Point</code> object and the <code>Point</code> object <code>p</code> passed in
as an argument.</p>
</div>
<div class="paragraph">
<p>Write client code that allows you to create two <code>Point</code> objects and test
if the <code>distance()</code> method gives the right answer.</p>
</div>
</li>
<li>
<p><a id="exercise9.14"></a> Re-implement the solution from <a href="#_solution_nested_expressions">Section 9.6</a> so that it performs its input and output with GUIs created
using <code>JOptionPane</code>.</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise9.15"></a> Objects are great tools for solving problems, but there is some
additional overhead associated with creating objects and calling
methods.</p>
<div class="paragraph">
<p>Write a piece of code that allocates an array of 10,000,000 <code>int</code>
values. Iterate through that array, storing the value <code>i</code> into index
<code>i</code>, and time the process using an OS <code>time</code> command. As you know, the
<code>Integer</code> wrapper class allows us to store an <code>int</code> value in object
form. Repeat the experiment, but, instead of <code>int</code> values, allocate an
array to hold 10,000,000 <code>Integer</code> objects. Iterate through the array
again, storing an <code>Integer</code> object into each index of the array. For
index <code>i</code>, store a new <code>Integer</code> objected created by passing value <code>i</code>
into its constructor. Compare the time taken to the previous time for
<code>int</code> values. Do you think this is a reasonable way to estimate the time
it takes to call a constructor and allocate a new object?</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interfaces">10. Interfaces</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Our work is the presentation of our capabilities.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Edward Gibbon
</div>
</div>
<div class="sect2">
<h3 id="_problem_sort_it_out">10.1. Problem: Sort it out</h3>
<div class="paragraph">
<p>Defining classes as we did in <a href="#_classes">Chapter 9</a> provides us
with useful tools. First, we can group related data together. Then, we
can encapsulate that data so that it can only be changed in carefully
controlled ways. But these ideas are only a fraction of the true power
of object orientation that becomes apparent when we exploit
relationships between different classes. Eventually, in
<a href="#_inheritance">Chapter 11</a>, we will talk about hierarchical
relationships, in which one class can be the parent of many other child
classes. However, there is a simpler relationship that classes can
share, the ability to do some specific action or answer some specific
question. If we know that several different classes can all do the same
things, we want to be able to treat them in a unified way. For example,
imagine that you are writing code to aid laboratory analysis of the free
radical content of a number of creatures and items. For this analysis it
is necessary to sort the test subjects by weight and by age.</p>
</div>
<div class="paragraph">
<p>The subjects you are going to sort will be objects of type <code>Dog</code>, <code>Cat</code>,
<code>Person</code>, and <code>Cheese</code>. All of these subjects will have some calendar
age. Naturally, the age we are interested for a <code>Dog</code> is 7 times its
calendar age. At the same time, because a cat has nine lives, we will
use \(\frac{1}{9}\) of its calendar age. The age we use for
<code>Person</code> and <code>Cheese</code> objects is simply their calendar age.</p>
</div>
<div class="paragraph">
<p>As we discussed in <a href="#selectionSortExample">Example 63</a>, sorting is one of
the most fundamental things that computer scientists do. In that
example, we introduced selection sort. Here we are going to use another
sort called bubble sort. We are introducing bubble sort to expose you to
another way to sort data. Although they are easy to understand, neither
bubble sort nor selection sort are the fastest ways known to sort lists.</p>
</div>
<div class="paragraph">
<p>Bubble sort works by scanning through a list of items, a pair at a time,
and swapping the elements of the pair if they are out of order. One scan
through the list is called a <em>pass</em>. The algorithm keeps making passes
until no consecutive pair of elements is out of order. Here is an
implementation of bubble sort that sorts an array of <code>int</code> values in
ascending order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">swapped</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">swapped</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">swapped</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">&gt;</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
            <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">];</span>
            <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
            <span class="tok-n">swapped</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Array out of bounds</div>
<div class="paragraph">
<p>Note that index variable <code>i</code> stops before <code>array.length - 1</code> since we
don’t want to get an<br>
<code>ArrayIndexOutOfBoundsException</code> when looking at <code>array[i + 1]</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The only change needed to make a bubble sort work with lists of
arbitrary objects (instead of just <code>int</code> values) is the <code>if</code> statement.
Likewise, changing the greater than (<code>&gt;</code>) to a less than (<code>&lt;</code>) will
change the sort from ascending to descending.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_making_a_promise">10.2. Concepts: Making a promise</h3>
<div class="paragraph">
<p>Knowing how to sort a list of items is half of the problem we want to
solve. The other half is designing the classes so that sorting by either
age or weight is easy. And easy sorting is not enough: We want to follow
good object oriented design so that sorting future classes will be easy
as well.</p>
</div>
<div class="paragraph">
<p>For these kinds of situations, Java has a feature called <em>interfaces</em>.
An interface is a set of methods that a class must have in order to
<em>implement</em> that interface. If a class implements an interface, it is
making a promise to have a version of each of the methods listed in the
interface. It can choose to do anything it wants inside the body of each
method, but it must have them to compile. Interfaces are also described
as contracts, since a contract is a promise to do certain things. One
reason that interfaces are so useful is because Java allows a class to
implement any number of them.</p>
</div>
<div class="paragraph">
<p>The purpose of an interface is to guarantee that a class has the
capability to do something. In the case of this sorting problem, we will
need to sort by age and weight. Consequently, the ability to report age
and weight are the two important capabilities that the objects we are
sorting must have.</p>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_interfaces">10.3. Syntax: Interfaces</h3>
<div class="paragraph">
<p>Declaring an interface is similar to declaring a class except that
interfaces can only hold public abstract methods and constants. An
<em>abstract method</em> is one that does not have a body. Its return type,
name, and parameters are given, but this information is concluded with a
semicolon (<code>;</code>) instead of a method body. Because the purpose of an
interface is to ensure a class has certain publicly available
capabilities, all abstract methods and constants listed in an interface
are assumed to be <code>public</code>. It is legal but needlessly cluttered to mark
each method with <code>public</code>, and it is illegal to mark them with <code>private</code>
or <code>protected</code>.</p>
</div>
<div class="paragraph">
<p>Here is an interface for a guitar player that defines two abstract
methods.</p>
</div>
<div id="GuitaristProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Guitarist</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kt">void</span> <span class="tok-nf">strumChord</span><span class="tok-o">(</span> <span class="tok-n">Chord</span> <span class="tok-n">chord</span> <span class="tok-o">);</span>
<span class="lineno">3 </span>	<span class="tok-kt">void</span> <span class="tok-nf">playMelody</span><span class="tok-o">(</span> <span class="tok-n">Melody</span> <span class="tok-n">notes</span> <span class="tok-o">);</span>
<span class="lineno">4 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Any class that implements this interface must have both of these
methods, declared with the access modifier <code>public</code>, the same return
types, and the same parameters. We could create a <code>RockGuitarist</code> class
that implements <code>Guitarist</code> as follows.</p>
</div>
<div id="RockGuitaristProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RockGuitarist</span> <span class="tok-kd">implements</span> <span class="tok-n">Guitarist</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">strumChord</span><span class="tok-o">(</span> <span class="tok-n">Chord</span> <span class="tok-n">chord</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Totally wails on that &quot;</span> <span class="tok-o">+</span> <span class="tok-n">chord</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span>
<span class="lineno"> 4 </span>				<span class="tok-o">+</span> <span class="tok-s">&quot; chord!&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>	<span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">playMelody</span><span class="tok-o">(</span> <span class="tok-n">Melody</span> <span class="tok-n">notes</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-s">&quot;Burns through the notes &quot;</span> <span class="tok-o">+</span>
<span class="lineno"> 9 </span>				<span class="tok-n">notes</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; like Jimmy Page!&quot;</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can create a <code>ClassicalGuitarist</code> class. A classical guitarist is
going to approach playing a chord or a melody differently from a rock
guitarist. Java only requires that all the methods in the interface are
implemented.</p>
</div>
<div id="ClassicalGuitaristProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ClassicalGuitarist</span> <span class="tok-kd">implements</span> <span class="tok-n">Guitarist</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">strumChord</span><span class="tok-o">(</span> <span class="tok-n">Chord</span> <span class="tok-n">chord</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-s">&quot;Delicately voices a &quot;</span> <span class="tok-o">+</span> <span class="tok-n">chord</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span>
<span class="lineno"> 4 </span>				<span class="tok-o">+</span> <span class="tok-s">&quot; chord.&quot;</span> <span class="tok-o">);</span>
<span class="lineno"> 5 </span>	<span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">playMelody</span><span class="tok-o">(</span> <span class="tok-n">Melody</span> <span class="tok-n">notes</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Plucks the melodic line &quot;</span>
<span class="lineno"> 9 </span>				<span class="tok-o">+</span> <span class="tok-n">notes</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">()</span>
<span class="lineno">10 </span>				<span class="tok-o">+</span> <span class="tok-s">&quot; with the skill of John Williams.&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span>
<span class="lineno">12 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Interfaces make our code more flexible because we can use a reference
with an interface type to refer to any objects which implement that
interface. In the following snippet of code we do this by creating 100
<code>Guitarist</code> references, each of which randomly points to either a
<code>RockGuitarist</code> or a <code>ClassicalGuitarist</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Guitarist</span><span class="tok-o">[]</span> <span class="tok-n">guitarists</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Guitarist</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">guitarists</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextBoolean</span><span class="tok-o">()</span> <span class="tok-o">)</span>
        <span class="tok-n">guitarists</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RockGuitarist</span><span class="tok-o">();</span>
    <span class="tok-k">else</span>
        <span class="tok-n">guitarists</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ClassicalGuitarist</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mistakes in the use of interfaces should generally be caught at compile
time. If you implement an interface with a class you are writing but
forget (or misspell) a required method, the compiler will fail to
compile that class. If you remember all of the required methods but
forget to specify that your class implements a particular interface, the
compiler will fail when you try to use that class in a place where that
interface is required.</p>
</div>
<div class="paragraph">
<p>If you have code that takes some arbitrary object as a parameter, you
can determine if that object implements a particular interface by using
the <code>instanceof</code> keyword. For example, the following method takes a
<code>Chord</code> object and an object of type <code>Object</code>. The <code>Object</code> type is the
most basic reference type there is. All reference types in Java can be
treated as an <code>Object</code> type. Thus, a reference of type <code>Object</code> could
point at any object of any type. In this case, if the <code>Object</code> turns out
to implement the <code>Guitarist</code> interface, we can cast it to a <code>Guitarist</code>
and use it to strum a chord.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">void</span> <span class="tok-nf">checkBeforeStrum</span><span class="tok-o">(</span> <span class="tok-n">Object</span> <span class="tok-n">unknown</span><span class="tok-o">,</span> <span class="tok-n">Chord</span> <span class="tok-n">chord</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">unknown</span> <span class="tok-k">instanceof</span> <span class="tok-n">Guitarist</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Guitarist</span> <span class="tok-n">player</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Guitarist</span><span class="tok-o">)</span><span class="tok-n">unknown</span><span class="tok-o">;</span>
        <span class="tok-n">player</span><span class="tok-o">.</span><span class="tok-na">strumChord</span><span class="tok-o">(</span> <span class="tok-n">chord</span> <span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">else</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;That&#39;s not a guitarist!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Interfaces cannot be instantiated</div>
<div class="paragraph">
<p>It is tempting to try to create an object of an interface type. If you
think about this carefully, it should be clear why this is impossible.
An interface is a promise to do things, but it is not a class. It has no
data nor methods to manipulate data. Thus, the following code will fail
to compile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Guitarist</span> <span class="tok-n">guitarist</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Guitarist</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are permitted to make a reference to objects that implement
<code>Guitarist</code>. We can make an array that holds such references. The
interface itself, however, can never be instantiated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_interfaces_and_code_static_code">10.3.1. Interfaces and <code>static</code></h4>
<div class="paragraph">
<p>When designing an interface, you cannot mark a method as <code>static</code>.
Whether or not a method is <code>static</code> is considered by Java to be an
implementation detail that is not suitable to specify in an interface.
For example, even with <code>Chord</code> and <code>Melody</code> defined, the following
interface fails to compile.</p>
</div>
<div id="StaticGuitaristProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">StaticGuitarist</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kt">void</span> <span class="tok-nf">strumChord</span><span class="tok-o">(</span> <span class="tok-n">Chord</span> <span class="tok-n">chord</span> <span class="tok-o">);</span>
<span class="lineno">3 </span>	<span class="tok-kt">void</span> <span class="tok-nf">playMelody</span><span class="tok-o">(</span> <span class="tok-n">Melody</span> <span class="tok-n">notes</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">getStrings</span><span class="tok-o">();</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The designers of Java decided that they did not want their language to
function this way. Some languages like PHP allow the equivalent of
static methods in interfaces.</p>
</div>
<div class="paragraph">
<p>Neither fields nor class variables are allowed in interfaces either, but
class constants are allowed. Thus, we could define <code>static</code> <code>final</code>
values that might be useful to any class implementing an interface. With
<code>Chord</code> and <code>Melody</code> defined, the following interface <strong>will</strong> compile.</p>
</div>
<div id="ConstantGuitaristProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">ConstantGuitarist</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">MAJOR</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">NATURAL_MINOR</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">HARMONIC_MINOR</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">MELODIC_MINOR</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">CHROMATIC</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">PENTATONIC</span> <span class="tok-o">=</span> <span class="tok-mi">6</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kt">void</span> <span class="tok-nf">strumChord</span><span class="tok-o">(</span> <span class="tok-n">Chord</span> <span class="tok-n">chord</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>	<span class="tok-kt">void</span> <span class="tok-nf">playMelody</span><span class="tok-o">(</span> <span class="tok-n">Melody</span> <span class="tok-n">notes</span> <span class="tok-o">);</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Many modern Java users object to the use of constants in interfaces,
since the purpose of an interface is to define a list of a requirements
for what a class does rather than dealing with data values.
Nevertheless, constants are allowed in interfaces, and the Java API does
so in many cases.</p>
</div>
<div id="supermarketPricingExample" class="exampleblock">
<div class="title">Example 87. Supermarket pricing</div>
<div class="content">
<div class="paragraph">
<p>Interface names often include the suffix <em>-able</em>, for example,
<code>Runnable</code>, <code>Callable</code>, and <code>Comparable</code>. This suffix is typical because
it reminds us that a class implementing an interface has some specific
ability. Let’s consider an example in a supermarket in which the items
could have very little in common with each other but they all have a
price. We could define the interface <code>Priceable</code> as follows.</p>
</div>
<div id="PriceableProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">interface</span> <span class="tok-nc">Priceable</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kt">double</span> <span class="tok-nf">getPrice</span><span class="tok-o">();</span>
<span class="lineno">3 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If bananas cost $0.49 a pound, we can define the <code>Bananas</code> class as
follows.</p>
</div>
<div id="BananasProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Bananas</span> <span class="tok-kd">implements</span> <span class="tok-n">Priceable</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">PRICE_PER_POUND</span> <span class="tok-o">=</span> <span class="tok-mf">0.49</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Bananas</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">weight</span> <span class="tok-o">=</span> <span class="tok-n">weight</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getPrice</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-k">return</span> <span class="tok-n">weight</span><span class="tok-o">*</span><span class="tok-n">PRICE_PER_POUND</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>	<span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If eggs are $1.50 for a dozen large eggs and $1.75 for a dozen extra
large eggs, we can define the <code>Eggs</code> class as follows.</p>
</div>
<div id="EggsProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Eggs</span> <span class="tok-kd">implements</span> <span class="tok-n">Priceable</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">PRICE_PER_DOZEN_LARGE</span> <span class="tok-o">=</span> <span class="tok-mf">1.5</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">PRICE_PER_DOZEN_EXTRA_LARGE</span> <span class="tok-o">=</span> <span class="tok-mf">1.75</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">dozens</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">extraLarge</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Eggs</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">dozens</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">extraLarge</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">dozens</span> <span class="tok-o">=</span> <span class="tok-n">dozens</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">extraLarge</span> <span class="tok-o">=</span> <span class="tok-n">extraLarge</span><span class="tok-o">;</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getPrice</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">extraLarge</span> <span class="tok-o">)</span>
<span class="lineno">14 </span>			<span class="tok-k">return</span> <span class="tok-n">dozens</span><span class="tok-o">*</span><span class="tok-n">PRICE_PER_DOZEN_EXTRA_LARGE</span><span class="tok-o">;</span>
<span class="lineno">15 </span>		<span class="tok-k">else</span>
<span class="lineno">16 </span>			<span class="tok-k">return</span> <span class="tok-n">dozens</span><span class="tok-o">*</span><span class="tok-n">PRICE_PER_DOZEN_LARGE</span><span class="tok-o">;</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, if water is $0.99 a gallon, we can define the <code>Water</code> class as
follows.</p>
</div>
<div id="WaterProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Water</span> <span class="tok-kd">implements</span> <span class="tok-n">Priceable</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">PRICE_PER_GALLON</span> <span class="tok-o">=</span> <span class="tok-mf">0.99</span><span class="tok-o">;</span>
<span class="lineno">3 </span>    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">gallons</span><span class="tok-o">;</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span>    <span class="tok-kd">public</span> <span class="tok-nf">Water</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">gallons</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">gallons</span> <span class="tok-o">=</span> <span class="tok-n">gallons</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">6 </span>
<span class="lineno">7 </span>    <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getPrice</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">gallons</span><span class="tok-o">*</span><span class="tok-n">PRICE_PER_GALLON</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">8 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each class could be much more complicated, but the code shown is all
that is needed to implement the <code>Priceable</code> interface. Even though there
is no clear relationship between bananas, eggs, and water, a shopping
cart filled with these items (and any others implementing the
<code>Priceable</code> interface) could easily be totaled at the register. If we
represent the shopping cart as an array of <code>Priceable</code> items, we could
write a simple method to total the values like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span> <span class="tok-nf">getTotal</span><span class="tok-o">(</span> <span class="tok-n">Priceable</span><span class="tok-o">[]</span> <span class="tok-n">cart</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">double</span> <span class="tok-n">total</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">cart</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">total</span> <span class="tok-o">+=</span> <span class="tok-n">cart</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">getPrice</span><span class="tok-o">();</span>

    <span class="tok-k">return</span> <span class="tok-n">total</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we can pass in <code>Bananas</code>, <code>Eggs</code>, <code>Water</code>, and many other
kinds of objects in a <code>Priceable</code> array as long as they all implement
this interface. Even though it is impossible to create an object with an
interface type, we can make as many references to it as we want.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_local_and_anonymous_classes">10.4. Advanced: Local and anonymous classes</h3>
<div class="paragraph">
<p>If you have not read <a href="#_advanced_nested_classes">Section 9.5</a>, you may want
to look over that material to be sure that you understand what nested
classes and inner classes are. Recall that a normal inner class is
declared inside of another class, but it is also legal to declare a
class inside of a method. Such a class is called a <em>local class</em>. Under
some circumstances, it is useful to create another kind of inner class
that has no name. That kind of class is called an <em>anonymous class</em>.</p>
</div>
<div class="paragraph">
<p>Both kinds of classes are inner classes. They can access fields and
methods, even if they are marked <code>private</code>. Like other inner classes,
they are not allowed to declare <code>static</code> variables other than constants.
We bring up these kinds of classes in this chapter because they are
commonly used to create a class with a narrow purpose that implements a
required interface.</p>
</div>
<div class="sect3">
<h4 id="_local_classes">10.4.1. Local classes</h4>
<div class="paragraph">
<p>A local class declaration looks like any other class declaration except
that it occurs within a method. The name of a local class only has
meaning inside the method where it is defined. Because the scope of the
name is only the method, a local class cannot have access modifiers such
as <code>public</code>, <code>private</code>, or <code>protected</code> applied to it.</p>
</div>
<div class="paragraph">
<p>Consider the following method in which an <code>Ellipse</code> class is defined
locally. Recall that an ellipse (or oval) has a major (long) axis and a
minor (short) axis. The area of an ellipse is half its major axis times
half its minor axis times \(\pi\). (Because the major and
minor axes of a circle are its diameter, this formula becomes
\(\pi
r^2\) in that case.)</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/10-interfaces/images/ellipse.svg" alt="ellipse" width="50%">
</div>
<div class="title">Figure 41. Area of an ellipse.</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">createEllipse</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">a1</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">a2</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kd">class</span> <span class="tok-nc">Ellipse</span> <span class="tok-o">{</span>
        <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">axis1</span><span class="tok-o">;</span>
        <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">axis2</span><span class="tok-o">;</span>

        <span class="tok-kd">public</span> <span class="tok-nf">Ellipse</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">axis1</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">axis2</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">axis2</span> <span class="tok-o">=</span> <span class="tok-n">axis2</span><span class="tok-o">;</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">axis1</span> <span class="tok-o">=</span> <span class="tok-n">axis1</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getArea</span><span class="tok-o">()</span> <span class="tok-o">{</span>

            <span class="tok-k">return</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">PI</span><span class="tok-o">*</span><span class="tok-mf">0.5</span><span class="tok-o">*</span><span class="tok-n">axis1</span><span class="tok-o">*</span><span class="tok-mf">0.5</span><span class="tok-o">*</span><span class="tok-n">axis2</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
        <span class="tok-o">}</span>

    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The ellipse has area &quot;</span> <span class="tok-o">+</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getArea</span><span class="tok-o">());</span>
    <span class="tok-n">Ellipse</span> <span class="tok-n">e</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Ellipse</span><span class="tok-o">(</span><span class="tok-n">a1</span><span class="tok-o">,</span> <span class="tok-n">a2</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>Ellipse</code> class cannot be referred to by any other methods. Since
an <code>Ellipse</code> class might be useful in other code, a top-level class
would make more sense than this local class. For this reason, local
classes are not commonly used.</p>
</div>
<div class="paragraph">
<p>However, we can make local classes more useful if they implement
interfaces. Consider the following interface which can be implemented by
any shape that returns its area.</p>
</div>
<div id="AreaGettableProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">AreaGettable</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kt">double</span> <span class="tok-nf">getArea</span><span class="tok-o">();</span>
<span class="lineno">3 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The method below takes an array of <code>AreaGettable</code> objects and sums their
areas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span> <span class="tok-nf">sumAreas</span><span class="tok-o">(</span> <span class="tok-n">AreaGettable</span><span class="tok-o">[]</span> <span class="tok-n">shapes</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">double</span> <span class="tok-n">sum</span>  <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">shapes</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">shapes</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">getArea</span><span class="tok-o">();</span>

    <span class="tok-k">return</span> <span class="tok-n">sum</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we create a local class that implements <code>AreaGettable</code>, we can use it</p>
</div>
<div class="paragraph">
<p>in conjunction with the <code>sumAreas()</code> method. In the following method, we
100 <code>Ellipse</code> instances which can then be passed to <code>sumAreas()</code>.
will expand the local <code>Ellipse</code> class in this way and fill an array with</p>
</div>
<div class="paragraph">
<p>public static void createEllipses() {</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">class</span> <span class="tok-nc">Ellipse</span> <span class="tok-kd">implements</span> <span class="tok-n">AreaGettable</span> <span class="tok-o">{</span>
        <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">axis1</span><span class="tok-o">;</span>

        <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">axis2</span><span class="tok-o">;</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">axis1</span> <span class="tok-o">=</span> <span class="tok-n">axis1</span><span class="tok-o">;</span>
        <span class="tok-kd">public</span> <span class="tok-nf">Ellipse</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">axis1</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">axis2</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">axis2</span> <span class="tok-o">=</span> <span class="tok-n">axis2</span><span class="tok-o">;</span>

        <span class="tok-o">}</span>
        <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getArea</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">PI</span><span class="tok-o">*</span><span class="tok-mf">0.5</span><span class="tok-o">*</span><span class="tok-n">axis1</span><span class="tok-o">*</span><span class="tok-mf">0.5</span><span class="tok-o">*</span><span class="tok-n">axis2</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>


    <span class="tok-n">AreaGettable</span><span class="tok-o">[]</span> <span class="tok-n">ellipses</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AreaGettable</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">ellipses</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Ellipse</span><span class="tok-o">(</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">()</span> <span class="tok-o">*</span> <span class="tok-mf">25.0</span><span class="tok-o">,</span>
            <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">()</span> <span class="tok-o">*</span> <span class="tok-mf">25.0</span><span class="tok-o">);</span>
    <span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-n">sumAreas</span><span class="tok-o">(</span> <span class="tok-n">ellipses</span> <span class="tok-o">);</span>

    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The total area is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though the <code>Ellipse</code> class had the <code>getArea()</code> method before, the
compiler would not have allowed us to store <code>Ellipse</code> references in an
<code>AreaGettable</code> array until we marked the <code>Ellipse</code> class as implementing
<code>AreaGettable</code>. As in <a href="#supermarketPricingExample">Example 87</a>, we used
an array of the interface type.</p>
</div>
</div>
<div class="sect3">
<h4 id="subsection:_Anonymous_classes">10.4.2. Anonymous classes</h4>
<div class="paragraph">
<p>This second <code>Ellipse</code> class is more useful since objects with its type
can be passed to other methods as an <code>AreaGettable</code> reference, but
declaring the class locally provides few benefits over a top-level
class. Indeed, local classes are seldom preferable to top-level classes.
Although anonymous classes behave like local classes, they conveniently
can be created at any point.</p>
</div>
<div class="paragraph">
<p>An anonymous class has no name. It is created on the fly from some
interface or parent class and can be stored into a reference with that
type. In the following example, we modify the <code>createEllipses()</code> method
so that it creates an anonymous class which behaves exactly like the
<code>Ellipse</code> class and implements the <code>AreaGettable</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">createEllipses</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">AreaGettable</span><span class="tok-o">[]</span> <span class="tok-n">ellipses</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AreaGettable</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>

    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">value1</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">();</span>
        <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">value2</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">();</span>

        <span class="tok-n">ellipses</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AreaGettable</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">axis1</span> <span class="tok-o">=</span> <span class="tok-n">value1</span><span class="tok-o">;</span>
            <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">axis2</span> <span class="tok-o">=</span> <span class="tok-n">value2</span><span class="tok-o">;</span>

            <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getArea</span><span class="tok-o">()</span> <span class="tok-o">{</span>
                <span class="tok-k">return</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">PI</span><span class="tok-o">*</span><span class="tok-mf">0.5</span><span class="tok-o">*</span><span class="tok-n">axis1</span><span class="tok-o">*</span><span class="tok-mf">0.5</span><span class="tok-o">*</span><span class="tok-n">axis2</span><span class="tok-o">;</span>
            <span class="tok-o">}</span>
        <span class="tok-o">};</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-n">sumAreas</span><span class="tok-o">(</span> <span class="tok-n">ellipses</span> <span class="tok-o">);</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The total area is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax for creating an anonymous class is ugly. First, you use the
<code>new</code> keyword followed by the name of the interface or parent class you
want to create the anonymous class from. Next, you put the arguments to
the parent class constructor inside of parentheses or leave empty
parentheses for an interface. Finally, you open a set of braces and fill
in the body for your anonymous class. When defining an anonymous class,
the entire body is crammed into a single statement, and you will often
need to complete that statement with a semicolon (<code>;</code>).</p>
</div>
<div class="paragraph">
<p>Anonymous classes do not have constructors. If you need a constructor,
you will have to create a local class. Constructors are usually not
necessary since both local and anonymous classes can see local variables
and fields and use those to initialize values. Although any fields can
be used, local variables must be marked <code>final</code> (as shown above) if
their values will be used by local or anonymous classes. This
restriction prevents local variables from being changed unpredictably by
methods in the local class.</p>
</div>
<div class="paragraph">
<p>It may not be easy to see why anonymous classes are useful. Both the
Java API and libraries written by other programmers have many methods
that require parameters whose type implements a particular interface.
Without anonymous classes, you would have to define a named class and
instantiate it to supply such a method with an object with the required
capabilities.</p>
</div>
<div class="paragraph">
<p>Using anonymous classes, you can create such an object in one step,
right where you need it. This practice is commonly used for creating
<em>listeners</em> for GUIs. A listener is an object that does the right action
when a particular event happens. If you need many different listeners in
one program, it can be convenient to create anonymous classes that can
handle each event rather than defining many named classes which each
have a single, narrow purpose. We will use this technique in
<a href="#_constructing_graphical_user_interfaces">Chapter 15</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_sort_it_out">10.5. Solution: Sort it out</h3>
<div class="paragraph">
<p>It is not difficult to move from totaling the value of items as we did
in <a href="#supermarketPricingExample">Example 87</a> to sorting them. Refer to the
following class diagram as we explain our solution to the sorting
problem posed at the beginning of the chapter. Dotted lines are used to
show the implements relationship.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/10-interfaces/images/ageandweight.svg" alt="ageandweight" width="100%">
</div>
<div class="title">Figure 42. Sorting relationships.</div>
</div>
<div class="paragraph">
<p>We will start with the definitions of the two interfaces we will use to
compare objects.</p>
</div>
<div id="AgeableProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Ageable</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kt">int</span> <span class="tok-nf">getAge</span><span class="tok-o">();</span>
<span class="lineno">3 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="WeighableProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Weighable</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kt">double</span> <span class="tok-nf">getWeight</span><span class="tok-o">();</span>
<span class="lineno">3 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Classes implementing these two interfaces will be able to give their age
and weight independently. The next step is to create the <code>Dog</code>, <code>Cat</code>,
<code>Person</code>, and <code>Cheese</code> classes which can do so.</p>
</div>
<div class="paragraph">
<p>We’ll see in <a href="#_inheritance">Chapter 11</a> that the <code>Dog</code>, <code>Cat</code>, and
<code>Person</code> classes could inherit from a common ancestor (such as
<code>Creature</code> or <code>Mammal</code>) which implements the <code>Ageable</code> and <code>Weighable</code>
interfaces. That design could reduce the total amount of code needed.
For now, each class will have to implement both interfaces directly.</p>
</div>
<div id="DogProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Dog</span> <span class="tok-kd">implements</span> <span class="tok-n">Ageable</span><span class="tok-o">,</span> <span class="tok-n">Weighable</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Dog</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">age</span> <span class="tok-o">=</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">weight</span> <span class="tok-o">=</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getAge</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">age</span><span class="tok-o">*</span><span class="tok-mi">7</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getWeight</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">weight</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">13 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cat</span> <span class="tok-kd">implements</span> <span class="tok-n">Ageable</span><span class="tok-o">,</span> <span class="tok-n">Weighable</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Cat</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">age</span> <span class="tok-o">=</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">weight</span> <span class="tok-o">=</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getAge</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">age</span><span class="tok-o">/</span><span class="tok-mi">9</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getWeight</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">weight</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">13 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="PersonProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Person</span> <span class="tok-kd">implements</span> <span class="tok-n">Ageable</span><span class="tok-o">,</span> <span class="tok-n">Weighable</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Person</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">age</span> <span class="tok-o">=</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">weight</span> <span class="tok-o">=</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getAge</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">age</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getWeight</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">weight</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">13 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="CheeseProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Cheese</span> <span class="tok-kd">implements</span> <span class="tok-n">Ageable</span><span class="tok-o">,</span> <span class="tok-n">Weighable</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">type</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Cheese</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">type</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">age</span> <span class="tok-o">=</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">weight</span> <span class="tok-o">=</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">type</span> <span class="tok-o">=</span> <span class="tok-n">type</span><span class="tok-o">;</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getAge</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">age</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getWeight</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">weight</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getType</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">type</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">17 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the classes in place, we can assume that client code will
instantiate some objects and perform operations on them. All that is
necessary is to write the method that will do the sorting. We can wrap
the bubble code given earlier in a method body with only a few changes
to generalize the sort beyond <code>int</code> values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">sort</span><span class="tok-o">(</span> <span class="tok-n">Object</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">age</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">boolean</span> <span class="tok-n">swapped</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
    <span class="tok-n">Object</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
    <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">swapped</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">swapped</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
        <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
            <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">outOfOrder</span><span class="tok-o">(</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">],</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">],</span> <span class="tok-n">age</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
                <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">];</span>
                <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
                <span class="tok-n">swapped</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
            <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this method, the <code>boolean</code> <code>age</code> is <code>true</code> if we are sorting by age
and <code>false</code> if we are sorting by weight. Note that the array and <code>temp</code>
have the <code>Object</code> type. Recall that any object can be stored in a
reference of type <code>Object</code>.</p>
</div>
<div class="paragraph">
<p>The only other change we needed was to replace the greater-than
comparison (<code>&gt;</code>) with the <code>outOfOrder()</code> method, which we define below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">outOfOrder</span><span class="tok-o">(</span> <span class="tok-n">Object</span> <span class="tok-n">o1</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">o2</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">age</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">age</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Ageable</span> <span class="tok-n">age1</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Ageable</span><span class="tok-o">)</span><span class="tok-n">o1</span><span class="tok-o">;</span>
        <span class="tok-n">Ageable</span> <span class="tok-n">age2</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Ageable</span><span class="tok-o">)</span><span class="tok-n">o2</span><span class="tok-o">;</span>
        <span class="tok-k">return</span> <span class="tok-n">age1</span><span class="tok-o">.</span><span class="tok-na">getAge</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-n">age2</span><span class="tok-o">.</span><span class="tok-na">getAge</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
    <span class="tok-k">else</span> <span class="tok-o">{</span>
        <span class="tok-n">Weighable</span> <span class="tok-n">weight1</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Weighable</span><span class="tok-o">)</span><span class="tok-n">o1</span><span class="tok-o">;</span>
        <span class="tok-n">Weighable</span> <span class="tok-n">weight2</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Weighable</span><span class="tok-o">)</span><span class="tok-n">o2</span><span class="tok-o">;</span>
        <span class="tok-k">return</span> <span class="tok-n">weight1</span><span class="tok-o">.</span><span class="tok-na">getWeight</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-n">weight2</span><span class="tok-o">.</span><span class="tok-na">getWeight</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though we have designed our program for objects that implement both
the <code>Ageable</code> and <code>Weighable</code> interfaces, the compiler only sees
<code>Object</code> references in the array. Thus, we must cast each object to the
appropriate interface type to do the comparison. There is a danger that
a user will pass in an array with objects which do not implement both
<code>Ageable</code> and <code>Weighable</code>, causing a <code>ClassCastException</code>. To allow for
universal sorting methods, the Java API defines a <code>Comparable</code> interface
which can be implemented by any class which requires sorting. With Java
5 and higher, the <code>Comparable</code> interface uses generics to be more
type-safe, so we will not discuss how to use this interface until we
cover generics in <a href="#_dynamic_data_structures">Chapter 18</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_interfaces">10.6. Concurrency: Interfaces</h3>
<div class="paragraph">
<p>As we discussed in <a href="#_concepts_making_a_promise">Section 10.2</a>, implementing
an interface means making a promise to have public methods with the
signatures specified in the interface definition. Making a promise seems
only tangentially related to having multiple threads of execution.
Indeed, interfaces and concurrency do not overlap a great deal, but
there are two important areas where they affect one another.</p>
</div>
<div class="paragraph">
<p>The first is that a special interface called the <code>Runnable</code> interface
can be used to create new threads of execution. <code>Runnable</code> is a very
simple interface, containing the single signature <code>void run()</code>. This
means that any object with a <code>run()</code> method that takes no arguments and
returns no values can be used to create a thread of execution. This
makes intuitive sense. A regular program has a single starting place,
the <code>main()</code> method. If we want to run additional threads, some method
needs to be marked as a starting place for each one. For more
information about using the <code>Runnable</code> interface, refer to
<a href="#Runnable">[Runnable]</a>.</p>
</div>
<div class="paragraph">
<p>The second connection between interfaces and concurrency is more
philosophical. What can you specify in an interface? The rules for
interfaces in Java are relatively limited: You can require a class to
have a public instance method with specific parameters and a specific
return type. Java interfaces do not allow you to require a static
method.</p>
</div>
<div class="paragraph">
<p>In <a href="#_synchronization">Chapter 14</a>, we will discuss a key way to
make classes thread-safe by using the<br>
<code>synchronized</code> keyword. Like static, Java does not allow an interface to
specify whether a method is synchronized. Thus, it is impossible to use
an interface to guarantee that a method will be thread-safe.</p>
</div>
<div class="paragraph">
<p>As with all interface usage, this restriction cuts both ways: If you are
designing an interface, there is no way that you can guarantee that
implementing classes use synchronized methods. On the other hand, if you
are implementing an interface, the designer may hope that your class
uses synchronized (or otherwise thread-safe) methods, but the interface
cannot force you to do so. Whenever thread-safety is an issue, make sure
you read (or write) the documentation carefully. Since there is no way
to force programmers to use the <code>synchronized</code> keyword, the
documentation may be the only guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_10">10.7. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise10.1"></a> What is the purpose of an interface?</p>
</li>
<li>
<p><a id="exercise10.2"></a> Why implement an interface when it puts additional requirements on a
class yet adds no functionality?</p>
</li>
<li>
<p><a id="exercise10.3"></a> Is it legal to have methods marked <code>private</code> or <code>protected</code> in an
interface? Why did the designers of Java make this choice?</p>
</li>
<li>
<p><a id="exercise10.4"></a> What is the <code>instanceof</code> keyword used for? Why is it useful in the
context of interfaces?</p>
</li>
<li>
<p><a id="exercise10.5"></a> What kind of programming error causes a <code>ClassCastException</code>?</p>
</li>
<li>
<p><a id="exercise10.6"></a> Create an interface called <code>ColorWavelengths</code> that only contains
constants storing the wavelengths in nanometers for each of the seven
colors of light, as given below.</p>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Color</th>
<th class="tableblock halign-center valign-top">Wavelength (nm)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Red</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">680</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Orange</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">605</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yellow</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">580</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Green</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">545</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Blue</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">473</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Indigo</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">430</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Violet</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">415</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><a id="exercise10.7"></a> Write an interface called <code>Clock</code> that specifies the functionality a
clock should have. Remember that the classes that implement the clock
may tell time in different ways (hourglass, water clock, mechanical
movement, atomic clock), but they must share the basic functionality
that you specify.</p>
</li>
<li>
<p><a id="exercise10.8"></a> There are four compiler errors in the following interface. Name each
one and explain why it is an error.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Singable</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">SOPRANO</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">ALTO</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">sing</span><span class="tok-o">();</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-nf">chant</span><span class="tok-o">();</span>
    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasDeepVoice</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasPerfectPitch</span><span class="tok-o">();</span>
    <span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">tune</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">frequency</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise10.9"></a> Consider the interface defined below.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Explodable</span> <span class="tok-o">{</span>
    <span class="tok-kt">boolean</span> <span class="tok-nf">explode</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">megatons</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which of the following classes properly implement <code>Explodable</code>?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Dynamite</span> <span class="tok-kd">implements</span> <span class="tok-n">Explodable</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">explode</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;BOOM!&quot;</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AtomicBomb</span> <span class="tok-kd">implements</span> <span class="tok-n">Explodable</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">explode</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">size</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;A huge &quot;</span> <span class="tok-o">+</span> <span class="tok-n">size</span> <span class="tok-o">+</span>
            <span class="tok-s">&quot; megaton blast shakes the earth!&quot;</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Grenade</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">explode</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">megatons</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Firecracker</span> <span class="tok-kd">implements</span> <span class="tok-n">Explodable</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-nf">explode</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">megatons</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-o">(</span><span class="tok-n">megatons</span> <span class="tok-o">&lt;</span> <span class="tok-mf">0.0000001</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise10.10"></a> Write a single class that correctly implements the following three
interfaces.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Laughable</span> <span class="tok-o">{</span>
    <span class="tok-kt">boolean</span> <span class="tok-nf">laugh</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">times</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Cryable</span> <span class="tok-o">{</span>
    <span class="tok-kt">void</span> <span class="tok-nf">cry</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">tears</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">moaning</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Shoutable</span> <span class="tok-o">{</span>
    <span class="tok-kt">void</span> <span class="tok-nf">shout</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">volume</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">words</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise10.11"></a> If you are sorting a list of items \(n\) elements long
using bubble sort, what is the minimum number of passes you would need
to be sure the list is sorted, assuming the worst possible ordering of
items to start with? (Hint: Imagine the list is in backwards order.)
What is the minimum number of passes if the list is already sorted?</p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise10.12"></a> Add client code that randomly creates the objects needing sorting in
the solution from <a href="#_solution_sort_it_out">Section 10.5</a>. Design and include
additional classes <code>Wine</code> and <code>Tortoise</code> that both implement <code>Ageable</code>
and <code>Weighable</code>. Add <code>toString()</code> methods to each class so that their
contents can be easily output. Make sure that you print out the list of
objects after sorting to test your implementation.</p>
</li>
<li>
<p><a id="exercise10.13"></a> Refer to the sort given as a solution in <a href="#_solution_sort_it_out">Section 10.5</a>. Add another <code>boolean</code> to the parameters of the sort which
specifies whether the sort is ascending or descending. Make the needed
changes throughout the code to add this functionality.</p>
</li>
<li>
<p><a id="exercise10.14"></a> After learning about threads in
<a href="#_concurrent_programming">Chapter 13</a>, refer to the simple bubble
sort from <a href="#_problem_sort_it_out">Section 10.1</a>. The goal is now to
parallelize the sort. Write some code which will generate an array of
random <code>int</code> values. Design your code so that you can spawn
\(n\) threads. Partition the single array into \(n\)
arrays and map one partition to each thread. Use your bubble sort
implementation to sort each partition. Finally, merge the arrays back
together, in sorted order, into one final array. For now, just use one
thread (ideally the main thread) to do the merge.</p>
<div class="paragraph">
<p>The merge operation is a simple idea, but it is easy to make mistakes in
its implementation. The idea is to have three indexes, one for each of
the two arrays you are merging and one for the result array. Always take
the smaller (or larger, if sorting in descending order) index value from
the two arrays and put it in the result. Then increment the index from
the array you took the data from as well as the index of the result
array. Make sure that you are careful not to go beyond the end of the
arrays which are being merged.</p>
</div>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise10.15"></a> Once you have implemented the sort in parallel from
<a href="#exercise10.14">Exercise 10.14</a>, time it against the sequential
version. Try two, four, and eight different threads. Be sure to create
one random array and use copies of the same array for both the parallel
and sequential versions. Be careful not to sort an array that is already
sorted! Try array sizes of 1,000, 100,000, and 1,000,000. Did the
performance increase? Was it as much as you expected?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inheritance">11. Inheritance</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Your children are not your children.<br>
They are the sons and daughters of Life&#8217;s longing for itself.<br>
They come through you but not from you,<br>
And though they are with you yet they belong not to you.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Khalil Gibran
</div>
</div>
<div class="sect2">
<h3 id="_problem_boolean_circuits">11.1. Problem: Boolean circuits</h3>
<div class="paragraph">
<p>In <a href="#_selection">Chapter 4</a>, we talked extensively about Boolean
algebra and how it can be applied to <code>if</code> statements in order to control
the flow of execution in your program. The commands that we give in
software must be executed by hardware in order to have an effect. It
should not be surprising that computer hardware is built out of digital
circuits that behave according to the same rules as Boolean logic. Each
component of these circuits is called a <em>logic gate</em>. There are logic
gates corresponding to all the Boolean operations you are used to: AND,
OR, XOR, NOT, and others.</p>
</div>
<div class="paragraph">
<p>The output of an AND gate is the result of performing a logical AND on
its inputs. That is, the output is true if and only if both of the
inputs are true. The same correlation exists between each gate and the
Boolean operator with the same name. At the level of circuitry, a 1 (or
&#8220;on&#8221;) is often used to represent true, and a 0 (or &#8220;off&#8221;) is often
used to represent false. Modern computer circuitry is built almost
entirely out of such gates, performing addition, subtraction, and all
other basic operations as complicated combinations of logic gates, where
each digit of every number is a 1 or 0 determined by the circuit.</p>
</div>
<div class="paragraph">
<p>Because these circuits can become large and unwieldy, your problem is to
write a Java program that will allow a user to specify the design of
such a circuit and then see what its output is. The input to this
program will be a text file redirected to standard input that gives the
number of gates of the circuit, lists what each gate is, then gives a
list of connections between them.</p>
</div>
<div class="paragraph">
<p>The following is an example of input to make a circuit with six
components.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>6
true
false
AND
XOR
NOT
OUTPUT 1
2 0 1
3 2 1
4 3
5 4</pre>
</div>
</div>
<div class="paragraph">
<p>The first line specifies the total number of components. The next two
components give either true or false inputs, depending on their name.
The <code>AND</code> and the <code>XOR</code> correspond to gates of the same name which each
take two inputs. The <code>NOT</code> corresponds to a NOT gate with a single
input. Finally, <code>OUTPUT 1</code> is the single output of this circuit that we
are interested in. After the list of gates is a list of how they are
connected. The line <code>2 0 1</code> specifies that gate at index 2, which
happens to be an AND gate, has an input from the gate at index 0 and an
input from the gate at index 1. In other words, the AND gate has one
true input and one false input. The final circuit produced would look
like the following.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/11-inheritance/images/circuit.png" alt="circuit">
</div>
<div class="title">Figure 43. Final circuit diagram showing the six components.</div>
</div>
<div class="paragraph">
<p>We are only interested in the value of any OUTPUT gates. Thus, the
program that is simulating this circuit would print the following.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>OUTPUT 1: true</pre>
</div>
</div>
<div class="paragraph">
<p>There are many different ways to implement a solution to this problem.
The total number of gates is given as the first input. Thus, you can
make an array of gates. When you go to connect them, the indexes given
in the input will map naturally onto the gates in the array. But, what
type should the array be? You could create a <code>Gate</code> class that could do
the work of any conceivable gate, but the implementation would be
awkward. All gates would have to have two inputs even if they don&#8217;t need
any. Adding different kinds of gates later (like a NAND, for example)
would mean rewriting the <code>Gate</code> class.</p>
</div>
<div class="paragraph">
<p>Instead, a cleaner approach to the solution is to use <em>inheritance</em>. In
object oriented languages like Java, inheritance is a process that
allows you to create a new specialized class from a more general,
preexisting class.</p>
</div>
<div class="paragraph">
<p>We recommend the following inheritance hierarchy, in which the arrows
point from each child class to its parent class.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/11-inheritance/images/gates.png" alt="gates">
</div>
<div class="title">Figure 44. Recommended inheritance hierarchy.</div>
</div>
<div class="paragraph">
<p>As you can see, every class inherits from the <code>Gate</code> class. If your
array can be of type <code>Gate</code>, it will be able to hold objects of any
child of <code>Gate</code>. <code>UnaryOperator</code>, <code>BinaryOperator</code>, <code>True</code>, and <code>False</code>
are children of the basic <code>Gate</code> class. Then, <code>Output</code> and <code>Not</code> are
children of <code>UnaryOperator</code> since each only has a single input.
Naturally, <code>And</code>, <code>Or</code>, and <code>Xor</code> are children of <code>BinaryOperator</code>,
since they all have two inputs.</p>
</div>
<div class="paragraph">
<p>If this large collection of classes seems bewildering, do not be
discouraged. Each is very short and easy to write. We&#8217;ll explain what
the inheritance relationship means and how to use it in the next few
sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_refining_classes">11.2. Concepts: Refining classes</h3>
<div class="paragraph">
<p>Here we give a brief overview of inheritance that will give us enough
information to continue onward. We cover some of the deeper areas of the
subject in <a href="#_polymorphism">Chapter 17</a>.</p>
</div>
<div class="sect3">
<h4 id="_basic_inheritance">11.2.1. Basic inheritance</h4>
<div class="paragraph">
<p>The process of creating an inherited class out of an existing class is
called <em>inheriting</em> a class, <em>deriving</em> a class, or simply
<em>subclassing</em>. The class that already exists is called a <em>parent class</em>,
<em>base class</em>, or <em>superclass</em> and the new class is called a <em>child
class</em>, <em>derived class</em>, or <em>subclass</em>.</p>
</div>
<div class="paragraph">
<p>When you create a child class from a parent class, the child class
inherits all of its fields and methods. Thus, you can use a child class
object anywhere you would use the parent class object. This relationship
explains the terms superclass and subclass: Since you can treat any
subclass object as if it were a superclass object, the superclass type
can be thought of as a superset including all subclass objects.</p>
</div>
<div class="paragraph">
<p>Others have noted that the names superclass and subclass sound
misleading because the subclass can usually do more than the superclass.
From that perspective, the child class has a superset of the fields and
methods of its parent class. To avoid confusion, we favor the
terminology of parent and child classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_functionality">11.2.2. Adding functionality</h4>
<div class="paragraph">
<p>When creating a child class, a programmer will normally add
functionality above and beyond the original parent class. Otherwise,
there is little point in creating a child class. For example, a simple
<code>Fish</code> class might be able to do things like swim and feed. A child
<code>Flounder</code> class has the additional ability to camouflage itself.
Another child class, the <code>Shark</code> class, adds the ability to eat other
<code>Fish</code> objects.</p>
</div>
<div class="paragraph">
<p>By adding a few methods, we can create a new class with special
abilities without interfering with the basic functionality of the
underlying class.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_reuse">11.2.3. Code reuse</h4>
<div class="paragraph">
<p>Of course, a programmer who wished to program a <code>Shark</code> class could
simply copy and paste in all the code from the <code>Fish</code> class and then
make the necessary additions. In many ways the evolution of modern
programming languages has been specifically to minimize any copying and
pasting.</p>
</div>
<div class="paragraph">
<p>Old mistakes are propagated with copying and pasting. When discovered,
they must be fixed in several different locations. New mistakes can also
be introduced by cutting and pasting. Instead, we wish to guarantee that
working code from a parent class continues to work in a child class.
Ideally, code from parent classes will not need to be debugged a second
time when a child class is created.</p>
</div>
<div class="paragraph">
<p>Even without the issue of errors introduced by copying and pasting, the
total amount of code increases. By minimizing the amount of code, issues
of performance and storage can be improved, but not always. Object
oriented languages have taken criticism for low speed and high memory
use due to the additional complexities of objects and inheritance, but
compiler optimization, good library design, and improved JVM performance
have brought Java a long way in this area.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_inheritance_in_java">11.3. Syntax: Inheritance in Java</h3>
<div class="paragraph">
<p>In this section we discuss the mechanism for creating a child class in
Java using the <code>extends</code> keyword. Then, we discuss access restriction
and visibility, constructor issues, the <code>Object</code> class, and overriding
methods.</p>
</div>
<div class="sect3">
<h4 id="_the_code_extends_code_keyword">11.3.1. The <code>extends</code> keyword</h4>
<div class="paragraph">
<p>In order to make a child class in Java, we use the <code>extends</code> keyword.
Let&#8217;s give an example using the <code>Fish</code> class defined below. This class
creates a basic fish that can swim, feed, and die. We can check its
color, location, and whether or not it is alive. When it runs out of
energy, it dies.</p>
</div>
<div id="FishProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Fish</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">protected</span> <span class="tok-n">Color</span> <span class="tok-n">color</span> <span class="tok-o">=</span> <span class="tok-n">Color</span><span class="tok-o">.</span><span class="tok-na">GRAY</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">location</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">energy</span> <span class="tok-o">=</span> <span class="tok-mf">100.0</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">alive</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-n">Color</span> <span class="tok-nf">getColor</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">color</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getLocation</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">location</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isAlive</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">alive</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">swim</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">alive</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>			<span class="tok-n">location</span> <span class="tok-o">+=</span> <span class="tok-mf">0.5</span><span class="tok-o">;</span>
<span class="lineno">16 </span>			<span class="tok-n">energy</span> <span class="tok-o">-=</span> <span class="tok-mf">0.25</span><span class="tok-o">;</span>
<span class="lineno">17 </span>		<span class="tok-o">}</span>
<span class="lineno">18 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">energy</span> <span class="tok-o">&lt;=</span> <span class="tok-mf">0.0</span> <span class="tok-o">)</span>
<span class="lineno">19 </span>			<span class="tok-n">die</span><span class="tok-o">();</span>
<span class="lineno">20 </span>	<span class="tok-o">}</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">feed</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-n">energy</span> <span class="tok-o">=</span> <span class="tok-mf">100.0</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">23 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">die</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-n">alive</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">24 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>From here we can create a child class called <code>BoringFish</code> that does
exactly what <code>Fish</code> does. To do so, we use the <code>extends</code> keyword after
the new class name, followed by the parent class name (in this case
<code>Fish</code>), followed by the body of the class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BoringFish</span> <span class="tok-kd">extends</span> <span class="tok-n">Fish</span> <span class="tok-o">{</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as we are allowed to make an empty class, we are allowed to make an
inherited class and add nothing, but doing so is pointless. Instead, we
can make a <code>Flounder</code> class that can change its color.</p>
</div>
<div id="FlounderProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Flounder</span> <span class="tok-kd">extends</span> <span class="tok-n">Fish</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setColor</span><span class="tok-o">(</span> <span class="tok-n">Color</span> <span class="tok-n">newColor</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">color</span> <span class="tok-o">=</span> <span class="tok-n">newColor</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">3 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Flounder</code> class can do everything a <code>Fish</code> can: It can swim, feed,
and die. Now, we add the additional ability of changing color, since
flounders are famous for their ability to mimic the ocean floor they
swim over. Note that the <code>color</code> field in the <code>Fish</code> class has the
<code>protected</code> access modifier, not <code>private</code>. We&#8217;ll come back to this
point.</p>
</div>
<div class="paragraph">
<p>Here is a <code>Shark</code> class that extends <code>Fish</code> in another ways, by adding
the capability of eating other <code>Fish</code>.</p>
</div>
<div id="SharkProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Shark</span> <span class="tok-kd">extends</span> <span class="tok-n">Fish</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">eat</span><span class="tok-o">(</span> <span class="tok-n">Fish</span> <span class="tok-n">fish</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-n">fish</span><span class="tok-o">.</span><span class="tok-na">die</span><span class="tok-o">();</span>
<span class="lineno">4 </span>		<span class="tok-n">feed</span><span class="tok-o">();</span>
<span class="lineno">5 </span>	<span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have added an <code>eat()</code> method that takes another <code>Fish</code> object as
a parameter. First, the <code>Fish</code> parameter is killed; then the <code>eat()</code>
method calls <code>feed()</code>, restoring the energy of the <code>Shark</code> object. Note
that the <code>Shark</code> object is able to call the <code>feed()</code> method even though
it isn&#8217;t defined inside of <code>Shark</code>. Because it inherits from <code>Fish</code>, it
has a version of <code>feed()</code>.</p>
</div>
<div class="sect4">
<h5 id="_single_inheritance_only">Single inheritance only</h5>
<div class="paragraph">
<p>Particularly if you have programmed in C, you might be wondering if it
is possible to have one class inherit from *multiple* classes in Java.
In multiple inheritance, a single class can have many different parents.
Since C supports multiple inheritance, you can have a
<code>SharkAlligatorMan</code> class in that language that inherits from the
<code>Shark</code>, <code>Alligator</code>, and <code>Human</code> classes. If you go back to the sorting
problem from <a href="#_interfaces">Chapter 10</a>, multiple inheritance would
allow us to solve the problem with an <code>Age</code> class and a <code>Weight</code> class
from which <code>Dog</code>, <code>Cat</code>, <code>Person</code>, and <code>Cheese</code> all inherit.</p>
</div>
<div class="paragraph">
<p>However, the designers of Java decided not to allow multiple
inheritance, perhaps for this reason: Imagine a <code>River</code> class with a
<code>run()</code> method and a <code>Politician</code> class with a <code>run()</code> method. It seems
strange to create a class which is both a river and politician, but
there is no rule in C++ which makes doing so impossible. If you did have
a <code>RiverPolitician</code> class which inherits from both, what would happen
when you call the <code>run()</code> method? How would the <code>RiverPolitician</code> class
know which of its parents' methods to pick? Surely, the way that a
politician runs for office is very different from the way a river runs
along its banks.</p>
</div>
<div class="paragraph">
<p>If you find yourself in a situation where you want to use multiple
inheritance in Java, try to reformulate your class hierarchy into one
where your classes implement multiple interfaces. Recall that multiples
interfaces <strong>can</strong> be implemented by a single class in Java, and like
multiple inheritance, this practice allows a single class to be used in
wildly different contexts.</p>
</div>
</div>
<div class="sect4">
<h5 id="_interfaces_using_code_extends_code">Interfaces using <code>extends</code></h5>
<div class="paragraph">
<p>The <code>extends</code> keyword is not limited to classes. It is possible for an
interface to extend another interface. In fact, an interface can extend
any number of other interfaces. As when a class implements multiple
interfaces, each interface in an extends list is separated by commas.</p>
</div>
<div class="paragraph">
<p>When an interface extends other interfaces, it includes all the methods
(and constants) they define. If a class implements an interface that
extends other interfaces, it must contain versions of all the methods
specified by <strong>all</strong> the interfaces. Recall the <code>Ageable</code> and <code>Weighable</code>
interfaces from <a href="#_interfaces">Chapter 10</a>, which specified the
<code>getAge()</code> and <code>getWeight()</code> methods, respectively. We could create an
interface that required both of these methods by extending <code>Ageable</code> and
<code>Weighable</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">AgeableAndWeighable</span> <span class="tok-kd">extends</span> <span class="tok-n">Ageable</span><span class="tok-o">,</span> <span class="tok-n">Weighable</span> <span class="tok-o">{</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could add additional methods to the <code>AgeableAndWeighable</code> interface,
but even empty it will enforce the contracts defined by both <code>Ageable</code>
and <code>Weighable</code>. It is generally not necessary to create an interface
that extends other interfaces, since a class could implement each of the
individual interfaces. Nevertheless, it can be used as a convenience to
save typing or to create a reference type with certain guaranteed
abilities.</p>
</div>
<div class="paragraph">
<p>Note that a class can never extend an interface. Likewise, an interface
cannot extend a class or implement another interface.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_access_restriction_and_visibility">11.3.2. Access restriction and visibility</h4>
<div class="paragraph">
<p>The <code>Shark</code> example above gives an example of inheritance in which the
child class only calls methods of the parent class and does not
interfere with the fields of the parent class. Generally, this is a good
thing because it protects the state of the parent class from getting
corrupted. However, it is not always possible. If we return to the
earlier <code>Flounder</code> example, we had to change the <code>color</code> field directly,
since there was no mutator to change it.</p>
</div>
<div class="paragraph">
<p>Perhaps the <code>Fish</code> class was poorly designed because it did not have a
<code>color</code> mutator. On the other hand, most fish cannot change their color,
so it might be good design to prevent outside code from changing the
<code>color</code> field with such a mutator. There are no absolute rules for
making these kinds of decisions.</p>
</div>
<div class="paragraph">
<p>We introduced access modifiers in <a href="#subsection:Access_modifiers">Section 9.3.4</a>, but inheritance gives them new meaning. Recall that the
access modifier for the <code>color</code> field of <code>Fish</code> was <code>protected</code>. A field
or method with the <code>protected</code> modifier can be accessed by all child
classes (as well as classes in the same package). If the modifier for
<code>color</code> was <code>private</code>, the <code>Flounder</code> class would not be able to change
it directly.</p>
</div>
<div class="paragraph">
<p>In the <code>Shark</code> class, it <strong>must</strong> use mutators to change the value of its
own <code>energy</code> and the <code>alive</code> field of <code>fish</code> since they are both marked
<code>private</code>. It is generally preferable to use mutator and accessor
methods whenever possible, even within the same class, so that fields
are not inadvertently corrupted.</p>
</div>
</div>
<div class="sect3">
<h4 id="_constructors_2">11.3.3. Constructors</h4>
<div class="paragraph">
<p>When you create a child class, you can think of it as if a copy of the
parent class exists inside of the child. When you create an object from
a child class, how do you properly initialize the fields inside the
parent class?</p>
</div>
<div class="paragraph">
<p>As we discussed in <a href="#_classes">Chapter 9</a>, every class has a
constructor, even if it is a default one created for you. Whenever the
constructor for a child class is invoked, the constructor for the parent
class is invoked as well. If the parent class is also the child of some
other class, that grandparent class will have its constructor invoked as
well. This chain of constructors will continue, reaching all the way
back to the ultimate ancestor, <code>Object</code>.</p>
</div>
<div class="paragraph">
<p>When writing the constructor for a child class, the first line of it
should be the call to the parent constructor. If you don&#8217;t explicitly
call the parent constructor, its default (no parameter) constructor will
be called. If the parent class does not have a default constructor, then
leaving off an appropriate call to a parent constructor will result in a
compiler error. Consider the following two classes.</p>
</div>
<div id="ParentProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Parent</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Parent</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="ChildProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Child</span> <span class="tok-kd">extends</span> <span class="tok-n">Parent</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Child</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-s">&quot;Baby &quot;</span> <span class="tok-o">+</span> <span class="tok-n">name</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown above, the <code>super</code> keyword is used to call the constructor of a
parent class. The <code>Child</code> constructor takes a name and prepends the
<code>String</code> <code>"Baby "</code> to it before passing it on to the <code>Parent</code>
constructor.</p>
</div>
<div class="paragraph">
<p>In a similar way, the <code>this</code> keyword can be used to call another
constructor in the <strong>same</strong> class, provided that a constructor to the
<strong>parent</strong> class is eventually reached. For example, we could add the
following constructor to the <code>Child</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-nf">Child</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">(</span> <span class="tok-s">&quot;Unknown&quot;</span> <span class="tok-o">);</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This second constructor will be called whenever a new <code>Child</code> object is
instantiated without any arguments. It will supply the <code>String</code>
<code>"Unknown"</code> to the other constructor, which will add <code>"Baby"</code> and pass
it on to the <code>Parent</code> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="_overriding_methods_and_hiding_fields">11.3.4. Overriding methods and hiding fields</h4>
<div class="paragraph">
<p>Sometimes a parent method does not provide all the power you want in the
child class. It is possible to <em>override</em> a parent method in the child
class. Then, when that method is called on child objects, the new method
will be called. The new method has exactly the same name and parameters.
The return type must be either exactly the same or a child class of the
original return type.</p>
</div>
<div class="paragraph">
<p>We can return to the <code>Fish</code> class example and make a new kind of fish
that never moves.</p>
</div>
<div id="LazyFishProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LazyFish</span> <span class="tok-kd">extends</span> <span class="tok-n">Fish</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">swim</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;I think I&#39;ll just sit here.&quot;</span><span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever someone calls the <code>swim()</code> method on a <code>LazyFish</code> object, it
will just announce that it is going to sit where it is. Its location is
not updated and its energy does not change.</p>
</div>
<div class="paragraph">
<p>On the other hand, we could create another child class that swims twice
as fast as the original <code>Fish</code>.</p>
</div>
<div id="FastFishProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FastFish</span> <span class="tok-kd">extends</span> <span class="tok-n">Fish</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">swim</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">swim</span><span class="tok-o">();</span>
<span class="lineno">4 </span>		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">swim</span><span class="tok-o">();</span>
<span class="lineno">5 </span>	<span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Every time <code>swim()</code> is called on objects of type <code>FastFish</code>, those
objects will call the <code>swim()</code> method from <code>Fish</code> twice. Thus, this fish
will move twice as fast (and consume twice as much energy). Because the
<code>location</code> and <code>energy</code> fields are <code>private</code>, we must use methods from
<code>Fish</code> to affect them. Note the use of the keyword <code>super</code>, allowing us
to specify that we want to call the <code>swim()</code> method from <code>Fish</code> and not
just call the same method from <code>FastFish</code> again. Using the <code>super</code>
keyword, we can call methods from the parent. If the parent did not
override a method from an ancestor class, we can still use <code>super</code> to
call a method from the last class that did implement the method.
However, Java does not allow us to skip over a parent method to call a
grandparent method if there is an implementation in the parent class. In
other words, there is no way to call something like a
<code>super.super.swim()</code> method.</p>
</div>
<div class="paragraph">
<p>Just as methods are overridden, fields are <em>hidden</em>. It is perfectly
legal to declare a field with the same name as a field from a parent
class, but the new field will then be used instead of the old one.</p>
</div>
<div id="AProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">A</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getA</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">a</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setA</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="BProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">B</span> <span class="tok-kd">extends</span> <span class="tok-n">A</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setA</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">4 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Class <code>B</code> is a child of class <code>A</code> and declares a field called <code>a</code>,
hiding a field of the same name from <code>A</code>. However, which <code>a</code> is which
can cause some confusion. Consider the following fragment of code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">A</span> <span class="tok-n">objectA</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">A</span><span class="tok-o">();</span>
<span class="tok-n">B</span> <span class="tok-n">objectB</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">B</span><span class="tok-o">();</span>
<span class="tok-n">objectA</span><span class="tok-o">.</span><span class="tok-na">setA</span><span class="tok-o">(</span> <span class="tok-mi">5</span> <span class="tok-o">);</span>
<span class="tok-n">objectB</span><span class="tok-o">.</span><span class="tok-na">setA</span><span class="tok-o">(</span> <span class="tok-mi">10</span> <span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;A = &quot;</span> <span class="tok-o">+</span> <span class="tok-n">objectA</span><span class="tok-o">.</span><span class="tok-na">getA</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;B = &quot;</span> <span class="tok-o">+</span> <span class="tok-n">objectB</span><span class="tok-o">.</span><span class="tok-na">getA</span><span class="tok-o">()</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of this code is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>A = 5
B = 0</pre>
</div>
</div>
<div class="paragraph">
<p>Calling the <code>setA()</code> method on an <code>A</code> object sets the <code>a</code> field inside
of <code>A</code>. Calling the overridden <code>setA()</code> method on a <code>B</code> object sets the
<code>a</code> field inside of <code>B</code>, but since the <code>getA()</code> method has not been
overridden, the <code>a</code> field from the <code>A</code> parent class part of <code>B</code> is
returned. Since that <code>a</code> field in <code>B</code> has not been given a value, it
still has the default value of <code>0</code>. Both <code>a</code> fields exist inside of <code>B</code>,
but the methods are poorly designed, leaving one field capable only of
being set and the other capable only of being retrieved.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_code_object_code_class">11.3.5. The <code>Object</code> class</h4>
<div class="paragraph">
<p>You may not have realized it, but every class you created in Java used
inheritance. To provide uniformity, the designers of Java made every
class the child (or grandchild or great-grandchild&#8230;&#8203; ) of a class
called <code>Object</code>. When you omit the <code>extends</code> clause in a class
definition, you are making that class a direct child of <code>Object</code>.</p>
</div>
<div class="paragraph">
<p>As a consequence, <strong>all</strong> classes in Java are guaranteed to have the
following methods.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Method</strong></th>
<th class="tableblock halign-left valign-top"><strong>Purpose</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clone()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make a separate copy of an object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>equals()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determine if two objects are the same.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>finalize()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perform cleanup when an object is garbage collected. Similar to a destructor in C++. Rarely used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getClass()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find out what the class type of a given object is.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hashCode()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get the hash code for an object, useful for making hash
tables of objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>notify()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for synchronization with threaded programs. More in
<a href="#_synchronization">Chapter 14</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>notifyAll()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as previous.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>toString()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get a <code>String</code> representation of the given object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wait()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used with <code>notify()</code> and <code>notifyAll()</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Java provides basic implementations for most of these, but if you want
them to work well for your object, you will have to override some of
them with appropriate methods. For example, the <code>Object</code> version of
<code>toString()</code> returns the virtual address of the object in JVM memory.</p>
</div>
<div class="paragraph">
<p>Nevertheless, API classes usually have good <code>equals()`and `toString()</code>
methods. Aside from making a few useful methods available, having a
common ancestor for all classes means that you can store any object in
an <code>Object</code> reference. An array of type <code>Object</code> can hold anything,
provided that you know how to retrieve it. We discuss the finer points
of inheritance and polymorphism in <a href="#_polymorphism">Chapter 17</a> and
how to build lists and other data structures using <code>Object</code> references
in <a href="#_dynamic_data_structures">Chapter 18</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_problem_solving_with_inheritance">11.4. Examples: Problem solving with inheritance</h3>
<div class="paragraph">
<p>Here are two extended examples showing how we can use inheritance to
solve problems. First, we revisit the student roster example from
<a href="#_classes">Chapter 9</a> and then move onto an inheritance hierarchy
of polygons.</p>
</div>
<div class="exampleblock">
<div class="title">Example 88. Graduate student roster</div>
<div class="content">
<div class="paragraph">
<p>The <code>Student</code> class we create in <a href="#_classes">Chapter 9</a> is useful
but works only for undergraduate students. With only a few additions, we
can make it suitable for graduate students as well. First, lets take
another look at the <code>Student</code> class.</p>
</div>
<div id="StudentProgram" class="listingblock">
<div class="title">Program 46. Basic student class, designed for undergraduates.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Student</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">YEARS</span> <span class="tok-o">=</span>
<span class="lineno"> 3 </span>	<span class="tok-o">{</span><span class="tok-s">&quot;Freshman&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Sophomore&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Junior&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Senior&quot;</span><span class="tok-o">};</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">year</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">GPA</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Student</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">year</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">GPA</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>		<span class="tok-n">setName</span><span class="tok-o">(</span> <span class="tok-n">name</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-n">setYear</span><span class="tok-o">(</span> <span class="tok-n">year</span> <span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-n">setGPA</span><span class="tok-o">(</span> <span class="tok-n">GPA</span> <span class="tok-o">);</span>
<span class="lineno">12 </span>	<span class="tok-o">}</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setName</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">15 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setYear</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">year</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">year</span> <span class="tok-o">=</span> <span class="tok-n">year</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setGPA</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">GPA</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">GPA</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">GPA</span> <span class="tok-o">&lt;=</span> <span class="tok-mf">4.0</span> <span class="tok-o">)</span>
<span class="lineno">19 </span>			<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">GPA</span> <span class="tok-o">=</span> <span class="tok-n">GPA</span><span class="tok-o">;</span>
<span class="lineno">20 </span>		<span class="tok-k">else</span>
<span class="lineno">21 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Invalid GPA: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">GPA</span><span class="tok-o">);</span>
<span class="lineno">22 </span>	<span class="tok-o">}</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">};</span>
<span class="lineno">25 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getYear</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">year</span><span class="tok-o">;</span> <span class="tok-o">};</span>
<span class="lineno">26 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getGPA</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">GPA</span><span class="tok-o">;</span> <span class="tok-o">};</span>
<span class="lineno">27 </span>
<span class="lineno">28 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">29 </span>		<span class="tok-k">return</span> <span class="tok-n">name</span> <span class="tok-o">+</span> <span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">YEARS</span><span class="tok-o">[</span><span class="tok-n">year</span><span class="tok-o">]</span> <span class="tok-o">+</span>
<span class="lineno">30 </span>			<span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">GPA</span><span class="tok-o">;</span>
<span class="lineno">31 </span>	<span class="tok-o">}</span>
<span class="lineno">32 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We want to create a <code>GraduateStudent</code> class that inherits from
<code>Student</code>. We need to add a thesis topic for each graduate student.
Likewise, we need to update the <code>toString()</code> method so that outputs the
appropriate data. We use <code>4</code> as the year value for graduate students.</p>
</div>
<div id="GraduateStudentProgram" class="listingblock">
<div class="title">Program 47. Class extending <code>Student</code> to add graduate student capabilities.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">GraduateStudent</span> <span class="tok-kd">extends</span> <span class="tok-n">Student</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">topic</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-nf">GraduateStudent</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">GPA</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">topic</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-n">GPA</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">setTopic</span><span class="tok-o">(</span> <span class="tok-n">topic</span> <span class="tok-o">);</span>
<span class="lineno"> 7 </span>	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setTopic</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">topic</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">topic</span> <span class="tok-o">=</span> <span class="tok-n">topic</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>		<span class="tok-k">return</span> <span class="tok-n">getName</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">+</span> <span class="tok-s">&quot;Graduate&quot;</span> <span class="tok-o">+</span>
<span class="lineno">13 </span>			<span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">getGPA</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot;\tTopic: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">topic</span><span class="tok-o">;</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because we are inheriting most of the fields we need, we only need to
declare the <code>topic</code> field. Then, in the <code>GraduateStudent</code> constructor,
we call the parent constructor with the name, year, and GPA and then set
<code>topic</code> to the input value.</p>
</div>
<div class="paragraph">
<p>Finally, we override the <code>toString()</code> method so that <code>"Graduate"</code> and
the thesis topic are output. Note that we must use the <code>getName()</code> and
<code>getGPA()</code> accessors since the actual values are <code>private</code>.</p>
</div>
<div class="paragraph">
<p>Most code that uses <code>Student</code> objects should be able to incorporate
<code>GraduateStudent</code> objects easily. Code that creates <code>Student</code> objects
from input will need slight modifications to handle the thesis topic.
Also, old code that only expects values of <code>0</code>, <code>1</code>, <code>2</code>, or <code>3</code> for
year may need to be modified so that it doesn&#8217;t break.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 89. Polygons</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s examine a class hierarchy used to create several different
polygons. Our base class needs to be general. It can represent any kind
of closed polygon, using an array of <code>Point</code> objects. The <code>Point</code> class
is a way to package up <code>x</code> and <code>y</code> values of type <code>int</code>. Each coordinate
in the array gives the next vertex of the polygon.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Polygon</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>	<span class="tok-kd">protected</span> <span class="tok-n">Point</span><span class="tok-o">[]</span> <span class="tok-n">points</span><span class="tok-o">;</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Polygon</span><span class="tok-o">(</span> <span class="tok-n">Point</span><span class="tok-o">[]</span> <span class="tok-n">points</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">points</span> <span class="tok-o">=</span> <span class="tok-n">points</span><span class="tok-o">;</span>
<span class="lineno">8 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>import</code> statement allows us to use the <code>Point</code> class as well as the
<code>Graphics</code> class. Our array of type <code>Point</code> is declared <code>protected</code> so
that the child classes we want to create can access it directly. The
constructor takes an array of type <code>Point</code> and stores it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getPerimeter</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-kt">double</span> <span class="tok-n">perimeter</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">points</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 4 </span>			<span class="tok-n">perimeter</span> <span class="tok-o">+=</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">]);</span>
<span class="lineno"> 5 </span>		<span class="tok-n">perimeter</span> <span class="tok-o">+=</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-n">points</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">]);</span>
<span class="lineno"> 6 </span>		<span class="tok-k">return</span> <span class="tok-n">perimeter</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">draw</span><span class="tok-o">(</span> <span class="tok-n">Graphics</span> <span class="tok-n">g</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">points</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>			<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">drawLine</span><span class="tok-o">(</span><span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">x</span><span class="tok-o">,</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">y</span><span class="tok-o">,</span>
<span class="lineno">12 </span>				<span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">x</span><span class="tok-o">,</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">y</span><span class="tok-o">);</span>
<span class="lineno">13 </span>		<span class="tok-n">g</span><span class="tok-o">.</span><span class="tok-na">drawLine</span><span class="tok-o">(</span><span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">x</span><span class="tok-o">,</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">y</span><span class="tok-o">,</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-n">points</span><span class="tok-o">.</span><span class="tok-na">length</span>
<span class="lineno">14 </span>			<span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">x</span><span class="tok-o">,</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-n">points</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">y</span><span class="tok-o">);</span>
<span class="lineno">15 </span>	<span class="tok-o">}</span>
<span class="lineno">16 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The number of things that can be done with this very general <code>Polygon</code>
class are limited. The <code>getPerimeter()</code> method can determine the length
of the perimeter by adding the lengths of the segments connecting the
vertices. It is possible to determine the area enclosed by a list of
vertices, but the algorithm is complex. The <code>draw()</code> method draws the
polygon by drawing each line segment that connects adjacent vertices. We
discuss the <code>Graphics</code> class in <a href="#_constructing_graphical_user_interfaces">Chapter 15</a>. If you compile and run this code, please note that in
Java graphics, like many computer graphics environments, the upper left
hand corner of the screen or window is considered (0,0), and
\(y\) values <strong>increase</strong> going downward, not upward.</p>
</div>
<div class="paragraph">
<p>With this basic parent class defined, we can design a <code>Triangle</code> class
as a child of it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Triangle</span> <span class="tok-kd">extends</span> <span class="tok-n">Polygon</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Triangle</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">x1</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y1</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">x2</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y2</span><span class="tok-o">,</span>
<span class="lineno"> 5 </span>		<span class="tok-kt">int</span> <span class="tok-n">x3</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y3</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">toPointArray</span><span class="tok-o">(</span> <span class="tok-n">x1</span><span class="tok-o">,</span> <span class="tok-n">y1</span><span class="tok-o">,</span> <span class="tok-n">x2</span><span class="tok-o">,</span> <span class="tok-n">y2</span><span class="tok-o">,</span> <span class="tok-n">x3</span><span class="tok-o">,</span> <span class="tok-n">y3</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno"> 7 </span>	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">protected</span> <span class="tok-kd">static</span> <span class="tok-n">Point</span><span class="tok-o">[]</span> <span class="tok-nf">toPointArray</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">x1</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y1</span><span class="tok-o">,</span>
<span class="lineno">10 </span>		<span class="tok-kt">int</span> <span class="tok-n">x2</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y2</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">x3</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y3</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>		<span class="tok-n">Point</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-k">new</span> <span class="tok-n">Point</span><span class="tok-o">(</span><span class="tok-n">x1</span><span class="tok-o">,</span> <span class="tok-n">y1</span><span class="tok-o">),</span> <span class="tok-k">new</span> <span class="tok-n">Point</span><span class="tok-o">(</span><span class="tok-n">x2</span><span class="tok-o">,</span> <span class="tok-n">y2</span><span class="tok-o">),</span>
<span class="lineno">12 </span>			<span class="tok-k">new</span> <span class="tok-n">Point</span><span class="tok-o">(</span><span class="tok-n">x3</span><span class="tok-o">,</span> <span class="tok-n">y3</span><span class="tok-o">)};</span>
<span class="lineno">13 </span>		<span class="tok-k">return</span> <span class="tok-n">array</span><span class="tok-o">;</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the <code>import</code> statement is for the <code>Point</code> class. One reasonable
constructor to make a triangle would take in six values, giving the
\(x\) and \(y\) coordinates of the three vertices of
the triangle. Of course, the <code>Polygon</code> class requires an array of type
<code>Point</code>, but the <code>super</code> constructor must be the first line of the
<code>Triangle</code> constructor. To solve this problem, we create a <code>static</code>
method to package the values into an array. We could have done the same
thing in the argument list of the <code>super</code> constructor, but it would have
looked messier. The <code>toPointArray()</code> is <code>protected</code> because there is no
reason to let external code have access to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getType</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-kt">double</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]);</span>
<span class="lineno"> 3 </span>		<span class="tok-kt">double</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]);</span>
<span class="lineno"> 4 </span>		<span class="tok-kt">double</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">].</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]);</span>
<span class="lineno"> 5 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">==</span> <span class="tok-n">b</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">b</span> <span class="tok-o">==</span> <span class="tok-n">c</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>			<span class="tok-k">return</span> <span class="tok-s">&quot;Equilateral&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">==</span> <span class="tok-n">b</span> <span class="tok-o">||</span> <span class="tok-n">b</span> <span class="tok-o">==</span> <span class="tok-n">c</span> <span class="tok-o">||</span> <span class="tok-n">a</span> <span class="tok-o">==</span> <span class="tok-n">c</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>			<span class="tok-k">return</span> <span class="tok-s">&quot;Isosceles&quot;</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">return</span> <span class="tok-s">&quot;Scalene&quot;</span><span class="tok-o">;</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the <code>getType()</code> method allows us to do something specific with
triangles. We can use the <code>distance()</code> method from the <code>Point</code> class to
find the length of each of the three sides. By comparing these lengths,
we can determine whether the triangle represented is equilateral,
isosceles, or scalene. Of course, computing the perimeter and drawing
the triangle are already taken care of by the <code>Polygon</code> class.</p>
</div>
<div class="paragraph">
<p>We can easily make a <code>Rectangle</code> class along the same lines.</p>
</div>
<div id="RectangleProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Rectangle</span> <span class="tok-kd">extends</span> <span class="tok-n">Polygon</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Rectangle</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">length</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">width</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">toArray</span><span class="tok-o">(</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-n">length</span><span class="tok-o">,</span> <span class="tok-n">width</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>	<span class="tok-o">}</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">protected</span> <span class="tok-kd">static</span> <span class="tok-n">Point</span><span class="tok-o">[]</span> <span class="tok-nf">toArray</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">length</span><span class="tok-o">,</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">int</span> <span class="tok-n">width</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-n">Point</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-k">new</span> <span class="tok-n">Point</span><span class="tok-o">(</span><span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span><span class="tok-o">),</span> <span class="tok-k">new</span> <span class="tok-n">Point</span><span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">length</span><span class="tok-o">,</span> <span class="tok-n">y</span><span class="tok-o">),</span>
<span class="lineno">11 </span>			<span class="tok-k">new</span> <span class="tok-n">Point</span><span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">length</span><span class="tok-o">,</span> <span class="tok-n">y</span> <span class="tok-o">+</span> <span class="tok-n">width</span><span class="tok-o">),</span> <span class="tok-k">new</span> <span class="tok-n">Point</span><span class="tok-o">(</span><span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span> <span class="tok-o">+</span> <span class="tok-n">width</span><span class="tok-o">)};</span>
<span class="lineno">12 </span>		<span class="tok-k">return</span> <span class="tok-n">array</span><span class="tok-o">;</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getArea</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>		<span class="tok-kt">int</span> <span class="tok-n">length</span> <span class="tok-o">=</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">x</span> <span class="tok-o">-</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">x</span><span class="tok-o">;</span>
<span class="lineno">17 </span>		<span class="tok-kt">int</span> <span class="tok-n">width</span> <span class="tok-o">=</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">].</span><span class="tok-na">y</span> <span class="tok-o">-</span> <span class="tok-n">points</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">y</span><span class="tok-o">;</span>
<span class="lineno">18 </span>		<span class="tok-k">return</span> <span class="tok-n">length</span> <span class="tok-o">*</span> <span class="tok-n">width</span><span class="tok-o">;</span>
<span class="lineno">19 </span>	<span class="tok-o">}</span>
<span class="lineno">20 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor is similar to the <code>Triangle</code> constructor except that the
upper left corner of the rectangle is specified, along with the length
and the width. From these values, the appropriate array of <code>Point</code>
values is generated. The rectangle-specific code that we add is the
<code>getArea()</code> method, which determines the length and width of the
rectangle by examining the <code>points</code> array and then calculates area.</p>
</div>
<div class="paragraph">
<p>Using inheritance as form of specialization, we can go one step further
and make a <code>Square</code> class.</p>
</div>
<div id="SquareProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Square</span> <span class="tok-kd">extends</span> <span class="tok-n">Rectangle</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Square</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">size</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-n">size</span><span class="tok-o">,</span> <span class="tok-n">size</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This very short class uses everything available in <code>Rectangle</code> but
simplifies the constructor slightly so that the user does not have to
enter both length and width.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_boolean_circuits">11.5. Solution: Boolean circuits</h3>
<div class="paragraph">
<p>Here we present our solution to the Boolean Circuits problem. First, we
define a parent class for all circuit components, called <code>Gate</code>.</p>
</div>
<div id="GateProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Gate</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Gate</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-k">return</span> <span class="tok-n">getName</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot;: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">getValue</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Gate</code> class doesn&#8217;t do anything except set up ways to store a name
and to get a value. From <code>Gate</code>, we can define the most basic circuit
components: gates whose value is either always true or always false. It
doesn&#8217;t really matter what <code>getValue()</code> gives back for <code>Gate</code>, but we
can say that it is <code>false</code>.</p>
</div>
<div id="TrueProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">True</span> <span class="tok-kd">extends</span> <span class="tok-n">Gate</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">True</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-s">&quot;true&quot;</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">4 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="FalseProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">False</span> <span class="tok-kd">extends</span> <span class="tok-n">Gate</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">False</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-s">&quot;false&quot;</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">4 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To conform with the constructor for <code>Gate</code>, these new classes must pass
a <code>String</code> giving their name to the <code>super</code> constructor. The values
returned by the <code>getValue()</code> method are clear. Next, we want to create a
class that can be used for general unary operators.</p>
</div>
<div id="UnaryOperatorProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UnaryOperator</span> <span class="tok-kd">extends</span> <span class="tok-n">Gate</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">private</span> <span class="tok-n">Gate</span> <span class="tok-n">input</span><span class="tok-o">;</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-nf">UnaryOperator</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">name</span> <span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">5 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setInput</span><span class="tok-o">(</span> <span class="tok-n">Gate</span> <span class="tok-n">input</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">input</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">6 </span>	<span class="tok-kd">public</span> <span class="tok-n">Gate</span> <span class="tok-nf">getInput</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">input</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">7 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The important addition in the <code>UnaryOperator</code> class is the <code>input</code>
field. Any unary operator must have a single input gate that it operates
on. This class provides a mutator and accessor for <code>input</code>, as well as
an appropriate constructor. From <code>UnaryOperator</code>, we can derive two
specific operators.</p>
</div>
<div id="OutputProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Output</span> <span class="tok-kd">extends</span> <span class="tok-n">UnaryOperator</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Output</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-s">&quot;OUTPUT &quot;</span> <span class="tok-o">+</span> <span class="tok-n">i</span> <span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">getInput</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">4 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="NotProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Not</span> <span class="tok-kd">extends</span> <span class="tok-n">UnaryOperator</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Not</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-s">&quot;NOT&quot;</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-o">!(</span><span class="tok-n">getInput</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">());</span> <span class="tok-o">}</span>
<span class="lineno">4 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Output</code> class takes in an <code>int</code> value and uses it to make a
numbered name. Its <code>getValue()</code> method simply returns the value of its
input. The <code>Output</code> class doesn&#8217;t do anything except serve as a marker
for circuit output. The <code>Not</code> class uses <code>"NOT"</code> as the name supplied to
the <code>super</code> constructor and returns the logical NOT of the value of its
input.</p>
</div>
<div class="paragraph">
<p>Just as we did for unary operators, we also need a base class for binary
operators.</p>
</div>
<div id="BinaryOperatorProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BinaryOperator</span> <span class="tok-kd">extends</span> <span class="tok-n">Gate</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-n">Gate</span> <span class="tok-n">operand1</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-n">Gate</span> <span class="tok-n">operand2</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">BinaryOperator</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">name</span> <span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-n">Gate</span> <span class="tok-nf">getOperand1</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">operand1</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-n">Gate</span> <span class="tok-nf">getOperand2</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">operand2</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setOperand1</span><span class="tok-o">(</span> <span class="tok-n">Gate</span> <span class="tok-n">operand</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">operand1</span> <span class="tok-o">=</span> <span class="tok-n">operand</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setOperand2</span><span class="tok-o">(</span> <span class="tok-n">Gate</span> <span class="tok-n">operand</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">operand2</span> <span class="tok-o">=</span> <span class="tok-n">operand</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>BinaryOperator</code> has two <code>Gate</code> fields, <code>operand1</code> and <code>operand2</code>,
representing the inputs to the operator. The <code>BinaryOperator</code> class has
an appropriate constructor and then accessors and mutators for the
operands. With <code>BinaryOperator</code> as a parent, only a few lines of code
are necessary to define any logical binary operator.</p>
</div>
<div id="AndProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">And</span> <span class="tok-kd">extends</span> <span class="tok-n">BinaryOperator</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">And</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-s">&quot;AND&quot;</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-k">return</span> <span class="tok-n">getOperand1</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span>
<span class="lineno">6 </span>			<span class="tok-n">getOperand1</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">();</span>
<span class="lineno">7 </span>	<span class="tok-o">}</span>
<span class="lineno">8 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="OrProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Or</span> <span class="tok-kd">extends</span> <span class="tok-n">BinaryOperator</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Or</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-s">&quot;OR&quot;</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-k">return</span> <span class="tok-n">getOperand1</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">()</span> <span class="tok-o">||</span>
<span class="lineno">6 </span>			<span class="tok-n">getOperand1</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">();</span>
<span class="lineno">7 </span>	<span class="tok-o">}</span>
<span class="lineno">8 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="XorProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Xor</span> <span class="tok-kd">extends</span> <span class="tok-n">BinaryOperator</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Xor</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-s">&quot;XOR&quot;</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-k">return</span> <span class="tok-n">getOperand1</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">()</span> <span class="tok-o">^</span> <span class="tok-n">getOperand1</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">();</span>
<span class="lineno">6 </span>	<span class="tok-o">}</span>
<span class="lineno">7 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In each case, a constructor passes the name of the gate to the <code>super</code>
constructor. Then, each <code>getValue()</code> method gets the values from the two
operands and combines them with AND, OR, or XOR, respectively. This
design allows the programmer to focus only on the important element of
each class. Adding new classes for NAND, NOR, or any other possible
logical binary operator would be quick.</p>
</div>
<div class="paragraph">
<p>The client code that uses these classes to simulate a circuit follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BooleanCircuit</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno">6 </span>		<span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">7 </span>		<span class="tok-n">Gate</span><span class="tok-o">[]</span> <span class="tok-n">gates</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Gate</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">];</span>
<span class="lineno">8 </span>		<span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno">9 </span>		<span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First we have the <code>import</code> needed for <code>Scanner</code>. Next, we read in the
total number of gates and create an array of type <code>Gate</code> of that length
and declare a few useful temporary variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-c1">// Create gates</span>
<span class="lineno"> 2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">count</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>			<span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">toUpperCase</span><span class="tok-o">();</span>
<span class="lineno"> 4 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;true&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>				<span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">True</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;false&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>				<span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">False</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;AND&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>				<span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">And</span><span class="tok-o">();</span>
<span class="lineno">10 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;OR&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>				<span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Or</span><span class="tok-o">();</span>
<span class="lineno">12 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;XOR&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>				<span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Xor</span><span class="tok-o">();</span>
<span class="lineno">14 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;NOT&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">15 </span>				<span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Not</span><span class="tok-o">();</span>
<span class="lineno">16 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;OUTPUT&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>				<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">18 </span>				<span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Output</span><span class="tok-o">(</span> <span class="tok-n">value</span> <span class="tok-o">);</span>
<span class="lineno">19 </span>			<span class="tok-o">}</span>
<span class="lineno">20 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, we parse the input, creating an appropriate gate based on the name
read in. In the case of an OUTPUT gate, we must also read in a number so
that we can identify which OUTPUT gate is which later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-c1">//connect gates</span>
<span class="lineno"> 2 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextInt</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 4 </span>			<span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">value</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;AND&quot;</span><span class="tok-o">)</span> <span class="tok-o">||</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;OR&quot;</span><span class="tok-o">)</span> <span class="tok-o">||</span>
<span class="lineno"> 6 </span>				<span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;XOR&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>				<span class="tok-n">BinaryOperator</span> <span class="tok-n">operator</span> <span class="tok-o">=</span>
<span class="lineno"> 8 </span>					<span class="tok-o">(</span><span class="tok-n">BinaryOperator</span><span class="tok-o">)</span><span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">value</span><span class="tok-o">];</span>
<span class="lineno"> 9 </span>				<span class="tok-n">operator</span><span class="tok-o">.</span><span class="tok-na">setOperand1</span><span class="tok-o">(</span> <span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">()]</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>				<span class="tok-n">operator</span><span class="tok-o">.</span><span class="tok-na">setOperand2</span><span class="tok-o">(</span> <span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">()]</span> <span class="tok-o">);</span>
<span class="lineno">11 </span>			<span class="tok-o">}</span>
<span class="lineno">12 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;NOT&quot;</span><span class="tok-o">)</span> <span class="tok-o">||</span>
<span class="lineno">13 </span>				<span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-na">startsWith</span><span class="tok-o">(</span><span class="tok-s">&quot;OUTPUT&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>				<span class="tok-n">UnaryOperator</span> <span class="tok-n">operator</span> <span class="tok-o">=</span>
<span class="lineno">15 </span>					<span class="tok-o">(</span><span class="tok-n">UnaryOperator</span><span class="tok-o">)</span><span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">value</span><span class="tok-o">];</span>
<span class="lineno">16 </span>				<span class="tok-n">operator</span><span class="tok-o">.</span><span class="tok-na">setInput</span><span class="tok-o">(</span> <span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">()]</span> <span class="tok-o">);</span>
<span class="lineno">17 </span>			<span class="tok-o">}</span>
<span class="lineno">18 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As long as there is remaining input, we read in an index. Based on the
name of the gate at that index in the array, we either read in two more
indexes (for binary operators) or just a single additional index (for
unary operators). In either case, we set the input or inputs of the
operator to the gate or gates at those indexes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-c1">// Compute output</span>
<span class="lineno">2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">count</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">3 </span>		  <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">getName</span><span class="tok-o">().</span><span class="tok-na">startsWith</span><span class="tok-o">(</span><span class="tok-s">&quot;OUTPUT&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">4 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">gates</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">);</span>
<span class="lineno">5 </span>	  <span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the simulation of the circuit is absurdly simple. We look
through array until we find a gate whose name starts with <code>"OUTPUT"</code>.
Then, we print out its value. In order to determine its value, it will
ask its input what its value is, which in turn will ask for the values
from its input. The <code>toString()</code> in the <code>Gate</code> class will assure us that
the final output is nicely formatted. This system accommodates any
number of output gates connected arbitrarily, as long as the circuit has
no loops inside of it, such as an AND gate whose output is also one of
its inputs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_inheritance">11.6. Concurrency: Inheritance</h3>
<div class="paragraph">
<p>Like interfaces, inheritance in Java is not closely related to
concurrency. However, two ways in which inheritance interacts with
concurrency deserve attention.</p>
</div>
<div class="paragraph">
<p>The first is the <code>Thread</code> class. Each thread of execution in Java
(except the main thread) is managed with a <code>Thread</code> object or an object
whose type inherits from <code>Thread</code>. Creating such types is done by
extending <code>Thread</code>, just as you would extend any other class. Further
information about extending <code>Thread</code> for concurrency is given in
<a href="#_syntax_threads_in_java">Section 13.4</a>. Extending the <code>Thread</code> class to make
your own customized threads of execution is an alternative to
implementing the <code>Runnable</code> interface mentioned in
<a href="#_concurrency_interfaces">Section 10.6</a> and is discussed in greater detail in
<a href="#_the_code_runnable_code_interface">Section 13.4.5</a>.</p>
</div>
<div class="paragraph">
<p>The second interaction between inheritance and concurrency is again very
similar to the problem with interfaces and concurrency: There is no way
to specify that a method is thread-safe. Recall that it is not allowed
to use the <code>synchronized</code> keyword on a method in an interface
declaration. Likewise, there is no restriction on overriding a
synchronized method with a non-synchronized method or vice versa.</p>
</div>
<div class="paragraph">
<p>The rules for overriding methods in Java guarantee that an object of a
child class is usable anywhere that an object of the parent class is
usable. Thus, you cannot override a public method with a private one,
reducing the visibility of a method. We discuss a similar restriction
with exceptions in <a href="#subsection:Inheritance_and_exceptions">Section 17.3.4</a>.</p>
</div>
<div class="paragraph">
<p>If it has these restrictions, why doesn&#8217;t Java prevent a synchronized
method from being overridden by a non-synchronized method? In the first
place, a non-synchronized method can be used anywhere a synchronized one
could. (Unlike a private method, which is not accessible everywhere a
public one is.) In the second, the designers of Java have put thread
safety in the category of implementation details left up to the
programmer. Some classes need specific methods to be synchronized and
others (even child classes) do not. However, if you override a class
with a synchronized method, it is safest to mark your method
synchronized as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_11">11.7. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise11.1"></a> Give three advantages of using inheritance instead of copying and
pasting code from a parent class. Are there any disadvantages to using
inheritance?</p>
</li>
<li>
<p><a id="exercise11.2"></a> Consider classes <code>Radish</code> and <code>Carrot</code> which both extend class
<code>Vegetable</code> and implement interface <code>Crunchable</code>. Which of the following
sets of assignments are legal and why?</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Radish radish = new Radish();</code></p>
</li>
<li>
<p><code>Radish radish = new Vegetable();</code></p>
</li>
<li>
<p><code>Vegetable vegetable = new Radish();</code></p>
</li>
<li>
<p><code>Crunchable crunchy = new Radish();</code></p>
</li>
<li>
<p><code>Radish radish = new Carrot();</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise11.3"></a> In the context of inheritance, the keyword <code>super</code> can be used for
two different purposes. What are they?</p>
</li>
<li>
<p><a id="exercise11.4"></a> Consider the following class definitions.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">A</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
    <span class="tok-kd">public</span> <span class="tok-nf">A</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">s</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-s">&quot;A&quot;</span> <span class="tok-o">+</span> <span class="tok-n">s</span> <span class="tok-o">+</span> <span class="tok-s">&quot;A&quot;</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">toString</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">B</span> <span class="tok-kd">extends</span> <span class="tok-n">A</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">B</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">s</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-s">&quot;B&quot;</span> <span class="tok-o">+</span> <span class="tok-n">s</span> <span class="tok-o">+</span> <span class="tok-s">&quot;B&quot;</span> <span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">C</span> <span class="tok-kd">extends</span> <span class="tok-n">B</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">C</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">s</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-s">&quot;C&quot;</span> <span class="tok-o">+</span> <span class="tok-n">s</span> <span class="tok-o">+</span> <span class="tok-s">&quot;C&quot;</span> <span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What is output by the following code fragment?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">C</span> <span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">C</span><span class="tok-o">(</span><span class="tok-s">&quot;ABC&quot;</span><span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">c</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise11.5"></a> Beginning Java programmers often confuse package-private access (no
explicit specifier) with <code>public</code> access. How is this confusion possible
when default access is more constrained than both <code>public</code> and
<code>protected</code> access? (Hint: The file system plays a role.)</p>
</li>
<li>
<p><a id="exercise11.6"></a> What are the similarities and differences between overloading a
method and overriding a method?</p>
</li>
<li>
<p><a id="exercise11.7"></a> What is field hiding? How can software bugs arise from this
functionality in Java?</p>
</li>
<li>
<p><a id="exercise11.8"></a> Give reasons why the designers of Java decided not to allow multiple
inheritance. Would you have made the same decision? Why or why not?</p>
</li>
<li>
<p><a id="exercise11.9"></a> Draw a class hierarchy establishing a sensible relationship between
the <code>Human</code>, <code>Soldier</code>, <code>Sailor</code>, <code>Marine</code>, <code>General</code>, and <code>Admiral</code>
classes. For this class hierarchy, refer to the U.S. military structure
in which the U.S. Marine Corps is a part of the U.S. Navy.</p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise11.10"></a> Create an <code>InternationalStudent</code> class that extends <code>Student</code>. It
should include <code>String</code> fields for country of origin and also visa
status. It should include mutator and accessor methods for these two new
fields.</p>
</li>
<li>
<p><a id="exercise11.11"></a> Add <code>Pentagon</code> and <code>Hexagon</code> classes that extend the <code>Polygon</code>
class. The constructor for each class should take an \(x\),
\(y\) and radius value, each of <code>int</code> type. Both classes
should be implemented to create <em>regular</em> polygons, that is, polygons in
which all 5 or 6 sides have the same length. The \(x\) and
\(y\) values should give the center of the polygon, and each
of the 5 or 6 points should be the radius distance away from that
center.</p>
<div class="paragraph">
<p>Because the internal structure of <code>Polygon</code> keeps all vertices as
<code>Point</code> values, the \(x\) and \(y\) coordinates of
the points must be <code>int</code> values. This requirement will force you to
round these \(x\) and \(y\) coordinates after using
trigonometry to determine their locations. As a result, the final
pentagons and hexagons stored and displayed will be slightly irregular.</p>
</div>
</li>
<li>
<p><a id="exercise11.12"></a> The inheritance design of our solution to the Boolean circuits
problem given in <a href="#_solution_boolean_circuits">Section 11.5</a> makes adding new
gates easy. Add classes that implement a NAND gate and a NOR gate. Then,
rewrite the <code>main()</code> method of <code>BooleanCircuit</code> to accommodate these two
extra classes.</p>
</li>
<li>
<p><a id="exercise11.13"></a> Re-implement the object hierarchy in the solution to the sort it out
problem from <a href="#_interfaces">Chapter 10</a>. This time, let the <code>Cat</code>,
<code>Dog</code>, and <code>Person</code> classes extend the <code>Creature</code> class defined below.</p>
<div id="CreatureProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Creature</span> <span class="tok-kd">implements</span> <span class="tok-n">Ageable</span><span class="tok-o">,</span> <span class="tok-n">Weighable</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Creature</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">weight</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">age</span> <span class="tok-o">=</span> <span class="tok-n">age</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">weight</span> <span class="tok-o">=</span> <span class="tok-n">weight</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getAge</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">age</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getWeight</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">weight</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">13 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Refactor your code so that the <code>Cat</code>, <code>Dog</code>, and <code>Person</code> classes are as
short as possible. How many lines of code do you save?</p>
</div>
</li>
<li>
<p><a id="exercise11.14"></a> Design a celestial body simulator. You will
need to create a class containing fields for the \(x\),
\(y\), and \(z\) locations, \(x\),
\(y\), and \(z\) velocities, radii, and masses of
each object. For each time step of length \(t\), you must do
the following.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Compute the sum of forces exerted on each body by every other body.
The equation for gravitational force on body \(b\) exerted by
body \(a\) is
\(\mathbf{F}_{ab} = - G \frac{m_a m_b}{{\vert \mathbf{r}_{ab} \vert}^2} \, \mathbf{\hat{r}}_{ab}\)
where
\(G = 6.673\times 10^{-11} \mbox{N} \mbox{m}^2 \mbox{kg}^{-2}\),
\(\vert \mathbf{r}_{ab} \vert\) is the distance between the
centers of objects \(a\) and \(b\), and
\(\mathbf{\hat{r}}_{ab} = \frac{\mathbf{r}_b - \mathbf{r}_a}{\vert\mathbf{r}_b - \mathbf{r}_a\vert}\),
the unit vector between the centers of the two objects.</p>
</li>
<li>
<p>Compute the \(x\), \(y\), and \(z\)
components of the acceleration vector \({\mathbf a}\) for each
object using the equation, \({\mathbf F} = m {\mathbf a}\),
once the sum of forces has been calculated.</p>
</li>
<li>
<p>Update the \(x\), \(y\), and \(z\)
components of the velocity vector \({\mathbf v}\) for each
object using the equation
\({\mathbf v}_{new} = {\mathbf v}_{old} + {\mathbf a}t\).</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise11.15"></a> Inheritance is a powerful technique, but it comes with some overhead
costs. Create a class called <code>A</code> with the following implementation.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">A</span> <span class="tok-o">{</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, create 25 more classes named <code>B</code> through <code>Z</code>. Class <code>B</code> should
extend <code>A</code> and add a <code>protected</code> <code>int</code> field called <code>b</code>. Continue in
this manner, with each new class extending the previous one and adding
an <code>int</code> field named the lowercase version of the class name. Thus, if
you create an object of type <code>Z</code>, it will contain, through inheritance,
26 <code>int</code> fields named <code>a</code> through <code>z</code>. But, for a single <code>Z</code> object to
be created, it must call 27 (<code>Z</code> back through <code>A</code> plus <code>Object</code>)
constructors. You may wish to use the file I/O material in
<a href="#_file_i_o">Chapter 20</a> to write a program to create all these
classes so that you do not have to do so by hand.</p>
</div>
<div class="paragraph">
<p>Finally, create a new class called <code>All</code> which contains 26 <code>protected</code>
fields of <code>int</code> type named <code>a</code> through <code>z</code>. Now, the purpose of doing
all this is to compare the time needed to instantiate an object of type
<code>Z</code> with one of type <code>All</code>, though they both only contained 26 <code>int</code>
fields named <code>a</code> through <code>z</code>.</p>
</div>
<div class="paragraph">
<p>Create an array of 100,000 elements of type <code>Z</code> and then populate it
with 100,000 <code>Z</code> objects. Time this process. Create an array of 100,000
elements of type <code>All</code> and then populate that array with 100,000 <code>All</code>
objects. You may wish to use the <code>System.nanoTime()</code> method described in
<a href="#_concurrent_programming">Chapter 13</a> to accurately time these
processes. Is there a significant difference in the times you found?</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exceptions">12. Exceptions</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The vulgar mind always mistakes the exceptional for the important.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; W. R. Inge
</div>
</div>
<div class="sect2">
<h3 id="_problem_bank_burglary">12.1. Problem: Bank burglary</h3>
<div class="paragraph">
<p>Let&#8217;s consider a problem in which various aspects of a bank burglary are
modeled as objects in Java. You want to write some code that will
accomplish the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable the burglar alarm</p>
</li>
<li>
<p>Break into the bank</p>
</li>
<li>
<p>Find the vault</p>
</li>
<li>
<p>Open the vault</p>
</li>
<li>
<p>Carry away the loot</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>But any number of things could go wrong! When trying to disable the
burglar alarm, you might set it off. When you try to break into the
bank, you might have thought that you&#8217;d disabled the burglar alarm but
actually failed to do so. The door of the bank might be too difficult to
open. The vault might be impossible to find, or the vault might be
impossible to open. It could even be empty. The money might be made of
enormous gold blocks that are too heavy to carry away. Finally, at any
time during the heist, a night watchman might catch you in the act.</p>
</div>
<div class="paragraph">
<p>If you are the criminal mastermind who planned this deed, you need to
know if (and preferably how) your henchman bungled the burglary. You
need a simple system that can inform you of any errors that have
occurred along the way. Likewise, you need to be able to react
differently depending on what went wrong.</p>
</div>
<div class="paragraph">
<p>We are going to model each of these error conditions with Java
<em>exceptions</em>. An exception is how Java indicates exceptional or
incorrect situations inside of a program. These exceptions are <em>thrown</em>
when the error happens. You must then write code to <em>catch</em> the error
and deal with it appropriately. The bank burglar program will deal with
three different classes, <code>Bank</code>, <code>Vault</code>, and <code>Loot</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Bank</code> class has three methods, <code>disableAlarm()</code>, <code>breakIn()</code>, and
<code>findVault()</code>, which returns a <code>Vault</code> object. The <code>Vault</code> class has an
<code>open()</code> method and a <code>getLoot()</code> method, which returns a <code>Loot</code> object.
The <code>Loot</code> class has a <code>carryAway()</code> method. Below is a table of the
exceptions which can be thrown by each of the methods.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Class</th>
<th class="tableblock halign-left valign-middle">Method</th>
<th class="tableblock halign-left valign-middle">Exceptions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="6"><div class="literal"><pre>Bank</pre></div></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><div class="literal"><pre>disableAlarm()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>BurglarAlarmException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>WatchmanException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="3"><div class="literal"><pre>breakIn()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>BurglarAlarmException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>LockPickFailException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>WatchmanException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>findVault()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>WatchmanException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="3"><div class="literal"><pre>Vault</pre></div></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><div class="literal"><pre>open()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>LockPickFailException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>WatchmanException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>getLoot()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>WatchmanException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><div class="literal"><pre>Loot</pre></div></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><div class="literal"><pre>carryAway()</pre></div></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>LootTooHeavyException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>WatchmanException</pre></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In order to deal with each of these possible errors, you need some
special Java syntax.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_error_handling">12.2. Concepts: Error handling</h3>
<div class="paragraph">
<p>As a rule, computer programs are filled with errors. Writing a program
is a difficult and complex process. Even if a segment of code is free
from errors, it may call other code which contains mistakes. The user
could be making mistakes and issuing commands to a program that are
impossible to execute. Even hardware can produce errors, as in a hard
drive crash or a DVD with a scratch on its surface.</p>
</div>
<div class="sect3">
<h4 id="_error_codes">12.2.1. Error codes</h4>
<div class="paragraph">
<p>A robust program should deal with as many errors as possible. One
strategy is to have every method give back a special error code
corresponding to the error that has just occurred. Then, the code
calling the method can react appropriately. Of course, many methods do
not return a numerical type, limiting this kind of error handling. A
solution that was very common in the C language, particularly in Unix
system calls, was to set a globally visible <code>int</code> variable called
<code>errno</code> to a value corresponding to the error that has just happened.</p>
</div>
<div class="paragraph">
<p>These solutions have a number of drawbacks. In the case of <code>errno</code>, if a
number of different threads were running at the same time, different
errors could occur simultaneously, but only one value could be kept in
<code>errno</code>. For any system that relies on checking for an error condition
after each method call, a large amount of error handling code must be
mixed in with normal code. Doing so reduces code readability and makes
it difficult to centralize error handling. Likewise, a numerical value
can be difficult to deal with. A user may have to look it up to find out
what kind of error it is.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise12.1">Exercise 12.1</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exceptions_2">12.2.2. Exceptions</h4>
<div class="paragraph">
<p>Java adopts a different error handling strategy called exceptions.
Whenever a specified error state or unusual situation is reached, an
exception is thrown. When an exception is thrown, normal execution stops
immediately. The exception looks for code that is designed to deal with
that specific exception. The code that will handle the exception can be
in the current method, in the calling method, in the caller of the
calling method, or arbitrarily far back in the chain of method calls,
all the way to <code>main()</code>. Each method will return, looking for code to
handle this exception, until it is found. If no handling code is found,
the exception will propagate all the way past <code>main()</code> to the JVM, and
the program will end.</p>
</div>
<div class="paragraph">
<p>Exceptions give a unified and simple way to handle all errors. You can
choose to deal with errors directly or delegate that responsibility to
methods that call the code you are writing. Selection statements and
loops are forms of local control flow, but exceptions give us the power
of non-local control flow, able to jump back through any number of
method calls.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_exceptions_in_java">12.3. Syntax: Exceptions in Java</h3>
<div class="paragraph">
<p>In Java syntax, there are two important parts needed to use exceptions:
throwing the exception when an error occurs and then handling that
exception properly. Below we will explain both of these as well as the
catch or specify requirement, the <code>finally</code> keyword, and the process of
creating custom exceptions.</p>
</div>
<div class="sect3">
<h4 id="_throwing_exceptions">12.3.1. Throwing exceptions</h4>
<div class="paragraph">
<p>By now you have probably experienced a <code>NullPointerException</code> in the
process of coding. This exception happens when an object reference is
<code>null</code> but we try to access one of its methods or fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-c1">// NullPointerException</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the exception is thrown by the JVM itself. It is possible
to catch this exception and deal with it, but a <code>NullPointerException</code>
generally means a mistake in the program, not an error that can be
recovered from. Although many useful exceptions such as<br>
<code>NullPointerException</code>, <code>ArithmeticException</code>, and
<code>ArrayIndexOutOfBoundsException</code> are implicitly thrown by the JVM, we
are permitted to throw them explicitly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">y</span> <span class="tok-o">&lt;</span> <span class="tok-mi">14</span> <span class="tok-o">)</span>
    <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">NullPointerException</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like any other object, we use the <code>new</code> keyword to instantiate a
<code>NullPointerException</code> using its default constructor. Once created, we
use the <code>throw</code> keyword to cause the exception to go into effect. Any
exception you throw explicitly must use the <code>throw</code> keyword, but the
majority of exceptions thrown by your programs will either be mistakes
or exceptions thrown by library code you are calling. If you write a
significant amount of library or API code, you may use <code>throw</code> more
often.</p>
</div>
</div>
<div class="sect3">
<h4 id="_handling_exceptions">12.3.2. Handling exceptions</h4>
<div class="paragraph">
<p>Normal application programmers will find themselves writing code that
handles exceptions much more often than code that throws them. In order
to catch an exception, you must enclose the code that you think is going
to throw an exception in a <code>try</code> block. Immediately after the <code>try</code>
block, you can list one or more <code>catch</code> blocks. The code inside the
first <code>catch</code> block that matches your exception will be executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-c1">//NullPointerException</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;This will never be printed.&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">NullPointerException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Surprise! A NullPointerException!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, trying to access the <code>length()</code> method of a <code>null</code>
reference will still throw a <code>NullPointerException</code>, but now it will be
caught by the <code>catch</code> block below. The message
<code>"Surprise! A NullPointerException!"</code> will be printed to the screen, and
execution will continue normally after the <code>catch</code> block. Once the
exception is caught, it stops trying to propagate. Of course, whatever
the code was doing when the exception was thrown was abandoned
immediately because it might have depended on successful execution of
the code that threw an exception. Thus, the call to the
<code>System.out.println()</code> method in the <code>try</code> block will never be executed.</p>
</div>
<div class="paragraph">
<p>An exception will match the first <code>catch</code> block with the same class or
any superclass. Since <code>Exception</code> is the parent of <code>RuntimeException</code>
which is the parent of <code>NullPointerException</code>, we could write our
example with <code>Exception</code> instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-c1">//NullPointerException</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;This will never be printed.&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Well, of course you got a NullPointerException!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In general, you should write the most specific exception class possible
for your <code>catch</code> blocks. Otherwise, you might be catching a different
exception than you plan for or preventing an exception from propagating
up to an appropriate handler. For example, the following code has the
potential to throw either a <code>NullPointerException</code> or an
<code>ArithmeticException</code>, because of a division by 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-o">;</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-mf">0.5</span> <span class="tok-o">)</span>
        <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-c1">//NullPointerException</span>
    <span class="tok-k">else</span>
        <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-o">/</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-c1">//ArithmeticException</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You got some kind of exception!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will catch either kind of exception, but it will not tell you
which you got. Instead, the correct approach is to have one <code>catch</code>
block for each possible kind of exception.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">text</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">x</span><span class="tok-o">;</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">random</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-mf">0.5</span> <span class="tok-o">)</span>
        <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-c1">//NullPointerException</span>
    <span class="tok-k">else</span>
        <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">5</span> <span class="tok-o">/</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-c1">//ArithmeticException</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">NullPointerException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You got a null pointer!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">ArithmeticException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You divided by zero!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The list of <code>catch</code> blocks can be arbitrarily long. You must always go
from the most specific exceptions to the most general, like <code>Exception</code>,
otherwise some exceptions could never be reached. The Java compiler
enforces this requirement. The <code>e</code> is a reference to the exception
itself, which behaves something like a parameter in a method. It is
common to use <code>e</code> as the identifier but you are allowed to call it any
legal variable name. Usually, the kind of exception is all you need to
know, but every exception is an object and has fields and methods.
Particularly useful is the <code>getMessage()</code> method which can give
additional information about the exception.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise12.10">Exercise 12.10</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_catch_or_specify">12.3.3. Catch or specify</h4>
<div class="paragraph">
<p>Despite the examples given above, you will rarely write code to catch a
<code>NullPointerException</code> or an <code>ArithmeticException</code>. Both of these
exceptions are called <em>unchecked</em> exceptions. In
<a href="#_arrays">Chapter 6</a>, we used the <code>Thread.sleep()</code> method to put
the execution of our program to sleep for a short period of time. We
were forced to enclose this method call in a <code>try</code> block with a <code>catch</code>
block for <code>InterruptedException</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span><span class="tok-o">{</span>
    <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span>  <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Wake up!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An <code>InterruptedException</code> is thrown when another thread tells your
thread of execution to wake up before it finishes sleeping or waiting.
This exception is a <em>checked</em> exception, meaning that Java insists that
you use a <code>try</code>-<code>catch</code> pair anytime there is even a chance of it being
thrown. Otherwise your code will not compile.</p>
</div>
<div class="paragraph">
<p>Checked exceptions are those exceptions that your program should plan
for. Library and API code often throw checked exceptions. For example,
when trying to open a file with an API call, it&#8217;s possible that no file
with that name exists or that the user might not have permission to
access it. A program should catch the corresponding exceptions and
recover rather than crashing. Perhaps the program should prompt the user
for a new name or explain that the required permission is not set.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise12.5">Exercise 12.5</a><br>
<a href="#exercise12.8">Exercise 12.8</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>In <a href="#_arrays">Chapter 6</a>, there were no executable statements in
the <code>catch</code> block used with the<br>
<code>Thread.sleep()</code> method. You should <strong>never</strong> write an empty <code>catch</code>
block. Doing so allows errors to fail silently.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise12.6">Exercise 12.6</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>We are allowed to put code that can throw a checked exception into a
<code>try</code>-<code>catch</code> block, but there is another possibility. Java has a catch
or specify requirement, meaning that your code is required either to
catch a checked exception or to specify that it has the potential for
causing that exception. To specify that a method can throw certain
exceptions, we use the <code>throws</code> keyword. Note that this is <strong>not</strong> the
same as the <code>throw</code> keyword.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise12.3">Exercise 12.3</a><br>
<a href="#exercise12.4">Exercise 12.4</a></p>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">sleepWithoutTry</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">milliseconds</span> <span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
    <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span> <span class="tok-n">milliseconds</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, there is no need for a <code>try</code>-<code>catch</code> block because the
method announces that it has a risk of throwing an
<code>InterruptedException</code>. Of course, any code that uses this method will
have to have a <code>try</code>-<code>catch</code> block or specify that it also throws<br>
<code>InterruptedException</code>. A method can throw many different exceptions,
and you can simply list them out after the <code>throws</code> keyword, separated
by commas.</p>
</div>
<div class="paragraph">
<p>Almost every exception thrown in Java is a child class of <code>Exception</code>,
<code>RuntimeException</code>, or <code>Error</code>. Any descendant of <code>RuntimeException</code> or
<code>Error</code> is an unchecked exception and is exempt from the catch or
specify requirement. Any direct descendant of <code>Exception</code> is a checked
exception and must either be caught with a <code>try</code>-<code>catch</code> block or
specified with the <code>throws</code> keyword. We say <strong>direct</strong> descendant because
<code>RuntimeException</code> is a child of <code>Exception</code>, leading to the confusing
situation where only those descendants of <code>Exception</code> which are not also
descendants of <code>RuntimeException</code> are checked.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_code_finally_code_keyword">12.3.4. The <code>finally</code> keyword</h4>
<div class="paragraph">
<p>To deal with the situation in which some important cleanup or finalizing
task must be done no matter what, the designers of Java introduced the
<code>finally</code> keyword. A <code>finally</code> block comes after all the <code>catch</code> blocks
following a <code>try</code> block. The code inside the <code>finally</code> block will be
executed <strong>whether or not</strong> any exception was thrown. A <code>finally</code> block is
often used with file I/O to close the file, which should be closed
whether or not something went wrong in the process of reading it as we
demonstrate in <a href="#_file_i_o">Chapter 20</a></p>
</div>
<div class="paragraph">
<p>The <code>finally</code> keyword is unusually powerful. If an exception is not
caught and propagates up another level, the <code>finally</code> block will be
executed before propagating the exception. Even a <code>return</code> statement
will wait for a <code>finally</code> block to be executed before returning, leading
to the following bizarre possibility.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">neverTrue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">finally</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This method attempts to return <code>true</code>, but before it can finish, the
<code>finally</code> block returns <code>false</code>. Only one value can be returned, and the
<code>finally</code> block wins. You should be aware of <code>finally</code> blocks and their
unusual semantics. Use them sparingly and only for careful cleanup
operations when necessary to guarantee that some event occurs.</p>
</div>
<div class="paragraph">
<p>Code in a <code>finally</code> block will execute <strong>no matter what</strong> unless the JVM
exits or the thread in question terminates.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise12.2">Exercise 12.2</a><br>
<a href="#exercise12.9">Exercise 12.9</a><br>
<a href="#exercise12.11">Exercise 12.11</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customized_exceptions">12.3.5. Customized exceptions</h4>
<div class="paragraph">
<p>Exceptions are incredibly useful when dealing with problems encountered
by API code. In those cases, your code must merely catch exceptions
defined by someone else; however, it is sometimes useful to define your
own exceptions. For one thing, you may write an API yourself. Generally,
you will want to use the standard exceptions whenever possible, but your
code may generate some unusual or very specific error condition that you
want to communicate to a programmer using your own exception.</p>
</div>
<div class="paragraph">
<p>Defining a new exception is surprisingly simple. All you have to do is
write a class that extends <code>Exception</code>. Theoretically, you could
alternately extend <code>RuntimeException</code> or <code>Error</code>, but you typically will
not. Children of <code>RuntimeException</code> are intended to indicate a bug in
the program and children of <code>Error</code> are intended to indicate a system
error. When creating your new exception, you don&#8217;t even have to create
any methods, but it is wise to implement a default constructor and one
that takes a <code>String</code> as an additional message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EndOfWorldException</span> <span class="tok-kd">extends</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">EndOfWorldException</span><span class="tok-o">()</span> <span class="tok-o">{}</span>

    <span class="tok-kd">public</span> <span class="tok-nf">EndOfWorldException</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">message</span> <span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with all other classes, your exceptions should be named in a readable
way. This exception is apparently thrown when the world ends. It is
considered good style to end the name of any exception class with
<code>Exception</code>. An exception class is a fully fledged class. If you need to
add other fields or methods to give your exception the functionality it
needs, go ahead. However, the main value of an exception is simply in
its existence as a named error, not in any tricks it can perform.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise12.12">Exercise 12.12</a><br>
<a href="#exercise12.13">Exercise 12.13</a><br>
<a href="#exercise12.14">Exercise 12.14</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Here we will give a few examples of exception handling, although
exceptions are more useful in large systems with heavy API use. We will
start with an example of a simple calculator that detects division by
zero, then look at exceptions as a tool to detect array bounds problems,
and end with a custom exception used with the <code>Color</code> class.</p>
</div>
<div class="exampleblock">
<div class="title">Example 90. Calculator with division by zero</div>
<div class="content">
<div class="paragraph">
<p>Here we will implement a quick calculator that reads input from the user
in the form of <strong>integer</strong> <strong>operator</strong> <strong>integer</strong>, where <strong>operator</strong> is one
of the four basic arithmetic operators (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>). Our code
will perform the appropriate operation and output the answer, but we
will use exception handling to avoid killing the program when a division
by zero occurs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">QuickCalculator</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">b</span><span class="tok-o">,</span> <span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">char</span> <span class="tok-n">operator</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>		<span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">terms</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-n">String</span> <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">().</span><span class="tok-na">trim</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;quit&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>			<span class="tok-n">terms</span> <span class="tok-o">=</span> <span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-na">split</span><span class="tok-o">(</span><span class="tok-s">&quot; &quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">terms</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]);</span>
<span class="lineno">13 </span>			<span class="tok-n">operator</span> <span class="tok-o">=</span> <span class="tok-n">terms</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="lineno">14 </span>			<span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">terms</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By this point, the <code>main()</code> method has set up a system to read a line of
input from a user, test to see if it is the sentinel value <code>"quit"</code>, and
then parsing it into two <code>int</code> values and a <code>char</code> otherwise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>			<span class="tok-k">try</span><span class="tok-o">{</span>
<span class="lineno"> 2 </span>				<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">operator</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>					<span class="tok-k">case</span> <span class="tok-sc">&#39;+&#39;</span><span class="tok-o">:</span> <span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">b</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>					<span class="tok-k">case</span> <span class="tok-sc">&#39;-&#39;</span><span class="tok-o">:</span> <span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">a</span> <span class="tok-o">-</span> <span class="tok-n">b</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>					<span class="tok-k">case</span> <span class="tok-sc">&#39;*&#39;</span><span class="tok-o">:</span> <span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">a</span> <span class="tok-o">*</span> <span class="tok-n">b</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>					<span class="tok-k">case</span> <span class="tok-sc">&#39;/&#39;</span><span class="tok-o">:</span> <span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">a</span> <span class="tok-o">/</span> <span class="tok-n">b</span><span class="tok-o">;</span> <span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>				<span class="tok-o">}</span>
<span class="lineno"> 8 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Answer: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">answer</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>			<span class="tok-o">}</span>
<span class="lineno">10 </span>			<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">ArithmeticException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You can&#39;t divide by 0!&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-o">}</span>
<span class="lineno">13 </span>			<span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">().</span><span class="tok-na">trim</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
<span class="lineno">14 </span>		<span class="tok-o">}</span>
<span class="lineno">15 </span>	<span class="tok-o">}</span>
<span class="lineno">16 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have a <code>try</code> block enclosing the code where the operations
occur. Inside the <code>switch</code> statement, the code will blindly perform
addition, subtraction, multiplication, or division, depending on the
value of <code>operator</code>. Then, it will print the answer. However, if a
division by zero occurred, the execution would jump to the <code>catch</code> block
and print an appropriate message. This <code>try</code>-<code>catch</code> pair is situated
inside the loop so that the input will continue even if there was a
division by zero. We could achieve the same effect by using an <code>if</code>
statement to test if the divisor is zero, but our solution allows easy
extensions if there are other possible exceptions we want to catch.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 91. Array bounds</div>
<div class="content">
<div class="paragraph">
<p>Exceptions provide a lot of power. If we want, we can use the
<code>ArrayOutOfBoundsException</code> as a crutch when we don&#8217;t want to think
about the bounds of our array. Although this makes for an interesting
example, exceptions should not be used in Java to perform normal tasks.
This method takes in an array of <code>int</code> values and prints them all out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">exceptionalArrayPrint</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
        <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">)</span>
            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">++]</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">catch</span><span class="tok-o">(</span>  <span class="tok-n">ArrayIndexOutOfBoundsException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Although the <code>while</code> loop will run without stopping, the moment that <code>i</code>
reaches<br>
<code>array.length</code>, it will throw an <code>ArrayIndexOutOfBoundsException</code> when
it tries to access that element in <code>array</code>. Since we left the <code>catch</code>
block empty, nothing will happen, the method will return, and everything
will work fine. This example is a peculiar kind of laziness, indeed,
since a <code>for</code> loop could achieve the same effect with fewer lines of
code.</p>
</div>
<div class="paragraph">
<p>Programmers can be tempted to abuse exceptions in this way when a lot of
calculations are needed to determine the correct bounds. Consider a game
of Connect Four. To see if a player has won, the computer must examine
all horizontal, vertical, and diagonal possibilities for four in a row.
If the game board is represented as a 2D array, the programmer must be
careful to make sure that checking for four in a row does not access any
index greater than the last rows or column or smaller than 0.</p>
</div>
<div class="paragraph">
<p>The danger of using exceptions for these kinds of tasks has several
sources. First, the programmer may not deeply understand the problem and
may be careless about the solution. Second, there is a risk of hiding
real exceptions that are generated because of real errors. Third, the
code becomes difficult to read and unintuitive. Finally, excessive use
of exceptions can negatively impact performance.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise12.15">Exercise 12.15</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 92. Color ranges</div>
<div class="content">
<div class="paragraph">
<p>The <code>Color</code> class provided by Java allows us to represent a color as a
triple of red, green, and blue values with each value in the range
[0,255]. Using these three components, we can produce
256<sup>3</sup> = 16,777,216 colors. If we were programming some
image manipulation software, we might want to be able to increase the
red, green, or blue values separately. If changing a value makes it
larger than 255, we could throw an exception. Likewise, if changing a
value makes it less than 0, we could throw a different exception. Let&#8217;s
give two custom exceptions that could serve in these roles.</p>
</div>
<div id="ColorUnderflowExceptionProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ColorUnderflowException</span> <span class="tok-kd">extends</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">ColorUnderflowException</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">message</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">ColorComponentTooSmallException</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="ColorOverflowExceptionProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ColorOverflowException</span> <span class="tok-kd">extends</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">ColorOverflowException</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">message</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">ColorOverflowException</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can write six methods, each of which increases or decreases the
red, green, or blue component of a <code>Color</code> object by 5. If the value of
the component is out of range, an appropriate exception will be thrown.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Color</span> <span class="tok-nf">increaseRed</span><span class="tok-o">(</span> <span class="tok-n">Color</span> <span class="tok-n">color</span> <span class="tok-o">)</span>
    <span class="tok-kd">throws</span> <span class="tok-n">ColorOverflowException</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span> <span class="tok-o">&gt;</span> <span class="tok-mi">255</span> <span class="tok-o">)</span>
        <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">ColorOverflowException</span><span class="tok-o">(</span><span class="tok-s">&quot;Red: &quot;</span>
            <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span><span class="tok-o">));</span>
    <span class="tok-k">else</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">Color</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">(),</span>
            <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Color</span> <span class="tok-nf">increaseGreen</span><span class="tok-o">(</span> <span class="tok-n">Color</span> <span class="tok-n">color</span> <span class="tok-o">)</span>
    <span class="tok-kd">throws</span> <span class="tok-n">ColorOverflowException</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span> <span class="tok-o">&gt;</span> <span class="tok-mi">255</span> <span class="tok-o">)</span>
        <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">ColorOverflowException</span><span class="tok-o">(</span><span class="tok-s">&quot;Green: &quot;</span>
            <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span><span class="tok-o">));</span>
    <span class="tok-k">else</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">Color</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">(),</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span><span class="tok-o">,</span>
            <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Color</span> <span class="tok-nf">increaseBlue</span><span class="tok-o">(</span> <span class="tok-n">Color</span> <span class="tok-n">color</span> <span class="tok-o">)</span>
    <span class="tok-kd">throws</span> <span class="tok-n">ColorOverflowException</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span> <span class="tok-o">&gt;</span> <span class="tok-mi">255</span> <span class="tok-o">)</span>
        <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">ColorOverflowException</span><span class="tok-o">(</span><span class="tok-s">&quot;Blue: &quot;</span>
            <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span><span class="tok-o">));</span>
    <span class="tok-k">else</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">Color</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">(),</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">(),</span>
            <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-mi">5</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Color</span> <span class="tok-nf">decreaseRed</span><span class="tok-o">(</span> <span class="tok-n">Color</span> <span class="tok-n">color</span> <span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">ColorUnderflowException</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">5</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
        <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">ColorUnderflowException</span><span class="tok-o">(</span><span class="tok-s">&quot;Red: &quot;</span>
            <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">5</span><span class="tok-o">));</span>
    <span class="tok-k">else</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">Color</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">5</span><span class="tok-o">,</span>
            <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">(),</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Color</span> <span class="tok-nf">decreaseGreen</span><span class="tok-o">(</span> <span class="tok-n">Color</span> <span class="tok-n">color</span> <span class="tok-o">)</span>
    <span class="tok-kd">throws</span> <span class="tok-n">ColorUnderflowException</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">5</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
        <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">ColorUnderflowException</span><span class="tok-o">(</span><span class="tok-s">&quot;Green: &quot;</span>
            <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">5</span><span class="tok-o">));</span>
    <span class="tok-k">else</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">Color</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">(),</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">5</span><span class="tok-o">,</span>
            <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Color</span> <span class="tok-nf">decreaseBlue</span><span class="tok-o">(</span> <span class="tok-n">Color</span> <span class="tok-n">color</span> <span class="tok-o">)</span>
    <span class="tok-kd">throws</span> <span class="tok-n">ColorUnderflowException</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">5</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
        <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">ColorUnderflowException</span><span class="tok-o">(</span><span class="tok-s">&quot;Blue: &quot;</span>
            <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">5</span><span class="tok-o">));</span>
    <span class="tok-k">else</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">Color</span><span class="tok-o">(</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getRed</span><span class="tok-o">(),</span> <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getGreen</span><span class="tok-o">(),</span>
            <span class="tok-n">color</span><span class="tok-o">.</span><span class="tok-na">getBlue</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-mi">5</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can write a short method that changes a given color based on
user input and deals with exceptions appropriately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Color</span> <span class="tok-nf">changeColor</span><span class="tok-o">(</span> <span class="tok-n">Color</span> <span class="tok-n">color</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter &#39;R&#39;, &#39;G&#39;, or &#39;B&#39; to increase &quot;</span> <span class="tok-o">+</span>
        <span class="tok-s">&quot;the amount of red, green, or blue in your color. &quot;</span> <span class="tok-o">+</span>
        <span class="tok-s">&quot;Enter &#39;r&#39;, &#39;g&#39;, or &#39;b&#39; to decrease the amount of &quot;</span> <span class="tok-o">+</span>
        <span class="tok-s">&quot;red, green, or blue in your color.&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">().</span><span class="tok-na">trim</span><span class="tok-o">().</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;R&#39;</span><span class="tok-o">:</span> <span class="tok-n">color</span> <span class="tok-o">=</span> <span class="tok-n">increaseRed</span><span class="tok-o">(</span> <span class="tok-n">color</span> <span class="tok-o">);</span> <span class="tok-k">break</span><span class="tok-o">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;G&#39;</span><span class="tok-o">:</span> <span class="tok-n">color</span> <span class="tok-o">=</span> <span class="tok-n">increaseGreen</span><span class="tok-o">(</span> <span class="tok-n">color</span> <span class="tok-o">);</span> <span class="tok-k">break</span><span class="tok-o">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;B&#39;</span><span class="tok-o">:</span> <span class="tok-n">color</span> <span class="tok-o">=</span> <span class="tok-n">increaseBlue</span><span class="tok-o">(</span> <span class="tok-n">color</span> <span class="tok-o">);</span> <span class="tok-k">break</span><span class="tok-o">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;r&#39;</span><span class="tok-o">:</span> <span class="tok-n">color</span> <span class="tok-o">=</span> <span class="tok-n">decreaseRed</span><span class="tok-o">(</span> <span class="tok-n">color</span> <span class="tok-o">);</span> <span class="tok-k">break</span><span class="tok-o">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;g&#39;</span><span class="tok-o">:</span> <span class="tok-n">color</span> <span class="tok-o">=</span> <span class="tok-n">decreaseGreen</span><span class="tok-o">(</span> <span class="tok-n">color</span> <span class="tok-o">);</span> <span class="tok-k">break</span><span class="tok-o">;</span>
            <span class="tok-k">case</span> <span class="tok-sc">&#39;b&#39;</span><span class="tok-o">:</span> <span class="tok-n">color</span> <span class="tok-o">=</span> <span class="tok-n">decreaseBlue</span><span class="tok-o">(</span> <span class="tok-n">color</span> <span class="tok-o">);</span> <span class="tok-k">break</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
    <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">ColorOverflowException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">e</span> <span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">ColorUnderflowException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">e</span> <span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-n">color</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code that uses these methods and exceptions is compact. One <code>try</code>
block enclosing the method calls is needed so that the exceptions can be
caught. Following the <code>try</code>, there is a <code>catch</code> block for the
<code>ColorOverflowException</code> and one for the <code>ColorUnderflowException</code>. Each
will print out its exception, including the customized message inside.
If an exception occurred, the value of <code>color</code> would remain unchanged
because execution would have jumped to a <code>catch</code> block before the
assignment could happen.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_bank_burglary">12.4. Solution: Bank burglary</h3>
<div class="paragraph">
<p>Here is our solution to the bank burglary problem. Although somewhat
fanciful, the process could be expanded into a more serious simulation.
We begin by defining each of the exceptions.</p>
</div>
<div id="BurglarAlarmExceptionProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BurglarAlarmException</span> <span class="tok-kd">extends</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">BurglarAlarmException</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">message</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">BurglarAlarmException</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="WatchmanExceptionProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WatchmanException</span> <span class="tok-kd">extends</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">WatchmanException</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">message</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">WatchmanException</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="LockPickFailExceptionProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LockPickFailException</span> <span class="tok-kd">extends</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">LockPickFailException</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">message</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">LockPickFailException</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="LootTooHeavyExceptionProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LootTooHeavyException</span> <span class="tok-kd">extends</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">LootTooHeavyException</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">message</span> <span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">LootTooHeavyException</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-kd">super</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the default constructor for each exception is necessary, since
constructors taking a <code>String</code> value are provided for each class.
Although these default constructors do nothing other than call their
parent constructor, they are needed so that it is possible to create
each of these contructors <strong>without</strong> a customized message.</p>
</div>
<div class="paragraph">
<p>With the exceptions defined, we can assume that the <code>Bank</code> class and the
<code>Vault</code> class throw the appropriate exceptions when something goes
wrong. Thus, we can make a `Henchman`class who can try to do the heist
and react appropriately if there is a problem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Henchman</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">burgle</span><span class="tok-o">(</span> <span class="tok-n">Bank</span> <span class="tok-n">bank</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			<span class="tok-n">bank</span><span class="tok-o">.</span><span class="tok-na">disableAlarm</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>			<span class="tok-n">bank</span><span class="tok-o">.</span><span class="tok-na">breakIn</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>			<span class="tok-n">Vault</span> <span class="tok-n">vault</span> <span class="tok-o">=</span> <span class="tok-n">bank</span><span class="tok-o">.</span><span class="tok-na">findVault</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>			<span class="tok-n">vault</span><span class="tok-o">.</span><span class="tok-na">open</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>			<span class="tok-n">Loot</span> <span class="tok-n">loot</span> <span class="tok-o">=</span> <span class="tok-n">vault</span><span class="tok-o">.</span><span class="tok-na">getLoot</span><span class="tok-o">();</span>
<span class="lineno">10 </span>			<span class="tok-n">loot</span><span class="tok-o">.</span><span class="tok-na">carryAway</span><span class="tok-o">();</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;We got &quot;</span> <span class="tok-o">+</span> <span class="tok-n">loot</span> <span class="tok-o">+</span> <span class="tok-s">&quot;!&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To burgle a bank, one must create a <code>Henchman</code> object then pass a <code>Bank</code>
object into its <code>burgle()</code> method. The method will try to disable the
alarm, break into the bank, find the vault, open the vault, get the loot
out of the vault, and carry it away. If all those steps happen
successfully, the method will print out a <code>String</code> version of the loot.
All of this code is inside of a <code>try</code> block. If an exception is thrown
at any point, the following <code>catch</code> blocks will deal with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">BurglarAlarmException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;I set off the burglar because &quot;</span>
<span class="lineno"> 3 </span>					<span class="tok-o">+</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">());</span>
<span class="lineno"> 4 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;I had to run away.&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>		<span class="tok-o">}</span>
<span class="lineno"> 6 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">WatchmanException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;A watchman caught me because &quot;</span>
<span class="lineno"> 8 </span>					<span class="tok-o">+</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">());</span>
<span class="lineno"> 9 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Please bail me out of jail.&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-o">}</span>
<span class="lineno">11 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">LockPickFailException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;I couldn&#39;t pick the vault lock.&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;No loot for us.&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>		<span class="tok-o">}</span>
<span class="lineno">15 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">LootTooHeavyException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The loot was too heavy to carry.&quot;</span><span class="tok-o">);</span>
<span class="lineno">17 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;No loot for us.&quot;</span><span class="tok-o">);</span>
<span class="lineno">18 </span>		<span class="tok-o">}</span>
<span class="lineno">19 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">NullPointerException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The vault was hidden or empty.&quot;</span><span class="tok-o">);</span>
<span class="lineno">21 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;No loot for us.&quot;</span><span class="tok-o">);</span>
<span class="lineno">22 </span>		<span class="tok-o">}</span>
<span class="lineno">23 </span>	<span class="tok-o">}</span>
<span class="lineno">24 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If a <code>BurglarAlarmException</code> happens, the henchman is forced to run
away. If a <code>WatchmanException</code> happens, the henchman is caught and must
be bailed out of jail. If a <code>LockPickFailException</code> or
<code>LootTooHeavyException</code> happens, the henchman is unable to carry the
loot off.</p>
</div>
<div class="paragraph">
<p>The last <code>catch</code> block is a little unusual. In this case, a
<code>NullPointerException</code> has occurred. Within the <code>try</code> block, two obvious
sources of this exception are the <code>vault</code> and the <code>loot</code> variables. If
either of them were <code>null</code>, in the case of a vault that could not be
found or a vault that was empty, trying to call a method on that <code>null</code>
reference would throw a <code>NullPointerException</code>. Although this code shows
the power of exception handling, it is a little unwieldy since we do not
know which variable was <code>null</code>. Also, we will hide any
<code>NullPointerException</code> that might have for other reasons. A better
solution would be to check for each of these <code>null</code> cases or create more
specific exceptions thrown by <code>findVault()</code> and <code>getLoot()</code> if either
returns <code>null</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_exceptions">12.5. Concurrency: Exceptions</h3>
<div class="paragraph">
<p>Any thread in Java can throw an exception. That thread might be the main
thread or it might be an extra one that you spawned yourself. (Or even
one spawned behind the scenes through a library call.)</p>
</div>
<div class="paragraph">
<p>What happens when a thread throws an exception? As we have been
discussing in this chapter, the exception will either be caught or
passed on to its caller. If the exception is caught, the <code>catch</code> block
determines what happens. If the exception is passed up and up and up and
never caught, then what? If you have coded some of the examples in this
chapter, you might think the entire program crashes, but only the thread
throwing the exception dies.</p>
</div>
<div class="exampleblock">
<div class="title">Example 93. Multiple threads with exceptions</div>
<div class="content">
<div class="paragraph">
<p>In a program with a single thread, an exception thrown by the <code>main()</code>
method will crash the program, completely halting execution. In a
multi-threaded program, execution will continue on all threads that have
not thrown exceptions. If even a single thread is executing, the program
will run to completion before the JVM shuts down.</p>
</div>
<div id="CrazyThreadProgram" class="listingblock">
<div class="title">Program 48. Spawns 10 threads. 9 out of 10 spawned threads as well as the main thread throw an exception and die. The remaining thread outputs the sum of the sines of 1 through 1,000,000.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CrazyThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>			<span class="tok-k">new</span> <span class="tok-n">CrazyThread</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">).</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>		<span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">RuntimeException</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-nf">CrazyThread</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span> <span class="tok-o">==</span> <span class="tok-mi">7</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>			<span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">16 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">1000000</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">17 </span>				<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sin</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno">18 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Sum: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span><span class="tok-o">);</span>
<span class="lineno">19 </span>		<span class="tok-o">}</span>
<span class="lineno">20 </span>		<span class="tok-k">else</span>
<span class="lineno">21 </span>			<span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">RuntimeException</span><span class="tok-o">();</span>
<span class="lineno">22 </span>	<span class="tok-o">}</span>
<span class="lineno">23 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the program given above, all of the threads except one will die
because of the<br>
<code>RuntimeException</code> that they throw. Note that we use the unchecked
<code>RuntimeException</code> so that Java does not complain about the lack of
<code>catch</code> blocks. The thread with a <code>value</code> of 7 will complete its
calculation and print it to the screen even though the main thread has
died. For more information on how to spawn threads, refer to
<a href="#_concurrent_programming">Chapter 13</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This behavior can cause a program that never seems to finish. You might
write a program that spawns a number of threads and does some work. Even
if the <code>main()</code> method has completed and all the important data has been
output, the program will not terminate if any threads are still alive.
This problem can also be caused by creating a GUI (such as a <code>JFrame</code>),
which spawns one or more threads indirectly, if the GUI is not properly
disposed.</p>
</div>
<div class="sect3">
<h4 id="_code_interruptedexception_code">12.5.1. <code>InterruptedException</code></h4>
<div class="paragraph">
<p>In conjunction with concurrency, one exception deserves special
attention:<br>
<code>InterruptedException</code>. This exception can happen when a thread calls
<code>wait()</code>, <code>join()</code>, or <code>sleep()</code>. It is a checked exception, requiring
either a <code>catch</code> block or a <code>throws</code> declaration.</p>
</div>
<div class="paragraph">
<p>This exception is used in cases where the executing thread must wait for
some event to occur or some time to pass. In extreme circumstances,
another thread can interrupt the waiting thread, forcing it to continue
executing before it&#8217;s done waiting. If that happens, the code in the
<code>catch</code> block determines how the thread should recover from being woken
prematurely.</p>
</div>
<div class="paragraph">
<p>Programmers who are new to concurrency in Java are often confused or
annoyed by<br>
<code>InterruptedException</code>, particularly since it never seems to be thrown.
Although it is thrown rarely, situations such as a system shutting down
may be best dealt with by calling <code>interrupt()</code> on a waiting thread,
causing such an exception. Although we will generally leave the
<code>InterruptedException</code> <code>catch</code> block empty in this book, threads written
for production code should always handle interruptions gracefully.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_12">12.6. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise12.1"></a> What are the advantages of
using exceptions instead of returning error codes?</p>
</li>
<li>
<p><a id="exercise12.2"></a> The keywords <code>final</code> and <code>finally</code>,
as well as the <code>Object</code> method <code>finalize()</code>, are sometimes confused.
What is the purpose of each one?</p>
</li>
<li>
<p><a id="exercise12.3"></a> What is the difference between the
<code>throw</code> keyword and the <code>throws</code> keyword?</p>
</li>
<li>
<p><a id="exercise12.4"></a> Explain the catch or specify
requirement of Java.</p>
</li>
<li>
<p><a id="exercise12.5"></a> What must be done differently
when using methods that throw checked exceptions as compared to
unchecked exceptions? How do the classes <code>Exception</code>,<br>
<code>RuntimeException</code>, and <code>Error</code> play a role?</p>
</li>
<li>
<p><a id="exercise12.6"></a> For every program you write, you
could choose to put the entire body of your <code>main()</code> method in a large
<code>try</code> block with a <code>catch</code> block at the end that catches <code>Exception</code>. In
this way, no exception would cause your program to crash. Why is this
approach a bad programming decision?</p>
</li>
<li>
<p><a id="exercise12.7"></a> Why did the designers of Java choose to make <code>NullPointerException</code>
and<br>
<code>ArithmeticException</code> unchecked exceptions even though this choice means
that a program that unintentionally dereferences a <code>null</code> pointer or
divides by zero will often crash.</p>
</li>
<li>
<p><a id="exercise12.8"></a> Consider the following two classes.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Trouble</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">makeTrouble</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">ArithmeticException</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Hazard</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">makeHazard</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">InterruptedException</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Class <code>Trouble</code> will compile, but class <code>Hazard</code> will not. Explain why
and what could be done to make <code>Hazard</code> compile.</p>
</div>
</li>
<li>
<p><a id="exercise12.9"></a> What value will the following method
always return and why?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">magic</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span> <span class="tok-n">value</span> <span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">x</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Some exception occurred.&quot;</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">finally</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise12.10"></a> Why will the following
segment of code fail to compile?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span><span class="tok-o">{</span>
    <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">1000</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Exception occurred!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Woke up early!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise12.11"></a> Consider the following fragment of
Java.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">NullPointerException</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-k">finally</span> <span class="tok-o">{</span>
    <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">ArrayIndexOutOfBoundsException</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code is legal Java. It is possible to have a <code>finally</code> block after
a <code>try</code> block without any <code>catch</code> blocks between them. However, only a
single exception can be active at once. Which exception will propagate
up from this code and why?</p>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise12.12"></a> The <code>NumberFormatException</code>
exception is thrown whenever the <code>Integer.parseInt()</code> method receives a poorly formatted <code>String</code> representation of an integer. Re-implement <code>QuickCalculator</code> to catch any <code>NumberFormatException</code> and give an appropriate message to the user.</p>
</li>
<li>
<p><a id="exercise12.13"></a> Refer to
<a href="#exercise11.14">Exercise 11.14</a> and add to the basic mechanics of the simulation by designing two custom
exceptions, <code>CollisionException</code> and <code>LightSpeedException</code>. These
exceptions should be thrown, respectively, if two bodies collide or if
the total magnitude of a body&#8217;s velocity exceeds the speed of light.</p>
</li>
<li>
<p><a id="exercise12.14"></a> Users often log onto systems by
entering their user name and a password. Unfortunately, human beings are
notoriously bad at picking passwords. In computer security, a tool
called a <em>proactive password checker</em> allows a user to pick a password
but rejects the choice if it doesn&#8217;t meet certain criteria.</p>
<div class="paragraph">
<p>Common criteria for a password are that it must be at least a certain
length, must contain must contain uppercase and lowercase letters, must
contain numerical digits, must contain symbols, cannot be the same as a
list of words from a dictionary, and others.</p>
</div>
<div class="paragraph">
<p>Write a short program with a <code>check()</code> method that takes a single
<code>String</code> parameter giving a possible password. This method should throw
an exception if the password does not meet the matching criteria listed
below.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Password criteria</th>
<th class="tableblock halign-left valign-middle">Exception</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">At least 8 characters in length</p></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>TooShortException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Contains both upper- and lowercase letters</p></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>NoMixedCaseException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Contains at least one numerical digit</p></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>NoDigitException</pre></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Contains at least one symbol</p></td>
<td class="tableblock halign-left valign-middle"><div class="literal"><pre>NoSymbolException</pre></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Your <code>main()</code> method should prompt the user to select a password and
then pass it to the <code>check()</code> method. If the method throws an exception,
you should catch it and print an appropriate error message. Otherwise,
you should report to the user that the password is acceptable. Note that
you will need to define each of the four exceptions as well.</p>
</div>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise12.15"></a> Throwing and catching exceptions
is a useful tool for making robust programs in Java. However, the JVM
machinery needed to implement such a powerful tool is complex. Create an
array containing 100,000 random <code>int</code> values. First, sum all these
variables up using a <code>for</code> loop and time how long it takes. Then, do the
same thing, but, inside of the <code>for</code> loop, put a <code>try</code> block containing
a simple division by zero instruction such as <code>x = 5 / 0;</code>. After the
<code>try</code> block, put a <code>catch</code> block catching an<br>
<code>ArithmeticException</code>. Time this version of the code. Again, you may
wish to use <code>System.nanoTime()</code> to measure the time accurately. Was
there a large difference in the time taken? Do your findings have any
implications for code that routinely throws thousands of exceptions?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concurrent_programming">13. Concurrent Programming</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Time is the substance from which I am made. Time is a river which carries me along, but I am
the river; it is a tiger that devours me, but I am the tiger; it is a fire that consumes me, but I am
the fire.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Jorge Luis Borges
</div>
</div>
<div class="sect2">
<h3 id="_introduction_2">13.1. Introduction</h3>
<div class="paragraph">
<p>So far we have focused mostly on writing sequential programs. Such
programs are executed sequentially by a computer. Sequential execution
implies that program statements are executed one at a time in a sequence
determined by program logic and input data. While it is common for
programmers to write sequential programs, the widespread availability of
multicore processors in a single computer has led to an increase in the
demand for programmers who can write <em>concurrent</em> programs. More than
one program statement can be executed independently by a multicore
processor.</p>
</div>
<div class="paragraph">
<p>A concurrent program is one in which several statements can be executed
simultaneously by two or more cores. In this chapter we show how to
write simple concurrent programs in Java that exploit the power of a
multicore computer. We begin with an example in which the fate of the
planet is in grave danger!</p>
</div>
</div>
<div class="sect2">
<h3 id="_problem_deadly_virus">13.2. Problem: Deadly virus</h3>
<div class="paragraph">
<p>A deadly virus capable of wiping out the world&#8217;s population is about to
be released by an evil mastermind. Only he knows the security code that
can stop the countdown. The world is doomed. The single hope for
salvation lies with you and your Java programming skills. Through the
investigations of a top secret, government-funded spy ring, it has been
revealed that the security code is tied to the number
59,984,005,171,248,659. This large number is the product of two prime
numbers, and the security code is their sum. All you need to do is
factor the number 59,984,005,171,248,659 into its two prime factors.</p>
</div>
<div class="paragraph">
<p>Of course, there is a catch. The deadly virus is going to be released
soon, so soon that there might not be enough time for your computer to
search through all the numbers one by one. Instead, you must use
concurrency to check more than one number at a time.</p>
</div>
<div class="paragraph">
<p>Does this problem sound contrived? To keep information sent over the
Internet private, some kinds of public key cryptography rely on the
difficulty of factoring large numbers. Although factoring the number in
this problem is not difficult, the numbers used for public key
cryptography, typically more than 300 decimal digits long, have resisted
factorization by even the fastest computers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_splitting_up_work">13.3. Concepts: Splitting up work</h3>
<div class="paragraph">
<p>The deadly virus problem has one large task (factoring a number) to
perform. How should we split up this task so that we can do it more
quickly? Splitting up the work to be done is at the heart of any
concurrent solution to a problem.</p>
</div>
<div class="paragraph">
<p>In a multicore processor, each core is an independent worker. It takes
some care to coordinate these workers. First of all, we still need to
get the right answer. A concurrent solution is worthless if it is
incorrect, and by reading and writing to the same shared memory, answers
found by one core can corrupt answers found by other cores. Preventing
that problem will be addressed in <a href="#_synchronization">Chapter 14</a>.
If we are sure the concurrent solution is correct, we also want to
improve performance in some way. Perhaps we want the task to finish more
quickly. Perhaps we have an interactive system that should continue to
handle user requests even though it is working on a solution in the
background. Again, if the overhead of coordinating our workers takes
more time than a sequential solution or makes the system less
responsive, it&#8217;s not useful.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.10">Exercise 13.10</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>There are two main ways to split up work. The first is called <em>task
decomposition</em>. In this approach, each worker is given a different job
to do. The second is called <em>domain decomposition</em>. In this approach,
the workers do the same job, but to different data.</p>
</div>
<div class="paragraph">
<p>It is possible to use both task and domain decomposition together to
solve the same problem. With both kinds of decomposition, it is usually
necessary to coordinate the workers so that they can share information.
In the next two subsections, we describe task decomposition and domain
decomposition in greater depth. Then we discuss mapping tasks to threads
of execution and the different memory architectures that can be used for
concurrent programming.</p>
</div>
<div class="sect3">
<h4 id="_task_decomposition">13.3.1. Task decomposition</h4>
<div class="paragraph">
<p>The idea of breaking a task down into smaller subtasks is a natural one.
Imagine you are planning a dinner party. You need to buy supplies, cook
the dinner, clean your house, and set the table. If four of you were
planning the party, each could perform a separate activity. The
preparations could go much faster than if a single person was doing the
work, but coordination is still important. Perhaps the person cooking
the dinner couldn&#8217;t finish until certain supplies had been bought.</p>
</div>
<div class="paragraph">
<p>Task decomposition is often easier than domain decomposition because
many tasks have natural divisions. Unfortunately, it is not always an
effective way to use multiple cores on a computer. If one task finishes
long before the others, a core might sit idle.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.9">Exercise 13.9</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The next two examples give simple illustrations of the process of
splitting a task into smaller subtasks in the context of multicore
programming.</p>
</div>
<div id="videoGameTasksExample" class="exampleblock">
<div class="title">Example 94. Video game tasks</div>
<div class="content">
<div class="paragraph">
<p>Consider a simple video game that consists of the following tasks.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>start game</p>
</li>
<li>
<p>process move</p>
</li>
<li>
<p>update score</p>
</li>
<li>
<p>repaint screen</p>
</li>
<li>
<p>end game</p>
</li>
</ol>
</div>
<div id="figure-video_game_tasks" class="imageblock text-center">
<div class="content">
<img src="chapters/13-concurrency/images/video-game-tasks.svg" alt="video game tasks" width="75%">
</div>
<div class="title">Figure 45. Execution of tasks in a video game. (a) Sequential execution on a single core. (b) Concurrent execution on two cores. Arrows show the flow of execution and data transfer.</div>
</div>
<div class="paragraph">
<p>Suppose that tasks B and D are independent and can be executed
concurrently if two cores are available. Task D continually updates the
screen with the old data until task C updates the information.</p>
</div>
<div class="paragraph">
<p><a href="#figure-video_game_tasks">Figure 45</a>(a) and (b) show how the tasks in this
video game can be sequenced, respectively, on a single core or on two
cores. All tasks are executed sequentially on a single-core processor.
In a dual-core processor tasks B and C can execute on one core while
task D is executing concurrently on another. Note from the figure that
task C sends the score and any other data to task D which is
continuously updating the screen. Having two cores can allow a faster
refresh of the display as the processor does not have to wait for tasks
B or C to complete.</p>
</div>
</div>
</div>
<div id="mathExpressionTasksExample" class="exampleblock">
<div class="title">Example 95. Math expression tasks</div>
<div class="content">
<div class="paragraph">
<p>Suppose that the following mathematical expression is to be evaluated
for parameters \(a\) and \(K\) at a given value of
\(t\).
\(2\cdot K\cdot a\cdot t\cdot e^{-a\cdot t^2}\) We can
divide the expression into two terms:
\(2\cdot K\cdot a\cdot t\) and \(e^{-a\cdot t^2}\).
Each of these terms can be assigned to a different task for evaluation.
On a dual-core processor, these two tasks can be executed on separate
cores and the results from each combined to generate the value of the
expression by the main task.</p>
</div>
<div id="figure-math_evaluation" class="imageblock text-center">
<div class="content">
<img src="chapters/13-concurrency/images/mathematical-expression-evaluation.svg" alt="mathematical expression evaluation" width="75%">
</div>
<div class="title">Figure 46. Evaluation of a mathematical expression (a) sequentially on a single core and (b) concurrently on two cores. Arrows show the flow of execution and data transfer. Bold typeface indicates the operation being performed.</div>
</div>
<div class="paragraph">
<p><a href="#figure-math_evaluation">Figure 46</a> shows how this expression can be
evaluated on single core and dual-core processors. Sometimes, using
multiple cores to evaluate an expression like this will take less time
than a single core. However, there is no guarantee that using multiple
cores will always be faster, because tasks take time to set up and to
communicate with each other.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.4">Exercise 13.4</a><br>
<a href="#exercise13.5">Exercise 13.5</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>These examples illustrate how a task can be divided into two or more
subtasks executed by different cores of a processor. We use a dual-core
processor for our examples, but the same ideas can be expanded to a
larger number of cores.</p>
</div>
</div>
<div class="sect3">
<h4 id="_domain_decomposition">13.3.2. Domain decomposition</h4>
<div class="paragraph">
<p>In a computer program, every task performs operations on data. This data
is called the <em>domain</em> of that task. In domain decomposition, the data
is divided into smaller chunks where each chunk is assigned to a
different core, instead of dividing a task into subtasks. Each core
executes the same task but on different data.</p>
</div>
<div class="paragraph">
<p>In the example of the dinner party, we could have used domain
decomposition instead of (or in addition to) task decomposition. If you
want to cook a massive batch of mashed potatoes, you could peel 24
potatoes yourself. However, if there are four of you (and you each have
a potato peeler), each person would only need to peel 6 potatoes.</p>
</div>
<div class="paragraph">
<p>The strategy of domain decomposition is very useful and is one of the
major focuses of concurrency in this book. Problems in modern computing
often use massive data, comprising millions of numbers or thousands of
database records. Writing programs that can chop up data so that
multiple cores can process smaller sections of it can greatly speed up
the time it takes to finish computing a solution.</p>
</div>
<div class="paragraph">
<p>Domain decomposition can be more difficult than task decomposition. The
data must be divided evenly and fairly. Once each section of data has
been processed, the results must be combined. Companies like Google that
process massive amounts of information have developed terminology to
describe this process. Dividing up the data and assigning it to workers
is called the <em>map</em> step. Combining the partial answers into the final
answer is called the <em>reduce</em> step.</p>
</div>
<div class="paragraph">
<p>We illustrate the domain decomposition strategy in the next two
examples.</p>
</div>
<div id="arraySummationPreviewExample" class="exampleblock">
<div class="title">Example 96. Array summation preview</div>
<div class="content">
<div class="paragraph">
<p>Suppose that we want to apply function \(f()\) to each element
of an array \(A\) and sum the results. Mathematically, we want
to compute the following sum.</p>
</div>
<div class="paragraph">
<p>\(S=\sum_{i=1}^N f\left(a(i)\right)\)</p>
</div>
<div class="paragraph">
<p>In this formula, \(a(i)\) is the \(i\)<sup>th</sup> element
of array \(A\). We want to perform the task of applying
function \(f()\) to each element in the array and summing the
result. Let&#8217;s assume that we have a dual-core processor available to
compute the sum. We split up the array so that each core performs the
task on half of the array. Let \(S_1\) and \(S_2\)
denote the sums computed by core 1 and core 2, respectively.</p>
</div>
<div class="paragraph">
<p>\(S_1 =\sum_{i=1}^{\lfloor \frac{N}{2}\rfloor } f\left(a(i)\right)\hspace{.75in}
S_2 =\sum_{i=\lfloor \frac{N}{2} \rfloor +1}^{N} f\left(a(i)\right)\)</p>
</div>
<div class="paragraph">
<p>Assuming that \(N\) is even, both cores process exactly the
same amount of data. For odd \(N\), one of the cores processes
one more data item than the other.</p>
</div>
<div id="figure-array_decomposition" class="imageblock text-center">
<div class="content">
<img src="chapters/13-concurrency/images/arrayDecomposition.svg" alt="arrayDecomposition" width="60%">
</div>
<div class="title">Figure 47. Computing the sum of a function of each element of an array.</div>
</div>
<div class="paragraph">
<p>After \(S_1\) and \(S_2\) have been computed, one of
the cores can add these two numbers together to get \(S\).
This strategy is illustrated in <a href="#figure-array_decomposition">Figure 47</a>.
After the two cores have completed their work on each half of the array,
the individual sums are added together to produce the final sum.</p>
</div>
</div>
</div>
<div id="matrixMultiplicationPreviewExample" class="exampleblock">
<div class="title">Example 97. Matrix multiplication preview</div>
<div class="content">
<div class="paragraph">
<p>The need to multiply matrices arises in many mathematical, scientific,
and engineering applications. Suppose we are asked to write a program to
multiply two square matrices \(A\) and \(B\), which
are both \(n\times n\) matrices. The product matrix
\(C\) will also be \(n\times n\). A sequential
program will compute each element of matrix \(C\) one at a
time. However, a concurrent program can compute more than one element of
\(C\) simultaneously using multiple cores.</p>
</div>
<div id="figure-matrix_decomposition" class="imageblock text-center">
<div class="content">
<img src="chapters/13-concurrency/images/matrixDecomposition.svg" alt="matrixDecomposition" width="75%">
</div>
<div class="title">Figure 48. Data decomposition to multiply two \(4\times 4\) matrices. The two cores perform the same multiplication tasks but on different data from matrix \(A\). The two cores compute the top and bottom two rows of \(C\), respectively.</div>
</div>
<div class="paragraph">
<p>In this problem, the task is to multiply matrices \(A\) and
\(B\). Through domain decomposition, we can replicate this
task on each core. As shown in <a href="#figure-matrix_decomposition">Figure 48</a>,
each core computes only a portion of \(C\). For example, if
\(A\) and \(B\) are \(4\times 4\)
matrices, we can ask one core to compute the product of the first two
rows of \(A\) with all four columns of \(B\) to
generate the first two rows of \(C\). The second core computes
the remaining two rows of \(C\). Both cores can access
matrices \(A\) and \(B\).</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tasks_and_threads">13.3.3. Tasks and threads</h4>
<div class="paragraph">
<p>It is the programmer&#8217;s responsibility to divide his or her solution into
a number of tasks and subtasks which will run on one or more cores on a
processor. In previous sections, we described concurrent programs as if
specific tasks could be assigned specific cores, but Java does not
provide a direct way to do so.</p>
</div>
<div class="paragraph">
<p>Instead, a Java programmer must group together a set of tasks and
subtasks into a <em>thread</em>. A thread is very much like a sequential
program. In fact, all sequential programs have only one thread. A thread
is a segment of executing code that runs through its instructions step
by step. Each thread can run independently. If you have a single core
processor, only one thread can run at a time, and all the threads will
take turns. If you have a multicore processor, as many threads as there
are cores can execute at the same time. You cannot pick which core a
given thread will run on. In most cases, you will not even be able to
tell which core a given thread is using.</p>
</div>
<div class="paragraph">
<p>Even though you cannot control which core a thread will use to execute,
it takes care to package up the right set of tasks into a single thread
of execution. Recall the previous examples of concurrent programming in
this chapter.</p>
</div>
<div class="paragraph">
<p>Consider dividing the tasks in <a href="#videoGameTasksExample">Example 94</a> into
two threads. Tasks B and C in can be packaged into thread 1, and task D
can be packaged into thread 2. This division is shown in
<a href="#figure-tasks_in_threads">Figure 49</a>(a).</p>
</div>
<div class="paragraph">
<p>Tasks to evaluate different subexpressions in <a href="#mathExpressionTasksExample">Example 95</a> can also be divided into two threads as shown in
<a href="#figure-tasks_in_threads">Figure 49</a>(b). In many problems there are
several reasonable ways of dividing a set of subtasks into threads.</p>
</div>
<div class="paragraph">
<p>Note that these figures look exactly like the earlier figures, except
that the tasks are grouped as threads instead of cores. This grouping is
matches reality better, since we can control how the tasks are packaged
into threads but not how they are assigned to cores.</p>
</div>
<div class="paragraph">
<p>In both examples, we have two threads. It is possible that some other
thread started these threads running. Every Java program, concurrent or
sequential, starts with one thread. We will refer to this thread as the
<em>main</em> thread since it contains the <code>main()</code> method.</p>
</div>
<div class="paragraph">
<p><a href="#arraySummationPreviewExample">Example 96</a> and <a href="#matrixMultiplicationPreviewExample">Example 97</a> use multiple identical tasks. But these tasks
operate on different data. Nevertheless, in <a href="#arraySummationPreviewExample">Example 96</a>, the two tasks can be assigned two threads that
operate on different portions of the input array. The task of summing
the results from the two threads can either be a separate thread or a
subtask included in one of the other threads. In
<a href="#matrixMultiplicationPreviewExample">Example 97</a>, the two tasks can
again be assigned to two distinct threads that operate on different
parts of the input matrix \(A\) to generate the corresponding
portions of the output matrix \(C\).</p>
</div>
<div id="figure-tasks_in_threads" class="imageblock">
<div class="content">
<img src="chapters/13-concurrency/images/task-thread-packaging.svg" alt="task thread packaging" width="100%">
</div>
<div class="title">Figure 49. (a) Tasks in a video game shown packaged into two threads. (b) Tasks to evaluate a mathematical expression shown packaged into two threads. Each thread may or may not run on the same core as the other.</div>
</div>
<div class="paragraph">
<p>There can be many ways to package tasks into threads. There can also be
many ways to decompose data into smaller chunks. The best ways to
perform these subdivisions of tasks or data depend on the problem at
hand and the processor architecture on which the program will be
executed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_memory_architectures_and_concurrency">13.3.4. Memory architectures and concurrency</h4>
<div class="paragraph">
<p>The two most important paradigms for concurrent programming are message
passing and shared memory systems. Each paradigm handles communication
between the various pieces of code running in parallel in a different
way. Message passing systems such as MPI and PVM approach this problem
by sending messages between otherwise independent pieces of code called
processes. A process which is executing a task may have to wait until it
receives a message from another process before it knows how to proceed.
Messages can be sent from a single process to a single other or
broadcast to many. Message passing systems are especially useful when
the processors doing the work do not share memory.</p>
</div>
<div class="paragraph">
<p>In contrast, Java uses the shared memory paradigm. In Java, a programmer
can create a number of threads which share the same memory space. Each
thread is an object which can perform work. We described threads as a
way to package up a group of tasks, and processes are another. People
use the term <em>processes</em> to describe executing sections of code with
separate memory and <em>threads</em> to describe executing sections of code
with shared memory.</p>
</div>
<div class="paragraph">
<p>When you first learned to program, one of the biggest challenges was
probably learning to solve a problem step by step. Each line of the
program had to be executed one at a time, logically and
deterministically. Human beings do not naturally think that way. We tend
to jump from one thing to another, making inferences and guesses,
thinking about two unrelated things at once, and so on. As you know well
by now, it is only possible to write and debug programs because of the
methodical way they work.</p>
</div>
<div class="paragraph">
<p>You can imagine the execution of a program as an arrow that points to
one line of code, then the next, then the next, and so on. We can think
of the movement of this arrow as the thread of execution of the program.
The code does the actual work, but the arrow keeps track of where
execution in the program currently is. The code can move the arrow
forward, it can do basic arithmetic, it can decide between choices with
<code>if</code> statements, it can do things repeatedly with loops, it can jump
into a method and then come back. A single thread of execution can do
all of these things, but it cannot be two places at once. It cannot both
be dividing two numbers in one part of the program and evaluating an
<code>if</code> statement in another. However, there is a way to split this thread
of execution so that two or more threads are executing different parts
of the program, and the next section will show you how it is done in
Java.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_threads_in_java">13.4. Syntax: Threads in Java</h3>
<div class="sect3">
<h4 id="_the_code_thread_code_class">13.4.1. The <code>Thread</code> class</h4>
<div class="paragraph">
<p>Java, like many programming languages, provides the necessary features
to package tasks and subtasks into threads. The <code>Thread</code> class and its
subclasses provide the tools for creating and managing threads. For
example, the following class definition allows objects of type
<code>ThreadedTask</code> to be created. Such an object can be executed as a
separate thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ThreadedTask</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
    <span class="tok-c1">// Add constructor and body of class</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor is written just like any other constructor, but there is
a special <code>run()</code> method in <code>Thread</code> that can be overridden by any of
its subclasses. This method is the starting point for the thread of
execution associated with an instance of the class. Most Java
applications begin with a single main thread which starts in a <code>main()</code>
method. Additional threads must start somewhere, and that place is the
<code>run()</code> method. A Java application will continue to run as long as at
least one thread is active. The following example shows two threads,
each evaluating a separate subexpression as in <a href="#figure-tasks_in_threads">Figure 49</a>(b).</p>
</div>
<div id="threadSamplesExample" class="exampleblock">
<div class="title">Example 98. Thread samples</div>
<div class="content">
<div class="paragraph">
<p>We will create <code>Thread1</code> and <code>Thread2</code> classes. The threads of execution
created by instances of these classes compute, respectively, the two
subexpressions in <a href="#figure-tasks_in_threads">Figure 49</a>(b) and save the
computed values.</p>
</div>
<div id="Thread1Program" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Thread1</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">K</span><span class="tok-o">,</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">t</span><span class="tok-o">,</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Thread1</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">K</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">t</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">K</span> <span class="tok-o">=</span> <span class="tok-n">K</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">a</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">t</span> <span class="tok-o">=</span> <span class="tok-n">t</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">K</span><span class="tok-o">*</span><span class="tok-n">a</span><span class="tok-o">*</span><span class="tok-n">t</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="Thread2Program" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Thread2</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">t</span><span class="tok-o">,</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span>  <span class="tok-nf">Thread2</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">t</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">a</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">t</span> <span class="tok-o">=</span> <span class="tok-n">t</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">exp</span><span class="tok-o">(-</span><span class="tok-n">a</span><span class="tok-o">*</span><span class="tok-n">t</span><span class="tok-o">*</span><span class="tok-n">t</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno"> 9 </span>    <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>run()</code> method in each thread above computes a subexpression and
saves its value. We show how these threads can be executed to solve the
math expression problem in <a href="#mathExpressionThreadsExample">Example 99</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_thread_object">13.4.2. Creating a thread object</h4>
<div class="paragraph">
<p>Creating an object from a subclass of <code>Thread</code> is the same as creating
any other object in Java. For example, we can instantiate the <code>Thread1</code>
class above to create an object called <code>thread1</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Thread1</span> <span class="tok-n">thread1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Thread1</span><span class="tok-o">(</span> <span class="tok-mf">15.1</span><span class="tok-o">,</span> <span class="tok-mf">2.8</span><span class="tok-o">,</span> <span class="tok-mf">7.53</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>new</code> keyword to invoke the constructor creates a <code>Thread1</code>
object, but it does not start executing it as a new thread. As with all
other classes, the constructor initializes the values inside of the new
object. A subclass of <code>Thread</code> can have many different constructors with
whatever parameters its designer thinks appropriate.</p>
</div>
</div>
<div class="sect3">
<h4 id="_starting_a_thread">13.4.3. Starting a thread</h4>
<div class="paragraph">
<p>To start the thread object executing, its <code>start()</code> method must be
called. For example, the <code>thread1</code> object created above can be started
as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-n">thread1</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once started, a thread executes independently. When a thread needs to
share data with another thread, it might have to wait.</p>
</div>
</div>
<div class="sect3">
<h4 id="_waiting_for_a_thread">13.4.4. Waiting for a thread</h4>
<div class="paragraph">
<p>Often some thread, main or otherwise, needs to wait for another thread
before proceeding further with its execution. The <code>join()</code> method is
used to wait for a thread to finish executing. For example, whichever
thread executes the following code will wait for <code>thread1</code> to complete.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-n">thread1</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling <code>join()</code> is a <em>blocking</em> call, meaning that the code calling
this method will wait until it returns. Since it can throw a a checked
<code>InterruptedException</code>. while the code is waiting, the <code>join()</code> method
is generally used within a <code>try</code>-<code>catch</code> block. We can add a
<code>try</code>-<code>catch</code> block to the <code>thread1</code> example so that we can recover from
being interrupted while waiting for <code>thread1</code> to finish.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Waiting for thread 1...&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">thread1</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Thread 1 finished!&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Thread 1 didn&#39;t finish!&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>InterruptedException</code> is thrown because the main thread
was interrupted while waiting for <code>thread1</code> to finish. If the <code>join()</code>
call returns, then <code>thread1</code> must have finished, and we inform the user.
If an <code>InterruptedException</code> is thrown, some outside thread must have
interrupted the main thread, forcing it to stop waiting for <code>thread1</code>.</p>
</div>
<div class="paragraph">
<p>In earlier versions of Java, there was a <code>stop()</code> method which would
stop an executing thread. Although this method still exists, it has been
deprecated and should not be used.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.1">Exercise 13.1</a></p>
</div>
</div>
</div>
<div id="mathExpressionThreadsExample" class="exampleblock">
<div class="title">Example 99. Math expression threads</div>
<div class="content">
<div class="paragraph">
<p>Now that we have the syntax to start threads and wait for them to
finish, we can use the threads defined in <a href="#threadSamplesExample">Example 98</a> with a main thread to make our first complete concurrent
program. The main thread in class <code>MathExpression</code> creates and starts
the worker threads <code>thread1</code> and <code>thread2</code> and waits for their
completion. When the two threads complete their execution, we can ask
each for its computed value. The main thread then prints the product of
these values, which is the result of the expression we want to evaluate.</p>
</div>
<div id="MathExpressionProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MathExpression</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kt">double</span> <span class="tok-n">K</span> <span class="tok-o">=</span> <span class="tok-mi">120</span><span class="tok-o">,</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mf">1.2</span><span class="tok-o">,</span> <span class="tok-n">t</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-n">Thread1</span> <span class="tok-n">thread1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Thread1</span><span class="tok-o">(</span><span class="tok-n">K</span><span class="tok-o">,</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">t</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>        <span class="tok-n">Thread2</span> <span class="tok-n">thread2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Thread2</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">t</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>        <span class="tok-n">thread1</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span> <span class="tok-c1">// start thread1</span>
<span class="lineno"> 7 </span>        <span class="tok-n">thread2</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span> <span class="tok-c1">// start thread2</span>
<span class="lineno"> 8 </span>        <span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-c1">// wait for both threads to complete</span>
<span class="lineno"> 9 </span>            <span class="tok-n">thread1</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">10 </span>            <span class="tok-n">thread2</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">11 </span>            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Value of expression: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">12 </span>            		<span class="tok-n">thread1</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">()*</span><span class="tok-n">thread2</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">());</span>
<span class="lineno">13 </span>        <span class="tok-o">}</span>
<span class="lineno">14 </span>        <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>        	<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;A thread didn&#39;t finish!&quot;</span><span class="tok-o">);</span>
<span class="lineno">16 </span>        <span class="tok-o">}</span>
<span class="lineno">17 </span>    <span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We want to make it absolutely clear when threads are created, start
executing, and finish. These details are crucial for the finer points of
concurrent Java programming. In <a href="#figure-tasks_in_threads">Figure 49</a>, it
appears as if execution of the concurrent math expression evaluation
begins with Thread 1 which spawns Thread 2. Although that figure
explains the basics of task decomposition well, the details are messier
for real Java code.</p>
</div>
<div class="paragraph">
<p>In the code above, execution starts with the <code>main()</code> method in
<code>MathExpression</code>. It creates <code>Thread1</code> and <code>Thread2</code> objects and waits
for them to finish. Then, it reads the values from the objects after
they have stopped executing. We could have put the <code>main()</code> method in
the <code>Thread1</code> class, omitting the <code>MathExpression</code> class entirely. Doing
so would make the execution match <a href="#figure-tasks_in_threads">Figure 49</a>
more closely, but it would make the two <code>Thread</code> subclasses less
symmetrical: The main thread and <code>thread1</code> would both independently
execute code inside the <code>Thread1</code> class while only <code>thread2</code> would
execute code inside the <code>Thread2</code> class.</p>
</div>
<div id="figure-thread_execution" class="imageblock text-center">
<div class="content">
<img src="chapters/13-concurrency/images/thread-lifecycle.svg" alt="thread lifecycle" width="75%">
</div>
<div class="title">Figure 50. Creation, starting, and joining of threads in <code>MathExpression</code>, <code>Thread1</code>, and <code>Thread2</code>.</div>
</div>
<div class="paragraph">
<p><a href="#figure-thread_execution">Figure 50</a> shows the execution of <code>thread1</code> and
<code>thread2</code> and the main thread. Note that the creation and start of the
main thread is done implicitly by the JVM while <code>thread1</code> and <code>thread2</code>
are created explicitly and started by the main thread. Even after the
threads associated with <code>thread1</code> and <code>thread2</code> have stopped running,
the objects continue to exist. Methods and fields can continue to be
accessed.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_code_runnable_code_interface">13.4.5. The <code>Runnable</code> interface</h4>
<div class="paragraph">
<p>Although it is possible to create Java threads by inheriting from the
<code>Thread</code> class directly, the Java API allows the programmer to use an
interface instead.</p>
</div>
<div class="paragraph">
<p>As an example, the <code>Summer</code> class takes an array of <code>int</code> values and
sums them up within a given range. If multiple instances of this class
are executed as separate threads, each one can sum up different parts of
an array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Summer</span> <span class="tok-kd">implements</span> <span class="tok-n">Runnable</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kt">int</span> <span class="tok-n">lower</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kt">int</span> <span class="tok-n">upper</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Summer</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">lower</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">upper</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">array</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">lower</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">upper</span> <span class="tok-o">=</span> <span class="tok-n">upper</span><span class="tok-o">;</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">upper</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">15 </span>			<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getSum</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">sum</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">19 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class is very similar to one that inherits from <code>Thread</code>. Imagine
for a moment that the code following <code>Summer</code> is <code>extends Thread</code>
instead of <code>implements Runnable</code>. The key thing a class derived from
<code>Thread</code> needs is an overridden <code>run()</code> method. Since only the <code>run()</code>
method is important, the designers of Java provided a way to create a
thread using the <code>Runnable</code> interface. To implement this interface, only
a <code>public void run()</code> method is required.</p>
</div>
<div class="paragraph">
<p>When creating a new thread, there are some differences in syntax between
the two styles. The familiar way of creating and running a thread from a
<code>Thread</code> subclass is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Summer</span> <span class="tok-n">summer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Summer</span><span class="tok-o">(</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">lower</span><span class="tok-o">,</span> <span class="tok-n">upper</span> <span class="tok-o">);</span>
<span class="tok-n">summer</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <code>Summer</code> does not inherit from <code>Thread</code>, it does not have a
<code>start()</code> method, and this code will not compile. When a class only
implements <code>Runnable</code>, it is still necessary to create a <code>Thread</code> object
and call its <code>start()</code> method. Thus, an extra step is needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Summer</span> <span class="tok-n">summer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Summer</span><span class="tok-o">(</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">lower</span><span class="tok-o">,</span> <span class="tok-n">upper</span> <span class="tok-o">);</span>
<span class="tok-n">Thread</span> <span class="tok-n">thread</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Thread</span><span class="tok-o">(</span> <span class="tok-n">summer</span> <span class="tok-o">);</span>
<span class="tok-n">thread</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This alternate way of implementing the <code>Runnable</code> interface seems more
cumbersome than inheriting directly from <code>Thread</code>, since you have to
instantiate a separate <code>Thread</code> object. However, most developers prefer
to design classes that implement <code>Runnable</code> instead of inheriting from
<code>Thread</code>. Why? Java only allows for single inheritance. If your class
implements <code>Runnable</code>, it is free to inherit from another parent class
with the features you want.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.2">Exercise 13.2</a></p>
</div>
</div>
</div>
<div id="arrayOfThreadsExample" class="exampleblock">
<div class="title">Example 100. Array of threads</div>
<div class="content">
<div class="paragraph">
<p>In domain decomposition, we often need to create multiple threads, all
from the same class. As an example, consider the following thread
declaration.</p>
</div>
<div id="NumberedThreadProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">NumberedThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-nf">NumberedThread</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">input</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">7 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Thread &quot;</span> <span class="tok-o">+</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="lineno">8 </span>	<span class="tok-o">}</span>
<span class="lineno">9 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now suppose that we want to create 10 thread objects of type
<code>NumberedThread</code>, start them, and then wait for them to complete.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">NumberedThread</span><span class="tok-o">[]</span> <span class="tok-n">threads</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">NumberedThread</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">threads</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">NumberedThread</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
    <span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">threads</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;A thread didn&#39;t finish!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First, we declare an array to hold references to <code>NumberedThread</code>
objects. Like any other type, we can make an array to hold objects that
inherit from <code>Thread</code>. The first line of the <code>for</code> loop instantiates a
new <code>NumberedThread</code> objects, invoking the constructor which stores the
current iteration of the loop into the <code>value</code> field. The reference to
each <code>NumberedThread</code> object is stored in the array. Remember that the
constructor does <strong>not</strong> start a new thread running. The second line of
the <code>for</code> loop does that.</p>
</div>
<div class="paragraph">
<p>We are also interested in when the threads stop. Calling the <code>join()</code>
method forces the main thread to wait for each thread to finish.</p>
</div>
<div class="paragraph">
<p>The entire second <code>for</code> loop is nested inside of a <code>try</code> block. If the
main thread is interrupted while waiting for any of the threads to
finish, an <code>InterruptedException</code> will be caught. As before, we warn the
user that a thread didn&#8217;t finish. For production-quality code, the
<code>catch</code> block should handle the exception in such a way that the thread
can recover and do useful work even though it didn&#8217;t get what it was
waiting for.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_concurrency_and_speedup">13.5. Examples: Concurrency and speedup</h3>
<div class="paragraph">
<p>Speedup is one of the classic motivations for writing concurrent
programs. To understand speedup, let&#8217;s assume we have a problem to
solve. We write two programs to solve this problem, one that is
sequential and another that is concurrent and, hence, able to exploit
the multiple cores. Let \(t_s\) be the average time to execute
the sequential program and \(t_c\) the average time to execute
the concurrent program. Sometimes we will use the notation
\(t_c^k\) to refer to the execution time of a concurrent
program with \(k\) threads. So that the comparison is
meaningful, assume that both programs are executed on the same computer.
The speedup obtained from concurrent programming is defined as follows.
\(\mbox{speedup}=\frac{t_s}{t_c}\)</p>
</div>
<div class="paragraph">
<p>Speedup measures how much faster the concurrent program executes
relative to the sequential program. Ideally, we expect
\(t_c&lt;t_s\), making the speedup greater than 1. However,
simply writing a concurrent program does not necessarily make it faster
than the sequential version.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.6">Exercise 13.6</a><br>
<a href="#exercise13.8">Exercise 13.8</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>To determine speedup, we need to measure \(t_s\) and
\(t_c\). Time in a Java program can easily be measured with
the following two static methods in the <code>System</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">long</span> <span class="tok-nf">currentTimeMillis</span><span class="tok-o">()</span>
<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">long</span> <span class="tok-nf">nanoTime</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first of these methods returns the current time in milliseconds
(ms). A <em>millisecond</em> is 0.001 seconds. This method gives the difference
between the current time on your computer&#8217;s clock and midnight of
January 1, 1970 coordinated universal time (UTC). This point in time is
used for many timing features on many computer platforms and is called
the <em>Unix epoch</em>. The second method returns the current time in
nanoseconds (ns). A <em>nanosecond</em> is 0.000001 seconds. This method also
gives the difference between the current time and some fixed time, which
is system dependent and not necessarily the Unix epoch. The
<code>System.nanoTime()</code> method can be used when you want timing precision
finer than milliseconds; however, the level of accuracy it returns is
again system dependent. The next example show how to use these methods
to measure execution time.</p>
</div>
<div class="exampleblock">
<div class="title">Example 101. Measuring execution time</div>
<div class="content">
<div class="paragraph">
<p>Suppose we want to measure the execution time of a piece of Java code.
For convenience, we can assume this code is contained in the <code>work()</code>
method. The following code snippet measures the time to execute
<code>work()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">long</span> <span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">();</span>
<span class="tok-n">work</span><span class="tok-o">();</span>
<span class="tok-kt">long</span> <span class="tok-n">end</span> <span class="tok-o">=</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-o">();</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Elapsed time: &quot;</span> <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">end</span> <span class="tok-o">-</span> <span class="tok-n">start</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; ms&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will give the execution time for <code>work()</code> measured in
milliseconds. To get the execution time in nanoseconds, use the
<code>System.nanoTime()</code> method instead.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.15">Exercise 13.15</a><br>
<a href="#exercise13.16">Exercise 13.16</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Now that we have the tools to measure execution time, we can measure
speedup. The next few examples show the speedup (or lack of it) that we
can achieve using a concurrent solution to a few simple problems.</p>
</div>
<div class="exampleblock">
<div class="title">Example 102. Math expression speedup</div>
<div class="content">
<div class="paragraph">
<p>Recall the concurrent program in <a href="#mathExpressionThreadsExample">Example 99</a> to evaluate a simple mathematical expression. This program
uses two threads. We executed this multi-threaded program on an iMac
computer with an Intel Core 2 Duo running at 2.16 Ghz. The execution
time was measured at 1,660,000 nanoseconds. We also wrote a simple
sequential program to evaluate the same expression. It took 4,100
nanoseconds to execute this program on the same computer. Plugging in
these values for \(t_c\) and \(t_s\), we can find
the speedup.</p>
</div>
<div class="paragraph">
<p>\(\mbox{speedup}=\frac{t_s}{t_c} = \frac{4,100}{1,660,000}= 0.00246\)<br>
This speedup is much less than 1. Although the result may be surprising,
the concurrent program with two threads executes much slower than the
sequential program. In this example, the cost of creating, running, and
joining threads outweighed the benefits of concurrent calculation on two
cores.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.7">Exercise 13.7</a></p>
</div>
</div>
</div>
<div id="arraySummationExample" class="exampleblock">
<div class="title">Example 103. Array summation</div>
<div class="content">
<div class="paragraph">
<p>In <a href="#arraySummationPreviewExample">Example 96</a>, we introduced the
problem of applying a function to every value in an array and then
summing the results. Let&#8217;s say that we want to apply the sine function
to each value. To solve this problem concurrently, we partition the
array evenly among a number of threads, using the domain decomposition
strategy. Each thread finds the sum of the sines of the values in its
part of the array. One factor that determines whether or not we achieve
speedup is the complexity of the function, in this case sine, that we
apply. Although we may achieve speedup with sine, a simpler function
such as doubling the value might not create enough work to justify the
overhead of using threads.</p>
</div>
<div class="paragraph">
<p>We create class <code>SumThread</code> whose <code>run()</code> method sums the sines of those
elements of the array in its assigned partition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Random</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SumThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">data</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">lower</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">upper</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">SIZE</span> <span class="tok-o">=</span> <span class="tok-mi">1000000</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">THREADS</span> <span class="tok-o">=</span> <span class="tok-mi">8</span><span class="tok-o">;</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-nf">SumThread</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">lower</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">upper</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">lower</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">upper</span> <span class="tok-o">=</span> <span class="tok-n">upper</span><span class="tok-o">;</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First, we set up all the fields that the class will need. We fix the
array size at 1,000,000 and the number of threads at 8, but these values
could easily be changed or read as input instead. In its constructor, a
<code>SumThread</code> takes the lower and upper bounds of its partition. Like most
ranges we discuss, the lower bound is inclusive though the upper bound
is exclusive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">upper</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">3 </span>			<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sin</span><span class="tok-o">(</span><span class="tok-n">data</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getSum</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">sum</span><span class="tok-o">;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>for</code> loop of the <code>run()</code> method, the <code>SumThread</code> finds the sine
of each number in its array partition and adds that value to its running
sum. The <code>getSum()</code> method is an accessor that allows the running sum to
be retrieved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[</span><span class="tok-n">SIZE</span><span class="tok-o">];</span>
<span class="lineno"> 3 </span>		<span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="lineno"> 4 </span>		<span class="tok-kt">int</span> <span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">SIZE</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>			<span class="tok-n">data</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>		<span class="tok-n">SumThread</span> <span class="tok-n">threads</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SumThread</span><span class="tok-o">[</span><span class="tok-n">THREADS</span><span class="tok-o">];</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">quotient</span> <span class="tok-o">=</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">/</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">int</span> <span class="tok-n">remainder</span> <span class="tok-o">=</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">%</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>			<span class="tok-kt">int</span> <span class="tok-n">work</span> <span class="tok-o">=</span> <span class="tok-n">quotient</span><span class="tok-o">;</span>
<span class="lineno">12 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">remainder</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>				<span class="tok-n">work</span><span class="tok-o">++;</span>
<span class="lineno">14 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SumThread</span><span class="tok-o">(</span> <span class="tok-n">start</span><span class="tok-o">,</span> <span class="tok-n">start</span> <span class="tok-o">+</span> <span class="tok-n">work</span> <span class="tok-o">);</span>
<span class="lineno">15 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">16 </span>			<span class="tok-n">start</span> <span class="tok-o">+=</span> <span class="tok-n">work</span><span class="tok-o">;</span>
<span class="lineno">17 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main()</code> method begins by instantiating the array and filling it
with random values. Note that the array is a static field so that it can
be shared by all instances of <code>SumThread</code>. Then each thread is created
with lower and upper bounds that mark its array partition. If the
process using the array length and the number of threads to determine
upper and lower bounds doesn&#8217;t make sense, refer to
<a href="#_concurrency_arrays">Section 6.11</a> which describes the fair division of work
to threads. If the length of the array is not divisible by the number of
threads, simple division isn&#8217;t enough. After creating each thread, its
<code>start()</code> method is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>		<span class="tok-k">try</span>	<span class="tok-o">{</span>
<span class="lineno"> 3 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>				<span class="tok-n">thread</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>				<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">thread</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">getSum</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>			<span class="tok-o">}</span>
<span class="lineno"> 7 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Sum: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">getSum</span><span class="tok-o">());</span>
<span class="lineno"> 8 </span>		<span class="tok-o">}</span>
<span class="lineno"> 9 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span>	<span class="tok-o">{</span>
<span class="lineno">10 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">11 </span>		<span class="tok-o">}</span>
<span class="lineno">12 </span>	<span class="tok-o">}</span>
<span class="lineno">13 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the threads have started working, the main thread creates its own
running total and iterates through each thread waiting for it to
complete. When each thread is done, the main thread adds its value to
the running total. If the main thread is interrupted while waiting for a
thread to complete, the stack trace is printed. Otherwise, the final sum
is printed out.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.12">Exercise 13.12</a><br>
<a href="#exercise13.19">Exercise 13.19</a><br>
<a href="#exercise13.20">Exercise 13.20</a></p>
</div>
</div>
</div>
<div id="matrixMultiplicationExample" class="exampleblock">
<div class="title">Example 104. Matrix multiplication</div>
<div class="content">
<div class="paragraph">
<p>In <a href="#matrixMultiplicationPreviewExample">Example 97</a>, we discussed the
importance of matrix operations in many applications. Now that we know
the necessary Java syntax, we can write a concurrent program to multiply
two square matrices \(A\) and \(B\) and compute the
resultant matrix \(C\). If these matrices have \(n\)
rows and \(n\) columns, the value at the \(i\)<sup>th</sup>
row and \(j\)<sup>th</sup> column of \(C\) is</p>
</div>
<div class="paragraph">
<p>\(C_{ij} = \sum_{k = 1}^n A_{ik}B_{kj} = A_{i1}B_{1j} + A_{i2}B_{2j} + \ldots +
A_{in}B_{nj}\)</p>
</div>
<div class="paragraph">
<p>In Java, it is natural for us to store matrices as 2-dimensional arrays.
To do this multiplication sequentially, the simplest approach uses three
nested <code>for</code> loops. The code below is a direct translation of the
mathematical notation, but we do have to be careful about bookkeeping.
Note that mathematical notation often uses uppercase letters to
represent matrices though the Java convention is to start all variable
names with lowercase letters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">c</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">c</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">k</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">k</span> <span class="tok-o">&lt;</span> <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">k</span><span class="tok-o">++</span> <span class="tok-o">)</span>
            <span class="tok-n">c</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">+=</span> <span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">k</span><span class="tok-o">]</span> <span class="tok-o">*</span> <span class="tok-n">b</span><span class="tok-o">[</span><span class="tok-n">k</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step in making a concurrent solution to this problem is to
create a <code>Thread</code> subclass which will do some part of the matrix
multiplication. Below is the <code>MatrixThread</code> class which will compute a
number of rows in the answer matrix <code>c</code>.</p>
</div>
<div id="MatrixThreadProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MatrixThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-n">b</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-n">c</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">lower</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">upper</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-nf">MatrixThread</span><span class="tok-o">(</span> <span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-n">b</span><span class="tok-o">,</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-n">c</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">lower</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">upper</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">a</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">b</span> <span class="tok-o">=</span> <span class="tok-n">b</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">c</span> <span class="tok-o">=</span> <span class="tok-n">c</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">lower</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">;</span>
<span class="lineno">14 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">upper</span> <span class="tok-o">=</span> <span class="tok-n">upper</span><span class="tok-o">;</span>
<span class="lineno">15 </span>	<span class="tok-o">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">upper</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">19 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">c</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">20 </span>				<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">k</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">k</span> <span class="tok-o">&lt;</span> <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">k</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">21 </span>					<span class="tok-n">c</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">+=</span> <span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">k</span><span class="tok-o">]</span> <span class="tok-o">*</span> <span class="tok-n">b</span><span class="tok-o">[</span><span class="tok-n">k</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">];</span>
<span class="lineno">22 </span>	<span class="tok-o">}</span>
<span class="lineno">23 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor for <code>MatrixThread</code> stores references to the arrays
corresponding to matrices \(A\), \(B\), and
\(C\) as well as lower and upper bounds on the rows of
\(C\) to compute. The body of the <code>run()</code> method is identical
to the sequential solution except that its outermost loop runs only from
<code>lower</code> to <code>upper</code> instead of through all the rows of the result. It is
critical that each thread is assigned a set of rows that does not
overlap with the rows another thread has. Not only would having multiple
threads compute the same row be inefficient, it could very likely lead
to an incorrect result, as we will see in
<a href="#_synchronization">Chapter 14</a>.</p>
</div>
<div class="paragraph">
<p>The following client code uses an array of <code>MatrixThread</code> objects to
perform a matrix multiplication. We assume that an <code>int</code> constant named
<code>THREADS</code> has been defined which gives the number of threads we want to
create.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">MatrixThread</span><span class="tok-o">[]</span> <span class="tok-n">threads</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MatrixThread</span><span class="tok-o">[</span><span class="tok-n">THREADS</span><span class="tok-o">];</span>
<span class="tok-kt">int</span> <span class="tok-n">quotient</span> <span class="tok-o">=</span> <span class="tok-n">c</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">/</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">remainder</span> <span class="tok-o">=</span> <span class="tok-n">c</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">%</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">rows</span> <span class="tok-o">=</span> <span class="tok-n">quotient</span><span class="tok-o">;</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">remainder</span> <span class="tok-o">)</span>
        <span class="tok-n">rows</span><span class="tok-o">++;</span>
    <span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MatrixThread</span><span class="tok-o">(</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">b</span><span class="tok-o">,</span> <span class="tok-n">c</span><span class="tok-o">,</span> <span class="tok-n">start</span><span class="tok-o">,</span> <span class="tok-n">start</span> <span class="tok-o">+</span> <span class="tok-n">rows</span> <span class="tok-o">);</span>
    <span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">start</span><span class="tok-o">();</span>
    <span class="tok-n">start</span> <span class="tok-o">+=</span> <span class="tok-n">rows</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We loop through the array, creating a <code>MatrixThread</code> object for each
location. As in the previous example, we use the approach described in
<a href="#_concurrency_arrays">Section 6.11</a> to allocate rows to each thread fairly.
Each new <code>MatrixThread</code> object is given a reference to each of the three
matrices as well as an inclusive starting and an exclusive ending row.
After the <code>MatrixThread</code> objects are created, we start them running with
the next line of code.</p>
</div>
<div class="paragraph">
<p>Next, there is a familiar <code>for</code> loop with the <code>join()</code> calls that force
the main thread to wait for the other threads to finish. Presumably,
code following this snippet will print the values of the result matrix
or use it for some other calculations. If we don&#8217;t use the <code>join()</code>
calls to be sure the threads have finished, we might print out a result
matrix that has only been partially filled in.</p>
</div>
<div class="paragraph">
<p>We completed the code for threaded matrix multiplication and executed it
on an iMac computer running on an Intel running at 2.16 Ghz. The program
was executed for matrices of different sizes (\(n \times n\)).
For each size, the sequential and concurrent execution times in seconds
and the corresponding speedup are listed in the following table.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Size (\(n\))</th>
<th class="tableblock halign-left valign-top">\(t_s\) (s)</th>
<th class="tableblock halign-left valign-top">\(t_c\) (s)</th>
<th class="tableblock halign-left valign-top">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.013</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.39</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.45<sup>*</sup></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Only with \(1000\times1000\) matrices did we see improved
performance when using two threads. In that case, we achieved a speedup
of 1.45, marked with an asterisk. In the other two cases, performance
became worse.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.14">Exercise 13.14</a><br>
<a href="#exercise13.17">Exercise 13.17</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_thread_scheduling">13.6. Concepts: Thread scheduling</h3>
<div class="paragraph">
<p>Now that we have seen how multiple threads can be used together, a
number of questions should be coming to the forefront. Who decides when
these threads run? How is processor time shared between threads? Can we
make any assumptions about the order in which the threads will run? Can
we affect this order?</p>
</div>
<div class="paragraph">
<p>These questions focus on thread scheduling. Because different concurrent
systems handle scheduling differently, we will only describe scheduling
in Java. Although sequential programming is all about precise control
over what happens <strong>next</strong>, concurrency takes much of this control away
from the programmer. When threads are scheduled and which processor they
run on is handled by a combination of the JVM and the OS. With normal
JVMs, there is no explicit way to access the scheduling and alter it to
your liking.</p>
</div>
<div class="paragraph">
<p>Of course, there are a number of implicit ways a programmer can affect
scheduling. In Java, as in several other languages and programming
systems, threads have <em>priorities</em>. Higher priority threads run more
often than lower priority threads. Some threads are performing
mission-critical operations which must be carried out as quickly as
possible, and some threads are just doing periodic tasks in the
background. A programmer can set the priorities accordingly.</p>
</div>
<div class="paragraph">
<p>Setting priorities gives only a very general way of controlling which
thread will run. The threads themselves might have more specific
information about when they will and will not need processor time. A
thread may need to wait for a specific event and will not need to run
until then. Java allows threads to interact with the scheduler through
<code>Thread.sleep()</code> and <code>Thread.yield()</code>, which we will discuss in
<a href="#_syntax_thread_states">Section 13.7</a>, and through the <code>wait()</code>, method which
we will discuss in <a href="#_synchronization">Chapter 14</a>.</p>
</div>
<div class="sect3">
<h4 id="_nondeterminism">13.6.1. Nondeterminism</h4>
<div class="paragraph">
<p>In Java, the mapping of a thread inside the JVM to a thread in the OS
varies. Some implementations give each Java thread an OS thread, some
put all Java threads on a single OS thread (with the side effect of
preventing concurrency), and some allow for the possibility of changing
which OS thread a Java thread uses. Thus, the performance and, in some
cases, the correctness of your program might vary, depending on which
system you are running. This is, yet again, one of those times when Java
is platform independent&#8230;&#8203; but not entirely.</p>
</div>
<div class="paragraph">
<p>Unfortunately, the situation is even more complicated. Making threads
part of your program means that the same program could run differently
on the <strong>same</strong> system. The JVM and the OS have to cooperate to schedule
threads, and both programs are complex mountains of code which try to
balance many factors. If you create three threads, there is no guarantee
that the first will run first, the second second, and the third third,
not even if it happens that way the first 10 times you run the program.
<a href="#exercise13.18">Exercise 13.18</a> shows that the pattern of thread
execution can vary a lot.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.18">Exercise 13.18</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>In all the programs before this chapter, the same sequence of input
would always produce the same sequence of output. Perhaps the biggest
hurdle created by this nondeterminism is that programmers must shift
their paradigm considerably. The processor can switch between executions
of threads at any time, even in the middle of operations. Every possible
interleaving of thread execution can crop up at some point. Unless you
can be sure that your program behaves properly for all of them, you may
never be able to debug your code completely. What is so insidious about
some nondeterministic bugs is that they can occur rarely and be almost
impossible to reproduce. In this chapter, we introduce how to create and
run threads, but making these threads interact properly is a major
problem we tackle in subsequent chapters.</p>
</div>
<div class="paragraph">
<p>After those dire words of warning, we&#8217;d like to remind you that
nondeterminism is not in itself a bad thing. Many threaded applications
with a lot of input and output, such as server applications, necessarily
exist in a nondeterministic world. For these programs, many different
sequences of thread execution may be perfectly valid. Each individual
program may have a different definition of correctness. For example, if
a stock market server receives two requests to buy the last share of a
particular stock at almost the same time from two threads corresponding
to two different clients, it might be correct for either one of them to
get that last share. However, it would never be correct for <strong>both</strong> of
them to get it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_polling">13.6.2. Polling</h4>
<div class="paragraph">
<p>So far the only mechanism we have introduced for coordinating different
threads is using the <code>join()</code> method to wait for a thread to end.
Another technique is <em>polling</em>, or <em>busy waiting</em>. The idea is to keep
checking the state of one thread until it changes.</p>
</div>
<div class="paragraph">
<p>There are a number of problems with this approach. The first is that it
wastes CPU cycles. Those cycles spent by the waiting thread continually
checking could have been used productively by some other thread in the
system. The second problem is that we have to be certain that the state
of the thread we are waiting for won&#8217;t change back to the original state
or to some other state. Because of the unpredictability of scheduling,
there is no guarantee that the waiting thread will read the state of the
other thread when it has the correct value.</p>
</div>
<div class="paragraph">
<p>We bring up polling partly because it has a historical importance to
parallel programming, partly because it can be useful in solving some
problems in this chapter, and partly because we want you to understand
the reasons why we need better techniques for thread communication.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.11">Exercise 13.11</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_thread_states">13.7. Syntax: Thread states</h3>
<div class="paragraph">
<p>A widely used Java tool for manipulating scheduling is the
<code>Thread.sleep()</code> method. This method can be called any time you want a
thread to do nothing for a set period of time. Until the sleep timer
expires, the thread will not be scheduled for any CPU time, unless it is
interrupted. To make a thread of execution sleep, call <code>Thread.sleep()</code>
in that thread of execution with a number of milliseconds as a
parameter. For example, calling <code>Thread.sleep(2000)</code> will make the
calling thread sleep for two full seconds.</p>
</div>
<div class="paragraph">
<p>Another useful tool is the <code>Thread.yield()</code> method. It gives up use of
the CPU so that the next waiting thread can run. To use it, a thread
calls <code>Thread.yield()</code>. This method is very useful in practice, but
according to official documentation, the JVM does not <strong>have</strong> to do to
anything when a <code>Thread.yield()</code> call happens. The Java specification
does not demand a particular implementation. A JVM could ignore a
<code>Thread.yield()</code> call completely, but most JVMs will move on to the next
thread in the schedule.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise13.3">Exercise 13.3</a><br>
<a href="#exercise13.13">Exercise 13.13</a></p>
</div>
</div>
</div>
<div id="figure-thread_states" class="imageblock text-center">
<div class="content">
<img src="chapters/13-concurrency/images/thread-states.svg" alt="thread states" width="80%">
</div>
<div class="title">Figure 51. Thread states and transitions.</div>
</div>
<div class="paragraph">
<p><a href="#figure-thread_states">Figure 51</a> shows the lifecycle of a thread. A
thread begins its life in the New Thread state, after the constructor is
called. When the <code>start()</code> method is called, the thread begins to run
and transitions to the Runnable state. Being Runnable doesn&#8217;t
necessarily mean that the thread is executing at any given moment but
that it is ready to run at any time. When in the Runnable state, a
thread may call <code>Thread.yield()</code>, relinquishing use of the processor,
but it will still remain Runnable.</p>
</div>
<div class="paragraph">
<p>However, if a thread goes to sleep with a <code>Thread.sleep()</code> call, waits
for a condition to be true using a <code>wait()</code> call, or performs a blocking
I/O operation, the thread will transition to the Not Runnable state. Not
Runnable threads cannot be scheduled for processor time until they wake
up, finish waiting, or complete their I/O. The final state is
Terminated. A thread becomes Terminated when its <code>run()</code> method
finishes. A Terminated thread cannot become Runnable again and is no
longer a separate thread of execution.</p>
</div>
<div class="paragraph">
<p>Any object with a type that is a subclass of <code>Thread</code> can tell you its
current state using the <code>getState()</code> method. This method returns an
<em>enum</em> type, whose value must come from a fixed list of constant
objects. These objects are <code>Thread.State.NEW</code>, <code>Thread.State.RUNNABLE</code>,
<code>Thread.State.BLOCKED</code>, <code>Thread.State.WAITING</code>,
<code>Thread.State.TIMED_WAITING</code>, and <code>Thread.State.TERMINATED</code>. Although
the others are self explanatory, we lump the <code>Thread.State.BLOCKED</code>,
<code>Thread.State.WAITING</code>, and <code>Thread.State.TIMED_WAITING</code> values into
the Not Runnable state, since the distinction between the three is not
important for us.</p>
</div>
<div class="paragraph">
<p>Threads also have priorities in Java. When an object that is a subclass
of <code>Thread</code> is created in Java, its priority is initially the same as
the thread that creates it. Usually, this priority is
<code>Thread.NORM_PRIORITY</code>, but there are some special cases when it is a
good idea to raise or lower this priority. Avoid changing thread
priorities because it increases platform dependence and because the
effects are not always predictable. Be aware that priorities exist, but
don&#8217;t use them unless and until you have a good reason.</p>
</div>
<div class="exampleblock">
<div class="title">Example 105. Military marching</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s apply the ideas discussed above to a lighthearted example. You
might be familiar with sound of soldiers marching: &#8220;Left, Left, Left,
Right, Left!&#8221; We can design a thread that prints <code>Left</code> and another
thread that prints <code>Right</code>. We can combine the two to print the correct
sequence for marching and loop the whole thing 10 times so that we can
see how accurately place the words. We want to use the scheduling tools
discussed above to get the timing right. Let&#8217;s try <code>Thread.sleep()</code>
first.</p>
</div>
<div id="LeftThreadProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LeftThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Left &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Left &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Left &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno"> 8 </span>			<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>				<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">10 </span>			<span class="tok-o">}</span>
<span class="lineno">11 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Left&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-o">}</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Class <code>LeftThread</code> has a <code>for</code> loop which prints out <code>Left</code> three times,
waits for 10 milliseconds, prints out <code>Left</code> again, then repeats.</p>
</div>
<div id="RightThreadProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RightThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno"> 4 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>		<span class="tok-o">}</span>
<span class="lineno"> 7 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Right &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">10 </span>			<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>				<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">12 </span>			<span class="tok-o">}</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Class <code>RightThread</code> waits for 5 milliseconds to get synchronized, then
has a <code>for</code> loop which prints out <code>Right</code>, waits for 10 milliseconds,
and repeats. The driver program below creates a thread for each of these
classes and then starts them. If you run this program, you should see 10
lines of <code>Left Left Left Right Left</code>, but there are a few problems.</p>
</div>
<div id="MilitaryMarchingProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MilitaryMarching</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-n">LeftThread</span> <span class="tok-n">left</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">LeftThread</span><span class="tok-o">();</span>
<span class="lineno"> 4 </span>		<span class="tok-n">RightThread</span> <span class="tok-n">right</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RightThread</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>		<span class="tok-n">left</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>		<span class="tok-n">right</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>			<span class="tok-n">left</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>			<span class="tok-n">right</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-o">}</span>
<span class="lineno">11 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first problem is that we have to wait some amount of time between
calls. We could shorten the <code>Thread.sleep()</code> calls, but there are limits
on the resolution of the timer. The bigger problem is that the two
threads can sometimes get out of sync. If you run the program many
times, you may see a <code>Right</code> out of place once in a while. If you
increase the repetitions of the <code>for</code> loops to a larger number, the
errors are more likely. Whether or not you see errors is somewhat system
dependent. We can try <code>Thread.yield()</code> instead of <code>Thread.sleep()</code>.</p>
</div>
<div id="LeftYieldThreadProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LeftYieldThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Left &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Left &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Left &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>			<span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">yield</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Left&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-o">}</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="RightYieldThreadProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RightYieldThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Right &quot;</span><span class="tok-o">);</span>
<span class="lineno">5 </span>			<span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">yield</span><span class="tok-o">();</span>
<span class="lineno">6 </span>		<span class="tok-o">}</span>
<span class="lineno">7 </span>	<span class="tok-o">}</span>
<span class="lineno">8 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These new versions of the two classes have essentially replaced calls to
<code>Thread.sleep()</code> with calls to <code>Thread.yield()</code>. Without the need for
exception handling, the code is simpler, but we have traded one set of
problems for another. If there are other threads operating in the same
application, they will be scheduled in ways that will interfere with the
pattern of yielding. Also, if you are running this code on a machine
with a single processor and a single core, you have a good chance of
seeing something which matches the expected output. If you are running
this on multiple cores, everything will be jumbled. It is likely that
the <code>LeftYieldThread</code> will be running on one processor with the
<code>RightYieldThread</code> on another. In that case, neither has any competition
to yield to.</p>
</div>
<div class="paragraph">
<p>Finally, let us look at a polling solution which still falls short of
the mark. To do this, we need state variables inside of each class to
keep track of whether or not it is done. Each thread needs a reference
to the other thread to make queries, and the driver program must be
updated to add these in before starting the threads.</p>
</div>
<div id="LeftPollingThreadProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LeftPollingThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-n">RightThread</span> <span class="tok-n">right</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setRight</span><span class="tok-o">(</span> <span class="tok-n">RightPollingThread</span> <span class="tok-n">right</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">=</span> <span class="tok-n">right</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Left &quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Left &quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Left &quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>			<span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">15 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">right</span><span class="tok-o">.</span><span class="tok-na">isDone</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">16 </span>			<span class="tok-n">right</span><span class="tok-o">.</span><span class="tok-na">setDone</span><span class="tok-o">(</span> <span class="tok-kc">false</span> <span class="tok-o">);</span>
<span class="lineno">17 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Left&quot;</span><span class="tok-o">);</span>
<span class="lineno">18 </span>		<span class="tok-o">}</span>
<span class="lineno">19 </span>	<span class="tok-o">}</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isDone</span><span class="tok-o">()</span>	<span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">done</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">22 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setDone</span><span class="tok-o">(</span> <span class="tok-kt">boolean</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">23 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="RightPollingThreadProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RightPollingThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-n">LeftThread</span> <span class="tok-n">left</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setLeft</span><span class="tok-o">(</span> <span class="tok-n">LeftPollingThread</span> <span class="tok-n">left</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">=</span> <span class="tok-n">left</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">left</span><span class="tok-o">.</span><span class="tok-na">isDone</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-n">left</span><span class="tok-o">.</span><span class="tok-na">setDone</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Right &quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>			<span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">15 </span>		<span class="tok-o">}</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isDone</span><span class="tok-o">()</span>	<span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">done</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">19 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setDone</span><span class="tok-o">(</span> <span class="tok-kt">boolean</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">20 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whether single core or multicore, this solution will always give the
right output. Or it should. Java experts will point out that we are
violating a technicality of the Java Memory Model. Because we are not
using synchronization tools, we have no guarantee that the change of the
<code>done</code> variable will even be <strong>visible</strong> from one thread to another. In
practice, this problem should affect you rarely, but to be safe, both of
the <code>done</code> variables should be declared with the keyword <code>volatile</code>.
This keyword makes Java aware that the value may be accessed at any time
from arbitrary threads.</p>
</div>
<div class="paragraph">
<p>Another issue is that there is <strong>no</strong> concurrency. Each thread must wait
for the other to complete. Of course, this problem does not benefit from
a concurrent solution, but applying this solution to problems which can
benefit from concurrency might cause performance problems. Each thread
wastes time busy waiting in a <code>while</code> loop for the other to be done,
consuming CPU cycles while it does so. You will notice that the code
must still be carefully written. Each thread must set the other thread&#8217;s
<code>done</code> value to <code>false</code>. If threads were responsible for setting their
own <code>done</code> values to <code>false</code>, one thread might print its information and
go back to the top of the <code>for</code> loop before the other thread had reset
its own <code>done</code> to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>In short, coordinating two or more threads together is a difficult
problem. None of the solutions we give here are fully acceptable. We
introduce better tools for coordination and synchronization in
<a href="#_synchronization">Chapter 14</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_deadly_virus">13.8. Solution: Deadly virus</h3>
<div class="paragraph">
<p>Finally, we give the solution to the deadly virus problem. By this
point, the threaded part of this problem should not seem very difficult.
It is simpler than some of the examples, such as matrix multiplication.
We begin with the worker class <code>FactorThread</code> that can be spawned as a
thread.</p>
</div>
<div id="FactorThreadProgram" class="listingblock">
<div class="title">Program 49. Thread class used to find the sum of the two factors of a large odd composite.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FactorThread</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">long</span> <span class="tok-n">lower</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">long</span> <span class="tok-n">upper</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">FactorThread</span><span class="tok-o">(</span> <span class="tok-kt">long</span> <span class="tok-n">lower</span><span class="tok-o">,</span> <span class="tok-kt">long</span> <span class="tok-n">upper</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">lower</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">upper</span> <span class="tok-o">=</span> <span class="tok-n">upper</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">lower</span> <span class="tok-o">%</span> <span class="tok-mi">2</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-c1">//only check odd numbers</span>
<span class="lineno">12 </span>			<span class="tok-n">lower</span><span class="tok-o">++;</span>
<span class="lineno">13 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">lower</span> <span class="tok-o">&lt;</span> <span class="tok-n">upper</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">Factor</span><span class="tok-o">.</span><span class="tok-na">NUMBER</span> <span class="tok-o">%</span> <span class="tok-n">lower</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Security code: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">16 </span>					<span class="tok-o">(</span><span class="tok-n">lower</span> <span class="tok-o">+</span> <span class="tok-n">Factor</span><span class="tok-o">.</span><span class="tok-na">NUMBER</span> <span class="tok-o">/</span> <span class="tok-n">lower</span><span class="tok-o">));</span>
<span class="lineno">17 </span>				<span class="tok-k">return</span><span class="tok-o">;</span>
<span class="lineno">18 </span>			<span class="tok-o">}</span>
<span class="lineno">19 </span>			<span class="tok-n">lower</span> <span class="tok-o">+=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="lineno">20 </span>		<span class="tok-o">}</span>
<span class="lineno">21 </span>	<span class="tok-o">}</span>
<span class="lineno">22 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor for <code>FactorThread</code> takes an upper and lower bound,
similar to <code>MatrixThread</code>. Once a <code>FactorThread</code> object has those
bounds, it can search between them. The number to factor is stored in
the <code>Factor</code> class. If any value divides that number evenly, it must be
one of the factors, making the other factor easy to find, sum, and print
out. We have to add a couple of extra lines of code to make sure that we
only search the odd numbers in the range. This solution is tuned for
efficiency for this specific security problem. A program to find general
prime factors would have to be more flexible. Next let us examine the
driver program <code>Factor</code>.</p>
</div>
<div id="FactorProgram" class="listingblock">
<div class="title">Program 50. Driver class which creates threads to lower the average search time for the factors of a large odd composite.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Factor</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">THREADS</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">long</span> <span class="tok-n">NUMBER</span> <span class="tok-o">=</span> <span class="tok-mi">59984005171248659L</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-n">FactorThread</span><span class="tok-o">[]</span> <span class="tok-n">threads</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FactorThread</span><span class="tok-o">[</span><span class="tok-n">THREADS</span><span class="tok-o">];</span>
<span class="lineno"> 7 </span>		<span class="tok-kt">long</span> <span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">long</span><span class="tok-o">)</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-n">NUMBER</span><span class="tok-o">);</span> <span class="tok-c1">// go to square root</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">long</span> <span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span>  <span class="tok-c1">// no need to test 2</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">long</span> <span class="tok-n">quotient</span> <span class="tok-o">=</span> <span class="tok-n">root</span> <span class="tok-o">/</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-kt">long</span> <span class="tok-n">remainder</span> <span class="tok-o">=</span> <span class="tok-n">root</span> <span class="tok-o">%</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>			<span class="tok-kt">long</span> <span class="tok-n">work</span> <span class="tok-o">=</span> <span class="tok-n">quotient</span><span class="tok-o">;</span>
<span class="lineno">14 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">remainder</span> <span class="tok-o">)</span>
<span class="lineno">15 </span>				<span class="tok-n">work</span><span class="tok-o">++;</span>
<span class="lineno">16 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FactorThread</span><span class="tok-o">(</span> <span class="tok-n">start</span><span class="tok-o">,</span> <span class="tok-n">start</span> <span class="tok-o">+</span> <span class="tok-n">work</span> <span class="tok-o">);</span>
<span class="lineno">17 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">18 </span>			<span class="tok-n">start</span> <span class="tok-o">+=</span> <span class="tok-n">work</span><span class="tok-o">;</span>
<span class="lineno">19 </span>		<span class="tok-o">}</span>
<span class="lineno">20 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">21 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">22 </span>				<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">23 </span>		<span class="tok-o">}</span>
<span class="lineno">24 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">25 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">26 </span>		<span class="tok-o">}</span>
<span class="lineno">27 </span>	<span class="tok-o">}</span>
<span class="lineno">28 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Static constants hold both the number to be factored and the number of
threads. In the <code>main()</code> method, we create an array of threads for
storage. Then, we create each <code>FactorThread</code> object, assigning upper and
lower bounds at the same time, using the standard technique from
<a href="#_concurrency_arrays">Section 6.11</a> to divide the work fairly. Because we
know the number we&#8217;re dividing isn&#8217;t even, we start with 3. By only
going up to the square root of the number, we know that we will only
find the smaller of the two factors. In that way we can avoid having one
thread find the smaller while another is finds the larger.</p>
</div>
<div class="paragraph">
<p>Afterwards, we have the usual <code>join()</code> calls to make sure that all the
threads are done. In this problem, these calls are unnecessary. One
thread will print out the correct security code, and the others will
search fruitlessly. If the program went on to do other work, we might
need to let the other threads finish or even interrupt them. Don&#8217;t
forget <code>join()</code> calls since they are usually very important.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_5">13.9. Summary</h3>
<div class="paragraph">
<p>In this chapter we have examined tasks and domains. We have explained
two strategies to obtain a concurrent solution to a programming problem.
One strategy, task decomposition, splits a task into two or more
subtasks. These subtasks can then be packaged as Java threads and
executed on different cores of a multicore processor. Another strategy,
domain decomposition, partitions input data into smaller chunks and
allows different threads to work concurrently on each chunk of data.</p>
</div>
<div class="paragraph">
<p>A concurrent solution to a programming problem can execute more quickly
than a sequential solution. Speedup measure how effective a concurrent
solution is at exploiting the architecture of a multicore processor.
Note that not all concurrent programs lead to speedup as some run slower
than their sequential counterparts. Writing a concurrent program is a
challenge that forces us to discover solutions that best exploit a given
processor and OS.</p>
</div>
<div class="paragraph">
<p>Java provides a rich set of primitives and syntactic elements to write
concurrent programs. Only a few of these have been introduced in this
chapter. Subsequent chapters give additional tools to code more complex
concurrent programs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_13">13.10. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise13.1"></a> The <code>start()</code>, <code>run()</code>, and <code>join()</code>
methods are essential parts of the process of using threads in Java.
Explain the purpose of each method.</p>
</li>
<li>
<p><a id="exercise13.2"></a> What is the difference between
extending the <code>Thread</code> class and implementing the <code>Runnable</code> interface?
When should you use one over the other?</p>
</li>
<li>
<p><a id="exercise13.3"></a> How do the <code>Thread.sleep()</code> method and
the <code>Thread.yield()</code> method each affect thread scheduling?</p>
</li>
<li>
<p><a id="exercise13.4"></a> Consider the expression in
<a href="#mathExpressionTasksExample">Example 95</a>. Suppose that the multiply and
exponentiation operations require 1 and 10 time units, respectively.
Compute the number of time units required to evaluate the expression as
in <a href="#figure-math_evaluation">Figure 46</a>(a) and (b).</p>
</li>
<li>
<p><a id="exercise13.5"></a> Suppose that a computer has one
quadcore processor. Can the tasks in <a href="#videoGameTasksExample">Example 94</a> and <a href="#mathExpressionTasksExample">Example 95</a> be further subdivided to
improve performance on four cores? Why or why not?</p>
</li>
<li>
<p><a id="exercise13.6"></a> Consider the definition of speedup from
<a href="#_examples_concurrency_and_speedup">Section 13.5</a>. Let&#8217;s assume you have a
job 1,000,000 units in size. A thread can process 10,000 units of work
every second. It takes an additional 100 units of work to create a new
thread. What is the speedup if you have a dual-core processor and create
2 threads? What if you have a quadcore processor and create 4 threads?
Or an 8-core processor and create 8 threads? You may assume that a
thread does not need to communicate after it has been created.</p>
</li>
<li>
<p><a id="exercise13.7"></a> In which situations can speedup be
smaller than the number of processors? Is it ever possible for speedup
to be greater than the number of processors?</p>
</li>
<li>
<p><a id="exercise13.8"></a> Amdahl&#8217;s Law is a mathematical description of
the maximum amount you can improve a system by only improving a part of
it. One form of it states that the maximum speedup attainable in a
parallel program is \(\frac{1}{1 - P}\) where \(P\)
is the fraction of the program which can be parallelized to an arbitrary
degree. If 30% of the work in a program can be fully parallelized but
the rest is completely serial, what is the speedup with 2 processors? 4?
8? What implications does Amdahl&#8217;s Law have?</p>
</li>
<li>
<p><a id="exercise13.9"></a> Consider the following table of
tasks:</p>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Task</th>
<th class="tableblock halign-center valign-middle">Time</th>
<th class="tableblock halign-center valign-middle">Concurrency</th>
<th class="tableblock halign-left valign-middle">Dependency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Washing Dishes</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Cooking Dinner</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">45</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Washing Dishes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Cleaning Bedroom</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Cleaning Bathroom</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Doing Homework</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Cleaning Bedroom</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this table, the <strong>Time</strong> column gives the number of minutes a task
takes to perform with a single person, the <strong>Concurrency</strong> column gives
the maximum number of people who can be assigned to a task, and the
<strong>Dependency</strong> column shows which tasks cannot start until other tasks
have been finished. Assume that people assigned to a given task can
perfectly divide the work. In other words, the time a task takes is the
single person time divided by the number of people assigned. What is the
minimum amount of time needed to perform all tasks with only a single
person? What is the minimum amount of time needed to perform all tasks
with an unlimited number of people? What is the smallest number of
people needed to achieve this minimum time?</p>
</div>
</li>
<li>
<p><a id="exercise13.10"></a> Consider the following code snippet.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">13</span><span class="tok-o">;</span>
<span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">x</span> <span class="tok-o">*</span> <span class="tok-mi">10</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Consider this snippet as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">7</span><span class="tok-o">;</span>
<span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">x</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we assume that these two snippets of code are running on separate
threads but that <code>x</code> is a shared variable, what are the possible values
<code>x</code> could have after both snippets have run? Remember that the execution
of these snippets can be interleaved in any way.</p>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise13.11"></a> Re-implement the array summing problem from
<a href="#arraySummationExample">Example 103</a> using polling instead of <code>join()</code>
calls. Your program should not use a single call to <code>join()</code>. Polling is
not an ideal way to solve this problem, but it is worth experimenting
with the technique.</p>
</li>
<li>
<p><a id="exercise13.12"></a> Composers often work with multiple tracks
of music. One track might contain solo vocals, another drums, a third
one violins, and so on. After recording the entire take, a mix engineer
might want to apply special effects such as an echo to one or more
tracks.</p>
<div class="paragraph">
<p>To understand how to add echo to a track, suppose that the track
consists of a list of audio samples. Each sample in a mono (not stereo)
track can be stored as a <code>double</code> in an array. To create an echo effect,
we combine the current value of an audio sample with a sample from a
fixed time earlier. This time is called the <em>delay</em> parameter. Varying
the delay can produce long and short echoes.</p>
</div>
<div class="paragraph">
<p>If the samples are stored in array <code>in</code> and the delay parameter is
stored in variable <code>delay</code>, the following code snippet can be used to
create array <code>out</code> which contains the sound with an echo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span><span class="tok-o">[]</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">+</span> <span class="tok-n">delay</span><span class="tok-o">];</span>
<span class="tok-c1">//sound before echo starts</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">delay</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">out</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="tok-c1">//sound with echo</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">delay</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">out</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">*</span><span class="tok-n">in</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">+</span> <span class="tok-n">b</span><span class="tok-o">*</span><span class="tok-n">in</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-n">delay</span><span class="tok-o">];</span>
<span class="tok-c1">//echo after sound is over</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">out</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">b</span><span class="tok-o">*</span><span class="tok-n">in</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">-</span> <span class="tok-n">delay</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameters <code>a</code> and <code>b</code> are used to control the nature of the echo. When
<code>a</code> is <code>1</code> and <code>b</code> is <code>0</code>, there is no echo. When <code>a</code> is <code>0</code> and <code>b</code> is
<code>1</code>, there is no mixing. Audio engineers will control the values of <code>a</code>
and <code>b</code> to create the desired echo effect.</p>
</div>
<div class="paragraph">
<p>Write a threaded program that computes the values in <code>out</code> in parallel
for an arbitrary number of threads.</p>
</div>
</li>
<li>
<p><a id="exercise13.13"></a> Write a program which takes a number of
minutes and seconds as input. In this program, implement a timer using
<code>Thread.sleep()</code> calls. Each second, print the remaining time to the
screen. How accurate is your timer?</p>
</li>
<li>
<p><a id="exercise13.14"></a> As you know,
\(\pi\approx
3.1416\). A more precise value can be found by writing a program which
approximates the area of a circle. The area of a circle can be
approximated by summing up the area of rectangles filling curve of the
arc of the circle. As the width of the rectangle goes to zero, the
approximation becomes closer and closer to the true area. Recall that
that height \(y\) of a circle centered at the origin at any
distance \(x\) is given by \(y = \sqrt{r^2 - x^2}\)
where \(r\) is the radius of the circle.</p>
<div class="paragraph">
<p>Write a parallel implementation of this problem which divides up
portions of the arc of the circle among several threads and then sums
the results after they all finish. By setting \(r = 2\), you
need only sum one quadrant of a circle to get \(\pi\). You
will need to use a very small rectangle width to get an accurate answer.
When your program finishes running, you can compare your value against
<code>Math.PI</code> for accuracy.</p>
</div>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise13.15"></a> Use the <code>currentTimeMillis()</code> method
to measure the time taken to execute a relatively long-running piece of
Java code you have written. Execute your program several times and
compare the execution time you obtain during different executions. Why
do you think the execution times are different?</p>
</li>
<li>
<p><a id="exercise13.16"></a> Thread creation overhead is an
important consideration in writing efficient parallel programs. Write a
program which creates a large number of threads which do nothing. Test
how long it takes to create and join various numbers of threads. See if
you can determine how long a single thread creation operation takes on
your system, on average.</p>
</li>
<li>
<p><a id="exercise13.17"></a> Create serial and concurrent
implementations of matrix multiplication like those described in
<a href="#matrixMultiplicationExample">Example 104</a>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Experiment with different matrix sizes and thread counts to see how
the speedup performance changes. If possible, run your tests on machines
with different numbers of cores or processors.</p>
</li>
<li>
<p>Given a machine with \(k&gt;1\) cores, what is the maximum
speedup you can expect to obtain?</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise13.18"></a> Repeatedly run the code in
<a href="#arrayOfThreadsExample">Example 100</a> which creates several
<code>NumberedThread</code> objects. Can you discover any patterns in the order
that the threads print? Add a loop and some additional instrumentation
to the <code>NumberedThread</code> class which will allow you to measure how long
each thread runs before the next thread has a turn.</p>
</li>
<li>
<p><a id="exercise13.19"></a> Create serial and parallel implementations of
the array summing problem solved in <a href="#arraySummationExample">Example 103</a>.
Experiment with different array sizes and thread counts to see how
performance changes. How does the speedup differ from matrix multiply?
What happens if you simply sum the numbers instead of taking the sine
first?</p>
</li>
<li>
<p><a id="exercise13.20"></a> The solution to the array summing problem in
<a href="#arraySummationExample">Example 103</a> seems to use concurrency
half-heartedly. After all the threads have computed their sums, the main
thread sums up the partial sums sequentially.</p>
<div class="paragraph">
<p>An alternative approach is to sum up the partial sums concurrently. Once
a thread has computed the sum of the sines of each partition, the sums
of each pair of neighboring partitions should be merged into a single
sum. The process can be repeated until the final sum has been computed.
At each step, half of the remaining threads will have nothing left to do
and will stop. The pattern of summing is like a tree which starts with
\(k\) threads working at the first stage,
\(\frac{k}{2}\) working at the second stage,
\(\frac{k}{4}\) working at the third, and so on, until a
single thread completes the summing process.</p>
</div>
<div id="figure-tree_summation" class="imageblock">
<div class="content">
<img src="chapters/13-concurrency/images/treesummation.svg" alt="treesummation" width="100%">
</div>
<div class="title">Figure 52. Example of concurrent tree-style summation with 8 threads.</div>
</div>
<div class="paragraph">
<p>Update the <code>run()</code> method in the <code>SumThread</code> class so that it adds its
assigned elements as before and then adds its neighbors sum to its own.
To do so, it must use the <code>join()</code> method to wait for the neighboring
thread. It should perform this process repeatedly. After summing their
own values, each even numbered thread should add in the partial sum from
its neighbor. At the next step, each thread with a number divisible by 4
should add the partial sum from its neighbor. At the next step, each
thread with a number divisible by 8 should add the partial sum from its
neighbor, and so on. Thread 0 will perform the final summation.
Consequently, the main thread only needs to wait for thread 0. So that
each thread can wait for other threads, the <code>threads</code> array will need to
be a static field. <a href="#figure-tree_summation">Figure 52</a> illustrates this
process.</p>
</div>
<div class="paragraph">
<p>Once you have implemented this design, test it against the original
<code>SumThread</code> class to see how it performs. Restrict the number of threads
you create to a power of 2 to make it easier to determine which threads
wait and which threads terminate.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_synchronization">14. Synchronization</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Sharing is sometimes more demanding than giving.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Mary Catherine Bateson
</div>
</div>
<div class="sect2">
<h3 id="_introduction_3">14.1. Introduction</h3>
<div class="paragraph">
<p>Concurrent programs allow multiple threads to be scheduled and executed,
but the programmer does not have a great deal of control over when
threads execute. As explained in <a href="#_concepts_thread_scheduling">Section 13.6</a>,
the JVM and the underlying OS are responsible for scheduling threads
onto processor cores.</p>
</div>
<div class="paragraph">
<p>While writing a concurrent program, you have to ensure that the program
will work correctly even though different executions of the same program
will likely lead to different sequences of thread execution. The problem
we introduce next illustrates why one thread execution sequence might be
perfectly fine while another might lead to unexpected and incorrect
behavior (and even people starving!)</p>
</div>
</div>
<div class="sect2">
<h3 id="_problem_dining_philosophers">14.2. Problem: Dining philosophers</h3>
<div class="paragraph">
<p>Concurrency gives us the potential to make our programs faster but
introduces a number of other problems. The way that threads interact can
be unpredictable. Because they share memory, one thread can corrupt the
value in another thread&#8217;s variables. We introduce synchronization tools
in this chapter that can prevent threads from corrupting data, but these
tools create new pitfalls. To explore these pitfalls, we give you
another problem to solve.</p>
</div>
<div class="paragraph">
<p>Imagine a number of philosophers sitting at a round table with plates
that are periodically filled with rice. Between adjacent philosophers
are single chopsticks so that there are exactly the same number of
chopsticks as there are philosophers. These philosophers only think and
eat. In order to eat, a philosopher must pick up both the chopstick on
her left and the chopstick on her right. <a href="#figure-dining">Figure 53</a> shows
an example of the situation.</p>
</div>
<div id="figure-dining" class="imageblock text-center">
<div class="content">
<img src="chapters/14-synchronization/images/diners.svg" alt="diners" width="50%">
</div>
<div class="title">Figure 53. Table for five dining philosophers.</div>
</div>
<div class="paragraph">
<p>Your goal is to write a class called <code>DiningPhilosopher</code> which extends
<code>Thread</code>. Each thread created in the <code>main()</code> method should be a
philosopher who thinks for some random amount of time, then acquires the
two necessary chopsticks and eats. No philosopher should starve. No
philosophers should be stuck indefinitely fighting over chopsticks.</p>
</div>
<div class="paragraph">
<p>Although this problem sounds simple, the solution is somewhat complex.
Make sure that you understand the concepts and Java syntax in this
chapter thoroughly before trying to implement your solution. It is
important that no two philosophers try to use the same chopstick at the
same time. Likewise, we need to avoid a situation where every
philosopher is waiting for every other philosopher to give up a
chopstick.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_thread_interaction">14.3. Concepts: Thread interaction</h3>
<div class="paragraph">
<p>This dining philosopher problem highlights some difficulties which were
emerging toward the end of the last chapter. In
<a href="#exercise13.10">Exercise 13.10</a> two snippets of code could run
concurrently and modify the same shared variable, potentially producing
incorrect output. Because of the nondeterministic nature of scheduling,
we have to assume that the code executing in two or more threads can be
interleaved in any possible way. When the <strong>result</strong> of computation
changes depending on the order of thread execution, it is called a <em>race
condition</em>. Below is a simple example of a race condition in Java.</p>
</div>
<div id="RaceConditionProgram" class="listingblock">
<div class="title">Program 51. Short example of a race condition.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RaceCondition</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">THREADS</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">COUNT</span> <span class="tok-o">=</span> <span class="tok-mi">1000000</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-n">RaceCondition</span><span class="tok-o">[]</span> <span class="tok-n">threads</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RaceCondition</span><span class="tok-o">[</span><span class="tok-n">THREADS</span><span class="tok-o">];</span>
<span class="lineno"> 8 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RaceCondition</span><span class="tok-o">();</span>
<span class="lineno">10 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">11 </span>		<span class="tok-o">}</span>
<span class="lineno">12 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">14 </span>				<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">15 </span>		<span class="tok-o">}</span>
<span class="lineno">16 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">18 </span>		<span class="tok-o">}</span>
<span class="lineno">19 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Counter:\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">counter</span> <span class="tok-o">);</span>
<span class="lineno">20 </span>	<span class="tok-o">}</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">COUNT</span> <span class="tok-o">/</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">24 </span>			<span class="tok-n">counter</span><span class="tok-o">++;</span>
<span class="lineno">25 </span>	<span class="tok-o">}</span>
<span class="lineno">26 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This short (and pointless) class attempts to increment the variable
<code>counter</code> until it reaches <code>1000000</code>. To illustrate the race condition,
we have divided the work of incrementing <code>counter</code> evenly among a number
of threads. If you run this program, the final value of <code>counter</code> will
often not be <code>1000000</code>. Depending on which JVM, OS, and how many cores
you have, you may never get <code>1000000</code>, and the answer you do get will
vary a lot. On all systems, if you change the value of <code>THREADS</code> to <code>1</code>,
the answer should always be correct.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.6">Exercise 14.6</a><br>
<a href="#exercise14.14">Exercise 14.14</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Looking at the code, the problem might not be obvious. Everything
centers on the statement <code>counter++</code> in the <code>for</code> loop inside the
<code>run()</code> method. But, this statement appears to execute in a single step!
Each thread should increase the value of <code>counter</code> a total of
<code>COUNT/THREADS</code> times, adding up to <code>1000000</code>. The trouble is that
<code>counter++</code> is not a single step. Recall that <code>counter++</code> is shorthand
for <code>counter = counter + 1</code>. To be even more explicit we could write it
as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">counter</span><span class="tok-o">;</span>
<span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-n">temp</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One thread may get as far as storing <code>counter</code> into a temporary
location, but then it runs out of time and the next thread in the
schedule runs. If that is the case, this next thread may do a series of
increments to <code>count</code> which are all overwritten when the first thread
runs again. Because the first thread had an old value of <code>counter</code>
stored in <code>temp</code>, adding 1 to <code>temp</code> has the effect of ignoring many
increments. This situation can happen on a single processor with threads
switching back and forth, but it is even more dangerous on a multicore
system.</p>
</div>
<div class="paragraph">
<p>The primary lesson here is that threads can switch between each other at
any time with unpredictable effects. The secondary lesson is that the
source code is too coarse-grained to show <em>atomic</em> operations. An atomic
operation is one which cannot be interrupted by a context switch to
another thread. The actual code that the JVM runs is much lower level
than source code.</p>
</div>
<div class="paragraph">
<p>We can&#8217;t easily force a non-atomic operation to be atomic, but there are
ways to restrict access to certain pieces of code under certain
conditions. The name we give to a piece of code which should not be
accessed by more than one thread at a time is a <em>critical section</em>. In
the example above, the single line of code which increments <code>counter</code> is
a critical section, and the error in the program would be removed if
only one thread were able to run that line of code at a time.</p>
</div>
<div class="paragraph">
<p>Protecting a critical section is done with <em>mutual exclusion</em> tools.
They are called mutual exclusion tools because they enforce the
requirement that one thread executing a critical section excludes the
possibility of another. There are many different techniques, algorithms,
and language features in computer science which can be used to create
mutual exclusion. Java relies heavily on a tool called a <em>monitor</em> which
hides some of the details of enforcing mutual exclusion from the user.
Mutual exclusion is a deeply researched topic with many approaches other
than monitors. If you plan to write concurrent programs in another
language, you may need to brush up on the features provided by that
language.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.5">Exercise 14.5</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_thread_synchronization">14.4. Syntax: Thread synchronization</h3>
<div class="sect3">
<h4 id="_the_code_synchronized_code_keyword">14.4.1. The <code>synchronized</code> keyword</h4>
<div class="paragraph">
<p>In Java, the language feature which allows you to enforce mutual
exclusion is the <code>synchronized</code> keyword. There are two ways to use this
keyword: with a method or with an arbitrary block of code. In the method
version, you add the <code>synchronized</code> modifier before the return type.
Let&#8217;s imagine a class with a private <code>String</code> field called <code>message</code>
which is set to be <code>"Will Robinson!"</code> by the constructor. Now, we define
the following method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">danger</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Danger, &quot;</span> <span class="tok-o">+</span> <span class="tok-n">message</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>danger()</code> is called five times from different threads, <code>message</code>
will contain<br>
<code>"Danger, Danger, Danger, Danger, Danger, Will Robinson!"</code> Without the
<code>synchronized</code> keyword, <code>danger()</code> would suffer from a race condition
similar to the one in <code>RaceCondition</code>. Some of the <code>String</code>
concatenations might be overwritten by other calls to <code>danger()</code>. You
would never have more than five copies of <code>"Danger, "</code> appended to the
beginning of <code>message</code>, but you might have fewer.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.1">Exercise 14.1</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Any time a thread enters a piece of code protected by the <code>synchronized</code>
keyword, it implicitly acquires a lock which only a single thread can
hold. If another thread tries to access the code, it is forced to wait
until the lock is released. This lock is <em>re-entrant</em>. Re-entrant means
that, when a thread currently holds a lock and tries to get it again, it
succeeds. This situation frequently occurs with synchronized methods
which call other synchronized methods.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.13">Exercise 14.13</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Consider method <code>safety()</code> which does the &#8220;opposite&#8221; of <code>danger()</code>, by
removing occurrences of <code>"Danger, "</code> from the beginning of <code>message</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">safety</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">startsWith</span><span class="tok-o">(</span><span class="tok-s">&quot;Danger, &quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
        <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span> <span class="tok-mi">8</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Will the <code>danger()</code> and <code>safety()</code> methods play nicely together? In
other words, will a thread be blocked from entering <code>safety()</code> if
another thread is already in <code>danger()</code>? Yes! The locks in Java are
connected to objects. When you use the <code>synchronized</code> keyword on a
method, the object the method is being called on (whichever object
<code>this</code> refers to inside the method) serves as the lock. Thus, only one
thread can be inside of either of these methods. If you have 10
synchronized methods in an object, only one of them can execute at a
time in a given object.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.2">Exercise 14.2</a><br>
<a href="#exercise14.7">Exercise 14.7</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Perhaps this level of control is too restrictive. You may have six
methods which conflict with each other and four others which conflict
with each other but not the first six. Using <code>synchronized</code> in each
method declaration would unnecessarily limit the amount of concurrency
your program could have.</p>
</div>
<div class="paragraph">
<p>Although it takes a little more work, using <code>synchronized</code> with a block
of code allows more fine-grained control. The following version of
<code>danger()</code> is equivalent to the earlier one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">danger</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-k">this</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Danger, &quot;</span> <span class="tok-o">+</span> <span class="tok-n">message</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>synchronized</code> on a block of code gives us more flexibility in two
ways. First, we can choose exactly how much code we want to control,
instead of the whole method. Second, we can choose which object we want
to use for synchronization. For the block style, any arbitrary object
can be used as a lock. Objects keep a list of threads which are waiting
to get the lock and do all the other management needed to make the
<code>synchronized</code> keyword work.</p>
</div>
<div class="paragraph">
<p>If you have two critical sections which are unrelated to each other, you
can use the fine-grained control the block style provides. First, you&#8217;ll
need some objects to use as locks, probably declared so that they can
easily be shared, perhaps as static fields of a class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Object</span> <span class="tok-n">lock1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Object</span><span class="tok-o">();</span>
<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Object</span> <span class="tok-n">lock2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Object</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, wherever you need control over concurrency, you use them as locks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-n">lock1</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-c1">//do dangerous thing 1</span>
<span class="tok-o">}</span>

<span class="tok-c1">//do safe things</span>

<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-n">lock2</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-c1">//do dangerous thing 2, unrelated to dangerous thing 1</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since declaring a method with <code>synchronized</code> is equivalent to having its
body enclosed in a block beginning with <code>synchronized(this)</code>, what about
<code>static</code> methods? Can they be <code>synchronized</code>? Yes, they can. Whenever a
class is loaded, Java creates an object of type <code>Class</code> which
corresponds to that class. This object is what synchronized static
methods inside the class will use as a lock. For example, a synchronized
static method inside of the <code>Eggplant</code> class will lock on the object
<code>Eggplant.class</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_code_wait_code_and_code_notify_code_methods">14.4.2. The <code>wait()</code> and <code>notify()</code> methods</h4>
<div class="paragraph">
<p>Protecting critical sections with the <code>synchronized</code> keyword is a
powerful technique, and many other synchronization tools can be built
using just this tool. However, efficiency demands a few more options.</p>
</div>
<div class="paragraph">
<p>Sometimes a thread is waiting for another thread to finish a task so
that it can process the results. Imagine one thread collecting votes
while another one is waiting to count them. In this example, the
counting thread must wait for all votes to be cast before it can begin
counting. We could use a synchronized block and an indicator <code>boolean</code>
called <code>votingComplete</code> to allow the collector thread to signal to the
counting thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-k">this</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">votingComplete</span> <span class="tok-o">)</span>
            <span class="tok-k">break</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
<span class="tok-n">countVotes</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s the problem with this design? Notice that the counting thread is
running through the <code>while</code> loop over and over waiting for
<code>votingComplete</code> to become <code>true</code>. On a single processor, the counting
thread would slow down the job of the collecting thread which is trying
to process all the votes. On a multicore system, the counting thread is
still wasting CPU cycles that some other thread could use. This
phenomenon is known as <em>busy waiting</em>, for obvious reasons.</p>
</div>
<div class="paragraph">
<p>To combat this problem, Java provides the <code>wait()</code> method. When a thread
is executing synchronized code, it can call <code>wait()</code>. Instead of busy
waiting, a thread which has called <code>wait()</code> will be removed from the
list of running threads. It will wait in a dormant state until someone
comes along and notifies the thread that its waiting is done. If you
recall the threadstate diagram from <a href="#_concurrent_programming">Chapter 13</a>, there is a Not Runnable state which threads enter by
calling <code>sleep()</code>, calling <code>wait()</code>, or performing blocking I/O. Using
<code>wait()</code>, we can rewrite the vote counting thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-k">this</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">votingComplete</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">wait</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
<span class="tok-n">countVotes</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the <code>while</code> loop has moved inside the synchronized block.
Doing so before might have kept our program from terminating: As long as
the vote counting thread held the lock, the vote collecting thread would
not be allowed to modify <code>votingComplete</code>. When a thread calls <code>wait()</code>,
however, it gives up the corresponding lock it is holding until it wakes
up and runs again. Why use the <code>while</code> loop at all, now? There is no
guarantee that the condition you are waiting for is <code>true</code>. Many threads
may be waiting on this particular lock. We use the <code>while</code> loop to check
that <code>votingComplete</code> is <code>true</code> and wait again if it isn&#8217;t.</p>
</div>
<div class="paragraph">
<p>In order to notify a waiting thread, the other thread calls the
<code>notify()</code> method. Like <code>wait()</code>, <code>notify()</code> must be called within a
synchronized block or method. Here is corresponding code the vote
collecting thread would use to notify the counting thread that voting is
complete.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// finish collecting votes</span>
<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-k">this</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">votingComplete</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
    <span class="tok-n">notifyAll</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A call to <code>notify()</code> will wake up one thread waiting on the lock object.
If there are many threads waiting, the method <code>notifyAll()</code> used above
can be called to wake them all up. In practice, it is usually safer to
call <code>notifyAll()</code>. If a particular condition changes and a single
waiting thread is notified, that thread may need to notify the next
waiting thread when it is done. If your code is not very carefully
designed, some thread may end up waiting forever and never be notified
if you only rely on <code>notify()</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.3">Exercise 14.3</a><br>
<a href="#exercise14.4">Exercise 14.4</a></p>
</div>
</div>
</div>
<div id="producerConsumerExample" class="exampleblock">
<div class="title">Example 106. Producer/consumer</div>
<div class="content">
<div class="paragraph">
<p>To illustrate the use of <code>wait()</code> and <code>notify()</code> calls inside of
synchronized code, we give a simple solution to the producer/consumer
problem below. This problem is a classic example in the concurrent
programming world. Many times one thread (or a group of threads) is
producing data, perhaps from some input operation. At the same time, one
thread (or, again, potentially many threads) are taking these chunks of
data and consuming them by performing some computational or output task.</p>
</div>
<div class="paragraph">
<p>Every resource inside of a computer is finite. Producer/consumer
problems often assume a bounded buffer which stores items from the
producer until the consumer can take them away. Our solution does all
synchronization on the buffer. Many different threads can share this
buffer, but all accesses will be controlled.</p>
</div>
<div id="BufferProgram" class="listingblock">
<div class="title">Program 52. Example of a synchronized buffer.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Buffer</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">SIZE</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-n">Object</span><span class="tok-o">[]</span> <span class="tok-n">objects</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Object</span><span class="tok-o">[</span><span class="tok-n">SIZE</span><span class="tok-o">];</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">addItem</span><span class="tok-o">(</span> <span class="tok-n">Object</span> <span class="tok-n">object</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">count</span> <span class="tok-o">==</span> <span class="tok-n">SIZE</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>			<span class="tok-n">wait</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-n">objects</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">object</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-n">count</span><span class="tok-o">++;</span>
<span class="lineno">12 </span>		<span class="tok-n">notifyAll</span><span class="tok-o">();</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>	<span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-n">Object</span> <span class="tok-nf">removeItem</span><span class="tok-o">()</span>
<span class="lineno">16 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">count</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">18 </span>			<span class="tok-n">wait</span><span class="tok-o">();</span>
<span class="lineno">19 </span>		<span class="tok-n">count</span><span class="tok-o">--;</span>
<span class="lineno">20 </span>		<span class="tok-n">Object</span> <span class="tok-n">object</span> <span class="tok-o">=</span> <span class="tok-n">objects</span><span class="tok-o">[</span><span class="tok-n">count</span><span class="tok-o">];</span>
<span class="lineno">21 </span>		<span class="tok-n">notifyAll</span><span class="tok-o">();</span>
<span class="lineno">22 </span>		<span class="tok-k">return</span> <span class="tok-n">object</span><span class="tok-o">;</span>
<span class="lineno">23 </span>	<span class="tok-o">}</span>
<span class="lineno">24 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When adding an item, producers enter the synchronized <code>addItem()</code>
method. If <code>count</code> shows that the buffer is full, the producer must wait
until the buffer has at least one open space. After adding an item to
the buffer, the producer then notifies all waiting threads. The consumer
does the mirror image in <code>removeItem()</code>. A consumer thread cannot
consume anything if the buffer is empty and must then wait. After there
is an object to consume, the consumer removes it and notifies all other
threads.</p>
</div>
<div class="paragraph">
<p>Both methods are synchronized, making access to the buffer completely
sequential. Although it seems undesirable, sequential behavior is
precisely what is needed for the producer/consumer problem. All
synchronized code is a protection against unsafe concurrency. The goal
is to minimize the amount of time spent in synchronized code and get
threads back to concurrent execution as quickly as possible.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.10">Exercise 14.10</a></p>
</div>
</div>
</div>
<div id="bankAccountExample" class="exampleblock">
<div class="title">Example 107. Bank account</div>
<div class="content">
<div class="paragraph">
<p>Although producer/consumer is a good model to keep in mind, there are
other ways that reading and writing threads might interact. Consider the
following programming problem, similar to one you might find in real
life.</p>
</div>
<div class="paragraph">
<p>As a rising star in a bank&#8217;s IT department, you have been given the job
of creating a new bank account class called <code>SynchronizedAccount</code>. This
class must have methods to support the following operations: deposit,
withdraw, and check balance. Each method should print a status message
to the screen on completion. Also, the method for withdraw should return
<code>false</code> and do nothing if there are insufficient funds. Because the
latest system is multi-threaded, these methods must be designed so that
the bookkeeping is consistent even if many threads are accessing a
single account. No money should magically appear or disappear.</p>
</div>
<div class="paragraph">
<p>There is an additional challenge. To maximize concurrency,
<code>SynchronizedAccount</code> should be synchronized differently for read and
write accesses. Any number of threads should simultaneously be able to
check the balance on an account, but only one thread can deposit or
withdraw at a time.</p>
</div>
<div class="paragraph">
<p>To solve this problem, our implementation of the class has a <code>balance</code>
variable to record the balance, but it also has a <code>readers</code> variable to
keep track of the number of threads which are reading from the account
at any given time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SynchronizedAccount</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">balance</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">readers</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, the <code>getBalance()</code> method is called by threads which wish to read
the balance. Access to the <code>readers</code> variable is synchronized. But,
after passing that first <code>synchronized</code> block, the code which stores the
balance is not synchronized. In this way, multiple readers can access
the data at the same time. For this example, the concurrency controls we
have are overkill. The command <code>amount = balance</code> does not take a great
deal of time. If it did, however, it would make sense for readers to
execute it concurrently as we do. After reading the balance, this method
decrements <code>readers</code>. If <code>readers</code> reaches 0, a call to <code>notifyAll()</code> is
made, signaling that threads trying to deposit to or withdraw from the
account can continue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getBalance</span><span class="tok-o">()</span>	<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-kt">double</span> <span class="tok-n">amount</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>		<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-k">this</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			<span class="tok-n">readers</span><span class="tok-o">++;</span>
<span class="lineno"> 5 </span>		<span class="tok-o">}</span>
<span class="lineno"> 6 </span>		<span class="tok-n">amount</span> <span class="tok-o">=</span> <span class="tok-n">balance</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-k">this</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-o">--</span><span class="tok-n">readers</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>				<span class="tok-n">notifyAll</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-o">}</span>
<span class="lineno">11 </span>		<span class="tok-k">return</span> <span class="tok-n">amount</span><span class="tok-o">;</span>
<span class="lineno">12 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>deposit()</code> and <code>withdraw()</code> methods are wrappers for the
<code>changeBalance()</code> method, which has all the interesting concurrency
controls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">deposit</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">amount</span> <span class="tok-o">)</span>
<span class="lineno"> 2 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-n">changeBalance</span><span class="tok-o">(</span> <span class="tok-n">amount</span> <span class="tok-o">);</span>
<span class="lineno"> 4 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Deposited $&quot;</span> <span class="tok-o">+</span> <span class="tok-n">amount</span> <span class="tok-o">+</span> <span class="tok-s">&quot;.&quot;</span> <span class="tok-o">);</span>
<span class="lineno"> 5 </span>	<span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">withdraw</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">amount</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">success</span> <span class="tok-o">=</span> <span class="tok-n">changeBalance</span><span class="tok-o">(</span> <span class="tok-o">-</span><span class="tok-n">amount</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">success</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Withdrew $&quot;</span> <span class="tok-o">+</span> <span class="tok-n">amount</span> <span class="tok-o">+</span> <span class="tok-s">&quot;.&quot;</span> <span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-k">else</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Failed to withdraw $&quot;</span> <span class="tok-o">+</span>
<span class="lineno">14 </span>				<span class="tok-n">amount</span> <span class="tok-o">+</span> <span class="tok-s">&quot;: insufficient funds.&quot;</span> <span class="tok-o">);</span>
<span class="lineno">15 </span>		<span class="tok-k">return</span> <span class="tok-n">success</span><span class="tok-o">;</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>changeBalance()</code> method is synchronized so that it can have
exclusive access to the <code>readers</code> variable. As long as <code>readers</code> is
greater than 0, this method will wait. Eventually, the readers should
finish their job and notify the waiting writer which can finish changing
the balance of the account.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">private</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">boolean</span> <span class="tok-nf">changeBalance</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">amount</span> <span class="tok-o">)</span>
<span class="lineno"> 2 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">success</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">readers</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>				<span class="tok-n">wait</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">success</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">balance</span> <span class="tok-o">+</span> <span class="tok-n">amount</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>			<span class="tok-n">balance</span> <span class="tok-o">+=</span> <span class="tok-n">amount</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>		<span class="tok-k">return</span> <span class="tok-n">success</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>	<span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pitfalls_synchronization_challenges">14.5. Pitfalls: Synchronization challenges</h3>
<div class="paragraph">
<p>As you can see from the dining philosophers problem, synchronization
tools help us get the right answer but also create other difficulties.</p>
</div>
<div class="sect3">
<h4 id="_deadlock">14.5.1. Deadlock</h4>
<div class="paragraph">
<p><em>Deadlock</em> is the situation when two or more threads are both waiting
for the others to complete, forever. Some combination of locks or other
synchronization tools has forced a blocking dependence onto a group of
threads which will never be resolved.</p>
</div>
<div class="paragraph">
<p>In the past, people have described four conditions which must exist for
deadlock to happen.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Mutual Exclusion: Only one thread can access the resource (often a
lock) at a time.</p>
</li>
<li>
<p>Hold and Wait: A thread holding a resource can ask for additional
resources.</p>
</li>
<li>
<p>No Preemption: A thread holding a resource cannot be forced to
release it by another thread.</p>
</li>
<li>
<p>Circular Wait: Two or more threads hold resources which make up a
circular chain of dependency.</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="title">Example 108. Deadlock philosophers</div>
<div class="content">
<div class="paragraph">
<p>We illustrate deadlock with an example of how <strong>not</strong> to solve the dining
philosophers problem. What if all the philosophers decided to pick up
the chopstick on her right and then the chopstick on her left? If the
timing was just right, each philosopher would be holding one chopstick
in her right hand and be waiting forever for her neighbor on the left to
give up a chopstick. No philosopher would ever be able to eat. Here is
that scenario illustrated in code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DeadlockPhilosopher</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">SEATS</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-n">chopsticks</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[</span><span class="tok-n">SEATS</span><span class="tok-o">];</span>
<span class="lineno">4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">seat</span><span class="tok-o">;</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>	<span class="tok-kd">public</span> <span class="tok-nf">DeadlockPhilosopher</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">seat</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">seat</span> <span class="tok-o">=</span> <span class="tok-n">seat</span><span class="tok-o">;</span>
<span class="lineno">8 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After setting up the class and the constructor, things get interesting
in the <code>run()</code> method. First a philosopher tries to get her left
chopstick, then sleeps for 50 milliseconds, then tries to get her right
chopstick. Without sleeping, this code would usually run just fine.
Every once in a while, the philosophers would become deadlocked, but it
would be hard to predict when. By introducing the sleep, we can all but
guarantee that the philosophers will deadlock every time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-k">try</span>	<span class="tok-o">{</span>
<span class="lineno"> 3 </span>			<span class="tok-n">getChopstick</span><span class="tok-o">(</span> <span class="tok-n">seat</span> <span class="tok-o">);</span>
<span class="lineno"> 4 </span>			<span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">50</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>			<span class="tok-n">getChopstick</span><span class="tok-o">(</span> <span class="tok-n">seat</span> <span class="tok-o">-</span> <span class="tok-mi">1</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-o">}</span>
<span class="lineno"> 7 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-o">}</span>
<span class="lineno">10 </span>		<span class="tok-n">eat</span><span class="tok-o">();</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The remaining two methods are worth examining to see how the
synchronization is done, but by getting the two chopsticks separately
above, we have already gotten ourselves into trouble.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">getChopstick</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">location</span> <span class="tok-o">)</span>
<span class="lineno"> 2 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">location</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno"> 4 </span>			<span class="tok-n">location</span> <span class="tok-o">+=</span> <span class="tok-n">SEATS</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-n">chopsticks</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">location</span><span class="tok-o">]</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>				<span class="tok-n">chopsticks</span><span class="tok-o">.</span><span class="tok-na">wait</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>			<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">location</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-o">}</span>
<span class="lineno">10 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Philosopher &quot;</span> <span class="tok-o">+</span> <span class="tok-n">seat</span> <span class="tok-o">+</span>
<span class="lineno">11 </span>			<span class="tok-s">&quot; picked up chopstick &quot;</span> <span class="tok-o">+</span> <span class="tok-n">location</span> <span class="tok-o">+</span> <span class="tok-s">&quot;.&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>	<span class="tok-o">}</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>	<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">eat</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>		<span class="tok-c1">//done eating, put back chopsticks</span>
<span class="lineno">16 </span>		<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-n">chopsticks</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>			<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">seat</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">18 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">seat</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span>
<span class="lineno">19 </span>				<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">SEATS</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">20 </span>			<span class="tok-k">else</span>
<span class="lineno">21 </span>				<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">seat</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">22 </span>			<span class="tok-n">chopsticks</span><span class="tok-o">.</span><span class="tok-na">notifyAll</span><span class="tok-o">();</span>
<span class="lineno">23 </span>		<span class="tok-o">}</span>
<span class="lineno">24 </span>	<span class="tok-o">}</span>
<span class="lineno">25 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="deadlockSumExample" class="exampleblock">
<div class="title">Example 109. Deadlock sum</div>
<div class="content">
<div class="paragraph">
<p>Here is another example of deadlock. We emphasize deadlock because it is
one of the most common and problematic issues with using synchronization
carelessly.</p>
</div>
<div class="paragraph">
<p>Consider two threads which both need access to two separate resources.
In our example, the two resources are random number generators. The goal
of each of these threads is to acquire locks for the two shared random
number generators, generate two random numbers each, and sum the numbers
generated. (Note that locks are unnecessary for this problem anyway,
because access to <code>Random</code> objects is synchronized.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Random</span><span class="tok-o">;</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Deadlock</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Random</span> <span class="tok-n">random1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="lineno">5 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Random</span> <span class="tok-n">random2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="lineno">6 </span>	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">reverse</span><span class="tok-o">;</span>
<span class="lineno">7 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">sum</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The class begins as expected, creating shared <code>static</code> <code>Random</code> objects
<code>random1</code> and <code>random2</code>. Then, in the <code>main()</code> method, the main thread
spawns two new threads, passing <code>true</code> to one and <code>false</code> to the other.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-n">Thread</span> <span class="tok-n">thread1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Deadlock</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">);</span>
<span class="lineno"> 3 </span>		<span class="tok-n">Thread</span> <span class="tok-n">thread2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Deadlock</span><span class="tok-o">(</span> <span class="tok-kc">false</span> <span class="tok-o">);</span>
<span class="lineno"> 4 </span>		<span class="tok-n">thread1</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>		<span class="tok-n">thread2</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>			<span class="tok-n">thread1</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>			<span class="tok-n">thread2</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-o">}</span>
<span class="lineno">10 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">12 </span>		<span class="tok-o">}</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, the mischief begins to unfold. One of the two threads stores
<code>true</code> in its <code>reverse</code> field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Deadlock</span><span class="tok-o">(</span> <span class="tok-kt">boolean</span> <span class="tok-n">reverse</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">reverse</span> <span class="tok-o">=</span> <span class="tok-n">reverse</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we have the <code>run()</code> method where all the action happens. If the
two running threads both acquire locks for <code>random1</code> and <code>random2</code> in
the same order, everything would work out fine. However, the reversed
thread locks on <code>random2</code> and then <code>random1</code>, with a <code>sleep()</code> in
between. The non-reversed thread tries to lock on <code>random1</code> and then
<code>random2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">reverse</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>	        <span class="tok-kd">synchronized</span><span class="tok-o">(</span><span class="tok-n">random2</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span>
<span class="lineno"> 5 </span>				<span class="tok-s">&quot;Reversed Thread: synchronized on random2&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>			  <span class="tok-k">try</span><span class="tok-o">{</span> <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">50</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno"> 7 </span>			  <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>				  <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>			  <span class="tok-o">}</span>
<span class="lineno">10 </span>			  <span class="tok-kd">synchronized</span><span class="tok-o">(</span><span class="tok-n">random1</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>			    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span>
<span class="lineno">12 </span>					<span class="tok-s">&quot;Reversed Thread: synchronized on random1&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>			    <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-n">random1</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-n">random2</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">14 </span>			  <span class="tok-o">}</span>
<span class="lineno">15 </span>	        <span class="tok-o">}</span>
<span class="lineno">16 </span>	    <span class="tok-o">}</span>
<span class="lineno">17 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>	        <span class="tok-kd">synchronized</span><span class="tok-o">(</span><span class="tok-n">random1</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">19 </span>			  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span>
<span class="lineno">20 </span>				<span class="tok-s">&quot;Normal Thread: synchronized on random1&quot;</span><span class="tok-o">);</span>
<span class="lineno">21 </span>			  <span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">50</span><span class="tok-o">);</span> <span class="tok-o">}</span>
<span class="lineno">22 </span>			  <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>				  <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">24 </span>			  <span class="tok-o">}</span>
<span class="lineno">25 </span>			  <span class="tok-kd">synchronized</span><span class="tok-o">(</span><span class="tok-n">random2</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">26 </span>			    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span>
<span class="lineno">27 </span>					<span class="tok-s">&quot;Normal Thread: synchronized on random2&quot;</span><span class="tok-o">);</span>
<span class="lineno">28 </span>			    <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-n">random1</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-n">random2</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">29 </span>			  <span class="tok-o">}</span>
<span class="lineno">30 </span>		        <span class="tok-o">}</span>
<span class="lineno">31 </span>		<span class="tok-o">}</span>
<span class="lineno">32 </span>	<span class="tok-o">}</span>
<span class="lineno">33 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run this code, it should invariably deadlock with <code>thread1</code>
locked on <code>random2</code> and <code>thread2</code> locked on <code>random1</code>. No sane
programmer would intentionally code the threads like this. In fact, the
extra work we did to acquire the locks in opposite orders is exactly
what causes the deadlock. For more complicated programs, there may be
many different kinds of threads and many different resources. If two
different threads (perhaps written by different programmers, even) need
both resource A and resource B at the same time but try to acquire them
in reverse order, this kind of deadlock can occur without such an
obvious cause.</p>
</div>
<div class="paragraph">
<p>For deadlock of this type, the circular wait condition can be broken by
ordering the resources and always locking the resources in ascending
order. Of course, this solution only works if there is some universal
way of ordering the resources and the ordering is always followed by all
code in the program.</p>
</div>
<div class="paragraph">
<p>Ignoring the deadlock problems with the example above, it gives a nice
example of the way Java intended synchronization to be done: when
possible, use the resource you need as its own lock. Many other
languages require programmers to create additional locks or semaphores
to protect a given resource, but this approach causes problems if the
same lock is not consistently used. Using the resource itself as a lock
elegantly avoids this problem.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.8">Exercise 14.8</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_starvation_and_livelock">14.5.2. Starvation and livelock</h4>
<div class="paragraph">
<p><em>Starvation</em> is another problem which can occur with careless use of
synchronization tools. Starvation is a general term which covers any
situation in which some thread never gets access to the resources it
needs. Deadlock can be viewed as a special case of starvation since none
of the threads which are deadlocking make progress.</p>
</div>
<div class="paragraph">
<p>The dining philosophers problem was framed around the idea of eating
with humorous intent. If a philosopher is never able to acquire
chopsticks, that philosopher will quite literally starve.</p>
</div>
<div class="paragraph">
<p>Starvation does not necessarily mean deadlock, however. Examine the
implementation in <a href="#bankAccountExample">Example 107</a> for the bank account.
That solution is correct in the sense that it preserves mutual
exclusion. No combination of balance checks, deposits, or withdrawals
will cause the balance to be incorrect. Money will neither be created
nor destroyed. A closer inspection reveals that the solution is not
entirely fair. If a single thread is checking the balance, no other
thread can make a deposit or a withdrawal. Balance checking threads
could be coming and going constantly, incrementing and decrementing the
<code>readers</code> variable, but if <code>readers</code> never goes down to zero, threads
waiting to make deposits and withdrawals will wait forever.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.11">Exercise 14.11</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Another kind of starvation is <em>livelock</em>. In deadlock, two or more
threads get stuck and wait forever, doing nothing. Livelock is similar
except that the two threads keep executing code and waiting for some
condition that never arrives. A classic example of livelock is two
polite (but oddly predictable) people who are speaking with each other:
Both happen to start talking at exactly the same moment and then stop to
hear what the other has to say. After exactly one second, they both
begin again and immediately stop. Lather, rinse, repeat.</p>
</div>
<div class="exampleblock">
<div class="title">Example 110. Livelock party preparations</div>
<div class="content">
<div class="paragraph">
<p>Imagine three friends who are going to a party. Each of them starts
getting ready at different times. They follow the pattern of getting
ready for a while, waiting for their friends to get ready, and then
calling their friends to see if the other two are ready. If all three
are ready, then the friends will leave. Unfortunately, if a friend calls
and either of the other two aren&#8217;t ready, he&#8217;ll become frustrated and
stop being ready. Perhaps he&#8217;ll realize that he&#8217;s got time to take a
shower or get involved in some other activity for a while. After
finishing that activity, he&#8217;ll become ready again and wait for his
friends to become ready.</p>
</div>
<div class="paragraph">
<p>If the timing is just right, the three friends will keep becoming ready,
waiting for a while, and then becoming frustrated when they realize that
their friends aren&#8217;t ready. Here is a rough simulation of this process
in code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Livelock</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">totalReady</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Object</span> <span class="tok-n">lock</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Object</span><span class="tok-o">();</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">6 </span>		<span class="tok-n">Livelock</span> <span class="tok-n">friend1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Livelock</span><span class="tok-o">();</span>
<span class="lineno">7 </span>		<span class="tok-n">Livelock</span> <span class="tok-n">friend2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Livelock</span><span class="tok-o">();</span>
<span class="lineno">8 </span>		<span class="tok-n">Livelock</span> <span class="tok-n">friend3</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Livelock</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first few lines create a shared variable called <code>totalReady</code> which
keeps track of the total number of friends ready. To avoid race
conditions, a shared <code>Object</code> called <code>lock</code> will be used to control
access to <code>totalReady</code>. Then, the <code>main()</code> method creates <code>Livelock</code>
objects representing each of the friends.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>			<span class="tok-n">friend1</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno"> 3 </span>			<span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">);</span>
<span class="lineno"> 4 </span>			<span class="tok-n">friend2</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>			<span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>			<span class="tok-n">friend3</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>			<span class="tok-n">friend1</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>			<span class="tok-n">friend2</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">10 </span>			<span class="tok-n">friend3</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">11 </span>		<span class="tok-o">}</span>
<span class="lineno">12 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">14 </span>		<span class="tok-o">}</span>
<span class="lineno">15 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;All ready!&quot;</span><span class="tok-o">);</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The rest of the <code>main()</code> method starts each of the threads representing
the friends running, with a 100 millisecond delay before the next thread
starts . Then, the <code>main()</code> method waits for them all to finish. If
successful, it will print <code>All ready!</code> to the screen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-kt">boolean</span> <span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">done</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>				<span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">75</span><span class="tok-o">);</span> <span class="tok-c1">//prepare for party</span>
<span class="lineno"> 7 </span>				<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-n">lock</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>					<span class="tok-n">totalReady</span><span class="tok-o">++;</span>
<span class="lineno"> 9 </span>				<span class="tok-o">}</span>
<span class="lineno">10 </span>				<span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">75</span><span class="tok-o">);</span> <span class="tok-c1">//wait for friends</span>
<span class="lineno">11 </span>				<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-n">lock</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>					<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">totalReady</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">3</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>						<span class="tok-n">done</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">14 </span>					<span class="tok-k">else</span>
<span class="lineno">15 </span>						<span class="tok-n">totalReady</span><span class="tok-o">--;</span>
<span class="lineno">16 </span>				<span class="tok-o">}</span>
<span class="lineno">17 </span>			<span class="tok-o">}</span>
<span class="lineno">18 </span>		<span class="tok-o">}</span>
<span class="lineno">19 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">21 </span>		<span class="tok-o">}</span>
<span class="lineno">22 </span>	<span class="tok-o">}</span>
<span class="lineno">23 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>run()</code> method, each friend goes through a loop until the <code>done</code>
variable is <code>true</code>. In this loop, an initial call to <code>Thread.sleep()</code>
for 75 milliseconds represents preparing for the party. After that,
<code>totalReady</code> is incremented by one. Then, the friend waits for another
75 milliseconds. Finally, he checks to see if everyone else is ready by
testing whether <code>totalReady</code> is <code>3</code>. If not, he decrements <code>totalReady</code>
and repeats the process.</p>
</div>
<div class="paragraph">
<p>At roughly 75 milliseconds into the simulation, the first friend becomes
ready, but he doesn&#8217;t check with his friends until 150 milliseconds.
Unfortunately, the second friend doesn&#8217;t become ready until 175
milliseconds. He then checks with his friends at 225 milliseconds,
around which time the first friend is becoming ready a second time.
However, the third friend isn&#8217;t ready until 275 milliseconds. When he
then checks at 350 milliseconds, the first friend isn&#8217;t ready anymore.
On some systems the timing might drift such that the friends all become
ready at the same time, but it could take a long, long while.</p>
</div>
<div class="paragraph">
<p>In reality, human beings would not put off going to a party
indefinitely. Some people would decide that it was too late to go.
Others would go alone. Others would go over to their friends' houses and
demand to know what was taking so long. Computers are not nearly as
sensible and must obey instructions, even if they cause useless
repetitive patterns. Realistic examples of livelock are hard to show in
a short amount of code, but they do crop up in real systems and can be
very difficult to predict.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sequential_execution">14.5.3. Sequential execution</h4>
<div class="paragraph">
<p>When designing a parallel program, you may notice that synchronization
tools are necessary to get a correct answer. Then, when you run this
parallel version and compare it to the sequential version, it runs no
faster or, worse, runs slower than the sequential version. Too much zeal
with synchronization tools may produce a program which gives the right
answer but does not exploit any parallelism.</p>
</div>
<div class="paragraph">
<p>For example, we can take the <code>run()</code> method from the parallel
implementation of matrix multiply given in <a href="#matrixMultiplicationExample">Example 104</a> and use the <code>synchronized</code> keyword to lock on the
matrix itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-n">c</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">lower</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">upper</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
            <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">j</span> <span class="tok-o">&lt;</span> <span class="tok-n">c</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">j</span><span class="tok-o">++</span> <span class="tok-o">)</span>
                <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">k</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">k</span> <span class="tok-o">&lt;</span> <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">k</span><span class="tok-o">++</span> <span class="tok-o">)</span>
                    <span class="tok-n">c</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">]</span> <span class="tok-o">+=</span> <span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">][</span><span class="tok-n">k</span><span class="tok-o">]</span> <span class="tok-o">*</span> <span class="tok-n">b</span><span class="tok-o">[</span><span class="tok-n">k</span><span class="tok-o">][</span><span class="tok-n">j</span><span class="tok-o">];</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, only a single thread would have access to the matrix at
any given time, and all speedup would be lost.</p>
</div>
<div class="paragraph">
<p>For this version of matrix multiply, no synchronization is needed. In
the case of the producer/consumer problem, synchronization is necessary,
and the only way to manage the buffer properly is to enforce sequential
execution. Sometimes sequential execution cannot be avoided, but you
should always know which pieces of code are truly executing in parallel
and which are not if you hope to get the maximum amount of speedup. The
<code>synchronized</code> keyword should be used whenever it is needed, but no
more.</p>
</div>
</div>
<div class="sect3">
<h4 id="_priority_inversion">14.5.4. Priority inversion</h4>
<div class="paragraph">
<p>In <a href="#_concurrent_programming">Chapter 13</a> we suggest that you use
thread priorities rarely. Even good reasons to use priorities can be
thwarted by <em>priority inversion</em>. In priority inversion, a lower
priority thread holds a lock needed by a higher priority thread,
potentially for a long time. Because the high priority thread cannot
continue, the lower priority thread gets more CPU time, as if it were a
high priority thread.</p>
</div>
<div class="paragraph">
<p>Worse, if there are some medium priority threads in the system, the low
priority thread may hold the lock needed by the high priority thread for
even longer because those medium priority threads reduce the amount of
CPU time the low priority thread has to finish its task.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.9">Exercise 14.9</a><br>
<a href="#exercise14.15">Exercise 14.15</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_dining_philosophers">14.6. Solution: Dining philosophers</h3>
<div class="paragraph">
<p>Now we give our solution to the dining philosophers problem. Although
deadlock was the key pitfall we were trying to avoid, many other issues
can crop up in solutions to this problem. A single philosopher may be
forced into starvation, or all philosophers may experience livelock
through some pattern of picking up and putting down chopsticks which
never quite works out. A very simple solution could allow the
philosophers to eat, one by one, in order. Then, the philosophers would
often and unnecessarily be waiting to eat, and the program would
approach sequential execution.</p>
</div>
<div class="paragraph">
<p>The key element that makes our solution work is that we force a
philosopher to pick up two chopsticks atomically. The philosopher will
either pick up both chopsticks or neither.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DiningPhilosopher</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">SEATS</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span><span class="tok-o">[]</span> <span class="tok-n">chopsticks</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">boolean</span><span class="tok-o">[</span><span class="tok-n">SEATS</span><span class="tok-o">];</span>
<span class="lineno">4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">seat</span><span class="tok-o">;</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>	<span class="tok-kd">public</span> <span class="tok-nf">DiningPhilosopher</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">seat</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">seat</span> <span class="tok-o">=</span> <span class="tok-n">seat</span><span class="tok-o">;</span>
<span class="lineno">8 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We begin with the same setup as the deadlocking version given in
<a href="#_deadlock">Section 14.5.1</a>. Unlike that example, we include a
<code>main()</code> method here for completeness. In <code>main()</code>, we set all the
chopsticks to <code>false</code> (unused), create and start a thread for each
philosopher, and then wait for them to finish.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">args</span><span class="tok-o">[])</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">SEATS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno"> 3 </span>			<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-n">DiningPhilosopher</span><span class="tok-o">[]</span> <span class="tok-n">philosophers</span> <span class="tok-o">=</span>
<span class="lineno"> 5 </span>			<span class="tok-k">new</span> <span class="tok-n">DiningPhilosopher</span><span class="tok-o">[</span><span class="tok-n">SEATS</span><span class="tok-o">];</span>
<span class="lineno"> 6 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">SEATS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>			<span class="tok-n">philosophers</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DiningPhilosopher</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">);</span>
<span class="lineno"> 8 </span>			<span class="tok-n">philosophers</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-o">}</span>
<span class="lineno">10 </span>		<span class="tok-k">try</span>	<span class="tok-o">{</span>
<span class="lineno">11 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">SEATS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">12 </span>				<span class="tok-n">philosophers</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span>
<span class="lineno">14 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">16 </span>		<span class="tok-o">}</span>
<span class="lineno">17 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;All philosophers done.&quot;</span><span class="tok-o">);</span>
<span class="lineno">18 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>run()</code> method is different from the deadlocking version but not in
a way that prevents deadlock. We added the <code>for</code> loop so that you could
see the philosophers eat and think many different times without
problems. We also added the <code>think()</code> method to randomize the amount of
time between eating so that each run of the program is less
deterministic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>			<span class="tok-n">think</span><span class="tok-o">();</span>
<span class="lineno"> 4 </span>			<span class="tok-n">getChopsticks</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>			<span class="tok-n">eat</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>		<span class="tok-o">}</span>
<span class="lineno"> 7 </span>	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">think</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="lineno">11 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>			<span class="tok-n">sleep</span><span class="tok-o">(</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">10</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span>
<span class="lineno">14 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">16 </span>		<span class="tok-o">}</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The real place where deadlock is prevented is in the <code>getChopsticks()</code>
method. The philosopher acquires the <code>chopsticks</code> lock and then picks up
the two chopsticks she needs only if both are available. Otherwise, she
waits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">getChopsticks</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-kt">int</span> <span class="tok-n">location1</span> <span class="tok-o">=</span> <span class="tok-n">seat</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>		<span class="tok-kt">int</span> <span class="tok-n">location2</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">seat</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>			<span class="tok-n">location2</span> <span class="tok-o">=</span> <span class="tok-n">SEATS</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-k">else</span>
<span class="lineno"> 7 </span>			<span class="tok-n">location2</span> <span class="tok-o">=</span> <span class="tok-n">seat</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>		<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-n">chopsticks</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">location1</span><span class="tok-o">]</span>
<span class="lineno">10 </span>				<span class="tok-o">||</span> <span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">location2</span><span class="tok-o">]</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>				<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>					<span class="tok-n">chopsticks</span><span class="tok-o">.</span><span class="tok-na">wait</span><span class="tok-o">();</span>
<span class="lineno">13 </span>				<span class="tok-o">}</span>
<span class="lineno">14 </span>				<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span>	<span class="tok-o">{</span>
<span class="lineno">15 </span>					<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">16 </span>				<span class="tok-o">}</span>
<span class="lineno">17 </span>			<span class="tok-o">}</span>
<span class="lineno">18 </span>			<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">location1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">19 </span>			<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">location2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">20 </span>		<span class="tok-o">}</span>
<span class="lineno">21 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Philosopher &quot;</span> <span class="tok-o">+</span> <span class="tok-n">seat</span> <span class="tok-o">+</span>
<span class="lineno">22 </span>			<span class="tok-s">&quot; picked up chopsticks &quot;</span> <span class="tok-o">+</span> <span class="tok-n">location1</span> <span class="tok-o">+</span> <span class="tok-s">&quot; and &quot;</span>
<span class="lineno">23 </span>			<span class="tok-o">+</span> <span class="tok-n">location2</span> <span class="tok-o">+</span> <span class="tok-s">&quot;.&quot;</span><span class="tok-o">);</span>
<span class="lineno">24 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, in the <code>eat()</code> method, the philosopher eats the rice. We would
assume that some other computation would be done here in a realistic
problem <strong>before</strong> entering the <code>synchronized</code> block. The eating itself
does not require a lock. After eating is done, the lock is acquired to
give back the chopsticks (hopefully after some cleaning), and then all
waiting philosophers are notified that some chopsticks may have become
available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">eat</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-c1">//eat rice first</span>
<span class="lineno"> 3 </span>		<span class="tok-kd">synchronized</span><span class="tok-o">(</span> <span class="tok-n">chopsticks</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">seat</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">seat</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span>
<span class="lineno"> 6 </span>				<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">SEATS</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>			<span class="tok-k">else</span>
<span class="lineno"> 8 </span>				<span class="tok-n">chopsticks</span><span class="tok-o">[</span><span class="tok-n">seat</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>			<span class="tok-n">chopsticks</span><span class="tok-o">.</span><span class="tok-na">notifyAll</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-o">}</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span>
<span class="lineno">12 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our solution prevents deadlock and livelock because some philosopher
will get control of two chopsticks eventually, yet there are still
issues. Note that each philosopher only eats and thinks 100 times. If,
instead of philosophers sharing chopsticks, each thread were a server
sharing network storage units, the program could run for an unspecified
amount of time: days, weeks, even years. If starvation is happening to a
particular philosopher in our program, the other philosophers will
finish after 100 rounds, and the starved philosopher can catch up. If
there were no limitation on the loop, a starving philosopher might never
catch up.</p>
</div>
<div class="paragraph">
<p>Even if you increase the number of iterations of the loop quite a lot,
you would probably not see starvation of an individual thread because we
are cheating in another way. Some unlucky sequence of chopstick accesses
by two neighboring philosophers could starve the philosopher between
them. By making the <code>think()</code> method wait a random amount of time, such
a sequence will probably be interrupted. If all philosophers thought for
exactly the same amount of time each turn, an unlucky pattern could
repeat over and over. It is not unreasonable to believe that the amount
of thinking a philosopher (or a server) will do at any given time will
vary, but this kind of behavior will vary from system to system.</p>
</div>
<div class="paragraph">
<p>It is very difficult to come up with a perfect answer to some
synchronization problems. Such problems have been studied for many
years, and research continues to find better solutions.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise14.12">Exercise 14.12</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_14">14.7. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise14.1"></a> What is the purpose of the
<code>synchronized</code> keyword? How does it work?</p>
</li>
<li>
<p><a id="exercise14.2"></a> The language specification for Java
makes it illegal to use the <code>synchronized</code> keyword on constructors.
During the creation of an object, it is possible to <em>leak</em> data to the
outside world by adding a reference to the object under construction to
some shared data structure. What&#8217;s the danger of leaking data in this
way?</p>
</li>
<li>
<p><a id="exercise14.3"></a> If you call
<code>wait()</code> or <code>notify()</code> on an object, it must be inside of a block
synchronized on the same object. If not, the code will compile, but an
<code>IllegalMonitorStateException</code> may be thrown at run time. Why is it
necessary to own the lock on an object before calling <code>wait()</code> or
<code>notify()</code> on it?</p>
</li>
<li>
<p><a id="exercise14.4"></a> Why is it safer to call
<code>notifyAll()</code> than <code>notify()</code>? If it is generally safer to call
<code>notifyAll()</code>, are there any scenarios in which there are good reasons
to call <code>notify()</code>?</p>
</li>
<li>
<p><a id="exercise14.5"></a> Imagine a simulation of a
restaurant with many waiter and chef objects. The waiters must submit
orders to the kitchen staff, and the chefs must divide the work among
themselves. How would you design this system? How would information and
food be passed from waiter to chef and chef to waiter? How would you
synchronize the process?</p>
</li>
<li>
<p><a id="exercise14.6"></a> What is a race condition? Give a real
life example of one.</p>
</li>
<li>
<p><a id="exercise14.7"></a> Let&#8217;s reexamine the code that
increments a variable with several threads from
<a href="#_concepts_thread_interaction">Section 14.3</a>. We can rewrite the <code>run()</code>
method as follows.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">COUNT</span> <span class="tok-o">/</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">counter</span><span class="tok-o">++;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Will this change fix the race condition? Why or why not?</p>
</div>
</li>
<li>
<p><a id="exercise14.8"></a> Examine our deadlock example from
<a href="#deadlockSumExample">Example 109</a>. Explain why this example fulfills all
four conditions for deadlock. Be specific about which threads and which
resources are needed to show each condition.</p>
</li>
<li>
<p><a id="exercise14.9"></a> What is priority inversion? Why can
a low priority thread holding a lock be particularly problematic?</p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise14.10"></a> In
<a href="#producerConsumerExample">Example 106</a> the <code>Buffer</code> class used to
implement a solution to the producer/consumer problem only has a single
lock. When the buffer is empty and a producer puts an item in it, both
producers and consumers are woken up. A similar situation happens
whenever the buffer is full and a consumer removes an item. Re-implement
this solution with two locks so that a producer putting an item into an
empty buffer only wakes up consumers and a consumer removing an item
from a full buffer only wakes up producers.</p>
</li>
<li>
<p><a id="exercise14.11"></a> In <a href="#bankAccountExample">Example 107</a>
we used the class <code>SynchronizedAccount</code> to solve a bank account problem.
As we mention in <a href="#_starvation_and_livelock">Section 14.5.2</a>, depositing
and withdrawing threads can be starved out by a steady supply of balance
checking threads. Add additional synchronization tools to
<code>SynchronizedAccount</code> so that balance checking threads will take turns
with depositing and withdrawing threads. If there are no depositing or
withdrawing threads, make your implementation continue to allow an
unlimited number of balance checking threads to read concurrently.</p>
</li>
<li>
<p><a id="exercise14.12"></a>The solution to the dining
philosophers problem given in <a href="#_solution_dining_philosophers">Section 14.6</a>
suffers from the problem that a philosopher could be starved by the two
philosophers on either side of her, if she happened to get unlucky. Add
variables to each philosopher which indicate hunger and the last time a
philosopher has eaten. If a given philosopher is hungry and has not
eaten for longer than her neighbor, her neighbor should not pick up the
chopstick they share. Add synchronization tools to enforce this
principle of fairness. Note that this solution should not cause
deadlock. Although one philosopher may be waiting on another who is
waiting on another and so on, <strong>some</strong> philosopher in the circle must have
gone hungry the longest, breaking circular wait.</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise14.13"></a> Critical sections can slow down
your program by preventing parallel computation. However, the locks used
to enforce critical sections can add extra delays on top of that. Design
a simple experiment which repeatedly acquires a lock and does some
simple operation. Test the running time with and without the lock. See
if you can estimate the time needed to acquire a lock in Java on your
system.</p>
</li>
<li>
<p><a id="exercise14.14"></a> Design a program which
experimentally determines how much time a thread is scheduled to spend
running on a CPU before switching to the next thread. To do this, first
create a tight loop which runs a large number of iterations, perhaps
1,000,000 or more. Determine how much time it takes to run a single run
of those iterations. Then, write an outer loop which runs the tight loop
several times. Each iteration of the outer loop, test to see how much
time has passed. When you encounter a large jump in time, typically at
least 10 times the amount of time the tight loop usually takes to run to
completion, record that time. If you run these loops in multiple threads
and average the unusually long times together for each thread, you
should be able to find out about how long each thread waits between
runs. Using this information, you can estimate how much time each thread
is allotted. Bear in mind that this is only an estimation. Some JVMs
will change the amount of CPU time allotted to threads for various
reasons. If you are on a multicore machine, it will be more difficult to
interpret your data since some threads will be running concurrently.</p>
</li>
<li>
<p><a id="exercise14.15"></a> Create an experiment to
investigate priority inversion in the following way.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create two threads, setting the priority of the first to
<code>MIN_PRIORITY</code> and the priority of the second to <code>MAX_PRIORITY</code>. Start
the first thread running but wait 100 milliseconds before starting the
second thread. The first thread should acquire a shared lock and then
perform some lengthy process such as finding the sum of the sines of the
first million integers. After it finishes its computation, it should
release the lock, and print a message. The second thread should try to
acquire the lock, print a message, and then release the lock. Time the
process. Because the lock is held by the lower priority thread, the
higher priority thread will have to wait until the other thread is done
for it to finish.</p>
</li>
<li>
<p>Once you have a feel for the time it takes for these two threads to
finish alone, create 10 more threads that must also perform a lot of
computation. However, these threads do not try to acquire the lock. How
much do they delay completion of the task? How does this delay relate to
the number of cores in your processor? How much does the delay change if
you set the priorities of these new threads to <code>MAX_PRIORITY</code> or
<code>MIN_PRIORITY</code>?</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_constructing_graphical_user_interfaces">15. Constructing Graphical User Interfaces</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A good sketch is better than a long speech.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Napoleon Bonaparte
</div>
</div>
<div class="sect2">
<h3 id="_problem_math_applet">15.1. Problem: Math applet</h3>
<div class="paragraph">
<p>An <em>applet</em> is a graphical Java program that runs inside of a special
environment, usually a web browser. The beauty of an applet is that
anyone with a Java-enabled web browser can run the program without any
special knowledge or computer skills. Most users don&#8217;t even realize they
are running a program.</p>
</div>
<div id="mathTutorAppletFigure" class="imageblock">
<div class="content">
<img src="chapters/15-gui/images/mathTutorAppletFigure.svg" alt="mathTutorAppletFigure" width="100%">
</div>
<div class="title">Figure 54. The <code>MathTutorApplet</code> as seen through the Google Chrome browser. (a) Initial applet. (b) Selecting an operation to practice. (c) After some practice.</div>
</div>
<div class="paragraph">
<p>Let&#8217;s write an applet that will allow young math students to practice
their arithmetic. Specifically, we are interested in addition,
subtraction, multiplication, and division with small, positive integers.
For this program, we will consider addition and subtraction basic and
multiplication and division advanced. Our applet should allow the user
to select a check box in a menu setting the mode to advanced or basic.
The user should then be able to select one of the four operations from
another menu. Once the operation is selected, the applet should generate
a random problem testing that operation. The problem should be displayed
as a label on the applet with a text field to one side. The user should
be able to enter an answer in the text field and hit a button to submit
it. The applet should check the answer and display the updated number of
correct and incorrect answers.</p>
</div>
<div class="paragraph">
<p><a href="#mathTutorAppletFigure">Figure 54</a> shows the final applet in three
different states. The screen to the left appears when the applet is
first initialized, and the Submit button is disabled until a problem is generated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_graphical_user_interfaces">15.2. Concepts: Graphical user interfaces</h3>
<div class="paragraph">
<p>The applet shown above with its menus, labels, buttons, and other
interactive components is called a graphical user interface, or GUI. A
GUI is a means of communication between a computer program and a
(usually human) user. (Although it is possible for some programs such as
scripts to interact with a GUI, most program to program communication is
done in other ways.) While communication through input and output on the
console is one way to communicate with a program, GUIs offer a
user-friendly alternative that has become extremely commonplace. In
fact, GUIs are so common that many people have never used anything else
to interact with programs and may not even suspect that other kinds of
interaction are possible.</p>
</div>
<div class="paragraph">
<p>This chapter will teach you how to write programs with GUIs. Although
GUIs can make input and output easier for the user, the programmer has
to shoulder the burden of arranging the layout and appearance of the GUI
and making it function properly. <a href="#_simple_graphical_user_interfaces">Chapter 7</a> introduced a way to make simple GUIs, but those GUIs came
in preset flavors designed for displaying a message, getting a range of
responses in the form of buttons, or reading a short piece of text as
input. In this chapter we will explore ways to make GUIs of arbitrary
complexity with no limitations on the size or shape of the GUI or the
components it contains.</p>
</div>
<div class="paragraph">
<p>A typical GUI consists of a <em>frame</em> (also known as a window) on which
are displayed one or more components (known as widgets), such as panels,
buttons, and text boxes. <em>Panels</em> are used to organize the contents
within the frame. A frame contains at least one panel, but additional
ones can be added. Each panel can also contain widgets: buttons, labels,
text boxes, and even other panels. Using code to create a GUI with all
the widgets laid out exactly where you want them is half the work of
making a GUI-driven program in Java.</p>
</div>
<div class="paragraph">
<p>Some components like labels are read-only to the user. They display
information such as status messages. Other components are more dynamic
in the sense that the user can use these to give input to the program.
Such components are associated with events. Handling events inside of a
program is the other half of writing a GUI program in Java. Layout is
concerned with appearance, but event handling is concerned with
functionality.</p>
</div>
<div class="paragraph">
<p>There are IDEs such as NetBeans have graphical tools that automatically
generate the GUI code for you. We focus on how to write this code
yourself because doing so gives you more control and helps you
understand Java GUIs better.</p>
</div>
<div class="sect3">
<h4 id="_swing_and_awt">15.2.1. Swing and AWT</h4>
<div class="paragraph">
<p>Most of the components you will use to create GUIs are defined in
classes that belong to the Java Swing library. This library contains
many interfaces and classes. Several components of the Swing library are
built upon another library known as the Abstract Window Toolkit that is
commonly referred to as AWT. In earlier chapters, you have seen, and
probably used, one class in the Swing library, the <code>JOptionPane</code> class.</p>
</div>
<div class="paragraph">
<p>The AWT is an older library which provides direct access to the OS
widgets. Thus, an AWT <code>Button</code> object in Microsoft Windows creates a
Windows button. Swing, however, draws its own button. AWT GUIs look
exactly like other GUIs from the same OS. Swing GUIs can be configured
to look similar using <em>look and feel</em> settings, or developers can choose
to use a default Java look and feel that will look almost the same
across all platforms.</p>
</div>
<div class="paragraph">
<p>We will discuss Swing widgets such as <code>JButton</code> and <code>JTextField</code>. Swing
components usually have a <code>J</code> at the beginning of their names to
distinguish them from similar AWT components. (The AWT contains <code>Button</code>
and <code>TextField</code>. If you see examples from other sources using widgets
that do not start with <code>J</code>, they are probably using AWT.) Although Swing
is built on top of the older AWT library, it is not a good idea to mix
Swing and AWT components in a single GUI, though it is possible.</p>
</div>
<div class="paragraph">
<p>The Swing library is far too large for us to cover in its entirety.
Instead, our goal is to show you how to construct GUIs using some of the
most common Java widgets. Once you have grasped the material in this
chapter, you will be able to read and understand how to use many other
interesting Swing components, as well as other Java libraries for
constructing GUIs. Since a frame is the basis for most windowed GUIs, we
will begin by showing you how to create a frame and display it on the
screen.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_guis_in_java">15.3. Syntax: GUIs in Java</h3>
<div class="sect3">
<h4 id="_creating_a_frame">15.3.1. Creating a frame</h4>
<div class="paragraph">
<p>A frame is the Java terminology for a window. Except when programming an
applet, GUI components in Java will usually be found on a frame. In
Swing, a frame is an object whose type is derived from the <code>JFrame</code>
class. Here is a line of code that creates a <code>JFrame</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JFrame</span> <span class="tok-n">soundCheck</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Sound Check&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above statement declares and creates a <code>JFrame</code> object named
<code>soundCheck</code>. The title of the frame is &#8220;Sound Check&#8221; and is given as
an argument to the <code>JFrame</code> constructor. Although calling the
constructor creates the frame, you need to make it visible for it to
show up on the screen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>setVisible()</code> method causes the <code>soundCheck</code> frame to be visible on
the screen as a window. You can specify its size as in the following
code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">300</span><span class="tok-o">,</span><span class="tok-mi">200</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>setSize()</code> method sets the width and height of the frame specified
in pixels. In the above example, the width of <code>soundCheck</code> is set to 300
pixels and its height to 200 pixels. The window created by the above
code is resizable. You could use the following code if you do not want
the user to be able to resize the window.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setResizable</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your entire GUI will often be a frame you create and the components
inside that frame. You might want your application to end when you close
the frame by clicking on the close button towards the top. The actual
location of this button depends on the operating system and the look and
feel managers you are using. Regardless, the following statement can be
used to set the behavior of the application when you close the frame
window.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span><span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Pitfall: Closing frames</div>
<div class="paragraph">
<p>Some books and online tutorials suggest setting <code>JFrame.EXIT_ON_CLOSE</code>
as the default close operation for a <code>JFrame</code> instead of
<code>JFrame.DISPOSE_ON_CLOSE</code>. In our opinion, this option should never be
used.</p>
</div>
<div class="paragraph">
<p>Using <code>JFrame.EXIT_ON_CLOSE</code> is equivalent to calling
<code>System.exit(0)</code>, which shuts down the JVM. In a single-threaded
application, the difference between disposing and exiting is small.
However, in a multi-threaded application, shutting down the JVM means
killing off all the other threads, no matter what task they are
performing. In general, <code>System.exit()</code> should never be called,
whether the program has a GUI or not.</p>
</div>
<div class="paragraph">
<p>By using <code>JFrame.DISPOSE_ON_CLOSE</code>, the frame releases all the
resources it has been using and terminates any threads it uses to redraw
itself and check for events. If there are no other threads running, the
application will then shut down.</p>
</div>
<div class="paragraph">
<p>It is still necessary to select <strong>some</strong> default closing operation. By
default, the operation is set to <code>JFrame.HIDE_ON_CLOSE</code>, which hides
the frame but does not end its threads. Unfortunately, if the frame is
the only way you have of interacting with your application, you can no
longer use it! At that point, you may have to use a process or task
manager to shut down the JVM by hand.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="emptyFrameExample" class="exampleblock">
<div class="title">Example 111. Empty frame</div>
<div class="content">
<div class="paragraph">
<p><a href="#EmptyFrame">[EmptyFrame]</a> creates and displays an empty frame with
the title &#8220;Sound Check.&#8221; Note that we have used the <code>import</code> statement
to let the compiler know that we are using the Swing library. The first
line inside the <code>main()</code> method declares and creates a <code>JFrame</code> object
and assigns a title to it. The following line sets its size. The third
line sets the default close operation and the following line makes the
frame visible. The frame so created is shown in
<a href="#emptyFrameFigure">Figure 55</a>. Note that the frame is resizable.</p>
</div>
<div id="EmptyFrameProgram" class="listingblock">
<div class="title">Program 53. Creates an empty frame.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EmptyFrame</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
<span class="lineno"> 5 </span>    	<span class="tok-c1">//Create frame</span>
<span class="lineno"> 6 </span>        <span class="tok-n">JFrame</span> <span class="tok-n">soundCheck</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Sound Check&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">350</span><span class="tok-o">,</span><span class="tok-mi">150</span><span class="tok-o">);</span> <span class="tok-c1">//Set size in pixels</span>
<span class="lineno"> 8 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno"> 9 </span>        		<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">10 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span> <span class="tok-c1">//Display it</span>
<span class="lineno">11 </span>    <span class="tok-o">}</span>
<span class="lineno">12 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="emptyFrameFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/emptyFrameFigure.png" alt="emptyFrameFigure" width="40%">
</div>
<div class="title">Figure 55. An empty frame titled &#8220;Sound Check.&#8221;</div>
</div>
<div class="paragraph">
<p>You may resize the frame at any point in the program even after the
frame has been created and made visible. The initial size may or may not
be set prior to making the frame visible. Similarly, the frame title can
be set, and reset, at any point in the program.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_widgets">15.3.2. Widgets</h4>
<div class="paragraph">
<p>A widget is a component of a GUI. Java provides a large variety of
widgets including panels, buttons, text boxes, check boxes, and menus.
While laying out a GUI, one or more of the widgets are created and then
placed on a frame. A widget is declared and created like any other
object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Widget</span> <span class="tok-n">w</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Widget</span><span class="tok-o">(</span><span class="tok-n">arguments</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we use class <code>Widget</code> to represent some Java widget class like
<code>JButton</code> or , and we use reference <code>w</code> to represent the name of a
widget like <code>startButton</code>. Arguments supplied while constructing a
widget allow you to set attributes such as its icon, color, size, or
text to display. A widget can be added to a frame and removed when not
needed. Its attributes can also be changed after creation.</p>
</div>
<div class="paragraph">
<p>Although widgets can be added directly to a frame, it is often
convenient to lay out a GUI by placing panels on a frame and then
placing widgets on the panels. Each panel can hold zero or more widgets.
A panel is also referred to as a <em>container</em> object. Next we show you
how to create a panel, populate it with widgets, place it on a frame,
and display the completed frame.</p>
</div>
<div class="paragraph">
<p>A panel is an instance of the <code>JPanel</code> class and can be created as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JPanel</span> <span class="tok-n">soundPanel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement creates a panel named <code>soundPanel</code>. Thus far, the panel
is empty. Let&#8217;s create two buttons and add these to <code>soundPanel</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JButton</span> <span class="tok-n">chirp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Chirp&quot;</span><span class="tok-o">);</span>
<span class="tok-n">JButton</span> <span class="tok-n">bark</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Bark&quot;</span><span class="tok-o">);</span>
<span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">chirp</span><span class="tok-o">);</span>
<span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">bark</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first two lines above create two buttons named <code>chirp</code> and <code>bark</code>.
These buttons are labeled using the <code>String</code> values <code>"Chirp"</code> and
<code>"Bark"</code>, but their labels could be any <code>String</code> values. The last two
statements add the two buttons one by one to the <code>soundPanel</code>. Then we
add the panel to a frame object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">soundPanel</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement adds the <code>soundPanel</code> to <code>soundCheck</code> frame that we
created in <a href="#emptyFrameExample">Example 111</a>.</p>
</div>
<div class="paragraph">
<p>Another useful widget is <code>JTextField</code>. It creates a text field that can
be used by a program for both input and output of <code>String</code> data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JTextField</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;This is not a pipe.&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement creates an object named <code>message</code> as an instance of the
<code>JTextField</code> class. When displayed, it will show the message &#8220;This is
not a pipe.&#8221; The user can replace this text by typing, but we will need
to talk about event handling before we can read the text and act on it
from within a program. The following example combines various concepts
and widgets already introduced into one program.</p>
</div>
<div class="exampleblock">
<div class="title">Example 112. GUI with buttons and text field</div>
<div class="content">
<div class="paragraph">
<p>We will now write an application with a GUI that contains three buttons
labeled &#8220;Chirp,&#8221; &#8220;Bark,&#8221; and &#8220;Exit.&#8221; In addition it contains a
text field that initially displays the text, &#8220;Listen to nature!&#8221;</p>
</div>
<div class="paragraph">
<p>In this example the buttons are only for display. You can click each
one, but the program will not do anything useful. Similarly, the text
field will not be changed by the program after it is initialized. In the
next subsection we add actions to each button and make the program more
useful.</p>
</div>
<div id="FrameWithPanelProgram" class="listingblock">
<div class="title">Program 54. Creates a frame with a panel containing three buttons.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FrameWithPanel</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
<span class="lineno"> 5 </span>    	<span class="tok-c1">//Create frame</span>
<span class="lineno"> 6 </span>        <span class="tok-n">JFrame</span> <span class="tok-n">soundCheck</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Sound Check&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>        <span class="tok-n">JPanel</span> <span class="tok-n">soundPanel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>        <span class="tok-c1">//Create three buttons</span>
<span class="lineno"> 9 </span>        <span class="tok-n">JButton</span> <span class="tok-n">chirp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Chirp&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>        <span class="tok-n">JButton</span> <span class="tok-n">bark</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Bark&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>        <span class="tok-n">JButton</span> <span class="tok-n">exit</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Exit&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>        <span class="tok-n">JTextField</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;Listen to nature!&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>        <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">chirp</span><span class="tok-o">);</span> <span class="tok-c1">// Add chirp to panel /*@\label{addBirdChirp}@*/</span>
<span class="lineno">14 </span>        <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">bark</span><span class="tok-o">);</span> <span class="tok-c1">//Add bark to panel</span>
<span class="lineno">15 </span>        <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span> <span class="tok-c1">//Add message box</span>
<span class="lineno">16 </span>        <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">exit</span><span class="tok-o">);</span> <span class="tok-c1">//Add exit button/*@\label{addExit}@*/</span>
<span class="lineno">17 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">soundPanel</span><span class="tok-o">);</span> <span class="tok-c1">//Add the panel to the frame/*@\label{addPanelToFrame}@*/</span>
<span class="lineno">18 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">350</span><span class="tok-o">,</span><span class="tok-mi">150</span><span class="tok-o">);</span> <span class="tok-c1">//Set size in pixels</span>
<span class="lineno">19 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno">20 </span>        	<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">21 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span> <span class="tok-c1">//Display frame</span>
<span class="lineno">22 </span>    <span class="tok-o">}</span>
<span class="lineno">23 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="frameWithAPanelFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/frameWithAPanelFigure.png" alt="frameWithAPanelFigure" width="40%">
</div>
<div class="title">Figure 56. GUI consisting of a frame, a panel, three buttons, and a text field.</div>
</div>
<div class="paragraph">
<p>In the <code>main()</code> method in <a href="#FrameWithPanel">[FrameWithPanel]</a>, we first
create a frame named <code>soundCheck</code> and a panel named <code>soundPanel</code>. Next,
we create three buttons named <code>chirp</code>, <code>bark</code>, and <code>exit</code>, labeled
&#8220;Chirp,&#8221; &#8220;Bark,&#8221; and &#8220;Exit,&#8221; respectively. Lines <a href="#addBirdChirp">[addBirdChirp]</a>
until <a href="#addExit">[addExit]</a> add the three buttons and the text field to
<code>soundPanel</code>. At line <a href="#addPanelToFrame">[addPanelToFrame]</a>, <code>soundPanel</code> is added to
<code>soundCheck</code>. After setting the closing operation, the frame is made
visible. The final GUI is shown in <a href="#frameWithAPanelFigure">Figure 56</a>.
Note that the same GUI may look different on different platforms. Later
we will see how to add multiple panels to a frame.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.17">Exercise 15.17</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_actions_to_widgets">15.3.3. Adding actions to widgets</h4>
<div class="paragraph">
<p>Many widgets in Java can be used to cause an action. For example, a user
could click a button labeled &#8220;Chirp,&#8221; causing the program to play a
bird chirp sound. Clicking a button generates an <em>event</em>. In Java, an
event is processed by one or more <em>listeners</em>. Java provides various
types of listeners, some of which are introduced here and a few others
in <a href="#subsection:Applets">Section 15.3.7</a>. Next we show you how to handle action
events generated by a few different kinds of widgets.</p>
</div>
<div class="sect4">
<h5 id="_the_code_actionlistener_code_interface">The <code>ActionListener</code> interface</h5>
<div class="paragraph">
<p>Java provides an <code>ActionListener</code> interface. This interface has a single
method named <code>actionPerformed()</code>. This method takes an <code>ActionEvent</code> as
input and performs a suitable action based on the event. A <code>JButton</code>
object generates <code>ActionEvent</code> when it is pressed. Any class that
implements the <code>ActionListener</code> interface can be registered as an action
listener on a <code>JButton</code> or any other widget that generates an
<code>ActionEvent</code>.</p>
</div>
<div class="paragraph">
<p>As discussed in <a href="#_interfaces">Chapter 10</a>, an interface is a set of
method signatures. If you implement an interface, you promise to have
all of the methods in the interface. If a class implements
<code>ActionListener</code>, it&#8217;s saying that it knows what to do when an action is
performed. The following statements show how to add an <code>ActionListener</code>
to a button and implement its <code>actionPerformed()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JButton</span> <span class="tok-n">chirp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Chirp&quot;</span><span class="tok-o">);</span>
<span class="tok-n">chirp</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActionListener</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
                <span class="tok-c1">//Code to perform an action goes here</span>
            <span class="tok-o">}</span>
        <span class="tok-o">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line above creates a button named <code>chirp</code>. The second line
adds an action listener to the button. The process of adding an action
listener to an object is also known as <em>registering</em> a listener on the
object. Note that the sole argument to this <code>addActionListener()</code> method
is a newly created <code>ActionListener</code> object. Inside this newly created
and anonymous <code>ActionListener</code> object, we implement the
<code>actionPerformed()</code> method. Whatever code we want to execute in response
to the clicking of the <code>chirp</code> button goes inside the
<code>actionPerformed()</code> method.</p>
</div>
<div class="paragraph">
<p>This syntax may look strange to you. <code>ActionListener</code> is an interface,
which cannot be instantiated. What is that <code>new</code> keyword doing? It&#8217;s
doing something pretty amazing by creating an instance of an <em>anonymous
class</em>. On the fly, we&#8217;re creating a class that has never existed
before. It doesn&#8217;t even have a name. All we know about it is that it
implements the interface <code>ActionListener</code>.</p>
</div>
<div class="paragraph">
<p>Note that there are braces after the constructor call, defining what&#8217;s
inside of this class. Inside, we have only created an
<code>actionPerformed()</code> method, but we could have created fields as well as
other methods. It&#8217;s a little ugly to create a whole new class and
instantiate it in the middle of calling the <code>addActionListener()</code>
method, but it&#8217;s also very convenient. We need to supply an object that
reacts to the event exactly the way we want it to. Since one doesn&#8217;t
exist yet, we have to create it. Of course, it is possible to supply any
object that implements the <code>ActionListener</code> interface, not just
instances of anonymous classes. For more information about nested
classes, inner classes, and anonymous classes, refer to
<a href="#_advanced_nested_classes">Section 9.5</a> and <a href="#_advanced_local_and_anonymous_classes">Section 10.4</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 113. GUI with actions</div>
<div class="content">
<div class="paragraph">
<p>We now modify <a href="#FrameWithPanelProgram">Program 54</a> to respond to button
clicks. When the <code>chirp</code> button is clicked, the program will display the
message &#8220;Chirp requested.&#8221; in the text field. Similarly, when the
<code>bark</code> button is clicked, the program will display &#8220;Bark requested.&#8221;</p>
</div>
<div class="paragraph">
<p><a href="#FrameWithPanelAndActionsProgram">Program 55</a> is largely the same as
<a href="#FrameWithPanelProgram">Program 54</a>. It adds the same buttons and text
field but then adds an action listener to each button. The action
performed when the <code>chirp</code> and <code>bark</code> buttons are clicked is to display
a message in the text box. When the <code>exit</code> button is clicked, the
listener displays a message on the console and exits the program.</p>
</div>
<div id="FrameWithPanelAndActionsProgram" class="listingblock">
<div class="title">Program 55. Demonstrates handling of action events.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FrameWithPanelAndActions</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
<span class="lineno"> 6 </span>        <span class="tok-kd">final</span> <span class="tok-n">JFrame</span> <span class="tok-n">soundCheck</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Sound Check&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>        <span class="tok-n">JPanel</span> <span class="tok-n">soundPanel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>        <span class="tok-n">JButton</span> <span class="tok-n">chirp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Chirp&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>        <span class="tok-n">JButton</span> <span class="tok-n">bark</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Bark&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>        <span class="tok-n">JButton</span> <span class="tok-n">exit</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Exit&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>        <span class="tok-kd">final</span> <span class="tok-n">JTextField</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JTextField</span><span class="tok-o">(</span>
<span class="lineno">12 </span>        	<span class="tok-s">&quot;Listen to nature!&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>        <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">chirp</span><span class="tok-o">);</span>
<span class="lineno">14 </span>        <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">bark</span><span class="tok-o">);</span>
<span class="lineno">15 </span>        <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
<span class="lineno">16 </span>        <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">exit</span><span class="tok-o">);</span>
<span class="lineno">17 </span>		<span class="tok-c1">// Add action listeners to various buttons</span>
<span class="lineno">18 </span>        <span class="tok-n">chirp</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActionListener</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">19 </span>            <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">20 </span>            	<span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Chirp requested.&quot;</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{chirpRequestedLine}@*/</span>
<span class="lineno">21 </span>            <span class="tok-o">}</span>
<span class="lineno">22 </span>        <span class="tok-o">});</span>
<span class="lineno">23 </span>        <span class="tok-n">bark</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActionListener</span><span class="tok-o">(){</span>
<span class="lineno">24 </span>            <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">25 </span>            	<span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Bark requested.&quot;</span><span class="tok-o">);</span>
<span class="lineno">26 </span>            <span class="tok-o">}</span>
<span class="lineno">27 </span>        <span class="tok-o">});</span>
<span class="lineno">28 </span>        <span class="tok-n">exit</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActionListener</span><span class="tok-o">(){</span>
<span class="lineno">29 </span>            <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">30 </span>                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Exit&quot;</span><span class="tok-o">);</span>
<span class="lineno">31 </span>                <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">dispose</span><span class="tok-o">();</span>
<span class="lineno">32 </span>            <span class="tok-o">}</span>
<span class="lineno">33 </span>        <span class="tok-o">});</span>
<span class="lineno">34 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">soundPanel</span><span class="tok-o">);</span>
<span class="lineno">35 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">350</span><span class="tok-o">,</span><span class="tok-mi">150</span><span class="tok-o">);</span>
<span class="lineno">36 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno">37 </span>        	<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">38 </span>        <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">39 </span>    <span class="tok-o">}</span>
<span class="lineno">40 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the sequence in which you add the buttons to the panel
determines the appearance of the GUI. The action listeners can be added
either before or after the panel has been set up but should be added
before the frame is made visible.</p>
</div>
<div class="paragraph">
<p>Do not be overly concerned with why the <code>final</code> keyword is used when
declaring <code>soundCheck</code> and <code>message</code>. You might be surprised that you
are even allowed to reference these local variables inside of the third
<code>ActionListener</code> class. An inner class has access to all the fields
inside of its outer class and access to local variables declared in the
same scope as the inner class. For technical reasons, any local variable
used in an anonymous inner class must be declared <code>final</code>. This
restriction does not apply to class variables.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.16">Exercise 15.16</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 114. GUI with alternate action listener style</div>
<div class="content">
<div class="paragraph">
<p>In the previous example we added an <code>ActionListener</code> object to each
button and implemented its <code>actionPerformed()</code> method with anonymous
inner classes. An alternate way to use <code>ActionListener</code> is to implement
<code>ActionListener</code> on the surrounding class and include an
<code>actionPerformed()</code> method exactly once instead of creating several
individual anonymous inner classes which each handle an event. Let&#8217;s
examine one such implementation in
<a href="#AlternateActionListenerProgram">Program 56</a> and contrast it with
<a href="#FrameWithPanelAndActionsProgram">Program 55</a>. Note that both programs
generate exactly the same GUI and exhibit identical behavior.</p>
</div>
<div id="AlternateActionListenerProgram" class="listingblock">
<div class="title">Program 56. Demonstrates handling of action events by implementing <code>ActionListener</code> at the class level.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AlternateActionListener</span> <span class="tok-kd">implements</span> <span class="tok-n">ActionListener</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>  <span class="tok-n">JFrame</span> <span class="tok-n">soundCheck</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Sound Check&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>  <span class="tok-n">JPanel</span> <span class="tok-n">soundPanel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>  <span class="tok-n">JButton</span> <span class="tok-n">chirpButton</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Bird&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>  <span class="tok-n">JButton</span> <span class="tok-n">barkButton</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Dog&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>  <span class="tok-n">JButton</span> <span class="tok-n">exitButton</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Exit&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>  <span class="tok-n">JTextField</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;Listen to nature!&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>  <span class="tok-kd">public</span> <span class="tok-nf">AlternateActionListener</span> <span class="tok-o">(){</span><span class="tok-cm">/*@\label{alternateActionListenerLine}@*/</span>
<span class="lineno">13 </span>    <span class="tok-n">chirpButton</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">14 </span>    <span class="tok-n">barkButton</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">15 </span>    <span class="tok-n">exitButton</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">16 </span>    <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">chirpButton</span><span class="tok-o">);</span>
<span class="lineno">17 </span>	<span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">barkButton</span><span class="tok-o">);</span>
<span class="lineno">18 </span>    <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
<span class="lineno">19 </span>	<span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">exitButton</span><span class="tok-o">);</span>
<span class="lineno">20 </span>    <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">soundPanel</span><span class="tok-o">);</span>
<span class="lineno">21 </span>    <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">,</span><span class="tok-mi">125</span><span class="tok-o">);</span>
<span class="lineno">22 </span>    <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno">23 </span>    	<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">24 </span>    <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">25 </span>  <span class="tok-o">}</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span><span class="tok-cm">/*@\label{actionPerformedLine}@*/</span>
<span class="lineno">28 </span>    <span class="tok-n">Object</span> <span class="tok-n">button</span> <span class="tok-o">=</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">();</span> <span class="tok-cm">/*@\label{identifyObjectLine}@*/</span>
<span class="lineno">29 </span>    <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">button</span> <span class="tok-o">==</span> <span class="tok-n">chirpButton</span><span class="tok-o">)</span>
<span class="lineno">30 </span>      <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Chirp requested.&quot;</span><span class="tok-o">);</span>
<span class="lineno">31 </span>    <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">button</span> <span class="tok-o">==</span> <span class="tok-n">barkButton</span><span class="tok-o">)</span>
<span class="lineno">32 </span>      <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Bark requested.&quot;</span><span class="tok-o">);</span>
<span class="lineno">33 </span>    <span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">34 </span>      <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Exit&quot;</span><span class="tok-o">);</span>
<span class="lineno">35 </span>      <span class="tok-n">soundCheck</span><span class="tok-o">.</span><span class="tok-na">dispose</span><span class="tok-o">();</span>
<span class="lineno">36 </span>    <span class="tok-o">}</span>
<span class="lineno">37 </span>  <span class="tok-o">}</span>
<span class="lineno">38 </span>
<span class="lineno">39 </span>  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
<span class="lineno">40 </span>    <span class="tok-k">new</span> <span class="tok-n">AlternateActionListener</span><span class="tok-o">();</span>
<span class="lineno">41 </span>  <span class="tok-o">}</span>
<span class="lineno">42 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In <a href="#AlternateActionListenerProgram">Program 56</a> class
<code>AlternateActionListener</code> implements <code>ActionListener</code>. Doing so requires
the class to include <code>actionPerformed()</code>. The constructor, starting at
line <a href="#alternateActionListenerLine">[alternateActionListenerLine]</a>, adds an <code>ActionListener</code> to each
button. The listener added is <code>this</code>, specifying that the
<code>AlternateActionListener</code> object is the one that will process any action
event generated by the buttons. The remainder of the code for the
constructor is essentially the same as that from the <code>main()</code> method in
<a href="#FrameWithPanelAndActionsProgram">Program 55</a>.</p>
</div>
<div class="paragraph">
<p>The <code>actionPerformed()</code> method, starting at
line <a href="#actionPerformedLine">[actionPerformedLine]</a>, has exactly one parameter, an
<code>ActionEvent</code> object. Whenever an action event occurs, its attributes
are bundled into an <code>ActionEvent</code> object and passed into the
<code>actionPerformed()</code> method. At line <a href="#identifyObjectLine">[identifyObjectLine]</a> the
<code>getSource()</code> method is used to determine which object is responsible
for the event. Variable <code>button</code> holds the object returned by
<code>getSource()</code>. The next <code>if</code> statement compares <code>button</code> with <code>chirp</code>
and <code>bark</code> to determine if either of these generated the event. Then a
suitable message is displayed in the <code>message</code> box. If neither button
generated the event, it must have been <code>exit</code>, and the frame disposes
itself after displaying &#8220;Exit&#8221; on the console.</p>
</div>
<div class="paragraph">
<p>The <code>main()</code> method simply creates an instance of
<code>AlternateActionListener</code> and terminates. The program does not end
because the threads for the GUI are still running.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>It is instructive to note the differences between
<a href="#FrameWithPanelAndActionsProgram">Program 55</a> and
<a href="#AlternateActionListenerProgram">Program 56</a>. In
<a href="#AlternateActionListenerProgram">Program 56</a>, most of the code has been
moved from the ` main()` method to the constructor. Various objects,
namely the <code>soundCheck</code> frame, the <code>soundPanel</code> panel, all three
buttons, and the text box are now fields of the object instead of local
variables in the <code>main()</code> method. This removes the need to mark
<code>soundCheck</code> and <code>message</code> as <code>final</code>.</p>
</div>
<div class="paragraph">
<p>We have examined two ways of adding an <code>ActionListener</code> to a Java
program. The choice of which style to use depends on your needs. Adding
an anonymous <code>ActionListener</code> to each object can require you to use the
<code>final</code> keyword to reference local variables, but it is otherwise quick
and easy. Using a named class (often the main program class or a
subclass of <code>JFrame</code>) as the <code>ActionListener</code> allows you to handle many
events in a centralized location. It can be easier to find errors when
all events are handled in one <code>actionPerformed()</code> method, but the method
can become long and complex as well.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.16">Exercise 15.16</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_code_mouselistener_code_interface">The <code>MouseListener</code> interface</h5>
<div class="paragraph">
<p>Clicking a button is great, but a mouse can be used to generate other
events too. For example, in a screen full of pictures, you might want to
highlight a picture when the cursor hovers over it. Or you might want to
create a drawing program which uses a mouse as a pen. To process general
mouse events, we need an object that implements the <code>MouseListener</code>
interface, which defines the following methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mouseClicked()</code></p>
</li>
<li>
<p><code>mouseEntered()</code></p>
</li>
<li>
<p><code>mouseExited()</code></p>
</li>
<li>
<p><code>mousePressed()</code></p>
</li>
<li>
<p><code>mouseReleased()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The function of each method is implied by its name. The <code>mouseEntered()</code>
event fires when the mouse cursor moves from outside of the area covered
by a widget into the area above it. Conversely, the <code>mouseExited()</code>
event fires when a mouse cursor was over a widget and has just moved
away. The <code>mousePressed()</code> event fires when a mouse button is pressed
over a widget. The <code>mouseReleased()</code> event fires when a mouse button is
released over a widget. The <code>mouseClicked()</code> event is a combination of
both the <code>mousePressed()</code> and <code>mouseReleased()</code> events, occurring only
if a mouse button was pressed and then released while the cursor was
over a widget. As you can see, a widget only fires events when the
cursor is over the component (or has just left). Thus, a widget only
reports events that have to do with it, not the general state of the
mouse.</p>
</div>
<div class="paragraph">
<p>Each method in <code>MouseListener</code> receives a <code>MouseEvent</code> object as its
argument. To handle mouse events, a class must implement the
<code>MouseListener</code> interface. This is similar to the implementation of the
<code>ActionListener</code> interface from the previous section, but implementing
<code>MouseListener</code> requires a definition for <strong>each</strong> of the five methods
listed above. The next example illustrates <code>MouseListener</code> in use.</p>
</div>
<div id="mouseListenerExample" class="exampleblock">
<div class="title">Example 115. Mouse listener</div>
<div class="content">
<div class="paragraph">
<p>We write a program that displays a GUI containing two buttons labeled
&#8220;One&#8221; and &#8220;Two.&#8221; In addition a text box displays a suitable message
when the cursor enters a button. When a button is clicked, the status
box should display the total number of times that button has been
clicked so far.</p>
</div>
<div class="paragraph">
<p><a href="#SimpleMouseEventsProgram">Program 57</a> generates the GUI shown in
<a href="#simpleMouseEventsFigure">Figure 57</a>. At
line <a href="#simpleMouseEventsClassDefLine">[simpleMouseEventsClassDefLine]</a> class <code>SimpleMouseEvents</code> is
declared, implementing the <code>MouseListener</code> interface. The following few
lines declare frame <code>frame</code>, buttons <code>one</code> and <code>two</code>, and a text box
<code>status</code>. Two integers <code>oneClicks</code> and <code>twoClicks</code> are initialized to 0
and are used to keep track of the number of times each button has been
clicked.</p>
</div>
<div id="SimpleMouseEventsProgram" class="listingblock">
<div class="title">Program 57. Demonstrates the handling of mouse generated events using the <code>MouseListener</code> interface.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SimpleMouseEvents</span> <span class="tok-kd">implements</span> <span class="tok-n">MouseListener</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{simpleMouseEventsClassDefLine}@*/</span>
<span class="lineno"> 6 </span>	<span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse Events&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>	<span class="tok-n">JTextField</span> <span class="tok-n">status</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JTextField</span><span class="tok-o">(</span>
<span class="lineno"> 8 </span>		<span class="tok-s">&quot;Mouse status comes here.&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>	<span class="tok-n">JButton</span> <span class="tok-n">one</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;One&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>	<span class="tok-n">JButton</span> <span class="tok-n">two</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Two&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>	<span class="tok-kt">int</span> <span class="tok-n">oneClicks</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">twoClicks</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-c1">//Number of clicks</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>    <span class="tok-kd">public</span> <span class="tok-nf">SimpleMouseEvents</span><span class="tok-o">()</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{simpleMouseEventsConstructorLine}@*/</span>
<span class="lineno">14 </span>        <span class="tok-n">JPanel</span> <span class="tok-n">panel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">();</span>
<span class="lineno">15 </span>        <span class="tok-n">one</span><span class="tok-o">.</span><span class="tok-na">addMouseListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">16 </span>        <span class="tok-n">two</span><span class="tok-o">.</span><span class="tok-na">addMouseListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">17 </span>        <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">one</span><span class="tok-o">);</span>
<span class="lineno">18 </span>        <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">two</span><span class="tok-o">);</span>
<span class="lineno">19 </span>        <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">status</span><span class="tok-o">);</span>
<span class="lineno">20 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">panel</span><span class="tok-o">);</span>
<span class="lineno">21 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">,</span><span class="tok-mi">100</span><span class="tok-o">);</span>
<span class="lineno">22 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno">23 </span>        	<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">24 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">25 </span>    <span class="tok-o">}</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span>    <span class="tok-c1">// Implement all abstract methods in MouseListener</span>
<span class="lineno">28 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseEntered</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-cm">/*@\label{mouseEnteredEventLine}@*/</span>
<span class="lineno">29 </span>	    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">one</span><span class="tok-o">)</span> <span class="tok-cm">/*@\label{getObjectEnteredLine}@*/</span>
<span class="lineno">30 </span>	        <span class="tok-n">status</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse enters One.&quot;</span><span class="tok-o">);</span>
<span class="lineno">31 </span>	    <span class="tok-k">else</span>
<span class="lineno">32 </span>	        <span class="tok-n">status</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse enters Two.&quot;</span><span class="tok-o">);</span>
<span class="lineno">33 </span>    <span class="tok-o">}</span>
<span class="lineno">34 </span>
<span class="lineno">35 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseClicked</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">36 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">one</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{getObjectClickedLine}@*/</span>
<span class="lineno">37 </span>			<span class="tok-n">oneClicks</span><span class="tok-o">++;</span>
<span class="lineno">38 </span>			<span class="tok-n">status</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;One clicked &quot;</span><span class="tok-o">+</span> <span class="tok-n">oneClicks</span> <span class="tok-o">+</span>
<span class="lineno">39 </span>				<span class="tok-s">&quot; times.&quot;</span><span class="tok-o">);</span>
<span class="lineno">40 </span>		<span class="tok-o">}</span>
<span class="lineno">41 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">42 </span>			<span class="tok-n">twoClicks</span><span class="tok-o">++;</span>
<span class="lineno">43 </span>			<span class="tok-n">status</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Two clicked &quot;</span><span class="tok-o">+</span> <span class="tok-n">twoClicks</span>  <span class="tok-o">+</span>
<span class="lineno">44 </span>				<span class="tok-s">&quot; times.&quot;</span><span class="tok-o">);</span>
<span class="lineno">45 </span>		<span class="tok-o">}</span>
<span class="lineno">46 </span>	<span class="tok-o">}</span>
<span class="lineno">47 </span>
<span class="lineno">48 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseExited</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{}</span> <span class="tok-cm">/*@\label{exitedNotImplementedLine}@*/</span>
<span class="lineno">49 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mousePressed</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">50 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseReleased</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">51 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
<span class="lineno">52 </span>		  <span class="tok-k">new</span> <span class="tok-n">SimpleMouseEvents</span><span class="tok-o">();</span>
<span class="lineno">53 </span>	<span class="tok-o">}</span>
<span class="lineno">54 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="simpleMouseEventsFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/simpleMouseEventsFigure.png" alt="simpleMouseEventsFigure" width="40%">
</div>
<div class="title">Figure 57. GUI consisting of two buttons and a text box. Button clicks and entry of the cursor into a button are reported by the text box.</div>
</div>
<div class="paragraph">
<p>The first line of the <code>SimpleMouseEvents</code> constructor creates the panel
<code>panel</code>. It does not need to be a field, and it is always preferable to
keep a variable local if it can be. The next two lines add a
<code>MouseListener</code> to the two buttons. Note the use of <code>this</code> in the
argument to <code>addMouseListener()</code> which refers to the object being
created by the constructor. Next, the panel is set up and added to the
frame. Finally the frame size and its default close operations are set,
and the frame is made visible.</p>
</div>
<div class="paragraph">
<p>Implementation of the methods in the <code>MouseListener</code> interface begins at
line <a href="#mouseEnteredEventLine">[mouseEnteredEventLine]</a>. The <code>mouseEntered()</code> method is invoked
when the cursor enters either of the two buttons. First we retrieve the
source of the event using the <code>getSource()</code> method and identify which
object generated the event. A suitable message is displayed in the
status box using the <code>setText()</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>mouseClicked()</code> method is invoked when the mouse cursor is placed
over a button and clicked. As before, we retrieve the source of the
event using the <code>getSource()</code> method. A suitable message, including the
number of clicks, is displayed in the text box. Of course, recording the
button clicks could have been done with an <code>ActionListener</code> instead.</p>
</div>
<div class="paragraph">
<p>The only job of the <code>main()</code> method is to create an instance of
<code>SimpleMouseEvents</code>. You may wish to compile and execute the program and
test whether or not the program behaves as described.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.8">Exercise 15.8</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mouse_adapter">Mouse adapter</h5>
<div class="paragraph">
<p>Creating a <code>MouseListener</code> requires all five methods in the interface to
be implemented. In some cases, as in <a href="#mouseListenerExample">Example 115</a>,
there is no need to implement all the methods because we are not
interested in all the corresponding events. In such situations we are
forced to include the methods without any statement in the method body.
However, you might want to include the methods only when they are
needed. The <code>MouseAdapter</code> abstract class helps us avoid implementing
methods we do not need.</p>
</div>
<div class="paragraph">
<p><code>MouseAdapter</code> is an abstract class, unlike the <code>MouseListener</code>
interface. The advantage of using <code>MouseAdapter</code> is that it already
provides a skeletal implementation of each method needed to process
mouse events. We can override these implementations as needed, and we do
not need to provide an implementation of a method that is not used.</p>
</div>
<div class="exampleblock">
<div class="title">Example 116. Mouse adapter</div>
<div class="content">
<div class="paragraph">
<p><a href="#SimpleMouseAdapterProgram">Program 58</a> is a revised version of
<a href="#SimpleMouseEventsProgram">Program 57</a>. At
line <a href="#simpleMouseAdapterClassDefLine">[simpleMouseAdapterClassDefLine]</a> class <code>SimpleMouseAdapter</code>
extends the abstract class <code>MouseAdapter</code>. Thus, it inherits all the
empty methods defined in <code>MouseAdapter</code>. We then override only the
implementations of the methods we want to use, <code>mouseEntered()</code> and
<code>mouseClicked()</code> in this example. Remember that an abstract class is
<strong>extended</strong> whereas an interface is <strong>implemented</strong>.</p>
</div>
<div id="SimpleMouseAdapterProgram" class="listingblock">
<div class="title">Program 58. Handles mouse generated events using the <code>MouseAdapter</code> abstract class.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SimpleMouseAdapter</span> <span class="tok-kd">extends</span> <span class="tok-n">MouseAdapter</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{simpleMouseAdapterClassDefLine}@*/</span>
<span class="lineno"> 6 </span>    <span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse Events&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>    <span class="tok-n">JTextField</span> <span class="tok-n">status</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JTextField</span><span class="tok-o">(</span>
<span class="lineno"> 8 </span>    	<span class="tok-s">&quot;Mouse status comes here.&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>    <span class="tok-n">JButton</span> <span class="tok-n">one</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;One&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>    <span class="tok-n">JButton</span> <span class="tok-n">two</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Two&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>    <span class="tok-kt">int</span> <span class="tok-n">oneClicks</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">twoClicks</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>    <span class="tok-kd">public</span> <span class="tok-nf">SimpleMouseAdapter</span> <span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>    	<span class="tok-n">JPanel</span> <span class="tok-n">panel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">();</span>
<span class="lineno">15 </span>        <span class="tok-n">one</span><span class="tok-o">.</span><span class="tok-na">addMouseListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">16 </span>        <span class="tok-n">two</span><span class="tok-o">.</span><span class="tok-na">addMouseListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">17 </span>        <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">one</span><span class="tok-o">);</span>
<span class="lineno">18 </span>        <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">two</span><span class="tok-o">);</span>
<span class="lineno">19 </span>        <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">status</span><span class="tok-o">);</span>
<span class="lineno">20 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">panel</span><span class="tok-o">);</span>
<span class="lineno">21 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">,</span><span class="tok-mi">100</span><span class="tok-o">);</span>
<span class="lineno">22 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno">23 </span>        	<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">24 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">25 </span>    <span class="tok-o">}</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span>    <span class="tok-c1">// Override only those methods we wants</span>
<span class="lineno">28 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseEntered</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-cm">/*@\label{implementMouseEnteredLine}@*/</span>
<span class="lineno">29 </span>	    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">one</span><span class="tok-o">)</span>
<span class="lineno">30 </span>	        <span class="tok-n">status</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse enters One.&quot;</span><span class="tok-o">);</span>
<span class="lineno">31 </span>	    <span class="tok-k">else</span>
<span class="lineno">32 </span>	        <span class="tok-n">status</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse enters Two.&quot;</span><span class="tok-o">);</span>
<span class="lineno">33 </span>    <span class="tok-o">}</span>
<span class="lineno">34 </span>
<span class="lineno">35 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseClicked</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{implementMouseClickedLine}@*/</span>
<span class="lineno">36 </span>    	<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">one</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">37 </span>			<span class="tok-n">oneClicks</span><span class="tok-o">++;</span>
<span class="lineno">38 </span>			<span class="tok-n">status</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;One clicked &quot;</span><span class="tok-o">+</span> <span class="tok-n">oneClicks</span> <span class="tok-o">+</span>
<span class="lineno">39 </span>				<span class="tok-s">&quot; times.&quot;</span><span class="tok-o">);</span>
<span class="lineno">40 </span>		<span class="tok-o">}</span>
<span class="lineno">41 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">42 </span>			<span class="tok-n">twoClicks</span><span class="tok-o">++;</span>
<span class="lineno">43 </span>			<span class="tok-n">status</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Two clicked &quot;</span><span class="tok-o">+</span> <span class="tok-n">twoClicks</span>  <span class="tok-o">+</span>
<span class="lineno">44 </span>				<span class="tok-s">&quot; times.&quot;</span><span class="tok-o">);</span>
<span class="lineno">45 </span>		<span class="tok-o">}</span>
<span class="lineno">46 </span>    <span class="tok-o">}</span>
<span class="lineno">47 </span>
<span class="lineno">48 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
<span class="lineno">49 </span>      <span class="tok-k">new</span> <span class="tok-n">SimpleMouseAdapter</span> <span class="tok-o">();</span>
<span class="lineno">50 </span>    <span class="tok-o">}</span>
<span class="lineno">51 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.3">Exercise 15.3</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_event_listeners">Other event listeners</h5>
<div class="paragraph">
<p>In this chapter we describe two types of listeners in Java,
<code>ActionListener</code> and <code>MouseListener</code>. You may have noticed that none of
the mouse events we discussed involved the movement of the mouse inside
of the component, only whether it was entering or exiting the component.
Because tracking mouse movement is more computationally expensive than
tracking presses, releases, enters, and exits, Java uses yet another
listener to handle mouse movement, <code>MouseMotionListener</code>. It contains
the methods <code>mouseDragged()</code> and <code>mouseMoved()</code>, which are used to
handle mouse movement with or without the button pressed.</p>
</div>
<div class="paragraph">
<p>An <code>ItemListener</code> can be attached to a widget such as a check box or a
radio button to listen for a check box to be selected. This listener is
illustrated in <a href="#subsection:Applets">Section 15.3.7</a>.</p>
</div>
<div class="paragraph">
<p>Java provides several other listeners to handle a variety of events. For
example, the <code>DocumentListener</code> can be attached to a <code>JTextField</code> or a
<code>JTextArea</code> object to listen to document events, which include the
<code>insertUpdate()</code> event that is fired when a character is inserted the
text box. A <code>KeyListener</code> can also be attached to text boxes to listen
to key events such as the return key being typed, which can have similar
functionality. These events could be useful while writing a text editor
application, for example.</p>
</div>
<div class="paragraph">
<p>After you have mastered the contents of this chapter, you may plan to
write more complex GUIs than the ones we discuss. For further
information, you may wish to follow the Java tutorial on writing event
listeners provided by Oracle at
<a href="http://download.oracle.com/javase/tutorial/uiswing/events/index.html" class="bare">http://download.oracle.com/javase/tutorial/uiswing/events/index.html</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_sounds_and_images">15.3.4. Adding sounds and images</h4>
<div class="paragraph">
<p>Sounds and images can also be added to a Java GUI application. While
Java offers a rich set of sound APIs, we restrict our examples to
playing sound clips from audio files that come in <code>au</code> or <code>wav</code> formats.
We also introduce the <code>ImageIcon</code> class to create icons from image
files.</p>
</div>
<div class="sect4">
<h5 id="_sounds">Sounds</h5>
<div class="paragraph">
<p>First, let&#8217;s see how to define an audio clip.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">AudioClip</span> <span class="tok-n">chirpClip</span> <span class="tok-o">=</span> <span class="tok-n">Applet</span><span class="tok-o">.</span><span class="tok-na">newAudioClip</span><span class="tok-o">(</span><span class="tok-n">chirpURL</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement declares <code>chirpClip</code> with type <code>AudioClip</code>. It
instantiates <code>chirpClip</code> using the <code>newAudioClip()</code> method found in the
<code>Applet</code> class in the <code>java.applet</code> package. Note that the argument to
the <code>newAudioClip()</code> method is an object of type <code>URL</code>. URL stands for
<em>universal resource locator</em>. It serves as a web address from which
files can be retrieved. A <code>URL</code> object can be defined as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">URL</span> <span class="tok-n">chirpURL</span> <span class="tok-o">=</span>
    <span class="tok-k">new</span> <span class="tok-n">URL</span><span class="tok-o">(</span><span class="tok-s">&quot;http://users.etown.edu/w/wittmanb/chirp.wav&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Above we specify the full URL to access an audio file named <code>chirp.wav</code>.
Alternately you can give the file name from a local directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">URL</span> <span class="tok-n">chirpURL</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">URL</span><span class="tok-o">(</span><span class="tok-s">&quot;file:sounds/chirp.wav&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The prefix <code>file:</code> indicates that the <code>chirp.wav</code> file is in a local
directory. Once a clip has been declared and loaded, it can be played as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">chirpClip</span><span class="tok-o">.</span><span class="tok-na">play</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will play the clip in <code>chirpClip</code> loaded from the specified
URL, exactly once. If you want to play the clip in a loop, use the
<code>loop()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">chirpClip</span><span class="tok-o">.</span><span class="tok-na">loop</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To stop a clip from playing, use the <code>stop()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">chirpClip</span><span class="tok-o">.</span><span class="tok-na">stop</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have seen how to declare, load, play, and stop an audio
clip, we are ready to write a more interesting version of
<a href="#FrameWithPanelAndActionsProgram">Program 55</a>.</p>
</div>
<div id="soundGameExample" class="exampleblock">
<div class="title">Example 117. Sound game</div>
<div class="content">
<div class="paragraph">
<p>We can rewrite <a href="#FrameWithPanelAndActionsProgram">Program 55</a> so that the
new program plays the sound clips in a loop when the corresponding
button is clicked. Think of the new program as a Java version of the
pull-string toys that children use to play animal sounds. Our program
only has two sounds, but more could be added.</p>
</div>
<div id="soundGameFigures" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/soundGameFigures.svg" alt="soundGameFigures" width="80%">
</div>
<div class="title">Figure 58. GUI for the sound game application. (a) On program start. (b) After the &#8220;Chirp&#8221; button has been clicked and the clip is playing.</div>
</div>
<div class="paragraph">
<p>We will add a new button labeled &#8220;Stop Sound&#8221; that stops the playback
of sounds when clicked. Let&#8217;s assume that this program is only allowed
to play one sound at a time. When it starts, the GUI will look like
<a href="#soundGameFigures">Figure 58</a>(a). Note that the <code>stop</code> button is gray,
indicating that it is disabled.</p>
</div>
<div class="paragraph">
<p>The complete program for the game is shown in
<a href="#SoundGameProgram">[SoundGameProgram]</a>. Because most of this program is similar
to <a href="#FrameWithPanelProgram">Program 54</a>, we will only look at the
differences. The action listeners for the <code>chirp</code> and <code>bark</code> buttons are
called when these two buttons are clicked. On line <a href="#buttonDisableLine">[buttonDisableLine]</a>
we disable the <code>bark</code> button when the bird chirp sound is playing. Also,
on line <a href="#buttonEnableLine">[buttonEnableLine]</a> we enable the <code>stop</code> button so that the
user can stop the chirp sound. Note that the <code>stop</code> button begins
disabled and remains that way until a sound is played. The GUI now looks
like <a href="#soundGameFigures">Figure 58</a>(b).</p>
</div>
<div id="pSoundGameProgram" class="listingblock">
<div class="title">Program 59. Animal sound game.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.applet.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span><span class="tok-kn">import</span> <span class="tok-nn">java.net.URL</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SoundGame</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">final</span> <span class="tok-n">JFrame</span> <span class="tok-n">soundGame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Sound Game&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>    <span class="tok-n">JPanel</span> <span class="tok-n">soundPanel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">();</span>
<span class="lineno">10 </span>    <span class="tok-kd">final</span> <span class="tok-n">JButton</span> <span class="tok-n">chirp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Chirp&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>    <span class="tok-kd">final</span> <span class="tok-n">JButton</span> <span class="tok-n">bark</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Bark&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>    <span class="tok-kd">final</span> <span class="tok-n">JButton</span> <span class="tok-n">stop</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Stop Sound&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>    <span class="tok-kd">final</span> <span class="tok-n">JButton</span> <span class="tok-n">exit</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Exit&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>    <span class="tok-kd">final</span> <span class="tok-n">JTextField</span> <span class="tok-n">message</span> <span class="tok-o">=</span>
<span class="lineno">15 </span>    	<span class="tok-k">new</span> <span class="tok-n">JTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;Click Chirp or Bark.   &quot;</span><span class="tok-o">);</span>
<span class="lineno">16 </span>    <span class="tok-n">URL</span> <span class="tok-n">chirpURL</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">URL</span><span class="tok-o">(</span><span class="tok-s">&quot;file:sounds/chirp.wav&quot;</span><span class="tok-o">);</span>
<span class="lineno">17 </span>    <span class="tok-n">URL</span> <span class="tok-n">barkURL</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">URL</span><span class="tok-o">(</span><span class="tok-s">&quot;file:sounds/bark.wav&quot;</span><span class="tok-o">);</span>
<span class="lineno">18 </span>    <span class="tok-kd">final</span> <span class="tok-n">AudioClip</span> <span class="tok-n">chirpClip</span> <span class="tok-o">=</span> <span class="tok-n">Applet</span><span class="tok-o">.</span><span class="tok-na">newAudioClip</span><span class="tok-o">(</span><span class="tok-n">chirpURL</span><span class="tok-o">);</span>
<span class="lineno">19 </span>    <span class="tok-kd">final</span> <span class="tok-n">AudioClip</span> <span class="tok-n">barkClip</span> <span class="tok-o">=</span> <span class="tok-n">Applet</span><span class="tok-o">.</span><span class="tok-na">newAudioClip</span><span class="tok-o">(</span><span class="tok-n">barkURL</span><span class="tok-o">);</span>
<span class="lineno">20 </span>    <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">chirp</span><span class="tok-o">);</span>
<span class="lineno">21 </span>    <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">bark</span><span class="tok-o">);</span>
<span class="lineno">22 </span>    <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">stop</span><span class="tok-o">);</span>
<span class="lineno">23 </span>    <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">exit</span><span class="tok-o">);</span>
<span class="lineno">24 </span>    <span class="tok-n">soundPanel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
<span class="lineno">25 </span>    <span class="tok-n">soundGame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">soundPanel</span><span class="tok-o">);</span>
<span class="lineno">26 </span>    <span class="tok-n">stop</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{stopButtonDisableLine}@*/</span>
<span class="lineno">27 </span>    <span class="tok-n">chirp</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActionListener</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">28 </span>      <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">29 </span>        <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Chirp sound playing.&quot;</span><span class="tok-o">);</span>
<span class="lineno">30 </span>        <span class="tok-n">bark</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>  <span class="tok-cm">/*@\label{buttonDisableLine}@*/</span>
<span class="lineno">31 </span>        <span class="tok-n">chirpClip</span><span class="tok-o">.</span><span class="tok-na">loop</span><span class="tok-o">();</span> <span class="tok-cm">/*@\label{soundPlayLine}@*/</span>
<span class="lineno">32 </span>        <span class="tok-n">stop</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{buttonEnableLine}@*/</span>
<span class="lineno">33 </span>      <span class="tok-o">}</span>
<span class="lineno">34 </span>    <span class="tok-o">});</span>
<span class="lineno">35 </span>    <span class="tok-n">bark</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActionListener</span><span class="tok-o">(){</span>
<span class="lineno">36 </span>      <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">37 </span>        <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Bark sound playing.&quot;</span><span class="tok-o">);</span>
<span class="lineno">38 </span>        <span class="tok-n">chirp</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">39 </span>        <span class="tok-n">barkClip</span><span class="tok-o">.</span><span class="tok-na">loop</span><span class="tok-o">();</span>
<span class="lineno">40 </span>        <span class="tok-n">stop</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">41 </span>      <span class="tok-o">}</span>
<span class="lineno">42 </span>    <span class="tok-o">});</span>
<span class="lineno">43 </span>    <span class="tok-n">stop</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActionListener</span><span class="tok-o">(){</span>
<span class="lineno">44 </span>      <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">45 </span>        <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Click Chirp or Bark.&quot;</span><span class="tok-o">);</span>
<span class="lineno">46 </span>        <span class="tok-n">chirpClip</span><span class="tok-o">.</span><span class="tok-na">stop</span><span class="tok-o">();</span>
<span class="lineno">47 </span>        <span class="tok-n">bark</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">48 </span>        <span class="tok-n">barkClip</span><span class="tok-o">.</span><span class="tok-na">stop</span><span class="tok-o">();</span>
<span class="lineno">49 </span>        <span class="tok-n">chirp</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">50 </span>        <span class="tok-n">stop</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">51 </span>      <span class="tok-o">}</span>
<span class="lineno">52 </span>    <span class="tok-o">});</span>
<span class="lineno">53 </span>    <span class="tok-n">exit</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActionListener</span><span class="tok-o">(){</span>
<span class="lineno">54 </span>      <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">55 </span>        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Exit&quot;</span><span class="tok-o">);</span>
<span class="lineno">56 </span>        <span class="tok-n">soundGame</span><span class="tok-o">.</span><span class="tok-na">dispose</span><span class="tok-o">();</span>
<span class="lineno">57 </span>      <span class="tok-o">}</span>
<span class="lineno">58 </span>    <span class="tok-o">});</span>
<span class="lineno">59 </span>    <span class="tok-n">soundGame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">175</span><span class="tok-o">,</span><span class="tok-mi">175</span><span class="tok-o">);</span> <span class="tok-c1">//Set size in pixels</span>
<span class="lineno">60 </span>    <span class="tok-n">soundGame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno">61 </span>    	<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">62 </span>    <span class="tok-n">soundGame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span> <span class="tok-c1">//Display it</span>
<span class="lineno">63 </span>  <span class="tok-o">}</span>
<span class="lineno">64 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The actions for the <code>bark</code> button are very similar to the actions for
the <code>chirp</code> button, but the actions for <code>stop</code> are different. When
<code>stop</code> is clicked, the action listener does not know which sound is
playing. For that reason, it stops both sounds and then disables the
stop button. An exercise asks you to modify the program so that the
action listener associated with the <code>stop</code> button knows which sound is
playing.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.11">Exercise 15.11</a><br>
<a href="#exercise15.12">Exercise 15.12</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_images_and_icons">Images and icons</h5>
<div class="paragraph">
<p>Images are often useful when creating GUIs. In this section we show you
how to use images to create icons and then use the icon to decorate
buttons and labels. First, let&#8217;s see how an icon object can be created.
Suppose we have a picture file named <code>smile.jpg</code> in a directory named
<code>pictures</code>. Note that the <code>pictures</code> directory should be located in same
directory as the class files for the program. The following statement
creates an object of type <code>ImageIcon</code> from this picture.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ImageIcon</span> <span class="tok-n">smileIcon</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ImageIcon</span><span class="tok-o">(</span><span class="tok-s">&quot;pictures/smile.jpg&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the file name, along with its path, is passed to the
<code>ImageIcon</code> constructor as a string. Now we can add the image to a
button.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JButton</span> <span class="tok-n">smile</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">();</span>
<span class="tok-n">smile</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">smileIcon</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly you can add an image icon to a label. The next example gives a
simple program that creates a button with an image.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.10">Exercise 15.10</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 118. Icon example</div>
<div class="content">
<div class="paragraph">
<p><a href="#IconExampleFigure">Figure 59</a> shows a GUI with a button decorated with a
picture. <a href="#IconExampleProgram">Program 60</a> gives the code to create this
GUI using the <code>ImageIcon</code> class.</p>
</div>
<div id="IconExampleFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/iconExampleFigure.png" alt="iconExampleFigure" width="40%">
</div>
<div class="title">Figure 59. A GUI with a button decorated by an image icon.</div>
</div>
<div class="paragraph">
<p>As explained earlier, an image icon is created at
line <a href="#iconCreationLine">[iconCreationLine]</a> from a JPEG file named <code>smile.jpg</code> located in
the <code>pictures</code> directory. The following line creates a button named
<code>smile</code> and decorates it with the icon by supplying it as an argument to
the <code>JButton</code> constructor. Note that, if the file cannot be found, the
program will fail <em>quietly</em>. This means that no exception is thrown.
Instead, the button will appear with no image. Subsequent lines add the
button to the frame, set the frame size and its default close operation,
and make the frame visible.</p>
</div>
<div id="IconExampleProgram" class="listingblock">
<div class="title">Program 60. Creates a GUI with a button decorated by a picture.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">IconExample</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>	<span class="tok-n">JFrame</span> <span class="tok-n">iconFrame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Icon Example&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>	<span class="tok-n">ImageIcon</span> <span class="tok-n">smileIcon</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ImageIcon</span><span class="tok-o">(</span><span class="tok-cm">/*@\label{iconCreationLine}@*/</span>
<span class="lineno"> 8 </span>		<span class="tok-s">&quot;pictures/smile.jpg&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>	<span class="tok-n">JButton</span>  <span class="tok-n">smile</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-n">smileIcon</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{adIconToButtonLine}@*/</span>
<span class="lineno">10 </span>	<span class="tok-n">iconFrame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">smile</span><span class="tok-o">);</span>
<span class="lineno">11 </span>	<span class="tok-n">iconFrame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">325</span><span class="tok-o">,</span><span class="tok-mi">250</span><span class="tok-o">);</span>
<span class="lineno">12 </span>	<span class="tok-n">iconFrame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno">13 </span>		<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">14 </span>	<span class="tok-n">iconFrame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">15 </span>  <span class="tok-o">}</span>
<span class="lineno">16 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.9">Exercise 15.9</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_labels_icons_and_text">Labels, icons, and text</h5>
<div class="paragraph">
<p>In some applications you might want to show a picture with an attached
text label. For example, in a shopping cart for an online clothing
store, you might have seen pictures of clothes, each labeled with a name
and a price. The <code>JLabel</code> class is flexible, able to display text alone,
an image alone, or both. Note that a <code>JLabel</code> is only for displaying
information and is incapable of firing events or reading user input.</p>
</div>
<div class="paragraph">
<p>Here are three different ways to create a label.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ImageIcon</span> <span class="tok-n">hibiscus</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ImageIcon</span><span class="tok-o">(</span><span class="tok-s">&quot;pictures/hibiscus.jpg&quot;</span><span class="tok-o">)</span>
<span class="tok-n">JLabel</span> <span class="tok-n">textOnly</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;Text only&quot;</span><span class="tok-o">);</span>
<span class="tok-n">JLabel</span> <span class="tok-n">flower</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-n">hibiscus</span><span class="tok-o">);</span>
<span class="tok-n">JLabel</span> <span class="tok-n">labeledflower</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;Red Hibiscus&quot;</span><span class="tok-o">,</span> <span class="tok-n">hibiscus</span><span class="tok-o">,</span> <span class="tok-n">JLabel</span><span class="tok-o">.</span><span class="tok-na">CENTER</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first <code>JLabel</code> constructor above creates a label displaying only
text, namely, &#8220;Text only.&#8221; The second constructor creates a label
decorated with an icon created from a picture. The third constructor
creates a label with the same icon and additional text. Note the last
argument in this third case. <code>JLabel.CENTER</code> is a constant that
specifies that the content of the label (both the image and the text)
should be placed horizontally in the center of the label. A horizontal
alignment of left or right can also be specified using the constants
<code>JLabel.LEFT</code> or <code>JLabel.RIGHT</code>, respectively. These three horizontal
alignment indicators are some of the many constants found in Swing.</p>
</div>
<div class="paragraph">
<p>Sometimes you might want to place the text below the icon that decorates
the label. This can be done as follows by setting the horizontal and
vertical positions of the text.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">flower</span><span class="tok-o">.</span><span class="tok-na">setVerticalTextPosition</span><span class="tok-o">(</span><span class="tok-n">JLabel</span><span class="tok-o">.</span><span class="tok-na">BOTTOM</span><span class="tok-o">);</span>
<span class="tok-n">flower</span><span class="tok-o">.</span><span class="tok-na">setHorizontalTextPosition</span><span class="tok-o">(</span><span class="tok-n">JLabel</span><span class="tok-o">.</span><span class="tok-na">CENTER</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 119. Label example</div>
<div class="content">
<div class="paragraph">
<p><a href="#labelExampleFigure">Figure 60</a>(a) is generated by executing Program 
<a href="#LabelExampleProgram">Program 61</a>. You will see the GUI shown in
<a href="#labelExampleFigure">Figure 60</a>(b) if the alignment instructions at
lines <a href="#verticalTextPositioningLine">[verticalTextPositioningLine]</a> and
<a href="#horizontalTextPositioningLine">[horizontalTextPositioningLine]</a> are omitted.</p>
</div>
<div id="labelExampleFigure" class="imageblock">
<div class="content">
<img src="chapters/15-gui/images/labelExampleFigure.svg" alt="labelExampleFigure" width="100%">
</div>
<div class="title">Figure 60. (a) A GUI with a label decorated by an image icon and a title beneath it. (b) The GUI with unaligned text.</div>
</div>
<div id="LabelExampleProgram" class="listingblock">
<div class="title">Program 61. Creates a GUI with a label decorated by a picture and text.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LabelExample</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Label Example&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">ImageIcon</span> <span class="tok-n">hibiscus</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ImageIcon</span><span class="tok-o">(</span>
<span class="lineno"> 8 </span>			<span class="tok-s">&quot;pictures/hibiscus.jpg&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-n">JLabel</span> <span class="tok-n">flower</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;Red Hibiscus&quot;</span><span class="tok-o">,</span>
<span class="lineno">10 </span>			<span class="tok-n">hibiscus</span><span class="tok-o">,</span> <span class="tok-n">JLabel</span><span class="tok-o">.</span><span class="tok-na">CENTER</span><span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-n">flower</span><span class="tok-o">.</span><span class="tok-na">setVerticalTextPosition</span><span class="tok-o">(</span><span class="tok-n">JLabel</span><span class="tok-o">.</span><span class="tok-na">BOTTOM</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{verticalTextPositioningLine}@*/</span>
<span class="lineno">12 </span>		<span class="tok-n">flower</span><span class="tok-o">.</span><span class="tok-na">setHorizontalTextPosition</span><span class="tok-o">(</span><span class="tok-n">JLabel</span><span class="tok-o">.</span><span class="tok-na">CENTER</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{horizontalTextPositioningLine}@*/</span>
<span class="lineno">13 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">flower</span><span class="tok-o">);</span>
<span class="lineno">14 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">300</span><span class="tok-o">,</span><span class="tok-mi">250</span><span class="tok-o">);</span>
<span class="lineno">15 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno">16 </span>			<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">17 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">18 </span>  <span class="tok-o">}</span>
<span class="lineno">19 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_layout_managers">15.3.5. Layout managers</h4>
<div class="paragraph">
<p>Java provides a number of <em>layout managers</em> to assist with the design of
GUIs. A layout manager is an object that controls the placement of
widgets on a frame or panel. Every container has a default layout
manager, but it is possible to set it to other ones. In this section we
will introduce the three layout managers <code>FlowLayout</code>, <code>GridLayout</code>, and
<code>BorderLayout</code>. Java also provides several other layout managers, each
designed for different layouts.</p>
</div>
<div class="sect4">
<h5 id="_code_flowlayout_code"><code>FlowLayout</code></h5>
<div class="paragraph">
<p>The <code>FlowLayout</code> manager is one of simplest layout managers. When a
container is using the <code>FlowLayout</code> manager, widgets will be added in
order from left to right. When there is no more space, subsequent
widgets will be added starting on the next row. In addition, each row of
components is centered within the container. The <code>JPanel</code> container uses
<code>FlowLayout</code> by default, but it is possible to set it explicitly as
well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JPanel</span> <span class="tok-n">panel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FlowLayout</span><span class="tok-o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we have added more than one widget to a <code>JFrame</code> in previous
examples, we have first added them to a <code>JPanel</code>. The reason we have
done so is because <code>FlowLayout</code> is the default layout manager for
<code>JPanel</code> containers. Although every <code>JFrame</code> has a container, it uses
the <code>BorderLayout</code> manager by default, which would have complicated our
examples. The next example illustrates <code>FlowLayout</code> further.</p>
</div>
<div class="exampleblock">
<div class="title">Example 120. FlowLayout</div>
<div class="content">
<div class="paragraph">
<p><a href="#FlowLayoutExampleProgram">Program 62</a> creates a GUI with several
buttons. It first creates a frame. At line <a href="#setLayoutManagerLine">[setLayoutManagerLine]</a> it
creates a panel and set its layout manager to <code>FlowLayout</code>. Then, it
uses a <code>for</code> loop to create a new button, label it appropriately, and
add it to the panel.</p>
</div>
<div class="paragraph">
<p>The <code>Flowlayout</code> manager neatly places the buttons along a number of
rows depending on the width of the frame. The GUI created is shown in
<a href="#FlowLayoutExampleFigure">Figure 61</a>. Run the program and resize
the frame to see the effect on the layout of the buttons.</p>
</div>
<div id="FlowLayoutExampleProgram" class="listingblock">
<div class="title">Program 62. Adds several buttons using <code>FlowLayout</code>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FlowLayoutExample</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>    <span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;FlowLayout Example&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>    <span class="tok-n">JPanel</span> <span class="tok-n">panel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FlowLayout</span><span class="tok-o">());</span>  <span class="tok-cm">/*@\label{setLayoutManagerLine}@*/</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">MAX_BUTTONS</span> <span class="tok-o">=</span> <span class="tok-mi">6</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>    <span class="tok-k">for</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">MAX_BUTTONS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
<span class="lineno">10 </span>    	<span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;   &quot;</span> <span class="tok-o">+</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-s">&quot;   &quot;</span><span class="tok-o">));</span><span class="tok-cm">/*@\label{createAButtonLine}@*/</span>
<span class="lineno">11 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">panel</span><span class="tok-o">);</span>
<span class="lineno">12 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">250</span><span class="tok-o">,</span><span class="tok-mi">100</span><span class="tok-o">);</span>
<span class="lineno">13 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setResizable</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{disableResizableLine}@*/</span>
<span class="lineno">14 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span><span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">15 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">16 </span>  <span class="tok-o">}</span>
<span class="lineno">17 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="FlowLayoutExampleFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/flowLayoutExampleFigure.png" alt="flowLayoutExampleFigure" width="40%">
</div>
<div class="title">Figure 61. Using the <code>FlowLayout</code> manager to generate a GUI containing six buttons.</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.18">Exercise 15.18</a><br>
<a href="#exercise15.19">Exercise 15.19</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_gridlayout_code"><code>GridLayout</code></h5>
<div class="paragraph">
<p>The <code>GridLayout</code> manager lays out components in a grid with a set number
of rows and columns. As with other layout managers, <code>GridLayout</code> can be
applied to frames and panels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Grid Layout&quot;</span><span class="tok-o">);</span>
<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setLayout</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GridLayout</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This snippet creates a frame named <code>frame</code> and sets its layout manager
to <code>GridLayout</code>. The first two arguments to <code>GridLayout</code> give the number
of rows and columns, respectively. The last two arguments give the
horizontal and vertical gaps between the neighboring cells in the grid.
In this example the frame will contain a total of six cells organized
into three rows with two columns.</p>
</div>
<div id="gridLayoutLToRFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/gridLayoutLToRFigure.png" alt="gridLayoutLToRFigure" width="40%">
</div>
<div class="title">Figure 62. A 3 × 2 grid layout containing six buttons using left to right orientation.</div>
</div>
<div class="paragraph">
<p><a href="#gridLayoutLToRFigure">Figure 62</a> shows how <code>frame</code> will look after six
buttons, labeled 0 through 5, have been added to it in that order. A key
feature of using a <code>GridLayout</code> is that all cells in the grid will be
the same size and will stretch to fill the entire container. Also note
the equal spacing between the neighboring cells. It is possible to add
more or fewer cells than specified in the <code>GridLayout</code> constructor, but
the layout manager will be forced to guess at your intentions.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.20">Exercise 15.20</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 121. Animal identifier</div>
<div class="content">
<div class="paragraph">
<p>We can write a program to displays pictures of animals and identify
which animal the mouse is current hovering over. The animal&#8217;s name will
be displayed in the title of the frame.
<a href="#animalIdentifierFigure">Figure 63</a> shows this GUI.</p>
</div>
<div id="animalIdentifierFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/animalIdentifierFigure.png" alt="animalIdentifierFigure" width="40%">
</div>
<div class="title">Figure 63. A GUI for an animal identifier. Note that the bison is identified according to the frame title.</div>
</div>
<div class="paragraph">
<p><a href="#AnimalIdentifierProgram">Program 63</a> creates the GUI shown in
<a href="#animalIdentifierFigure">Figure 63</a>. Class <code>AnimalIdentifier</code> declares
four labels and a frame as fields. The labels are named <code>bison</code>, <code>dove</code>,
<code>gecko</code>, and <code>spider</code>.</p>
</div>
<div id="AnimalIdentifierProgram" class="listingblock">
<div class="title">Program 63. Identifies which animal is in various images when the mouse hovers over the image. Images are laid out using a <code>GridLayout</code> manager.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AnimalIdentifier</span> <span class="tok-kd">implements</span> <span class="tok-n">MouseListener</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>  <span class="tok-n">JLabel</span> <span class="tok-n">bison</span><span class="tok-o">,</span> <span class="tok-n">dove</span><span class="tok-o">,</span> <span class="tok-n">gecko</span><span class="tok-o">,</span> <span class="tok-n">spider</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>  <span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Animal Identifier: Bison&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>  <span class="tok-kd">public</span> <span class="tok-nf">AnimalIdentifier</span><span class="tok-o">()</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{PicIdentifierConstructorLine}@*/</span>
<span class="lineno">10 </span>	<span class="tok-n">JPanel</span> <span class="tok-n">panel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GridLayout</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">2</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">,</span><span class="tok-mi">5</span><span class="tok-o">));</span>
<span class="lineno">11 </span>    <span class="tok-n">ImageIcon</span> <span class="tok-n">bisonIcon</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ImageIcon</span><span class="tok-o">(</span><span class="tok-s">&quot;pictures/bison.jpg&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>    <span class="tok-n">ImageIcon</span> <span class="tok-n">doveIcon</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ImageIcon</span><span class="tok-o">(</span><span class="tok-s">&quot;pictures/dove.jpg&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>    <span class="tok-n">ImageIcon</span> <span class="tok-n">geckoIcon</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ImageIcon</span><span class="tok-o">(</span><span class="tok-s">&quot;pictures/gecko.jpg&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>    <span class="tok-n">ImageIcon</span> <span class="tok-n">spiderIcon</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ImageIcon</span><span class="tok-o">(</span><span class="tok-s">&quot;pictures/spider.jpg&quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>    <span class="tok-n">bison</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-n">bisonIcon</span><span class="tok-o">);</span>
<span class="lineno">16 </span>    <span class="tok-n">bison</span><span class="tok-o">.</span><span class="tok-na">addMouseListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{buttonDecoratorLine}@*/</span>
<span class="lineno">17 </span>    <span class="tok-n">dove</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-n">doveIcon</span><span class="tok-o">);</span>
<span class="lineno">18 </span>    <span class="tok-n">dove</span><span class="tok-o">.</span><span class="tok-na">addMouseListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">19 </span>    <span class="tok-n">gecko</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-n">geckoIcon</span><span class="tok-o">);</span>
<span class="lineno">20 </span>    <span class="tok-n">gecko</span><span class="tok-o">.</span><span class="tok-na">addMouseListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">21 </span>    <span class="tok-n">spider</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-n">spiderIcon</span><span class="tok-o">);</span>
<span class="lineno">22 </span>    <span class="tok-n">spider</span><span class="tok-o">.</span><span class="tok-na">addMouseListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">23 </span>    <span class="tok-c1">// Add labels</span>
<span class="lineno">24 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">bison</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{prepareButtonPanelLine}@*/</span>
<span class="lineno">25 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">dove</span><span class="tok-o">);</span>
<span class="lineno">26 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">gecko</span><span class="tok-o">);</span>
<span class="lineno">27 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">spider</span><span class="tok-o">);</span>
<span class="lineno">28 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">panel</span><span class="tok-o">);</span>
<span class="lineno">29 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">400</span><span class="tok-o">,</span><span class="tok-mi">400</span><span class="tok-o">);</span>
<span class="lineno">30 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">pack</span><span class="tok-o">();</span>
<span class="lineno">31 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span>
<span class="lineno">32 </span>    	<span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">33 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">34 </span>  <span class="tok-o">}</span>
<span class="lineno">35 </span>  <span class="tok-c1">// Implement all abstract methods in MouseListener</span>
<span class="lineno">36 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseEntered</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-cm">/*@\label{mouseEventEnteredLine}@*/</span>
<span class="lineno">37 </span>    <span class="tok-n">Object</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{getPicMouseEventLine}@*/</span>
<span class="lineno">38 </span>    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">label</span> <span class="tok-o">==</span> <span class="tok-n">bison</span><span class="tok-o">)</span>
<span class="lineno">39 </span>      <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setTitle</span><span class="tok-o">(</span><span class="tok-s">&quot;Animal Identifier: Bison&quot;</span><span class="tok-o">);</span>
<span class="lineno">40 </span>    <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">label</span> <span class="tok-o">==</span> <span class="tok-n">dove</span><span class="tok-o">)</span>
<span class="lineno">41 </span>      <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setTitle</span><span class="tok-o">(</span><span class="tok-s">&quot;Animal Identifier: Dove&quot;</span><span class="tok-o">);</span>
<span class="lineno">42 </span>    <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">label</span> <span class="tok-o">==</span> <span class="tok-n">gecko</span><span class="tok-o">)</span>
<span class="lineno">43 </span>      <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setTitle</span><span class="tok-o">(</span><span class="tok-s">&quot;Animal Identifier: Gecko&quot;</span><span class="tok-o">);</span>
<span class="lineno">44 </span>    <span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">label</span> <span class="tok-o">==</span> <span class="tok-n">spider</span><span class="tok-o">)</span>
<span class="lineno">45 </span>      <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setTitle</span><span class="tok-o">(</span><span class="tok-s">&quot;Animal Identifier: Spider&quot;</span><span class="tok-o">);</span>
<span class="lineno">46 </span>  <span class="tok-o">}</span>
<span class="lineno">47 </span>
<span class="lineno">48 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseExited</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">49 </span>	  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse exited.&quot;</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{mouseEventsLine}@*/</span>
<span class="lineno">50 </span>  <span class="tok-o">}</span>
<span class="lineno">51 </span>
<span class="lineno">52 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mousePressed</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">53 </span>	  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse pressed.&quot;</span><span class="tok-o">);</span>
<span class="lineno">54 </span>  <span class="tok-o">}</span>
<span class="lineno">55 </span>
<span class="lineno">56 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseReleased</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">57 </span>	  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse released&quot;</span><span class="tok-o">);</span>
<span class="lineno">58 </span>  <span class="tok-o">}</span>
<span class="lineno">59 </span>
<span class="lineno">60 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">mouseClicked</span><span class="tok-o">(</span><span class="tok-n">MouseEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">61 </span>	  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Mouse clicked.&quot;</span><span class="tok-o">);</span>
<span class="lineno">62 </span>  <span class="tok-o">}</span>
<span class="lineno">63 </span>
<span class="lineno">64 </span>  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">65 </span>    <span class="tok-k">new</span> <span class="tok-n">AnimalIdentifier</span><span class="tok-o">();</span>
<span class="lineno">66 </span>  <span class="tok-o">}</span>
<span class="lineno">67 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the constructor, we create a panel with a
2 × 2 <code>GridLayout</code>. Then, we create four image icons,
one to decorate each label. Next, starting at
line <a href="#buttonDecoratorLine">[buttonDecoratorLine]</a>, each of the four labels is created with
its respective icon. We also add a <code>MouseListener</code> to each label.
Starting at line <a href="#prepareButtonPanelLine">[prepareButtonPanelLine]</a>, the buttons are added to
the panel, and the panel is added to the frame. The last few lines set
the size of the frame, pack it, set its close operation, and make it
visible.</p>
</div>
<div class="paragraph">
<p>Since <code>AnimalIdentifier</code> implements <code>MouseListener</code>, we need to define
all the methods in the <code>MouseListener</code> interface. These are implemented
starting at line <a href="#mouseEventEnteredLine">[mouseEventEnteredLine]</a>. As we are only interested in
displaying the name of a picture when the mouse moves over it, the
<code>mouseEntered()</code> method is where most of our even handling code will be.
At line <a href="#getPicMouseEventLine">[getPicMouseEventLine]</a> we get the label the mouse entered. We
compare this label to the four labels and change the frame title
correspondingly.</p>
</div>
<div class="paragraph">
<p>We implement the remaining methods from <code>MouseListener</code> to report the
event on the console. The <code>main()</code> method creates a new instance of
class <code>AnimalIdentifier</code>, launching the GUI.</p>
</div>
<div class="paragraph">
<p>Play with <a href="#AnimalIdentifierProgram">Program 63</a>. What happens when you
resize the window?</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.13">Exercise 15.13</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_borderlayout_code"><code>BorderLayout</code></h5>
<div class="paragraph">
<p>The <code>BorderLayout</code> manager is the default one for a <code>JFrame</code>. It allows
components to be laid out spatially in regions of a container. These
regions are north, south, east, west, and center. This layout is
intuitively easy to understand, but it is difficult to describe
precisely.</p>
</div>
<div class="paragraph">
<p>You can only add one component to each region of the layout, and adding
a component to any region is optional. The regions will stretch or
shrink to accommodate the components inside. The north and south regions
will only be as tall as needed to hold their contents, but their width
will stretch as wide as the entire container. The east and west regions
will only be as wide as needed to hold their contents, but their height
will stretch as tall as needed to fit the remaining height of the
container. Both the height and the width of the center region will
stretch as big as it needs to fill the container.</p>
</div>
<div class="exampleblock">
<div class="title">Example 122. BorderLayout</div>
<div class="content">
<div class="paragraph">
<p>Here is an example of a frame using <code>BorderLayout</code>. Five buttons have
been added, one to each region, using the program shown below.</p>
</div>
<div id="BorderLayoutExampleProgram" class="listingblock">
<div class="title">Program 64. Shows buttons laid out in each of the five regions of a <code>BorderLayout</code>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BorderLayoutExample</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>    <span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;BorderLayout Example&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>    <span class="tok-n">JPanel</span> <span class="tok-n">panel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">BorderLayout</span><span class="tok-o">());</span>
<span class="lineno"> 8 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;North&quot;</span><span class="tok-o">),</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">NORTH</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;South&quot;</span><span class="tok-o">),</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">SOUTH</span><span class="tok-o">);</span>
<span class="lineno">10 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;East&quot;</span><span class="tok-o">),</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">EAST</span><span class="tok-o">);</span>
<span class="lineno">11 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;West&quot;</span><span class="tok-o">),</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">WEST</span><span class="tok-o">);</span>
<span class="lineno">12 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Center&quot;</span><span class="tok-o">),</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">CENTER</span><span class="tok-o">);</span>
<span class="lineno">13 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">panel</span><span class="tok-o">);</span>
<span class="lineno">14 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">300</span><span class="tok-o">,</span><span class="tok-mi">200</span><span class="tok-o">);</span>
<span class="lineno">15 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span><span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">16 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">17 </span>  <span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="borderLayoutFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/borderLayoutFigure.png" alt="borderLayoutFigure" width="40%">
</div>
<div class="title">Figure 64. A GUI demonstrating <code>BorderLayout</code> generated by <a href="#BorderLayoutExampleProgram">Program 64</a>.</div>
</div>
<div class="paragraph">
<p>Unlike <code>FlowLayout</code> or <code>GridLayout</code>, the location must be specified to
add a component to a <code>BorderLayout</code>. (There is an overloaded <code>add()</code>
method to add a component to specific grid cell in a <code>GridLayout</code>, but
it is not necessary to use it.) With <code>BorderLayout</code>, the <code>add()</code> method
uses a second parameter, which is <code>BorderLayout.NORTH</code>,
<code>BorderLayout.SOUTH</code>, <code>BorderLayout.EAST</code>, <code>BorderLayout.WEST</code>, or
<code>BorderLayout.CENTER</code>, depending on where you want to add the component.
If you do not specify a second parameter, the component will be added to
the center region. Since only one component can be in each region,
adding a component to a region that is already occupied will replace the
old component with the new one.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>At first glance, <code>BorderLayout</code> seems that it would rarely be useful.
However, this layout is commonly used because it can be used to
establish a spatial relationship between different parts of a GUI. A
container with a <code>BorderLayout</code> generally has other containers with
their own layouts added to its regions, as shown in the following
example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 123. Calculator layout</div>
<div class="content">
<div class="paragraph">
<p>We can make a GUI application that functions as a simple calculator. The
calculator has the ten digits 0-9, a plus button, a minus button, and an
enter button. At the top is a display that shows the current value.</p>
</div>
<div class="paragraph">
<p>We create ten <code>JButton</code> objects for the digits and three more <code>JButton</code>
objects for plus, minus, and enter. The display is a <code>JLabel</code>. The code
is given below.</p>
</div>
<div id="CalculatorLayoutProgram" class="listingblock">
<div class="title">Program 65. Lays out a simple calculator.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CalculatorLayout</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>    <span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Calculator Layout&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>    <span class="tok-n">JPanel</span> <span class="tok-n">panel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">BorderLayout</span><span class="tok-o">());</span>
<span class="lineno"> 8 </span>    <span class="tok-n">JPanel</span> <span class="tok-n">numbers</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JPanel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GridLayout</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">3</span><span class="tok-o">));</span>
<span class="lineno"> 9 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;7&quot;</span><span class="tok-o">));</span>
<span class="lineno">10 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;8&quot;</span><span class="tok-o">));</span>
<span class="lineno">11 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;9&quot;</span><span class="tok-o">));</span>
<span class="lineno">12 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;4&quot;</span><span class="tok-o">));</span>
<span class="lineno">13 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;5&quot;</span><span class="tok-o">));</span>
<span class="lineno">14 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;6&quot;</span><span class="tok-o">));</span>
<span class="lineno">15 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;1&quot;</span><span class="tok-o">));</span>
<span class="lineno">16 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;2&quot;</span><span class="tok-o">));</span>
<span class="lineno">17 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;3&quot;</span><span class="tok-o">));</span>
<span class="lineno">18 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;0&quot;</span><span class="tok-o">));</span>
<span class="lineno">19 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;+&quot;</span><span class="tok-o">));</span>
<span class="lineno">20 </span>    <span class="tok-n">numbers</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;-&quot;</span><span class="tok-o">));</span>
<span class="lineno">21 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">numbers</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">CENTER</span><span class="tok-o">);</span>
<span class="lineno">22 </span>    <span class="tok-n">JButton</span> <span class="tok-n">enter</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter&quot;</span><span class="tok-o">);</span>
<span class="lineno">23 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">enter</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">SOUTH</span><span class="tok-o">);</span>
<span class="lineno">24 </span>    <span class="tok-n">JLabel</span> <span class="tok-n">display</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;0&quot;</span><span class="tok-o">);</span>
<span class="lineno">25 </span>    <span class="tok-n">panel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">display</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">NORTH</span><span class="tok-o">);</span>
<span class="lineno">26 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">panel</span><span class="tok-o">);</span>
<span class="lineno">27 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">250</span><span class="tok-o">,</span><span class="tok-mi">300</span><span class="tok-o">);</span>
<span class="lineno">28 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span><span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">29 </span>    <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">30 </span>  <span class="tok-o">}</span>
<span class="lineno">31 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="calculatorLayoutFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/calculatorLayoutFigure.png" alt="calculatorLayoutFigure" width="40%">
</div>
<div class="title">Figure 65. GUI generated by <a href="#CalculatorLayoutProgram">Program 65</a>.</div>
</div>
<div class="paragraph">
<p>This program uses a <code>BorderLayout</code> to put a container with a
<code>GridLayout</code> in a spatial arrangement with other components. First, we
put the ten digit buttons in a panel with a <code>GridLayout</code> having 4 rows
and 3 columns. We put the plus button and the minus button in the
remaining two cells of the grid. We add this grid panel to the larger
panel in the center region. We put the enter button in the south region
and the display in the north region.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>There is no limit to how deeply you can nest containers within each
other. Sometimes you must create a very complex GUI using many
<code>BorderLayout</code> managers to achieve the appearance you want.</p>
</div>
<div class="paragraph">
<p>The three layout managers discussed in this section are the simplest,
but there are others. The <code>BoxLayout</code> manager is a useful tool for
laying out components in a stack or in a row. The <code>GridBagLayout</code>
manager can be used to create complex layouts in a single container
using a grid-based framework that is much more flexible than
<code>GridLayout</code>, but the complexity of programming <code>GridBagLayout</code> is
significant. The <code>SpringLayout</code> and <code>GroupLayout</code> managers are also
powerful, but they are designed for use with a GUI builder utility.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_menus">15.3.6. Menus</h4>
<div class="paragraph">
<p>Menus provide a useful form of interface that is expected from most GUI
applications. In this section we show how to create menus and respond to
the selection of menu items. Menus are placed on a menu bar. Each menu
usually consists of several menu items that could be selected by the
user. In addition to simple text, a menu item can be a button, a radio
button, check box, or an icon. A menu can have one or more sub-menus
opening out of a menu item.</p>
</div>
<div class="sect4">
<h5 id="_creating_menus">Creating menus</h5>
<div class="paragraph">
<p>First we have to create a menu bar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JMenuBar</span> <span class="tok-n">bar</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuBar</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This statement creates an object of type <code>JMenuBar</code> named <code>bar</code> which
can hold menus. A <code>JFrame</code> has only one menu bar. We can create several
menus and add them to the menu bar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JMenu</span> <span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenu</span><span class="tok-o">(</span><span class="tok-s">&quot;Type&quot;</span><span class="tok-o">);</span>
<span class="tok-n">JMenu</span> <span class="tok-n">operations</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenu</span><span class="tok-o">(</span><span class="tok-s">&quot;Operations&quot;</span><span class="tok-o">);</span>
<span class="tok-n">bar</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">type</span><span class="tok-o">);</span>
<span class="tok-n">bar</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">operations</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These statements create two menus named <code>type</code> and <code>operations</code> labeled
&#8220;Type&#8221; and &#8220;Operations,&#8221; respectively. The two menus are added to
the existing menu bar using the <code>add()</code> method. Menus can be populated
with menu items as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JMenuItem</span> <span class="tok-n">addition</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Addition&quot;</span><span class="tok-o">);</span>
<span class="tok-n">JMenuItem</span> <span class="tok-n">subtraction</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Subtraction&quot;</span><span class="tok-o">)</span>
<span class="tok-n">operation</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">addition</span><span class="tok-o">);</span>
<span class="tok-n">operation</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">subtraction</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These statements create two menu items named <code>addition</code> and
<code>subtraction</code>. These menu items are then added to the menu <code>operations</code>.
After having created a menu bar together with its menus and their
respective menu items, we need to add it to a frame.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Menu Example&quot;</span><span class="tok-o">);</span>
<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setJMenuBar</span><span class="tok-o">(</span><span class="tok-n">bar</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These statements create a frame and set its menu bar to <code>bar</code>. It is
possible to use the <code>add()</code> method instead of the <code>setJMenuBar()</code> method
to add a <code>JMenuBar</code> to a <code>JFrame</code>. However, doing so will add the
<code>JMenuBar</code> to the regular content area, <strong>not</strong> to the menu area.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.4">Exercise 15.4</a><br>
<a href="#exercise15.21">Exercise 15.21</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Sometimes you might need to disable a menu item and enable it only under
certain conditions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JMenuItem</span> <span class="tok-n">subtraction</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Subtraction&quot;</span><span class="tok-o">);</span>
<span class="tok-n">subtraction</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These statements create a menu item named <code>subtraction</code> and disable it.
A disabled menu item shows as a gray item and does not respond to
attempts to select it. Note that <code>JButton</code> objects and many other
widgets can be disabled in the same way.</p>
</div>
</div>
<div class="sect4">
<h5 id="_adding_events_to_menus">Adding events to menus</h5>
<div class="paragraph">
<p>An action listener can be added to each menu item, just like a
<code>JButton</code>. Then, when a menu item is clicked by the user, an action
event is generated. A <code>JCheckBoxMenuItem</code> object can be added to a
<code>JMenu</code> as well. This object will have a check box which can be selected
or unselected. A regular <code>JMenuItem</code> object generates an <code>ActionEvent</code>
which is handled by an <code>ActionListener</code>. A <code>JCheckBoxMenuItem</code>, however,
generates an <code>ItemEvent</code> handled by an <code>ItemListener</code>. Here are examples
of both situations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">JMenuItem</span> <span class="tok-n">subtraction</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Subtraction&quot;</span><span class="tok-o">);</span>
<span class="tok-n">JCheckBoxMenuItem</span> <span class="tok-n">checkBox</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JCheckBoxMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Check yourself&quot;</span><span class="tok-o">);</span>
<span class="tok-n">subtraction</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="tok-n">checkbox</span><span class="tok-o">.</span><span class="tok-na">addItemListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>JMenuItem</code> works just like a <code>JButton</code>. In fact, the same action
listener code could handle events for both buttons and menu items.
However, a <code>JCheckBoxMenuItem</code> generates an <code>ItemEvent</code> (like many other
check box and list widgets that we do not discuss) when the state of its
check box changes. Thus, when you select a check box, a
\(\surd\) sign appears to its left and an <code>ItemEvent</code> is
generated. When you select an already checked check box, the sign
disappears and another <code>ItemEvent</code> is generated. Although an
<code>ActionEvent</code> and an <code>ItemEvent</code> are very similar, Java differentiates
between them because an <code>ItemEvent</code> has more information: By using the
<code>getStateChange()</code> method, it is possible to tell whether the widget
that fired the <code>ItemEvent</code> is now selected or deselected.</p>
</div>
<div class="exampleblock">
<div class="title">Example 124. Math tutor</div>
<div class="content">
<div class="paragraph">
<p>Here we give the code to generate the GUI shown in
<a href="#MathTutorFigure">Figure 66</a> which displays basic (addition and
subtraction) as well as advanced (multiplication and division) problems.
In <a href="#subsection:Applets">Section 15.3.7</a> we transform this GUI into an applet
like the one described in <a href="#_problem_math_applet">Section 15.1</a>.</p>
</div>
<div id="MathTutorFigure" class="imageblock">
<div class="content">
<img src="chapters/15-gui/images/mathTutorFigure.svg" alt="mathTutorFigure" width="100%">
</div>
<div class="title">Figure 66. GUI for the <code>MathTutor</code>. (a) No menu selected. (b) Type selected. (c) Operations selected.</div>
</div>
<div class="paragraph">
<p>As shown in <a href="#MathTutorFigure">Figure 66</a>, this GUI has a menu bar
consisting of two menus labeled &#8220;Type&#8221; and &#8220;Operations.&#8221; The
&#8220;Type&#8221; menu contains a check box labeled &#8220;Advanced&#8221; while the
&#8220;Operations&#8221; menu contains four menu items labeled &#8220;Add,&#8221;
&#8220;Subtract,&#8221; &#8220;Multiply,&#8221; and &#8220;Divide.&#8221; Note that the &#8220;Multiply&#8221;
and &#8220;Divide&#8221; menu items are disabled. They will be enabled when the
user selects the &#8220;Advanced&#8221; check box.</p>
</div>
<div class="paragraph">
<p>Before we introduce the program that creates this GUI, we need a helper
class called <code>ProblemGenerator</code> that can randomly generate arithmetic
problems. The class is designed so that the answers are always positive
integers.</p>
</div>
<div id="ProblemGeneratorProgram" class="listingblock">
<div class="title">Program 66. Utility class to generate random addition, subtraction, multiplication, and division problems.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Random</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ProblemGenerator</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">addPractice</span><span class="tok-o">(</span> <span class="tok-n">JLabel</span> <span class="tok-n">label</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-s">&quot; + &quot;</span> <span class="tok-o">+</span> <span class="tok-n">b</span> <span class="tok-o">+</span> <span class="tok-s">&quot; = &quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-k">return</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">b</span><span class="tok-o">;</span>
<span class="lineno">12 </span>	<span class="tok-o">}</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">subtractPractice</span><span class="tok-o">(</span> <span class="tok-n">JLabel</span> <span class="tok-n">label</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>		<span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">16 </span>		<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">17 </span>		<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span> <span class="tok-n">b</span> <span class="tok-o">+</span> <span class="tok-s">&quot; - &quot;</span> <span class="tok-o">+</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-s">&quot; = &quot;</span><span class="tok-o">);</span>
<span class="lineno">18 </span>		<span class="tok-k">return</span> <span class="tok-n">b</span> <span class="tok-o">-</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="lineno">19 </span>	<span class="tok-o">}</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">multiplyPractice</span><span class="tok-o">(</span> <span class="tok-n">JLabel</span> <span class="tok-n">label</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">22 </span>		<span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">23 </span>		<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">24 </span>		<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-s">&quot; \u00D7 &quot;</span> <span class="tok-o">+</span> <span class="tok-n">b</span> <span class="tok-o">+</span> <span class="tok-s">&quot; = &quot;</span><span class="tok-o">);</span>
<span class="lineno">25 </span>		<span class="tok-k">return</span> <span class="tok-n">a</span> <span class="tok-o">*</span> <span class="tok-n">b</span><span class="tok-o">;</span>
<span class="lineno">26 </span>	<span class="tok-o">}</span>
<span class="lineno">27 </span>
<span class="lineno">28 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">dividePractice</span><span class="tok-o">(</span> <span class="tok-n">JLabel</span> <span class="tok-n">label</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">29 </span>		<span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">30 </span>		<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">*(</span><span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
<span class="lineno">31 </span>		<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span> <span class="tok-n">b</span> <span class="tok-o">+</span> <span class="tok-s">&quot; \u00F7 &quot;</span> <span class="tok-o">+</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-s">&quot; = &quot;</span><span class="tok-o">);</span>
<span class="lineno">32 </span>		<span class="tok-k">return</span> <span class="tok-n">b</span> <span class="tok-o">/</span> <span class="tok-n">a</span><span class="tok-o">;</span>
<span class="lineno">33 </span>	<span class="tok-o">}</span>
<span class="lineno">34 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code listed above has four static methods <code>addPractice()</code>,
<code>subtractPractice()</code>, <code>multiplyPractice()</code>, and <code>dividePractice()</code>. Each
method generates an appropriate math problem, sets an input <code>JLabel</code> to
display the problem, and returns the solution. Note that <code>\u00D7</code> and
<code>\u00F7</code> are the Unicode values for the multiplication and division
symbols.</p>
</div>
<div class="paragraph">
<p><a href="#MathTutorProgram">Program 67</a> generates the GUI in
<a href="#MathTutorFigure">Figure 66</a>. Class <code>MathTutor</code> begins by creating only
the objects that need to interact with event handlers: four menu items,
a label, and a text field.</p>
</div>
<div id="MathTutorProgram" class="listingblock">
<div class="title">Program 67. Uses menus to generate math problems.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MathTutor</span> <span class="tok-kd">implements</span> <span class="tok-n">ActionListener</span><span class="tok-o">,</span> <span class="tok-n">ItemListener</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-n">JMenuItem</span> <span class="tok-n">add</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Addition&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>	<span class="tok-kd">private</span> <span class="tok-n">JMenuItem</span> <span class="tok-n">subtract</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Subtraction&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>	<span class="tok-kd">private</span> <span class="tok-n">JMenuItem</span> <span class="tok-n">multiply</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Multiply&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>	<span class="tok-kd">private</span> <span class="tok-n">JMenuItem</span> <span class="tok-n">divide</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span> <span class="tok-o">(</span><span class="tok-s">&quot;Divide&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>    <span class="tok-kd">private</span> <span class="tok-n">JLabel</span> <span class="tok-n">score</span> <span class="tok-o">=</span>
<span class="lineno">11 </span>    	<span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;Score: 0 Correct 0 Incorrect&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>    <span class="tok-kd">private</span> <span class="tok-n">JLabel</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">();</span>
<span class="lineno">13 </span>    <span class="tok-kd">private</span> <span class="tok-n">JTextField</span> <span class="tok-n">field</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JTextField</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">);</span>
<span class="lineno">14 </span>    <span class="tok-kd">private</span> <span class="tok-n">JButton</span> <span class="tok-n">submit</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Submit&quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>    <span class="tok-kd">public</span> <span class="tok-nf">MathTutor</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>        <span class="tok-n">JFrame</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JFrame</span><span class="tok-o">(</span><span class="tok-s">&quot;Math Tutor&quot;</span><span class="tok-o">);</span>
<span class="lineno">18 </span>        <span class="tok-n">JMenuBar</span> <span class="tok-n">menuBar</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuBar</span><span class="tok-o">();</span>
<span class="lineno">19 </span>        <span class="tok-n">JMenu</span> <span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenu</span><span class="tok-o">(</span><span class="tok-s">&quot;Type&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>        <span class="tok-n">JMenu</span> <span class="tok-n">operations</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenu</span><span class="tok-o">(</span><span class="tok-s">&quot;Operations&quot;</span><span class="tok-o">);</span>
<span class="lineno">21 </span>        <span class="tok-n">JCheckBoxMenuItem</span> <span class="tok-n">advanced</span> <span class="tok-o">=</span>
<span class="lineno">22 </span>        	<span class="tok-k">new</span> <span class="tok-n">JCheckBoxMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Advanced&quot;</span><span class="tok-o">);</span>
<span class="lineno">23 </span>    	<span class="tok-c1">// Add ActionListeners to menu items</span>
<span class="lineno">24 </span>    	<span class="tok-n">add</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{addActionsToMenuItemsLine}@*/</span>
<span class="lineno">25 </span>        <span class="tok-n">subtract</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">26 </span>        <span class="tok-n">multiply</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">27 </span>        <span class="tok-n">divide</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">28 </span>        <span class="tok-c1">// Add ItemListener to checkbox menu item</span>
<span class="lineno">29 </span>        <span class="tok-n">advanced</span><span class="tok-o">.</span><span class="tok-na">addItemListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">30 </span>        <span class="tok-c1">// Fill menu for problem type</span>
<span class="lineno">31 </span>        <span class="tok-n">type</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">advanced</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{createMenuLine}@*/</span>
<span class="lineno">32 </span>        <span class="tok-c1">// Fill menu for operations</span>
<span class="lineno">33 </span>        <span class="tok-n">operations</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">add</span><span class="tok-o">);</span>
<span class="lineno">34 </span>        <span class="tok-n">operations</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">subtract</span><span class="tok-o">);</span>
<span class="lineno">35 </span>        <span class="tok-n">operations</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">multiply</span><span class="tok-o">);</span>
<span class="lineno">36 </span>        <span class="tok-n">operations</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">divide</span><span class="tok-o">);</span>
<span class="lineno">37 </span>        <span class="tok-c1">// Disable advanced operations</span>
<span class="lineno">38 </span>        <span class="tok-n">multiply</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{defaultDisableLine}@*/</span>
<span class="lineno">39 </span>        <span class="tok-n">divide</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">40 </span>        <span class="tok-c1">// Fill menu bar set on frame</span>
<span class="lineno">41 </span>        <span class="tok-n">menuBar</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">type</span><span class="tok-o">);</span>
<span class="lineno">42 </span>        <span class="tok-n">menuBar</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">operations</span><span class="tok-o">);</span>
<span class="lineno">43 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setJMenuBar</span><span class="tok-o">(</span><span class="tok-n">menuBar</span><span class="tok-o">);</span>
<span class="lineno">44 </span>		<span class="tok-c1">// Add widgets to frame and display GUI</span>
<span class="lineno">45 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span> <span class="tok-n">score</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">NORTH</span> <span class="tok-o">);</span>
<span class="lineno">46 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span> <span class="tok-n">label</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">WEST</span> <span class="tok-o">);</span>
<span class="lineno">47 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span> <span class="tok-n">field</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">EAST</span> <span class="tok-o">);</span>
<span class="lineno">48 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span> <span class="tok-n">submit</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">SOUTH</span> <span class="tok-o">);</span>
<span class="lineno">49 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">250</span><span class="tok-o">,</span> <span class="tok-mi">125</span><span class="tok-o">);</span>
<span class="lineno">50 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span><span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">51 </span>        <span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">52 </span>    <span class="tok-o">}</span>
<span class="lineno">53 </span>
<span class="lineno">54 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">itemStateChanged</span><span class="tok-o">(</span><span class="tok-n">ItemEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">55 </span>    	<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getStateChange</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">ItemEvent</span><span class="tok-o">.</span><span class="tok-na">SELECTED</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">56 </span>            <span class="tok-n">add</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{enableDisableAdvancedLine}@*/</span>
<span class="lineno">57 </span>            <span class="tok-n">subtract</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">58 </span>            <span class="tok-n">multiply</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">59 </span>            <span class="tok-n">divide</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">60 </span>    	<span class="tok-o">}</span>
<span class="lineno">61 </span>    	<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">62 </span>			<span class="tok-n">add</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span> <span class="tok-cm">/*@\label{enableDisableBasicLine}@*/</span>
<span class="lineno">63 </span>			<span class="tok-n">subtract</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">64 </span>			<span class="tok-n">multiply</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">65 </span>			<span class="tok-n">divide</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">66 </span>    	<span class="tok-o">}</span>
<span class="lineno">67 </span>    <span class="tok-o">}</span>
<span class="lineno">68 </span>
<span class="lineno">69 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">70 </span>    	<span class="tok-n">Object</span> <span class="tok-n">menuItem</span> <span class="tok-o">=</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">();</span>
<span class="lineno">71 </span>    	<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">menuItem</span> <span class="tok-o">==</span> <span class="tok-n">add</span> <span class="tok-o">)</span>
<span class="lineno">72 </span>    		<span class="tok-n">ProblemGenerator</span><span class="tok-o">.</span><span class="tok-na">addPractice</span><span class="tok-o">(</span> <span class="tok-n">label</span> <span class="tok-o">);</span>
<span class="lineno">73 </span>        <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">menuItem</span> <span class="tok-o">==</span> <span class="tok-n">subtract</span> <span class="tok-o">)</span>
<span class="lineno">74 </span>        	<span class="tok-n">ProblemGenerator</span><span class="tok-o">.</span><span class="tok-na">subtractPractice</span><span class="tok-o">(</span> <span class="tok-n">label</span> <span class="tok-o">);</span>
<span class="lineno">75 </span>        <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">menuItem</span> <span class="tok-o">==</span> <span class="tok-n">multiply</span> <span class="tok-o">)</span>
<span class="lineno">76 </span>        	<span class="tok-n">ProblemGenerator</span><span class="tok-o">.</span><span class="tok-na">multiplyPractice</span><span class="tok-o">(</span> <span class="tok-n">label</span> <span class="tok-o">);</span>
<span class="lineno">77 </span>        <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">menuItem</span> <span class="tok-o">==</span> <span class="tok-n">divide</span> <span class="tok-o">)</span>
<span class="lineno">78 </span>        	<span class="tok-n">ProblemGenerator</span><span class="tok-o">.</span><span class="tok-na">dividePractice</span><span class="tok-o">(</span> <span class="tok-n">label</span> <span class="tok-o">);</span>
<span class="lineno">79 </span>    	<span class="tok-n">field</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">);</span>
<span class="lineno">80 </span>    <span class="tok-o">}</span>
<span class="lineno">81 </span>
<span class="lineno">82 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">){</span>
<span class="lineno">83 </span>        <span class="tok-k">new</span> <span class="tok-n">MathTutor</span><span class="tok-o">();</span>
<span class="lineno">84 </span>    <span class="tok-o">}</span>
<span class="lineno">85 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the <code>MathTutor</code> constructor, the frame and remaining widgets are
created. Action listeners are added to the four operations menu items.
An item listener is added to the &#8220;Advanced&#8221; check box menu item,
because it requires a different kind of event handler. Note that
<code>MathTutor</code> implements both the <code>ActionListener</code> and <code>ItemListener</code>
interfaces, allowing it to handle both kinds of events.</p>
</div>
<div class="paragraph">
<p>Starting at line <a href="#createMenuLine">[createMenuLine]</a>, the two menus are populated with
their respective menu items. At line <a href="#defaultDisableLine">[defaultDisableLine]</a> the
<code>multiply</code> and <code>divide</code> menu items are disabled because the application
starts in basic mode. The menus are then added to the menu bar, and the
menu bar is set on the frame. Finally, the label and text field are
added to the frame, which is made visible. Note that these two widgets
are added directly to the frame with the parameters <code>BorderLayout.NORTH</code>
and <code>BorderLayout.SOUTH</code>. <code>JFrame</code> objects use the <code>BorderLayout</code>
manager by default.</p>
</div>
<div class="paragraph">
<p>The <code>itemStateChanged()</code> method enables the <code>multiply</code> and <code>divide</code>
menus and disables the <code>add</code> and <code>subtract</code> menus if the <code>advanced</code>
check box is selected and does the reverse if it has been unselected.</p>
</div>
<div class="paragraph">
<p>The <code>actionPerformed()</code> method is similar to earlier examples. Depending
on which menu item fired the event, the appropriate static methods from
the <code>ProblemGenerator</code> class are used to display a math problem on
<code>label</code>.</p>
</div>
<div class="paragraph">
<p>The <code>main()</code> method creates an instance of <code>MathTutor</code>, initiating GUI
construction.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="subsection:Applets">15.3.7. Applets</h4>
<div class="paragraph">
<p>An applet is a Java program that is written to run inside a web browser.
A normal Java application is stored on disk and runs on the command line
or as a window on your desktop (or both), but an applet exists inside of
a webpage. This means that the code that launches an applet is usually
embedded in HTML code.</p>
</div>
<div class="paragraph">
<p>Almost all of the GUI tools we discuss are useful for writing an applet.
For example, you can write an applet that has menus, buttons, text
fields, and any other widget that Swing offers. You can also add
listeners to various objects for the applet to respond to events.</p>
</div>
<div class="paragraph">
<p>A Swing applet is derived from the <code>JApplet</code> class, which is a subclass
of the older AWT class <code>Applet</code>.</p>
</div>
<div class="paragraph">
<p>An applet differs from a stand-alone Java application in several
important ways. The first is that applets are sent across the Internet.
Unless you have increased security settings on your browser, they will
generally run as soon as you visit a page with an applet embedded in it,
without even asking your permission. This poses a huge security risk,
but the designers of Java have worked to protect us. Unsigned applets
(which are the ones we will talk about creating) cannot read, write, or
execute files, make network connections to servers other than the one
they come from, or interact with most other local system settings.
However, applets loaded from a local directory (instead of downloaded
over the Internet) do not have these restrictions. Be sure to remember
these restrictions when you design applets for distribution over the
Internet.</p>
</div>
<div class="paragraph">
<p>Another important and concrete difference from normal Java classes is
that an applet should not define a constructor. Instead, an applet uses
the <code>init()</code> method. When the applet is executed, often through a
browser, its <code>init()</code> method is called first. You can use this method to
set up the applet GUI by adding various widgets and event listeners.</p>
</div>
<div id="rainbowAppletExample" class="exampleblock">
<div class="title">Example 125. <code>RainbowApplet</code></div>
<div class="content">
<div class="paragraph">
<p>We can create a simple applet with a button and a label. Clicking this
button sets the text on the label to contain some information about the
colors in a rainbow. This applet is shown in
<a href="#rainbowAppletFigure">Figure 67</a>. <a href="#RainbowAppletProgram">Program 68</a>
defines the applet.</p>
</div>
<div id="rainbowAppletFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/rainbowAppletFigure.png" alt="rainbowAppletFigure" width="40%">
</div>
<div class="title">Figure 67. A simple applet containing one button.</div>
</div>
<div id="RainbowAppletProgram" class="listingblock">
<div class="title">Program 68. Applet with a button and a label.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RainbowApplet</span> <span class="tok-kd">extends</span> <span class="tok-n">JApplet</span><span class="tok-o">{</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-n">JLabel</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>
<span class="lineno"> 9 </span>        <span class="tok-n">JButton</span> <span class="tok-n">button</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Rainbows&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">button</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">NORTH</span><span class="tok-o">);</span>
<span class="lineno">11 </span>        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">SOUTH</span><span class="tok-o">);</span>
<span class="lineno">12 </span>        <span class="tok-n">button</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActionListener</span><span class="tok-o">(){</span>
<span class="lineno">13 </span>        	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span> <span class="tok-o">(</span> <span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">){</span>
<span class="lineno">14 </span>        		<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Have the colors ROYGBIV.&quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>        	<span class="tok-o">}</span>
<span class="lineno">16 </span>        <span class="tok-o">});</span>
<span class="lineno">17 </span>    <span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that class <code>RainbowApplet</code> extends <code>JApplet</code>, as will most applets
you write. The label is declared as a field, so that the event handler
can access it. The <code>init()</code> method creates a <code>JButton</code> with the label
&#8220;Rainbows,&#8221; adds both the label and the button to the applet, and adds
an action listener to the button with an anonymous inner class event
handler.</p>
</div>
<div class="paragraph">
<p>Note that the button and the label were added to the applet just as it
would have been done inside of a <code>JFrame</code> constructor. They were added
with the <code>BorderLayout.WEST</code> and <code>BorderLayout.EAST</code> constants because a
<code>JApplet</code> uses a <code>BorderLayout</code> manager by default.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>As you can see, creating an applet is very similar to creating a GUI
based on a <code>JFrame</code>. In fact, it may be easier. However, we need to
create an HTML file for the applet to be accessible via a browser. HTML
stands for <em>hypertext markup language</em>. HTML is the core language for
writing webpages. HTML is designed for marking up text and images to be
displayed within a browser. It is not as complicated as Java, but we do
not have time or space to describe the language deeply.</p>
</div>
<div class="paragraph">
<p>HTML is a language made up of <em>tags</em> that mark parts of a document with
formatting instructions. All of the tags we will need to embed an applet
will start with the name of the tag in angle brackets and then end with
the same name in angle brackets but preceded by a slash. For example, to
mark text as bold in HTML, you can use the <code>&lt;strong&gt;</code> tag as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-o">&lt;</span><span class="tok-n">strong</span><span class="tok-o">&gt;</span><span class="tok-n">Here</span> <span class="tok-n">is</span> <span class="tok-n">text</span> <span class="tok-n">that</span> <span class="tok-n">will</span> <span class="tok-n">appear</span> <span class="tok-n">in</span> <span class="tok-n">a</span> <span class="tok-n">bold</span> <span class="tok-n">font</span><span class="tok-o">.&lt;/</span><span class="tok-n">strong</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To run <code>RainbowApplet</code> we need to create an HTML file that includes the
applet&#8217;s class file inside the <code>&lt;applet&gt;</code> tag.</p>
</div>
<div class="exampleblock">
<div class="title">Example 126. RainbowApplet HTML</div>
<div class="content">
<div class="paragraph">
<p>We want to make <code>RainbowApplet</code> executable via a browser. In addition,
we would like the source code of the applet to be linked from the same
webpage. The following HTML code embeds the <code>RainbowApplet</code> and links to
its source.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-o">&lt;</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">title</span><span class="tok-o">&gt;</span><span class="tok-n">Rainbow</span> <span class="tok-n">Applet</span><span class="tok-o">&lt;/</span><span class="tok-n">title</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;/</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">applet</span> <span class="tok-n">code</span><span class="tok-o">=</span><span class="tok-s">&quot;RainbowApplet.class&quot;</span> <span class="tok-n">width</span><span class="tok-o">=</span><span class="tok-s">&quot;200&quot;</span> <span class="tok-n">height</span><span class="tok-o">=</span><span class="tok-s">&quot;100&quot;</span><span class="tok-o">&gt;&lt;/</span><span class="tok-n">applet</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">hr</span> <span class="tok-o">/&gt;&lt;</span><span class="tok-n">a</span> <span class="tok-n">href</span><span class="tok-o">=</span><span class="tok-s">&quot;RainbowApplet.java&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">The</span> <span class="tok-n">source</span><span class="tok-o">.&lt;/</span><span class="tok-n">a</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;/</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">html</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div id="rainbowAppletInBrowserFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/rainbowAppletInBrowserFigure.png" alt="rainbowAppletInBrowserFigure" width="60%">
</div>
<div class="title">Figure 68. The <code>RainbowApplet</code> as seen through a web browser. Clicking on the link displays the Java source code of the applet in <a href="#RainbowAppletProgram">Program 68</a>.</div>
</div>
<div class="paragraph">
<p>An <code>&lt;html&gt;</code> tag encloses an entire HTML document. Inside is the <code>&lt;head&gt;</code>
tag, followed by the <code>&lt;body&gt;</code> tag. The <code>&lt;head&gt;</code> tag contains information
about the page such as its title, which is given in the <code>&lt;title&gt;</code> tag.
The <code>&lt;body&gt;</code> tag contains the viewable content of the web page. In this
case, there is an <code>&lt;applet&gt;</code> tag, a <code>&lt;hr/&gt;</code> tag, and an <code>&lt;a&gt;</code> tag in the
body.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;applet&gt;</code> tag is used to embed our applet. The name of the applet
class must be given as the argument, in double quotes, to the <code>code</code>
attribute. The <code>width</code> and <code>height</code> attributes specify the size of the
applet on the screen. The <code>&lt;hr/&gt;</code> tag puts the horizontal line between
the applet and the link. It is the only tag in our example that does not
have both an opening and closing half. Finally, the <code>&lt;a&gt;</code> tag is used to
make a clickable link. On a web page, it will display &#8220;The source,&#8221;
but it will navigate to the file <code>RainbowApplet.java</code> when clicked.</p>
</div>
<div class="paragraph">
<p>Put this code in an HTML file named <code>RainbowApplet.html</code>. (Note that the
name of your HTML file should be descriptive, but it does not have to
match the name of the applet class.) If your browser is Java compatible
and has the appropriate plug-in installed, you should be able to run the
applet by double-clicking on the HTML file. Of course, if you are able
to upload the HTML file and the class file to a web server, you can view
the applet and share it with anyone with an Internet connection.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.22">Exercise 15.22</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Applets can be much more complex than <code>RainbowApplet</code>. We now solve the
problem posed at the beginning of the chapter with an applet with a
fully functional GUI designed to be an arithmetic tutor.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_math_applet">15.4. Solution: Math applet</h3>
<div class="paragraph">
<p>The applet that meets the specification given at the beginning of the
chapter is similar to <a href="#MathTutorProgram">Program 67</a>. Modifications must
be made to convert that program into an applet and add full
functionality to the event handlers. We now go through this rather long
Java program step by step. GUI programs in Java tend to be longer than
their command line versions because of the code needed to set up all the
widgets.</p>
</div>
<div id="menusInArithPracticeFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/menusInArithPracticeFigure.svg" alt="menusInArithPracticeFigure" width="80%">
</div>
<div class="title">Figure 69. The Type (a) and Operations (b) menus in the <code>MathTutorApplet</code>. Note that the &#8220;Multiply&#8221; and &#8220;Divide&#8221; operations are disabled because the &#8220;Advanced&#8221; option is not checked.</div>
</div>
<div class="paragraph">
<p>The <code>MathTutorApplet.java</code> file begins with the usual Swing imports and
the class declaration, followed by a list of its fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MathTutorApplet</span> <span class="tok-kd">extends</span> <span class="tok-n">JApplet</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">implements</span> <span class="tok-n">ActionListener</span><span class="tok-o">,</span> <span class="tok-n">ItemListener</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>    <span class="tok-kd">private</span> <span class="tok-n">JMenuItem</span> <span class="tok-n">add</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Addition&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">private</span> <span class="tok-n">JMenuItem</span> <span class="tok-n">subtract</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Subtraction&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>    <span class="tok-kd">private</span> <span class="tok-n">JMenuItem</span> <span class="tok-n">multiply</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Multiply&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>    <span class="tok-kd">private</span> <span class="tok-n">JMenuItem</span> <span class="tok-n">divide</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuItem</span> <span class="tok-o">(</span><span class="tok-s">&quot;Divide&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>    <span class="tok-kd">private</span> <span class="tok-n">JLabel</span> <span class="tok-n">score</span> <span class="tok-o">=</span>
<span class="lineno">12 </span>    	<span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;Score: 0 Correct 0 Incorrect&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>    <span class="tok-kd">private</span> <span class="tok-n">JLabel</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">();</span>
<span class="lineno">14 </span>    <span class="tok-kd">private</span> <span class="tok-n">JTextField</span> <span class="tok-n">field</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JTextField</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">);</span>
<span class="lineno">15 </span>    <span class="tok-kd">private</span> <span class="tok-n">JButton</span> <span class="tok-n">submit</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Submit&quot;</span><span class="tok-o">);</span>
<span class="lineno">16 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">correct</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">17 </span>    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">incorrect</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">18 </span>    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>int</code> variables <code>correct</code>, <code>incorrect</code>, and <code>answer</code> have
been added to the fields to keep track of the correct and incorrect
answers and the current answer that the user is trying to find.</p>
</div>
<div class="paragraph">
<p>Following the field declarations is the definition of the <code>init()</code>
method. As you can see, this method is almost identical to the
constructor in the <code>MathTutor</code> stand-alone application. Indeed, the
<code>init()</code> method is very much like the constructor for an applet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>        <span class="tok-n">JMenuBar</span> <span class="tok-n">menuBar</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenuBar</span><span class="tok-o">();</span>
<span class="lineno"> 3 </span>        <span class="tok-n">JMenu</span> <span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenu</span><span class="tok-o">(</span><span class="tok-s">&quot;Type&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 4 </span>        <span class="tok-n">JMenu</span> <span class="tok-n">operations</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JMenu</span><span class="tok-o">(</span><span class="tok-s">&quot;Operations&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>        <span class="tok-n">JCheckBoxMenuItem</span> <span class="tok-n">advanced</span> <span class="tok-o">=</span>
<span class="lineno"> 6 </span>        	<span class="tok-k">new</span> <span class="tok-n">JCheckBoxMenuItem</span><span class="tok-o">(</span><span class="tok-s">&quot;Advanced&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>    	<span class="tok-c1">// Add ActionListeners to menu items and buttons</span>
<span class="lineno"> 8 </span>    	<span class="tok-n">add</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>        <span class="tok-n">subtract</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">10 </span>        <span class="tok-n">multiply</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">11 </span>        <span class="tok-n">divide</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">12 </span>        <span class="tok-n">submit</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">13 </span>        <span class="tok-c1">// Add ItemListener to checkbox menu item</span>
<span class="lineno">14 </span>        <span class="tok-n">advanced</span><span class="tok-o">.</span><span class="tok-na">addItemListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">15 </span>        <span class="tok-c1">// Fill menu for problem type</span>
<span class="lineno">16 </span>        <span class="tok-n">type</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">advanced</span><span class="tok-o">);</span>
<span class="lineno">17 </span>        <span class="tok-c1">// Fill menu for operations</span>
<span class="lineno">18 </span>        <span class="tok-n">operations</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">add</span><span class="tok-o">);</span>
<span class="lineno">19 </span>        <span class="tok-n">operations</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">subtract</span><span class="tok-o">);</span>
<span class="lineno">20 </span>        <span class="tok-n">operations</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">multiply</span><span class="tok-o">);</span>
<span class="lineno">21 </span>        <span class="tok-n">operations</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">divide</span><span class="tok-o">);</span>
<span class="lineno">22 </span>        <span class="tok-c1">// Disable advanced operations and submit</span>
<span class="lineno">23 </span>        <span class="tok-n">multiply</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">24 </span>        <span class="tok-n">divide</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">25 </span>        <span class="tok-n">submit</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">26 </span>        <span class="tok-c1">// Fill menu bar and set on applet</span>
<span class="lineno">27 </span>        <span class="tok-n">menuBar</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">type</span><span class="tok-o">);</span>
<span class="lineno">28 </span>        <span class="tok-n">menuBar</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">operations</span><span class="tok-o">);</span>
<span class="lineno">29 </span>        <span class="tok-n">setJMenuBar</span><span class="tok-o">(</span><span class="tok-n">menuBar</span><span class="tok-o">);</span>
<span class="lineno">30 </span>		<span class="tok-c1">//Add widgets to applet content</span>
<span class="lineno">31 </span>        <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">score</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">NORTH</span> <span class="tok-o">);</span>
<span class="lineno">32 </span>        <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">label</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">WEST</span> <span class="tok-o">);</span>
<span class="lineno">33 </span>        <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">field</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">EAST</span> <span class="tok-o">);</span>
<span class="lineno">34 </span>        <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">submit</span><span class="tok-o">,</span> <span class="tok-n">BorderLayout</span><span class="tok-o">.</span><span class="tok-na">SOUTH</span> <span class="tok-o">);</span>
<span class="lineno">35 </span>    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like the <code>MathTutor</code> constructor, this method creates the menu bar,
the menus, and the menu items. Then, it adds action listeners to the
menu items and the button and an item listener to the check box menu
item. Next it adds <code>advanced</code> to the &#8220;Type&#8221; menu and the four
operation menu items to the &#8220;Operations&#8221; menu. It disables the
advanced menu items (since the applet starts in basic mode) and the
button (since it is impossible to submit an answer before a problem has
been given). Finally, it puts the menus on the menu bar, sets the menu
bar on the applet, and adds the two text fields, the label, and the
button to the applet content area using appropriate <code>BorderLayout</code>
constants.</p>
</div>
<div class="paragraph">
<p>One big difference between the <code>MathTutor</code> constructor and the
<code>MathTutorApplet</code> <code>init()</code> method is that the <code>MathTutor</code> constructor
creates a <code>JFrame</code> object. In <code>MathTutorApplet</code> no <code>JFrame</code> is necessary
because the class itself is a child of <code>JApplet</code> and thus is a GUI
container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">itemStateChanged</span><span class="tok-o">(</span><span class="tok-n">ItemEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    	<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getStateChange</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">ItemEvent</span><span class="tok-o">.</span><span class="tok-na">SELECTED</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>            <span class="tok-n">add</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno"> 4 </span>            <span class="tok-n">subtract</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>            <span class="tok-n">multiply</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno"> 6 </span>            <span class="tok-n">divide</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>    	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>    	<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>			<span class="tok-n">add</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">10 </span>			<span class="tok-n">subtract</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">11 </span>			<span class="tok-n">multiply</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-n">divide</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">13 </span>    	<span class="tok-o">}</span>
<span class="lineno">14 </span>    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>itemStateChanged()</code> method is the same as its counterpart in
<code>MathTutor</code>. If the state change is <code>ItemEvent.SELECTED</code>, we enable the
advanced menus and disable the basic ones. Otherwise, we do the reverse.
Note that this method would be more complicated if we were listening to
more than one object. Since we are only listening to the <code>advanced</code>
check box menu item, we know that it is what is being selected or
deselected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    	<span class="tok-n">Object</span> <span class="tok-n">object</span> <span class="tok-o">=</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">();</span>
<span class="lineno"> 3 </span>    	<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">object</span> <span class="tok-o">==</span> <span class="tok-n">submit</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    		<span class="tok-kt">int</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span><span class="tok-n">field</span><span class="tok-o">.</span><span class="tok-na">getText</span><span class="tok-o">());</span>
<span class="lineno"> 5 </span>    		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">response</span> <span class="tok-o">==</span> <span class="tok-n">answer</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>    			<span class="tok-n">correct</span><span class="tok-o">++;</span>
<span class="lineno"> 7 </span>    		<span class="tok-k">else</span>
<span class="lineno"> 8 </span>    			<span class="tok-n">incorrect</span><span class="tok-o">++;</span>
<span class="lineno"> 9 </span>			<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>    		<span class="tok-n">score</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Score: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">correct</span> <span class="tok-o">+</span> <span class="tok-s">&quot; Correct &quot;</span> <span class="tok-o">+</span>
<span class="lineno">11 </span>    				<span class="tok-n">incorrect</span> <span class="tok-o">+</span> <span class="tok-s">&quot; Incorrect&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-n">submit</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="lineno">13 </span>    	<span class="tok-o">}</span>
<span class="lineno">14 </span>    	<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>	    	<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">object</span> <span class="tok-o">==</span> <span class="tok-n">add</span> <span class="tok-o">)</span>
<span class="lineno">16 </span>	    		<span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">ProblemGenerator</span><span class="tok-o">.</span><span class="tok-na">addPractice</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
<span class="lineno">17 </span>	        <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">object</span> <span class="tok-o">==</span> <span class="tok-n">subtract</span> <span class="tok-o">)</span>
<span class="lineno">18 </span>	        	<span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">ProblemGenerator</span><span class="tok-o">.</span><span class="tok-na">subtractPractice</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
<span class="lineno">19 </span>	        <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">object</span> <span class="tok-o">==</span> <span class="tok-n">multiply</span> <span class="tok-o">)</span>
<span class="lineno">20 </span>	        	<span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">ProblemGenerator</span><span class="tok-o">.</span><span class="tok-na">multiplyPractice</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
<span class="lineno">21 </span>	        <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">object</span> <span class="tok-o">==</span> <span class="tok-n">divide</span> <span class="tok-o">)</span>
<span class="lineno">22 </span>	        	<span class="tok-n">answer</span> <span class="tok-o">=</span> <span class="tok-n">ProblemGenerator</span><span class="tok-o">.</span><span class="tok-na">dividePractice</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
<span class="lineno">23 </span>	    	<span class="tok-n">submit</span><span class="tok-o">.</span><span class="tok-na">setEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">24 </span>	    <span class="tok-o">}</span>
<span class="lineno">25 </span>    	<span class="tok-n">field</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">);</span>
<span class="lineno">26 </span>    <span class="tok-o">}</span>
<span class="lineno">27 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the <code>actionPerformed()</code> method deals with the menu item and
button clicks. If <code>submit</code> was clicked, we parse the text in the text
field to get an <code>int</code> value and compare it to the answer. Depending on
its correctness, we update the correct and incorrect counts, clear the
problem label, and update the <code>score</code> label. Finally, we disable the
<code>submit</code> button so that the user can&#8217;t submit an answer until another
problem has been given.</p>
</div>
<div class="paragraph">
<p>The next part of the <code>actionPerformed()</code> method has the same
functionality as the <code>actionPerformed()</code> method from <code>MathTutor</code>. It
updates <code>label</code> to contain a randomly generated problem with an
operation that matches whichever menu item was picked. It also saves the
answer into the <code>answer</code> field so that we can check the user&#8217;s response
later. Then, it enables the <code>submit</code> button since there is a problem to
answer. No matter what object triggered the action, the last line of the
method clears the text field.</p>
</div>
<div class="paragraph">
<p>We need some HTML to test the applet. Here is a suitable HTML file
similar to the <code>RainbowApplet.html</code> file presented before.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-o">&lt;</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">title</span><span class="tok-o">&gt;</span><span class="tok-n">Math</span> <span class="tok-n">Tutor</span> <span class="tok-n">Applet</span><span class="tok-o">&lt;/</span><span class="tok-n">title</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;/</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">applet</span> <span class="tok-n">code</span><span class="tok-o">=</span><span class="tok-s">&quot;MathTutorApplet.class&quot;</span> <span class="tok-n">width</span><span class="tok-o">=</span><span class="tok-s">&quot;250&quot;</span> <span class="tok-n">height</span><span class="tok-o">=</span><span class="tok-s">&quot;125&quot;</span><span class="tok-o">&gt;&lt;/</span><span class="tok-n">applet</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">hr</span> <span class="tok-o">/&gt;&lt;</span><span class="tok-n">a</span> <span class="tok-n">href</span><span class="tok-o">=</span><span class="tok-s">&quot;MathTutorApplet.java&quot;</span><span class="tok-o">&gt;</span><span class="tok-n">The</span> <span class="tok-n">source</span> <span class="tok-n">code</span><span class="tok-o">.&lt;/</span><span class="tok-n">a</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;/</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">html</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the stand-alone <code>MathTutor</code> application, we created a <code>JFrame</code> and
set its size to 250 × 125 pixels. The <code>width</code> and
<code>height</code> attributes in the HTML allow us to accomplish something
similar. Note that the widgets in the applet have more room than in the
<code>JFrame</code> version because the size of the <code>JFrame</code> includes the title bar
and window borders.</p>
</div>
<div class="paragraph">
<p>The functionality of this applet is limited, but it still shows off
menus, buttons, labels, text fields, applet creation, and two different
kinds of event listeners.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_guis">15.5. Concurrency: GUIs</h3>
<div class="paragraph">
<p>Stand-alone Java programs have at least one thread, the main thread.
Applets have a similar thread that calls its <code>init()</code> and <code>start()</code>
methods. Applications with GUIs (including applets) create additional
threads to manage the GUI behind the scenes.</p>
</div>
<div class="paragraph">
<p>Although a GUI will create several threads, the most important for the
programmer to worry about is called the <em>event dispatch thread</em> (EDT).
This thread handles events like button clicks. When you write your
<code>actionPerformed()</code> method, remember that the EDT is the one that will
actually execute the code inside.</p>
</div>
<div class="paragraph">
<p>If you are writing a complex program, the EDT may interact with many
other threads, and the synchronization issues discussed in
<a href="#_synchronization">Chapter 14</a> will become important. However, only
the EDT is allowed to change the state of widgets in a GUI. Using other
threads to do so will work some of the time, but it is not thread-safe
and violates the design of Swing.</p>
</div>
<div class="sect3">
<h4 id="_worker_threads">15.5.1. Worker threads</h4>
<div class="paragraph">
<p>Thread safety is not the most common multi-threaded GUI problem,
however. Unresponsive GUIs can be found on almost every platform, as you
have no doubt experienced. In Java, unresponsive GUIs usually happen
because the programmer is using the event dispatch thread to do some
task that takes too long. Because the EDT is responsible for updating
the GUI, the GUI freezes, and the user has to wait.</p>
</div>
<div class="paragraph">
<p>This is quite a conundrum. On the one hand, the EDT is the only thread
allowed to update widgets. On the other, it has to do its work quickly
so that the GUI is responsive. The solution is to spawn <em>worker threads</em>
to do the job. When they are done, they inform the EDT so that it is
able to update the GUI.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a GUI with two <code>JButton</code> widgets and two <code>JLabel</code> widgets.
When one button is pressed, the EDT goes to sleep for 5 seconds before
displaying an answer on the first label (in this case, approximately
\(\sqrt{2}\)). When the other button is pressed, it increments
a counter and displays the value in the second label.</p>
</div>
<div id="UnresponsiveGUIProgram" class="listingblock">
<div class="title">Program 69. GUI that becomes unresponsive when the &#8220;Compute&#8221; button is pressed.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UnresponsiveGUI</span> <span class="tok-kd">extends</span> <span class="tok-n">JFrame</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">implements</span> <span class="tok-n">ActionListener</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>	<span class="tok-n">JLabel</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;Answer:&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>	<span class="tok-n">JButton</span> <span class="tok-n">compute</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Compute&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>	<span class="tok-n">JLabel</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;0&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>	<span class="tok-n">JButton</span> <span class="tok-n">increment</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Increment&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>	<span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">args</span><span class="tok-o">[])</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>		<span class="tok-n">UnresponsiveGUI</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">UnresponsiveGUI</span><span class="tok-o">();</span>
<span class="lineno">15 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span><span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">16 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">250</span><span class="tok-o">,</span><span class="tok-mi">150</span><span class="tok-o">);</span>
<span class="lineno">17 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">18 </span>	<span class="tok-o">}</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span>	<span class="tok-kd">public</span> <span class="tok-nf">UnresponsiveGUI</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">21 </span>		<span class="tok-n">setLayout</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GridLayout</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">));</span>
<span class="lineno">22 </span>		<span class="tok-n">setTitle</span><span class="tok-o">(</span><span class="tok-s">&quot;Unresponsive GUI&quot;</span><span class="tok-o">);</span>
<span class="lineno">23 </span>		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
<span class="lineno">24 </span>		<span class="tok-n">compute</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">25 </span>		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">compute</span><span class="tok-o">);</span>
<span class="lineno">26 </span>		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">counter</span><span class="tok-o">);</span>
<span class="lineno">27 </span>		<span class="tok-n">increment</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">28 </span>		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">increment</span><span class="tok-o">);</span>
<span class="lineno">29 </span>	<span class="tok-o">}</span>
<span class="lineno">30 </span>
<span class="lineno">31 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">32 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">compute</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">33 </span>			<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Computing...&quot;</span><span class="tok-o">);</span>
<span class="lineno">34 </span>	    	<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">35 </span>	            <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">5000</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{unresponsive sleep}@*/</span>
<span class="lineno">36 </span>	        <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">ignore</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-o">}</span>
<span class="lineno">37 </span>	        <span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Answer: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-mf">2.0</span><span class="tok-o">));</span>
<span class="lineno">38 </span>		<span class="tok-o">}</span>
<span class="lineno">39 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">40 </span>			<span class="tok-n">count</span><span class="tok-o">++;</span>
<span class="lineno">41 </span>			<span class="tok-n">counter</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">count</span><span class="tok-o">);</span>
<span class="lineno">42 </span>		<span class="tok-o">}</span>
<span class="lineno">43 </span>	<span class="tok-o">}</span>
<span class="lineno">44 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="unresponsiveGUIFigure" class="imageblock text-center">
<div class="content">
<img src="chapters/15-gui/images/unresponsiveGUIFigure.png" alt="unresponsiveGUIFigure" width="40%">
</div>
<div class="title">Figure 70. GUI generated by <a href="#UnresponsiveGUIProgram">Program 69</a>.</div>
</div>
<div class="paragraph">
<p>If you click the &#8220;Compute&#8221; button, the GUI becomes unresponsive.
Specifically, you cannot click on the &#8220;Increment&#8221; button, but you
should still be able to move the frame around the desktop on most
systems. Furthermore, some thread in the GUI is registering the clicks
you do on the &#8220;Increment&#8221; button, but events triggered by those clicks
are not handled until after the EDT wakes up. At that point, the counter
will shoot up in value unpredictably.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.23">Exercise 15.23</a><br>
<a href="#exercise15.24">Exercise 15.24</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>One solution is to create an anonymous inner class that extends
<code>SwingWorker</code>. The <code>SwingWorker</code> class is abstract, but it is also
<em>generic</em>, meaning that it has type parameters (given in angle brackets)
which specify what type of objects it interacts with. Generic classes
are often containers like <code>LinkedList</code> where the type parameter says
what kind of objects will be kept in the list. <a href="#_dynamic_data_structures">Chapter 18</a> covers generics in some depth. The reason we need
generics for <code>SwingWorker</code> is so that it can specify what kind of object
it will return when it finishes its work. The first type parameter
specifies the type that the worker will return when it completes its
work. The second specifies the type that the worker will return
periodically in the process of doing work (which can be useful for
updating progress bars). Examine the following program which has added a
<code>SwingWorker</code> to its <code>actionPerformed()</code> method but is otherwise the
same as <a href="#UnresponsiveGUIProgram">Program 69</a>.</p>
</div>
<div id="WorkerGUIProgram" class="listingblock">
<div class="title">Program 70. GUI that uses <code>SwingWorker</code> to avoid becoming unresponsive.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">javax.swing.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.awt.event.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WorkerGUI</span> <span class="tok-kd">extends</span> <span class="tok-n">JFrame</span> <span class="tok-kd">implements</span> <span class="tok-n">ActionListener</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>	<span class="tok-n">JLabel</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;Answer:&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>	<span class="tok-n">JButton</span> <span class="tok-n">compute</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Compute&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>	<span class="tok-n">JLabel</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;0&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 9 </span>	<span class="tok-n">JButton</span> <span class="tok-n">increment</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JButton</span><span class="tok-o">(</span><span class="tok-s">&quot;Increment&quot;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>	<span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">args</span><span class="tok-o">[])</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>		<span class="tok-n">WorkerGUI</span> <span class="tok-n">frame</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">WorkerGUI</span><span class="tok-o">();</span>
<span class="lineno">14 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setDefaultCloseOperation</span><span class="tok-o">(</span><span class="tok-n">JFrame</span><span class="tok-o">.</span><span class="tok-na">DISPOSE_ON_CLOSE</span><span class="tok-o">);</span>
<span class="lineno">15 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setSize</span><span class="tok-o">(</span><span class="tok-mi">250</span><span class="tok-o">,</span><span class="tok-mi">150</span><span class="tok-o">);</span>
<span class="lineno">16 </span>		<span class="tok-n">frame</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span>	<span class="tok-kd">public</span> <span class="tok-nf">WorkerGUI</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>		<span class="tok-n">setLayout</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GridLayout</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">,</span><span class="tok-mi">1</span><span class="tok-o">));</span>
<span class="lineno">21 </span>		<span class="tok-n">setTitle</span><span class="tok-o">(</span><span class="tok-s">&quot;Worker GUI&quot;</span><span class="tok-o">);</span>
<span class="lineno">22 </span>		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
<span class="lineno">23 </span>		<span class="tok-n">compute</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">24 </span>		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">compute</span><span class="tok-o">);</span>
<span class="lineno">25 </span>		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">counter</span><span class="tok-o">);</span>
<span class="lineno">26 </span>		<span class="tok-n">increment</span><span class="tok-o">.</span><span class="tok-na">addActionListener</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
<span class="lineno">27 </span>		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">increment</span><span class="tok-o">);</span>
<span class="lineno">28 </span>	<span class="tok-o">}</span>
<span class="lineno">29 </span>
<span class="lineno">30 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">actionPerformed</span><span class="tok-o">(</span><span class="tok-n">ActionEvent</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getSource</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">compute</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">32 </span>			<span class="tok-n">SwingWorker</span> <span class="tok-n">worker</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SwingWorker</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Void</span><span class="tok-o">&gt;()</span> <span class="tok-o">{</span>
<span class="lineno">33 </span>			    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">doInBackground</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">34 </span>			    	<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">35 </span>			            <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">5000</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{responsive sleep}@*/</span>
<span class="lineno">36 </span>			        <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">ignore</span> <span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">37 </span>			        <span class="tok-k">return</span> <span class="tok-s">&quot;Answer: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-mf">2.0</span><span class="tok-o">);</span>
<span class="lineno">38 </span>			    <span class="tok-o">}</span>
<span class="lineno">39 </span>
<span class="lineno">40 </span>			    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">done</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">41 </span>			        <span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">42 </span>			        	<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-n">get</span><span class="tok-o">());</span>
<span class="lineno">43 </span>			        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">ignore</span><span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">44 </span>			    <span class="tok-o">}</span>
<span class="lineno">45 </span>			<span class="tok-o">};</span>
<span class="lineno">46 </span>
<span class="lineno">47 </span>			<span class="tok-n">worker</span><span class="tok-o">.</span><span class="tok-na">execute</span><span class="tok-o">();</span>
<span class="lineno">48 </span>			<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;Computing...&quot;</span><span class="tok-o">);</span>
<span class="lineno">49 </span>		<span class="tok-o">}</span>
<span class="lineno">50 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">51 </span>			<span class="tok-n">count</span><span class="tok-o">++;</span>
<span class="lineno">52 </span>			<span class="tok-n">counter</span><span class="tok-o">.</span><span class="tok-na">setText</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">count</span><span class="tok-o">);</span>
<span class="lineno">53 </span>		<span class="tok-o">}</span>
<span class="lineno">54 </span>	<span class="tok-o">}</span>
<span class="lineno">55 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this program, the first type parameter for the <code>SwingWorker</code> is
<code>String</code> because we are going to set the text in a <code>JLabel</code> with its
result. The second parameter is <code>Void</code>, meaning that we do not intend to
return any values periodically. Most child classes of <code>SwingWorker</code>
should override the <code>doInBackground()</code> and <code>done()</code> methods.</p>
</div>
<div class="paragraph">
<p>The <code>doInBackground()</code> method performs the time-consuming work that we
want done on another thread. In our example, the &#8220;work&#8221; is going to
sleep, but it will generally be some CPU or I/O intensive process.
Afterwards, it returns the answer it found. The <code>done()</code> method is
called automatically by the EDT after <code>doInBackground()</code> finishes. After
the <code>SwingWorker</code> object has been created, the <code>execute()</code> method starts
it working. The GUI will look identical to the unresponsive version
(except for the title), but it will remain responsive.</p>
</div>
<div class="paragraph">
<p>This syntax is not particularly elegant, but it accomplishes a complex
task. It spawns a thread transparently, and then the EDT is given work
when the thread gives back its answer. Using a <code>SwingWorker</code> is not
always required, but it is a useful tool to have in your arsenal if you
plan on writing industrial-strength GUIs.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise15.25">Exercise 15.25</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_6">15.6. Summary</h3>
<div class="paragraph">
<p>In this chapter we introduce the basics of constructing a GUI to allow
users to interact with an application. We show how to add widgets such
as buttons and text boxes and use layout managers to organize their
appearance. We show how you can add action listeners and other event
handlers so that user actions can perform useful tasks. Finally, we show
how these techniques can be applied to GUIs on stand-alone applications
as well as applets that run inside of a web browser.</p>
</div>
<div class="paragraph">
<p>While Java offers a large variety of widgets and listeners, this
introduction is limited to a few of the most commonly used. Once you
understand the basics of GUI construction as described in this chapter,
it should be easy to understand the extensive Java tutorial at
<a href="http://download.oracle.com/javase/tutorial/uiswing/components/" class="bare">http://download.oracle.com/javase/tutorial/uiswing/components/</a> or other
reference sources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_15">15.7. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise15.1"></a> In
<a href="#FrameWithPanelAndActionsProgram">Program 55</a>, why have we declared the
buttons and the text box to be <code>final</code>?</p>
</li>
<li>
<p><a id="exercise15.2"></a> Note that both <code>ActionListener</code>
and <code>MouseListener</code> interfaces can be used to process button clicks.
Under which circumstances is <code>ActionListener</code> better? Under which is
<code>MouseListener</code> better?</p>
</li>
<li>
<p><a id="exercise15.3"></a> Why is the <code>MouseAdapter</code>
abstract class useful?</p>
</li>
<li>
<p><a id="exercise15.4"></a> What do you expect will happen if you
used <code>setJMenuBar()</code> to set two different menu bars on a single <code>JFrame</code>
object?</p>
</li>
<li>
<p><a id="exercise15.5"></a> Describe the situations that the
following event listeners are useful for: <code>ActionListener</code>,
<code>MouseListener</code>, <code>ItemListener</code>, and <code>KeyListener</code></p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise15.6"></a> Remove the two
instances of the keyword <code>final</code> from
<a href="#FrameWithPanelAndActionsProgram">Program 55</a> and try to compile it. Why
does the compiler complain? What do you conclude regarding the use of
<code>final</code> with respect to local variables used in the <code>actionPerformed()</code>
method of an anonymous inner class? Why is this not a concern for
top-level, named classes used as an <code>ActionListener</code>?</p>
</li>
<li>
<p><a id="exercise15.7"></a> Write a program that creates a
GUI containing two buttons labeled &#8220;Start&#8221; and &#8220;Done.&#8221; The GUI frame
should be labeled &#8220;Start and Done.&#8221;</p>
</li>
<li>
<p><a id="exercise15.8"></a> Modify
<a href="#SimpleMouseEventsProgram">Program 57</a> by implementing the
<code>mouseExited()</code>, <code>mousePressed()</code>, and <code>mouseReleased()</code> methods. Each
method must display a suitable message in the text box when the
corresponding event occurs. For example, when the mouse exits button
<code>one</code>, the text box should display &#8220;Mouse exits One.&#8221;</p>
</li>
<li>
<p><a id="exercise15.9"></a> Modify
<a href="#IconExampleProgram">Program 60</a> such that clicking the icon-decorated
button generates a roaring sound. Note that this will require you to add
an <code>ActionListener</code> to the button, create an audio clip for the desired
sound, and then play this click when the button is clicked. Consider
visiting <a href="http://www.freesound.org/" class="bare">http://www.freesound.org/</a> for free sound files.</p>
</li>
<li>
<p><a id="exercise15.10"></a> Write a Java program that
creates a GUI containing a label with a picture of yourself.</p>
</li>
<li>
<p><a id="exercise15.11"></a> Extend the <code>SoundGame</code> class
developed in <a href="#soundGameExample">Example 117</a> to include sounds for
various animals. You may find a variety of publicly available sounds
files for use in your program. The Freesound link above is only one
source.</p>
<div class="paragraph">
<p>Note that some sites explicitly ask you not to embed the sound file URL
into your program. In those cases, download the sound file into your
local directory and load it from there into your application.</p>
</div>
</li>
<li>
<p><a id="exercise15.12"></a> In <a href="#soundGameExample">Example 117</a> we stopped both the chirp and the bark sounds because the action
listener corresponding to the &#8220;Stop Playing&#8221; button does not know
which sound is playing. Modify <a href="#SoundGameProgram">[SoundGameProgram]</a> so that
only the sound that is playing is stopped. You may need to declare
another variable to keep track of which is playing.</p>
</li>
<li>
<p><a id="exercise15.13"></a> Modify
<a href="#AnimalIdentifierProgram">Program 63</a> so that it plays a sound associated
with an animal when the mouse is clicked over its label. Note that this
is an example of a situation where a <code>MouseListener</code> can be used to
listen for mouse click events though an <code>ActionListener</code> cannot. As in
<a href="#exercise15.9">Exercise 15.9</a> and <a href="#exercise15.11">Exercise 15.11</a>, you may need to download sounds from
the Internet.</p>
</li>
<li>
<p><a id="exercise15.14"></a> Modify the applet from
<a href="#_solution_math_applet">Section 15.4</a> to display the problem number the user
is working on. The first problem is numbered &#8220;Problem 1&#8221; with
subsequent problems 2, 3, and so on. The number should increase each
time the user hits the Submit button. Find a suitable place on the GUI
to display this information. You may need to add a panel to reorganize
the GUI.</p>
</li>
<li>
<p><a id="exercise15.15"></a> Remove the <code>actionPerformed()</code> and
<code>itemStateChanged()</code> methods from the <code>MathTutorApplet</code> class given in
<a href="#_solution_math_applet">Section 15.4</a>. Move the code from these methods into
individual anonymous inner classes added to the <code>add</code>, <code>subtract</code>,
<code>multiply</code>, <code>divide</code>, <code>submit</code>, and <code>advanced</code> objects.</p>
<div class="paragraph">
<p>Note that you are now able to remove <code>ActionListener</code> and <code>ItemListener</code>
from the list of implemented interfaces for the <code>MathTutorApplet</code> class.
Reorganizing the code this way should have no impact on the
functionality of the applet. Is doing so a good idea or not? Why?</p>
</div>
</li>
<li>
<p><a id="exercise15.16"></a> In
<a href="#FrameWithPanelAndActionsProgram">Program 55</a> exchange the first two
<code>add()</code> method calls on the <code>soundPanel</code> so that <code>bark</code> is added to the
panel before the <code>chirp</code>. Explain how the appearance of the GUI is
changed.</p>
</li>
<li>
<p><a id="exercise15.17"></a> Modify
<a href="#FrameWithPanelProgram">Program 54</a> by adding a second panel named
<code>secondPanel</code>. Create a new button named <code>train</code> with the label
&#8220;Train.&#8221; Add <code>train</code> to <code>secondPanel</code>. Now add <code>secondPanel</code> to
<code>soundCheck</code> and look at the GUI generated. Can you explain why only one
panel is visible?</p>
</li>
<li>
<p><a id="exercise15.18"></a> Remove
line <a href="#disableResizableLine">[disableResizableLine]</a> from
<a href="#FlowLayoutExampleProgram">Program 62</a>. Run the modified program and
resize the frame to various sizes. How does the placement of the buttons
change?</p>
</li>
<li>
<p><a id="exercise15.19"></a> Modify
<a href="#FlowLayoutExampleProgram">Program 62</a> by deleting the lines that set the
frame size. What does the resulting GUI look like? Now add the following
code just before line <a href="#disableResizableLine">[disableResizableLine]</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">demo</span><span class="tok-o">.</span><span class="tok-na">pack</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run the modified program, what is the impact of using the
<code>pack()</code> method?</p>
</div>
</li>
<li>
<p><a id="exercise15.20"></a> Create a GUI with a frame that uses
<code>GridLayout</code> and has a suitable size. Use a 3 × 2
layout with a horizontal and vertical spacing of 5 pixels each. Use a
loop to add eight buttons to your frame, labeled 1 through 8. Observe
how the frame expands to include all the buttons even though the
initially specified <code>GridLayout</code> had only 6 cells. Depending on the
frame size, you might have to resize the window to see all cells and
buttons. What happens if you add fewer than 6?</p>
</li>
<li>
<p><a id="exercise15.21"></a> Write a Java program that creates
a GUI with a frame and a menu bar containing a single menu. Add a menu
item to this menu. Use the <code>add()</code> method, not the <code>setJMenuBar()</code>
method, to add the menu bar to the frame. What is the difference between
using the <code>add()</code> method and the <code>setJMenuBar()</code> method to add a menu
bar to a <code>JFrame</code>?</p>
</li>
<li>
<p><a id="exercise15.22"></a> Use the example from the book to
create a suitable HTML file that embeds the <code>RainbowApplet</code> class from
<a href="#rainbowAppletExample">Example 125</a> and links to the Java source code. Now
upload the class file, the source code, and the HTML file to a web
server so that you can run the applet over the Internet. Have a friend
test out your code on a computer in another location to make sure that
it works.</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise15.23"></a> Recall that
<a href="#UnresponsiveGUIProgram">Program 69</a> is unresponsive because the event
dispatch thread goes to sleep for 5 seconds (5,000 milliseconds) on
line <a href="#unresponsive_sleep">[unresponsive_sleep]</a>. Experiment with this value to determine
what is a reasonable amount of time for the EDT to be blocked before the
GUI feels unresponsive.</p>
</li>
<li>
<p><a id="exercise15.24"></a> <a href="#UnresponsiveGUIProgram">Program 69</a> is
unrealistic because the EDT simply goes to sleep. Normally, a GUI
becomes unresponsive because the EDT is performing extensive
calculations or doing slow I/O operations. Replace line <a href="#unresponsive
sleep">[unresponsive
sleep]</a> with a short loop that performs significant calculations. One
simple way to spend a lot of computational time is by summing the sines
of random numbers, similar to the work done in <a href="#arraySummationExample">Example 103</a>. How many sines do you need to compute to make the GUI
unresponsive for 5 seconds?</p>
</li>
<li>
<p><a id="exercise15.25"></a> Take the computationally expensive loop
from <a href="#exercise15.24">Exercise 15.24</a> and use it to replace
line <a href="#responsive_sleep">[responsive_sleep]</a> in <a href="#WorkerGUIProgram">Program 70</a>, the
<code>SwingWorker</code> version of the program. Does the program become
unresponsive if you run it? If possible, run the program on Windows,
Mac, and Linux environments. If it is unresponsive in some environments
but not others, why do you think that might be?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_and_debugging">16. Testing and Debugging</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>I never make stupid mistakes. Only very, very clever ones.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; John Peel
</div>
</div>
<div class="sect2">
<h3 id="_fixing_bugs">16.1. Fixing bugs</h3>
<div class="paragraph">
<p>This chapter is about finding, fixing, and, more importantly, preventing
bugs in software. This chapter is unique in that it is not based on
clearly stated concrete problems with straightforward solutions. As it
stands now, finding and fixing bugs in software, especially concurrent
software, is a problem which no one has solved completely. The first
half of this chapter will focus on common bugs and how to fix them. The
second half will focus on design techniques for preventing bugs and
testing to see if any hidden bugs remain in your code.</p>
</div>
<div class="sect3">
<h4 id="_common_sequential_bugs">16.1.1. Common sequential bugs</h4>
<div class="paragraph">
<p>We will begin with bugs commonly found in sequential programs, some of
which have already been mentioned as common mistakes in previous
chapters. We will not discuss syntax errors or any other errors which
can be caught at compile time. Instead, all bugs discussed in this
chapter are run-time bugs.</p>
</div>
<div class="paragraph">
<p>There are an infinite number of possible bugs and so they cannot all be
listed. Below are a few of the most common categories of bugs to affect
beginner (and occasionally veteran) programmers.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Precision Errors</dt>
<dd>
<p>Floating point numbers have limited precision inside of a computer.
Programs that assume infinite precision may break when real results
are slightly larger or smaller than expected.</p>
</dd>
<dt class="hdlist1">Overflow and Underflow</dt>
<dd>
<p>In some sense the cousin of precision in floating point types is the
limited range of values that integer types can take on. If the value
goes too high, it wraps back around and becomes a negative number. If
the values becomes too low, the opposite can happen.</p>
</dd>
<dt class="hdlist1">Casting Errors</dt>
<dd>
<p>Casting can have many subtle effects in a program. Sometimes
programmers divide two integers and forget that the result is an
integer. Incorrectly casting objects can lead to
`ClassCastException`s.</p>
</dd>
<dt class="hdlist1">Loop Errors</dt>
<dd>
<p>Loops are a favorite place for bugs to hide. Three of the most common
loop mistakes are:</p>
<div class="ulist">
<ul>
<li>
<p>Off-by-one errors: The loop executes one more or one fewer time than
expected.</p>
</li>
<li>
<p>Infinite loop: A classic. The loop continues executing until the
program runs out of memory or a user stops the program externally.</p>
</li>
<li>
<p>Zero loop: The loop does not execute even once, even though the
programmer expected it to.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Equivalence Testing Errors</dt>
<dd>
<p>If a programmer uses the <code>==</code> operator to compare two references, it
will be true only if the two references point at the same object.
Although doing so is occasionally necessary, the <code>equals()</code> method
should usually be used to compare the attributes of the objects
pointed at by the references.</p>
</dd>
<dt class="hdlist1">Array Errors</dt>
<dd>
<p>Arrays are often involved with loop errors. Two problems specific to
arrays are:</p>
<div class="ulist">
<ul>
<li>
<p>Out of bounds: A math mistake or an off-by-one error could lead to
trying to access an element of an array that comes before element 0 or
after the last element.</p>
</li>
<li>
<p>Uninitialized object arrays: Arrays of primitive data types can be
created and used instantly; however, arrays of object types are filled
with nulls until each element is assigned an object, often a new
object.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Scope Errors</dt>
<dd>
<p>Some errors can be caused by a programmer&#8217;s misunderstanding about the
visibility of a variable.</p>
<div class="ulist">
<ul>
<li>
<p>Shadowing variables: If a local variable is declared with the same
name as a field or class variable, changes within a method will be
made to that local variable. This principle is straightforward, but,
if a programmer does not notice the shadow declaration, the behavior
of the code can be very confusing.</p>
</li>
<li>
<p>Reference vs. value: When primitive data is passed as an argument
into a method, its value is copied into the method, and the original
data is unchanged. When an object is passed as an argument into a
method, the reference is unchanged, but methods called on the object
can still affect it.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Null Pointer Errors</dt>
<dd>
<p>By this point in your programming experience, you have almost
certainly experienced a <code>NullPointerException</code>. This is, in many ways,
a catch-all category, because a null reference is generally not due to
a simple typographical error. In the simplest case, a reference simply
has not been initialized with some default constructor, but more often
there is a logical error in the design of the code.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_approaches_to_debugging">16.2. Concepts: Approaches to debugging</h3>
<div class="paragraph">
<p>When you have discovered the existence of a bug, pinning down its cause
can be difficult. There are a number of different techniques that are
useful for narrowing down the possible problems.</p>
</div>
<div class="sect3">
<h4 id="_assertions">16.2.1. Assertions</h4>
<div class="paragraph">
<p>A common cause of program errors is an incorrect assumption by a
programmer. A programmer can assume that the user will only enter
positive numbers, that a library call will not throw any exceptions, or
that a linked list is not empty. Some assumptions are reasonable, but it
is important to make sure that they are correct.</p>
</div>
<div class="paragraph">
<p>Using <em>assertions</em> is a way to check some of your assumptions, often
those surrounding a method call. In most languages, an assertion tests a
condition. If that condition is true, nothing happens, but, if it is
false, the program shuts down or an error or exception is thrown. Using
assertion statements is particularly important with methods because you
want to be sure that both your input and output are in the ranges you
expect them to be.</p>
</div>
<div class="paragraph">
<p>Java supports assertions natively, as we will discuss in the next
section. However, virtually every language allows you to create your own
assertions should they not be present as a language construct.</p>
</div>
</div>
<div class="sect3">
<h4 id="_print_statements">16.2.2. Print statements</h4>
<div class="paragraph">
<p>Computer programs execute quickly. Even if they executed a million times
more slowly no human is sensitive enough to decipher the flow of
electrons inside the processor as a program executes. The simple truth
is that we have no idea what is happening when our programs execute. We
believe that we understand our programs well, and the output usually
confirms that our program is doing what we imagine that it should be
doing.</p>
</div>
<div class="paragraph">
<p>If the output does not match what is expected, we may not have enough
data to understand the problem. Since there have been programmers, they
have been printing out additional debug information to find their
errors. This technique can go a step beyond simple assertion statements
because you can print out the values of the variables rather than just
test to see if they are in a range.</p>
</div>
<div class="paragraph">
<p>Once you have found the error in your code, it can be tedious to remove
all of your debug statements. Some programmers use a special print
command that can be turned off using a global variable or compiler
option. Others send their output to <code>stderr</code> so that it doesn&#8217;t
interfere with the legitimate output of the program. Much depends upon
the system, the language, and the individual tastes of the programmer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_through_execution">16.2.3. Step-through execution</h4>
<div class="paragraph">
<p>With the rise of modern debugging environments, using print statements
has lost some of its appeal. Most languages allow the programmer to run
his or her program in a special debug mode in which it is possible to
execute a single line of code at a time. These tools usually give the
option of stepping over method calls or stepping into them, on a case by
case basis.</p>
</div>
<div class="paragraph">
<p>As the program executes, the programmer can inspect the values of the
variables in the code. This method of debugging is excellent because it
allows the programmer to watch the execution of the code at whatever
pace he or she desires. Pinpointing problems becomes trivial if you know
which variables you need to watch.</p>
</div>
<div class="paragraph">
<p>Despite the power of this technique, it has critics. Some older
programmers look down on these tools because they make beginning
programmers lazier and, in some cases, less careful about writing code
correctly in the first place. It should be noted that step-through
execution modes are not available for every language and for every
system. Some embedded software or operating system programming cannot be
debugged on the real hardware in this way. Of course, most of these
systems can be run in virtual environments that do allow step-through
debugging.</p>
</div>
<div class="paragraph">
<p>Even when step through debugging is available, there are difficulties
that can limit its effectiveness. If the bug occurs sporadically,
perhaps due to race conditions, a programmer may not know where to start
looking. Certain data structures such as the <code>list</code> template in C++ may
not be easily traversable using the inspection facilities of the
debugger. Likewise, the bug or the source of the unexplained behavior
could be buried in library code. The debugger does not always have
access to library code for stepping through.</p>
</div>
</div>
<div class="sect3">
<h4 id="_breakpoints">16.2.4. Breakpoints</h4>
<div class="paragraph">
<p>Breakpoints are a feature of step-through debuggers designed to make
them easier to use. A user can specify a particular line of code (with
some restrictions) as being a place where the debugger should pause
execution. Debuggers typically rely on at least one breakpoint in order
to skip all the preliminary parts of the code and skip straight to the
perceived trouble spot.</p>
</div>
<div class="paragraph">
<p>Sometimes an error will predictably crop up after many thousands of
iterations of a loop or unpredictably in the case of bugs dependent on
race conditions or user input. For either of these cases, conditional
breakpoints can be used to save the debugger a great deal of time.
Rather than always pausing execution on a given line, a conditional
breakpoint will only pause if a certain condition is met.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_java_debugging_tools">16.3. Syntax: Java debugging tools</h3>
<div class="sect3">
<h4 id="_assertions_2">16.3.1. Assertions</h4>
<div class="paragraph">
<p>As we mentioned before, many languages have assertions as a built-in
language construct. In Java, there are two forms this feature takes. The
simpler can be done by typing the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">assert</span> <span class="tok-n">condition</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>condition</code> is a boolean value that is expected to be true
for the program to function properly. The more complicated form of the
feature can be used as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">assert</span> <span class="tok-n">condition</span> <span class="tok-o">:</span> <span class="tok-n">value</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This form adds a value that can be attached to the assertion to give the
user more information about the problem. This value can be any primitive
data type, any object type, or a statement that evaluates to one of the
two.</p>
</div>
<div class="paragraph">
<p>If you have never used an <code>assert</code> statement before, you might want to
test it out by forcing an assertion to fail. You might try</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-k">assert</span> <span class="tok-o">(</span><span class="tok-n">x</span> <span class="tok-o">&lt;</span> <span class="tok-mi">4</span><span class="tok-o">)</span> <span class="tok-o">:</span> <span class="tok-s">&quot;x is too large!&quot;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, if you compile your program and run it through the JVM, you will
be shocked when <strong>absolutely nothing happens</strong>. Actually, some of you with
older Java compilers may have heard complaints when you tried to
compile. If you have a Java 1.3 compiler or earlier, it will treat
<code>assert</code> like an identifier. Some old Java 1.4 compilers may also give
warnings or require special flags to be set to compile. However, if you
have an up to date compiler, the problem is that the JVM must have
assertions enabled at runtime. Assertions are intended to be a special
debugging tool and ignored otherwise. To turn run program
<code>AssertionTest</code> with assertions enabled, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">java</span> <span class="tok-o">-</span><span class="tok-n">ea</span> <span class="tok-n">AssertionTest</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this option, an exception should be thrown at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Exception</span> <span class="tok-n">in</span> <span class="tok-n">thread</span> <span class="tok-s">&quot;main&quot;</span> <span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">AssertionError</span><span class="tok-o">:</span> <span class="tok-n">x</span> <span class="tok-n">is</span> <span class="tok-n">too</span> <span class="tok-n">large</span><span class="tok-o">!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are other options allowing you to enable or disable assertions for
specific packages or classes.</p>
</div>
<div class="paragraph">
<p>Now that you know how to use assertions, you need to know when they are
a good idea. The Java Tutorials on the Oracle website suggest five
situations where assertions are useful: internal invariants,
control-flow invariants, preconditions for methods, postconditions for
methods, and class invariants. <em>Internal invariants</em> are those
situations when you assume that reaching a certain place in your code,
like the <code>else</code> branch of an <code>if</code> statement, will force a variable to
have a certain value. For internal invariants, you assert that the
variable has the expected value. A <em>control-flow invariant</em> means that
you assume that your code will always execute along a certain path. For
control-flow invariants, you assert <code>false</code> if the JVM reaches a point
in the code you expected it never would. <em>Method preconditions</em> are
those conditions you expect to be true about the state of objects or the
input to a method before the method is called.</p>
</div>
<div class="paragraph">
<p>The philosophy of Java is that <code>public</code> methods should <em>not</em> have
assertions used to test their preconditions. Instead, illegal input
values for a <code>public</code> method should cause exceptions to be thrown, so
that improper usage can always be dealt with. In contrast, <em>method
postconditions</em> are the states that various variables and objects should
have at the end of a method call. Using assertions to check these values
is fine, since they reflect an error on the part of whoever wrote the
method. <em>Class invariants</em> are conditions about the state of every
instance of a class that should be true as long as the class is in a
consistent state. Perhaps a method call rearranges the innards of an
object, but, by the end of the method call, the object should be
consistent again. You should use assertions to check class invariants at
the end of every method that could make the object violate the
invariants.</p>
</div>
<div class="paragraph">
<p>Wonderful as assertions are, there are times when they should not be
used. The key danger of assertions is that they are usually turned off.
Thus, any statement that is part of an assertion should not have
side-effects that are necessary for the normal operation of the program.
For example, imagine that you have a object called <code>bacteria</code> that
mutates periodically. The mutation returns <code>true</code> if successful and
<code>false</code> if there was an unexpected error. You should <strong>not</strong> test for that
failure inside an assert, as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">assert</span> <span class="tok-n">bacteria</span><span class="tok-o">.</span><span class="tok-na">mutate</span><span class="tok-o">()</span> <span class="tok-o">:</span> <span class="tok-s">&quot;Mutation failed!&quot;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With assertions disabled, the <code>bacteria</code> object will no longer mutate.
Instead, your assertion should test only the result of the computation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">success</span> <span class="tok-o">=</span> <span class="tok-n">bacteria</span><span class="tok-o">.</span><span class="tok-na">mutate</span><span class="tok-o">();</span>
<span class="tok-k">assert</span> <span class="tok-n">success</span> <span class="tok-o">:</span> <span class="tok-s">&quot;Mutation failed!&quot;</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As stated above, checking for bad input coming into <code>public</code> methods
should not be done with assertions because turning off assertions will
remove your error checking.</p>
</div>
</div>
<div class="sect3">
<h4 id="_print_statements_2">16.3.2. Print statements</h4>
<div class="paragraph">
<p>Print statements are one of the most time-honored methods of debugging
and remain a quick, dirty, yet effective means of finding errors. Java
does not provide any special tools to make print statements easier to
use for debugging. Some purists might argue that all of this kind of
debugging which focuses on progressively narrowing own the location of a
problem until the bad assumption, logical error, or typographical error
can be found should be done only with assertions.</p>
</div>
<div class="paragraph">
<p>Nevertheless, there are a few tips to make print statements a better
debugging tool in Java. The first is the use of <code>System.err</code>. By now,
you have used <code>System.out.print()</code> and <code>System.out.println()</code> so many
times, you are probably tired of them. Any output method that can be
used with <code>System.out</code> can also be used with <code>System.err</code>. For example,
there is a <code>System.err.print()</code> and a <code>System.err.println()</code> method. If
you simply run a program from the command line and watch the output, you
should see no difference between using <code>System.out</code> and <code>System.err</code>.
However, if you redirect the output of your program to a file using the
<code>&gt;</code> operator, only the <code>System.out</code> code will be sent to the file.
Anything printed with <code>System.err</code> will be sent to the screen.
Alternatively, you can redirect <code>System.err</code> to a file by using the <code>2&gt;</code>
operator. Using <code>System.err</code> makes it easier to separate legitimate
output from error messages, but it also makes it easier to comment out
your debug code by doing a find and replace on your code.</p>
</div>
<div class="paragraph">
<p>A more extensive method for using print statements to debug is by
defining your own class for printing. Every method in it can call a
corresponding method in <code>System.out</code> or <code>System.err</code>. You can define a
<code>boolean</code> value at the class level that determines whether or not
methods in your debug printing class print or stay silent. When you want
to change from debugging to your submission or retail version of the
code, you can simply switch this value to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>A &#8220;modernized&#8221; method of using print statements is creating a simple
GUI instead. In preparing materials for this textbook, we were
occasionally frustrated by the fact that multiple threads can interfere
with each other while printing on the screen: You can&#8217;t always tell
which thread is printing which characters. By displaying the output of
each thread in separate <code>JTextArea</code> or <code>JLabel</code> widgets on a simple GUI,
you can disentangle the output of each thread.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_through_debugging_in_java">16.3.3. Step-through debugging in Java</h4>
<div class="paragraph">
<p>Since DrJava is a great educational tool and Eclipse is so widely used,
we are going to review the step-through debugging features of each
program. Similar tools are available with other IDE&#8217;s and for most
languages.</p>
</div>
<div class="paragraph">
<p>The debugger in DrJava is very simple. To enable the debugger, check the
Debug Mode checkbox in the Debugger menu. Doing so should bring up a
debugging pane in the DrJava window. In or out of debug mode, it should
be possible to set breakpoints on any executable line of code, either by
choosing the Toggle Breakpoint on Current Line command from the Debugger
menu or by typing <code>Ctrl+B</code>. Once you have set at least one breakpoint,
you can run the program. If a line with a breakpoint on it is reached,
then the execution of the program will pause.</p>
</div>
<div class="paragraph">
<p>In the debugging pane, there should now be a list of threads, with the
one that hit the breakpoint highlighted. Having reached this point, the
debugging pane has four buttons you can use to move through code:
<strong>Resume</strong>, <strong>Step Into</strong>, <strong>Step Over</strong>, and <strong>Step Out</strong>. The <strong>Resume</strong> button
allows the program to continue execution, until it hits another
breakpoint. The <strong>Step Into</strong> button advances the execution of the program
by one statement, moving into a method is there is a method call. The
<strong>Step Over</strong> button also advances the execution of the program by one
statement, but it skips over method calls. The <strong>Step Out</strong> button
advances the execution of the program to the end of the current method
and returns, popping the current method off the stack.</p>
</div>
<div class="paragraph">
<p>In the debugging pane, there will be a Watches tab that allows you to
find out the value of a given variable in local scope. All you need to
do is type the variable&#8217;s name, and its value and type should be
displayed. Next to the Threads tab, there should also be a Stack tab,
showing the current method call stack.</p>
</div>
<div class="paragraph">
<p>The Eclipse tools are similar but much more advanced. You can set
breakpoints in Eclipse either by right clicking on the shaded bar
immediately to the left of the line you are interested in or by
selecting Toggle Breakpoint from the Run menu. To debug a program in
Eclipse, right click on the file you wish to run in the Package Explorer
and select Debug As Java Application. If your program is already set up
to run, you can simply click the Debug button in the toolbar. Whenever
you hit a breakpoint, Eclipse will switch to the Debug perspective if it
is not already there. Once execution is suspended on a breakpoint, you
can use commands nearly identical to the ones in DrJava. The commands
Resume, Step Into, and Step Over from the Run menu are the same as
DrJava versions, and Step Return is the equivalent of Step Out. Eclipse
adds the useful command Run to Line, which will execute code until it
reaches the specified line.</p>
</div>
<div class="paragraph">
<p>By right-clicking on a breakpoint in Eclipse, you can access its
properties. Though properties, you can specify that a breakpoint only
halts execution when a specific condition is true or only for a specific
thread. The more advanced debugging in Eclipse also provides more
comprehensive variable watch and inspection options. Simply by hovering
over a variable, its type and value are displayed. You can also inspect
an object and traverse its fields. As with DrJava, you can explicitly
watch variables, but local variables are also displayed by default.</p>
</div>
<div class="paragraph">
<p>The difference between a good programmer and a bad programmer is often
just experience. Having seen a bug before means you know to expect it in
the future. There is no substitute for pulling your hair out over a bug
for hours before finally squashing it, but we will give a few examples
corresponding to the common bugs listed in <a href="#_fixing_bugs">Section 16.1</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 127. Precision errors</div>
<div class="content">
<div class="paragraph">
<p>Precision can cause some subtle errors, especially with <code>float</code> types.
Here is an example of a program attributed to Cleve Moler that gives
some estimation of the threshold for floating point precision. Note that
<code>a</code> ≈ 4/3, making <code>b</code> ≈ 1/3, <code>c</code>
≈ 1, and <code>d</code> ≈ 0. Nevertheless,
the comparison <code>(d == 0.0)</code> in the <code>if</code> statement in this code will
evaluate to <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">double</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">b</span><span class="tok-o">,</span> <span class="tok-n">c</span><span class="tok-o">,</span> <span class="tok-n">d</span><span class="tok-o">;</span>

<span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-mf">4.0</span> <span class="tok-o">/</span> <span class="tok-mf">3.0</span><span class="tok-o">;</span>
<span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">a</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-n">c</span> <span class="tok-o">=</span> <span class="tok-n">b</span> <span class="tok-o">+</span> <span class="tok-n">b</span> <span class="tok-o">+</span> <span class="tok-n">b</span><span class="tok-o">;</span>
<span class="tok-n">d</span> <span class="tok-o">=</span> <span class="tok-n">c</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">d</span><span class="tok-o">);</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">d</span> <span class="tok-o">==</span> <span class="tok-mf">0.0</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Success!&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output for this fragment is <code>-2.220446049250313E-16</code>. Computer
scientists who specialize in numerical analysis have tricks for
minimizing the amount of floating point error introduced, but awareness
is an easy solution to these kinds of bugs. When testing for specific
values of a floating point number, it is wise to test for a range rather
than a single value. For example, the condition <code>(d == 0.0)</code> could be
replaced by <code>(Math.abs(d) &lt; 0.000001)</code>.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 128. Overflow and underflow</div>
<div class="content">
<div class="paragraph">
<p>As you well know, the <code>int</code> and <code>long</code> types have limited bits for
storage. If an arithmetic operation pushes the value of an <code>int</code>
variable larger than <code>Integer.MAX_VALUE</code>, the variable will come full
circle and become a negative number, usually with a large magnitude. The
converse happens when a variable is pushed lower than the smallest value
it can hold. These situations are called overflow and underflow,
respectively, and Java throws no exceptions when they occur. Programmers
who deal with large magnitude values in <code>int</code> or <code>long</code> types get used
to underflow and overflow, and, when unexpected values are output by
their programs, they are usually quick to pin down the problem variable.</p>
</div>
<div class="paragraph">
<p>Overflow and underflow can cause much more subtle bugs when programmers
forget the limited range of values for <code>byte</code> and <code>char</code> types. For
example, a curious beginner programmer might want to print out a table
of all of the possible values for <code>char</code>. Perhaps the programmer has
forgotten the range of values a <code>char</code> can take. Perhaps surprisingly,
the following loop does not terminate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">char</span> <span class="tok-n">letter</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;\0&#39;</span><span class="tok-o">;</span> <span class="tok-n">letter</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100000</span><span class="tok-o">;</span> <span class="tok-n">letter</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-n">letter</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each time <code>letter</code> reaches <code>Character.MAX_VALUE</code> which is <code>'\uFFFF'</code> or
<code>65535</code> as a numerical value, the next increment pushes its value back
to 0. These kinds of errors with <code>byte</code> and <code>char</code> values are most
common when variables of those types are being used as numbers. Some
examples are cryptography, low level file operations, and manipulation
of multimedia data. The best solution is care and attention. It can help
to store the values in variables with more bits such as <code>int</code> or <code>long</code>
values, but care must still be taken to ensure that these values are
within the appropriate range before storing them back into variables
with a smaller number of bits.</p>
</div>
<div class="paragraph">
<p>For example, color values in many image formats are stored as red, green
blue values with a <code>byte</code> used for each of the three colors. In this
system, the darkest color, black, is represented as <code>(0,0,0)</code>, i.e. zero
values for each of the three <code>byte`s. At the same time, the lightest
color, white, is represented conceptually as `(255,255,255)</code>. In
principle, we can perform a very simple filter to increase contrast and
lightness by simply doubling all the pixel values. Given red, green, and
blue color values stored in three <code>byte</code> variables called <code>red</code>,
<code>green</code>, and <code>blue</code>, a naive implementation of this filter might be as
follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">red</span> <span class="tok-o">*=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="tok-n">green</span> <span class="tok-o">*=</span> <span class="tok-mi">2</span><span class="tok-o">;</span>
<span class="tok-n">blue</span> <span class="tok-o">*=</span> <span class="tok-mi">2</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, this code would not work. The first problem is that, even
though image standards are written with color values between 0 and 255,
Java <code>byte</code> values are <strong>signed</strong>. The web standard for the color purple
has red, green, and blue values of <code>(128,0,128)</code>. Since Java <code>byte</code>
values are signed, printing the <code>byte</code> values for each component of
purple directly will actually print <code>(-128,0,-128)</code>. Multiplying the
green value by 2 is clearly still 0. However, multiplying -128 by 2 as a
<code>byte</code> value is -256 which underflows back to 0. Thus, &#8220;brightening&#8221;
purple actually turns it into <code>(0,0,0)</code>, black. Properly applying the
filter to a <code>byte</code> requires a conversion to the <code>int</code> type, masking out
the sign bit, scaling by 2, capping the values at 255, and then casting
back into a <code>byte</code>. Despite the complicated description, the code is not
too unwieldy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">red</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">byte</span><span class="tok-o">)</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span> <span class="tok-mi">255</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">*(</span><span class="tok-n">red</span> <span class="tok-o">&amp;</span> <span class="tok-mh">0xFF</span><span class="tok-o">));</span> <span class="tok-c1">//bitwise AND automatically upcasts to int</span>
<span class="tok-n">green</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">byte</span><span class="tok-o">)</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span> <span class="tok-mi">255</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">*(</span><span class="tok-n">green</span> <span class="tok-o">&amp;</span> <span class="tok-mh">0xFF</span><span class="tok-o">));</span>
<span class="tok-n">blue</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">byte</span><span class="tok-o">)</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">min</span><span class="tok-o">(</span> <span class="tok-mi">255</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">*(</span><span class="tok-n">blue</span> <span class="tok-o">&amp;</span> <span class="tok-mh">0xFF</span><span class="tok-o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 129. Casting errors</div>
<div class="content">
<div class="paragraph">
<p>The previous example about scaling color component values is an
excellent example of the dangers of casting. Someone can easily forget
that the implicit cast to convert a <code>byte</code> to an <code>int</code> always uses a
signed conversion. Likewise, the explicit cast needed to store an <code>int</code>
into a <code>byte</code> will cheerfully convert any arbitrarily large <code>int</code> into a
<code>byte</code>, even though the final value might not be expected by the
programmer.</p>
</div>
<div class="paragraph">
<p>Many other casting errors crop up commonly. The most classic example
might be muddling floating point and integer types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">x</span> <span class="tok-o">=</span> <span class="tok-mi">5</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">y</span> <span class="tok-o">=</span> <span class="tok-mi">3</span><span class="tok-o">;</span>
<span class="tok-kt">double</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mf">2.0</span><span class="tok-o">*(</span><span class="tok-n">x</span><span class="tok-o">/</span><span class="tok-n">y</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Above, it is easy for a programmer to forget that the division of <code>x</code>
and <code>y</code> is integer division. After all, the <code>2.0</code> is right there,
causing an implicit cast to <code>double</code>. Of course, this cast happens after
the division, and the answer stored into <code>value</code> is <code>2.0</code> and not the
<code>3.3333333333333335</code> that the programmer might have expected.</p>
</div>
<div class="paragraph">
<p>Newer programmers sometimes forget that an explicit cast from a floating
point type to an integer type always uses truncation, never rounding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">three</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)</span><span class="tok-mf">2.99999</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This assignment will always store <code>2</code> into <code>three</code>. The <code>Math.round()</code>
method or some other additional step is needed to perform rounding.</p>
</div>
<div class="paragraph">
<p>Casting errors are not limited to primitive data types. Object casting
will be discussed at length in <a href="#_polymorphism">Chapter 17</a>. The
biggest danger there is an incorrect explicit upcast.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Fruit</span> <span class="tok-n">snack</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ChiliPepper</span><span class="tok-o">();</span>
<span class="tok-n">Apple</span> <span class="tok-n">apple</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Apple</span><span class="tok-o">)</span><span class="tok-n">snack</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In a botanical sense, a chili pepper is indeed a fruit and its parallel
Java class is apparently a child of the <code>Fruit</code> class. For some reason,
the programmer thought that the only <code>Fruit</code> that would be pointed at by
a <code>snack</code> reference would be of type <code>Apple</code>. Instead of a mouth on
fire, the programmer gets a <code>ClassCastException</code>. This two line example
is so simple that it should never come up in serious programming. A much
more common example is an array or linked-list whose type is some
superclass of the item you generally expect to be in there. If a large
team is working on a body of code which such a list in it, half of the
team might expect the list to contain only <code>Apple</code> objects while the
other expected only <code>ChiliPepper</code> objects. The use of generics,
discussed in <a href="#_dynamic_data_structures">Chapter 18</a>, can reduce the
number of casting errors of this kind, but some applications require a
list to hold many different types with a common superclass. In those
cases, some amount of explicit (and therefore dangerous) casting will
usually be necessary when retrieving the objects from the list.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Loops give Java much of its expressive power and unsurprisingly give it
much of its power to express incorrect as well as correct code. We are
just going to mention a few of the most common loop errors.</p>
</div>
<div class="exampleblock">
<div class="title">Example 130. Off-by-one errors</div>
<div class="content">
<div class="paragraph">
<p>Computer scientists often use zero-based counting. This departure from
&#8220;normal&#8221; practices is just one source of loops that iterate one time
more or less than they should. A good rule of thumb is, if you want to
iterate \(n\) times, start at 0 and go up to but not including
\(n\). Alternatively, if you have a reason not to be
zero-based, you can start at 1 and go up to and including
\(n\).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">50</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Question &quot;</span> <span class="tok-o">+</span> <span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-s">&quot;.&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Perhaps you want to make a template for an exam. Instead of being
zero-based, you start at 1 because most exams do not have a Question 0.
Unfortunately, you have gotten so used to use a strictly less than for
your ending condition, you forget to change it. You only get 49
questions printed out. If your only purpose is making an exam, you can
catch your mistake and move on. If you are writing a program that
dispenses a quantity of heart medication into a patient&#8217;s IV in a
hospital, one iteration too few or too many could cause the patient to
get too little of the drug to make a difference or too much of the drug
to be safe.</p>
</div>
<div class="paragraph">
<p>Input is another tricky area when it comes to being off by one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-n">Scanner</span> <span class="tok-n">scanner</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter an integer (negative to quit): &quot;</span><span class="tok-o">);</span>
    <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">scanner</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
    <span class="tok-n">count</span><span class="tok-o">++;</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Average: &quot;</span> <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">sum</span> <span class="tok-o">/</span> <span class="tok-n">count</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This fragment of code appears to be a perfectly innocent loop that finds
the average of the numbers entered by a user. The loop uses a sentinel
value so that the user simply enters a negative number when all the
numbers have been entered. The value of <code>sum</code> is updated before the user
enters a value; thus, the harmless <code>0</code> from the declaration of <code>i</code> is
included but the final negative number entered to leave the loop is not.
Unfortunately, the value of <code>count</code> is incremented for every turn of the
loop, even the extra one for the negative number. To combat this
problem, an <code>if</code> statement could be used inside of the loop or <code>count</code>
could simply be initialized to <code>-1</code>. The mistake is a simple one, but it
doesn&#8217;t jump out at you unless you trace a few executions. What is most
insidious is that, especially for large sets of input numbers, the error
is going to be small. Catching this kind of bug will be discussed more
throughly in the second half of this chapter, dealing with testing.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 131. Infinite loops</div>
<div class="content">
<div class="paragraph">
<p>Infinite loops come in many different flavors, from the <code>char</code> overflow
example earlier to traversing a linked-list which has a cycle in it.
Many infinite loops are caused by simple typographical errors. Perhaps
the most classic is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">100</span> <span class="tok-o">);</span>
<span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
    <span class="tok-n">i</span><span class="tok-o">++;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s usually a beginning programmer who leaves a semicolon at the end of
the <code>while</code> header, but even veterans can get a little enthusiastic
about semicolons. Often a programmer confronted with such a bug (which
causes no ouput, in this case) will scour the body of the loop for some
clue as to why it isn&#8217;t advancing yet never carefully scrutinizing the
condition. An extra semicolon the end of a <code>for</code> loop header will
usually cause an error but will usually <strong>not</strong> cause an infinite loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">average</span><span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
        <span class="tok-n">count</span><span class="tok-o">++;</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
            <span class="tok-n">i</span><span class="tok-o">--;</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-n">sum</span> <span class="tok-o">/</span> <span class="tok-n">count</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example is the kind that might be too confusing to appear in a
textbook, but nearly everyone has written worse code while learning to
program. We could suppose that this method is meant to average the
values in an array, but, for some reason, zero valued entries are not to
be counted. The student probably meant to have the following <code>if</code>
statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
            <span class="tok-n">count</span><span class="tok-o">--;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Those two small changes turn the method into a working but slightly
inelegant solution. When debugging remember that index variables in
<code>for</code> loops can get changed in the body of the loop and change the
expected behavior. Generally it is a bad idea to change the value of an
index variable anywhere other than the header of a <code>for</code> loop, but there
are times when doing so gives the cleanest solution.</p>
</div>
<div class="paragraph">
<p>Many loop errors are caused by a bad header. Getting the an inequality
backwards or switching increment and decrement will usually make a loop
that runs a very long time or not at all. We&#8217;ll see the second
possibility just a little later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-s">&quot;!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Blast-off!&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the programmer clearly wanted to count <strong>down</strong> from 10 to
1, but after so much incrementing, he or she forgot to make <code>i</code>
decrement. As a result, the value of <code>i</code> increases for a very long (but
not infinite) time, until it overflows.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 132. Zero loops</div>
<div class="content">
<div class="paragraph">
<p>On the other end of the spectrum, a bad condition can make a loop
execute zero times on <code>for</code> and <code>while</code> loops. For some input, doing so
might be intended behavior. In other cases, no input will ever cause the
loop to execute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-n">Scanner</span> <span class="tok-n">scanner</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">i</span><span class="tok-o">;</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter an integer (negative to quit): &quot;</span><span class="tok-o">);</span>
    <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">scanner</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
    <span class="tok-n">count</span><span class="tok-o">++;</span>
<span class="tok-o">}</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Average: &quot;</span> <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">sum</span> <span class="tok-o">/</span> <span class="tok-n">count</span><span class="tok-o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have just returned to our earlier example of averaging a set of
numbers input by the user. This time we have intialized <code>count</code> to be -1
to avoid the off-by-one error, but we have also changed the inequality
of the <code>while</code> loop from greater than or equal to strictly greater. As a
consequence, the loop is never entered because the zero, the initial
value of <code>i</code>, is too small.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isPrime</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">n</span> <span class="tok-o">%</span> <span class="tok-n">i</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
            <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a simple method intended to test the number <code>n</code> for primality.
Unfortunately, the programmer started the index <code>i</code> at 1 instead of 2.
As a consequence, this loop will only run once before finding that every
number is divisible by 1. True, this is not a loop that executes zero
times, but only once is still just as wrong.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isPrime</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">2</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">n</span> <span class="tok-o">%</span> <span class="tok-n">i</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
            <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
        <span class="tok-k">else</span>
            <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example is very similar code, trying to solve the same problem.
Again, the loop only runs once because the programmer forgot that
finding a single case when a number is not evenly divisible by another
number does not make it prime. Many, many beginning programmers make
this mistake when asked to solve this problem. Perhaps some insight
about the nature of bugs can be gained from this example. By the time a
student writes a program of this kind, he or she should have a fair idea
of how <code>for</code> loops and <code>if</code> statements work. Likewise, the student will
have a fair understanding of the notion of primality. Yet, in the
process of combining the ideas together, it is easy to get sloppy and
write code that gives some semblance of being correct without being.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 133. Equivalence testing errors</div>
<div class="content">
<div class="paragraph">
<p>Equivalence is tricky in Java. Very inexperienced programmers confuse
the <code>=</code> operator with the <code>==</code> operator, but using the <code>==</code> operator to
test for equivalence between two references causes more (and subtler)
problems. Comparing two references with the <code>==</code> operator will evaluate
to <code>true</code> if and only if the two references point at the exact same
object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">string1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">(</span><span class="tok-s">&quot;Test&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">string2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">(</span><span class="tok-s">&quot;Test&quot;</span><span class="tok-o">);</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">string1</span> <span class="tok-o">==</span> <span class="tok-n">string2</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Identical&quot;</span><span class="tok-o">);</span>
<span class="tok-k">else</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Different&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because these two <code>String</code> references point to two different <code>String</code>
objects, which happen to have identical contents, the <code>==</code> returns
<code>false</code> and the output is <code>Different</code>. With <code>String</code> objects this matter
is further confused by a Java optimization called <code>String</code> pooling.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span> <span class="tok-n">string1</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Test&quot;</span><span class="tok-o">;</span>
<span class="tok-n">String</span> <span class="tok-n">string2</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Test&quot;</span><span class="tok-o">;</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">string1</span> <span class="tok-o">==</span> <span class="tok-n">string2</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Identical&quot;</span><span class="tok-o">);</span>
<span class="tok-k">else</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Different&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because Java keeps a pool of existing <code>String</code> values, only one copy of
<code>"Test"</code> is in the pool, and both <code>string1</code> and <code>string2</code> point to it.
Thus, this second fragment of code prints <code>Identical</code>. Because of
<code>String</code> pooling, programmers can write code which can work in some
situations and fail in other, if it is dependent on the <code>==</code> operator.</p>
</div>
<div class="paragraph">
<p>For <code>String</code> objects as well as almost every reference type, it is
almost always the case that the <code>equals()</code> method should be used to test
for comparison instead of the <code>==</code> operator. There are a few instances
when it is necessary to know if two references really and truly do refer
to the same location in memory, but these instances should be a tiny
minority.</p>
</div>
<div class="paragraph">
<p>That said, the <code>equals()</code> method is not bullet-proof. With <code>String</code>
objects and most of the rest of the Java API, you can expect very good
behavior from the <code>equals()</code> method. However, if you create your own
class, you are expected to implement the <code>equals()</code> method. By default,
the <code>equals()</code> method inherited from <code>Object</code> only does an equality test
using <code>==</code>.</p>
</div>
<div class="paragraph">
<p>Properly implementing the <code>equals()</code> method takes care and thought. If
your class contains references to other custom classes, you must be
certain that they also properly implement their own <code>equals()</code> methods.
Likewise, to conform to Java standards, a custom <code>equals()</code> method
should also imply that you implement a custom <code>hashCode()</code> method so
that objects that are equivalent with <code>equals()</code> give the same hash
value. It seems nit-picky to mention this, but many real-world
applications depend on the efficient and correct operation of hash
tables.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_array_errors">16.3.4. Array errors</h4>
<div class="paragraph">
<p>Any time you have a large collection of data, there are always
opportunities for bugs. With catastrophic array bugs, Java usually gives
very good exceptions that will point you to the line number. Once you
have gotten to this point, the bug should be obvious. The biggest
difficulties arise when some unusual course of events is responsible for
the bug cropping up and you have to reconstruct what it is.</p>
</div>
<div class="exampleblock">
<div class="title">Example 134. Out of bounds</div>
<div class="content">
<div class="paragraph">
<p>We have all experienced an <code>ArrayIndexOutOfBoundsException</code>. Either a
little carelessness with our indexes or a mistake about the size of the
array can lead us to try to access an element that isn&#8217;t in the array.
In the C language, a negative index is sometimes a legal location but
never in Java. It is very common to go just slightly beyond the bounds
of the array, particularly with a loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">i</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the last iteration of the loop will access index <code>100</code>
when <code>array</code> only goes up to index <code>99</code>.</p>
</div>
<div class="paragraph">
<p>The causes for going out of bounds can be more subtle. We can imagine an
array of linked lists used as a hashtable, perhaps for storing words in
a dictionary. If we want to hash based on the first letter of the word,
we could have an array of length 26. Consider the following helper
method used to add a new <code>String</code> to the hashtable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">word</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-n">word</span><span class="tok-o">.</span><span class="tok-na">toLowerCase</span><span class="tok-o">().</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">-</span> <span class="tok-sc">&#39;a&#39;</span><span class="tok-o">;</span>
    <span class="tok-n">list</span><span class="tok-o">[</span><span class="tok-n">index</span><span class="tok-o">].</span><span class="tok-na">add</span><span class="tok-o">(</span> <span class="tok-n">word</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can assume that the <code>add()</code> method for a given linked list works
properly, but we may already have caused other problems. For one thing,
we assumed that <code>word</code> began with either an upper or lower case letter.
We are depending on other code to check the input and throw out words
like <code>"$1"</code> or <code>"-isms"</code>. Incidentally, we are also assuming that
<code>word</code> has at least one character in it. Even if we expect the input to
the method to be error free, the addition of error checking is rarely a bad idea.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 135. Uninitialized object arrays</div>
<div class="content">
<div class="paragraph">
<p>Another simple mistake that can occur with arrays is failing to
initialize an object array. With a primitive data type like <code>int</code>,
creating an array with 1,000 elements automatically allocates enough
space to hold those elements and even initializes each one to a default
value, zero in the case of an <code>int</code>. With an object data type, however,
each element of the array is just a reference to <code>null</code> until it is
initialized.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Hippopotamus</span><span class="tok-o">[]</span> <span class="tok-n">hippos</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Hippopotamus</span><span class="tok-o">[</span><span class="tok-mi">15</span><span class="tok-o">];</span>
<span class="tok-n">hippos</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">].</span><span class="tok-na">feed</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example causes a <code>NullPointerException</code>. New programmers are often
confused by this error because, if they are expecting an error, they are
expecting the exception to say something about the array. For more
experienced programmers, this kind of mistake is usually more of a
forehead-slapping, how-silly-of-me-to-forget error than a mind-numbing
puzzler that will take hours to debug. It is probably just a matter of
instantiating each element in the array before you try to feed those
hungry, hungry hippos.</p>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Hippopotamus</span><span class="tok-o">[]</span> <span class="tok-n">hippos</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Hippopotamus</span><span class="tok-o">[</span><span class="tok-mi">15</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">hippos</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">hippos</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Hippopotamus</span><span class="tok-o">();</span>
<span class="tok-n">hippos</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">].</span><span class="tok-na">feed</span><span class="tok-o">();</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_scope_errors">16.3.5. Scope errors</h4>
<div class="paragraph">
<p>We don&#8217;t have variables in real life, and, as a consequence, out
intuition about them is sometimes wrong. Which variable you are
accessing at any given time can appear obvious, even if it really isn&#8217;t.</p>
</div>
<div class="exampleblock">
<div class="title">Example 136. Shadowing variables</div>
<div class="content">
<div class="paragraph">
<p>Java allows variables in different scopes to be declared with the same
identifier. If the scopes are two separate methods, then they will never
interfere with each other. However, if one scope encloses another, the
inner variable will <em>shadow</em> or hide the outer variable.</p>
</div>
<div id="ShadowProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Shadow</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kt">int</span> <span class="tok-n">darkness</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">deepen</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">darkness</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">darkness</span> <span class="tok-o">+=</span> <span class="tok-n">darkness</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">darkness</span> <span class="tok-o">&gt;</span> <span class="tok-mi">100</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>			<span class="tok-n">darkness</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getDarkness</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">darkness</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the field <code>darkness</code> is being shadowed by the local
variable <code>darkness</code> in the <code>deepen()</code> method. It appears that the
programmer wanted to increase the field <code>darkness</code> by the amount passed
into the parameter <code>darkness</code> and failed to notice that both variables
had the same name. As a consequence, the parameter <code>darkness</code> will
double itself and then never be used again while the field <code>darkness</code>
will never increase. This kind of bug could go uncaught for a long while
until a programmer notices that the <code>Shadow</code> object is not increasing in
darkness no matter how many times it is told to.</p>
</div>
<div class="paragraph">
<p>This kind of mistake is also common in constructors, since it is
reasonable to give a certain parameter a name similar to the field it is
about to initialize. Some programmers explicitly prefix all fields with
<code>this</code> even though it is often redundant. Three additions of <code>this</code> will
fix the problem in the preceding example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">deepen</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">darkness</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">darkness</span> <span class="tok-o">+=</span> <span class="tok-n">darkness</span><span class="tok-o">;</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">darkness</span> <span class="tok-o">&gt;</span> <span class="tok-mi">100</span> <span class="tok-o">)</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">darkness</span> <span class="tok-o">=</span> <span class="tok-mi">100</span><span class="tok-o">;</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, scope is also defined in terms of classes and their parent
classes. A parent class variable can be shadowed by a child class
variable of the same name.</p>
</div>
<div id="BodybuilderProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Bodybuilder</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">strength</span> <span class="tok-o">=</span> <span class="tok-mi">8</span><span class="tok-o">;</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isStrongEnough</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">strengthNeeded</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-k">return</span> <span class="tok-n">strength</span> <span class="tok-o">&gt;=</span> <span class="tok-n">strengthNeeded</span><span class="tok-o">;</span>
<span class="lineno">6 </span>	<span class="tok-o">}</span>
<span class="lineno">7 </span>
<span class="lineno">8 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setStrength</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">strength</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">9 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="BraggingBodybuilderProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BraggingBodybuilder</span> <span class="tok-kd">extends</span> <span class="tok-n">Bodybuilder</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">strength</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">brag</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;My strength is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">strength</span> <span class="tok-o">+</span> <span class="tok-s">&quot;!&quot;</span><span class="tok-o">);</span>
<span class="lineno">6 </span>	<span class="tok-o">}</span>
<span class="lineno">7 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example looks like a simple case of inheritance, but whoever wrote
the <code>BraggingBodybuilder</code> class seems to have mistakenly included the
field <code>strength</code> again. As a consequence, any <code>BraggingBodybuilder</code> will
always brag that his or her strength is 10, even when code sets his or
her strength to other values. When strength is tested, it will use the
<code>strength</code> field from the superclass <code>Bodybuilder</code> which is set by the
<code>setStrength()</code> method. Sometimes similar behavior is desired, but it
seems to be accidental here. When classes have large numbers of fields,
making such a mistake becomes easier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-n">Bodybuilder</span> <span class="tok-n">builder</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BraggingBodybuilder</span><span class="tok-o">();</span>
<span class="lineno">2 </span><span class="tok-n">builder</span><span class="tok-o">.</span><span class="tok-na">strength</span> <span class="tok-o">=</span> <span class="tok-mi">15</span><span class="tok-o">;</span><span class="tok-cm">/*@\label{line:strength=15}@*/</span>
<span class="lineno">3 </span><span class="tok-n">BraggingBodybuilder</span> <span class="tok-n">bragger</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">BraggingBodybuilder</span><span class="tok-o">)</span><span class="tok-n">builder</span><span class="tok-o">;</span>
<span class="lineno">4 </span><span class="tok-n">bragger</span><span class="tok-o">.</span><span class="tok-na">brag</span><span class="tok-o">();</span>
<span class="lineno">5 </span><span class="tok-n">bragger</span><span class="tok-o">.</span><span class="tok-na">strength</span> <span class="tok-o">=</span> <span class="tok-mi">20</span><span class="tok-o">;</span><span class="tok-cm">/*@\label{line:strength=20}@*/</span>
<span class="lineno">6 </span><span class="tok-n">bragger</span><span class="tok-o">.</span><span class="tok-na">brag</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dynamic and static binding complicate this scope problem further. This
fragment of code using the class definitions above highlights these
complications. Because fields are statically bound to the class of the
object, the <code>strength</code> field for <code>Bodybuilder</code> will be set to 15 on line
<a href="#line:strength=15">[line:strength=15]</a>, and the <code>strength</code> field for <code>BraggingBodybuilder</code>
will be set to 20 on line <a href="#line:strength=20">[line:strength=20]</a>. Thus, the first call to
<code>brag()</code> will print out <code>My strength is 10!</code>, but the second call will
print out <code>My strength is 20!</code>.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 137. Reference vs. value</div>
<div class="content">
<div class="paragraph">
<p>The final category of scope error we will talk about occurs because of
confusion between passing by reference and passing by value when using
methods. Everything variable in Java is passed by value. However, when
that value is itself a reference, it is possible to change the values
that it references.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">increaseMagnitude</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">number</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">number</span> <span class="tok-o">*=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A novice Java programmer might write a method like the above, expecting
the value of <code>number</code> to increase by 10 in the calling code. Some
languages like Perl use call by reference as default. Other languages
like C++ and C# allow the user to mark certain parameters as call by
reference. Programmers comfortable with such languages may be confused
about the workings of Java.</p>
</div>
<div class="paragraph">
<p>On the other hand, becoming used to the pass by reference style of Java
can cause other errors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">increaseMagnitude</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">numbers</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">numbers</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">*=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this similar example, the 0 index element of <code>numbers</code> is increased
by a factor of 10. Unlike the previous code, the increase in the value
of that element will affect the array passed in by the calling code. The
values in the array are shared by the <code>increaseMagnitude()</code> method and
the calling code. The same phenomenon can be observed with the fields of
objects whose references are passed into a method.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_null_pointer_errors">16.3.6. Null pointer errors</h4>
<div class="paragraph">
<p>Null pointer errors usually raise a <code>NullPointerException</code> in Java. This
category of errors is something of a catch-all that could happen for
many different reasons, some of which have already been mentioned.
Because of loop errors, some variables might not be initialized. A
<code>NullPointerException</code> could be raised because the elements of an object
array have not be initialized. Scope problems could cause a reference to
be null if the programmer was mistakenly updating another reference,
leaving the reference in question uninitialized.</p>
</div>
<div class="paragraph">
<p>Though common, it is very difficult to give a blanket explanation for
why most null pointer errors happen. Usually there is some fundamental
error in program logic. Linked lists and tree structures that rely on
null references to mark the end of a list or an empty child node are
especially susceptible to these errors.</p>
</div>
<div class="paragraph">
<p>One significant source of errors is careless usage of method parameters.
A programmer may pass in objects that do not conform to the expectations
of the method or even null references instead of objects. Well written
methods, particularly library calls, should be designed to throw an
appropriate exception when this happens. Poorly designed code may
blindly use a null reference without checking it first, causing a
<code>NullPointerException</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_parallel_bugs">16.4. Concurrency: Parallel bugs</h3>
<div class="paragraph">
<p>We will only briefly discuss parallel bugs here because we have already
gone into depth about the dangers of parallel programming in
<a href="#_synchronization">Chapter 14</a>. Except in the case of deadlocks and
livelocks, the real trouble with parallel bugs is that they make the
appearance of ordinary sequential bugs become nondeterministic.</p>
</div>
<div class="sect3">
<h4 id="_race_conditions">16.4.1. Race conditions</h4>
<div class="paragraph">
<p>A race condition describes the situation when the output of a program is
dependent on the timing of the execution of two or more threads. Because
of the complexity of the JVM and the OS and the fact that many other
processes may be running and interacting, it is usually impossible to
determine how two threads will be scheduled. As a consequence, if the
output of the program depends on unpredictable timing, the output will
also be unpredictable.</p>
</div>
<div class="paragraph">
<p>In Java, the way that race conditions usually impact the program is
through some variable shared between multiple threads. When the schedule
of threads becomes unpredictable, the changes made to this variable can
come out of sequence, and its value becomes unpredictable. Incorrect
output means that your program has a bug, but the most frustrating
aspect of race conditions is that they are nondeterministic. Your
program could sometimes have the right answer and sometimes not. Your
program could always have the wrong answer, but not always the same one.
The truly insidious issue with race conditions is that they will usually
cause errors only a tiny percentage of the time. Thus, rigorous testing
such as we will discuss in the second half of this chapter is necessary
to even be aware that a race condition is occurring.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deadlocks_and_livelocks">16.4.2. Deadlocks and livelocks</h4>
<div class="paragraph">
<p>Both deadlocks and livelocks describe situations in which some part of
your program will stop making progress because of thread interaction. In
the case of deadlock, there will be some circular wait in which thread A
is waiting for thread B which is waiting, directly or indirectly, on
thread A. In the case of livelock, some repetitive pattern of waiting
for a condition that will never be satisfied is still going on, but the
threads continue to use CPU time and are not simply waiting.</p>
</div>
<div class="paragraph">
<p>If your program reaches a deadlock state, it will not terminate. If
threads updating a GUI become deadlocked, your windows may freeze.
Typically, deadlocks are nondeterministic and occur only some of the
time. Like all race conditions, they can be difficult to detect and
duplicate. In fact, <code>Thread.stop()</code>, <code>Thread.suspend()</code>, and
<code>Thread.resume()</code>, three seemingly useful and fundamental methods that
were originally part of the Java <code>Thread</code> class, have been deprecated
because they are deadlock prone.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sequential_execution_2">16.4.3. Sequential execution</h4>
<div class="paragraph">
<p>One bug which is impossible to achieve in non-parallel code is
sequential execution. This situation arises when, usually due to overuse
of synchronization tools, parallel code runs sequentially. Each segment
of code, instead of running in parallel, is forced to wait for another
to complete. A certain amount of serial execution is necessary to
maintain program correctness and avoid race conditions, but Amdahl&#8217;s Law
gives a rigid, mathematical characterization of how easily speedup can
be lost if the serial execution takes up large portions of the code.
Because setting up threads and using other concurrency tools does have
some overheard, a parallel program executing sequentially can even run
more slowly than a completely sequential version.</p>
</div>
<div class="paragraph">
<p>Because programs are usually parallelized for the sake of speedup, it is
possible to time sections of programs to see how well you have
parallelized them. Sequential execution due to synchronization tools is
only one of the many problems that can cause slow execution. The threads
may be competing for a limited resource such as an I/O device or may be
fighting over a small section of memory, causing cache misses. Tuning
applications for maximum performance requires an expert understanding of
the concurrency issues within software as well as the underlying OS and
hardware characteristics. For now, it&#8217;s enough to be aware of the risk
of sequential execution and be as careful as possible when applying
locks and other synchronization tools.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_finding_and_avoiding_bugs">16.5. Finding and avoiding bugs</h3>
<div class="paragraph">
<p>What would you do if you wanted to design a system for administering a
dose of radiation to a specific location on a patient to help treat them
for cancer? Depending on the specification of the problem, you might
need to control various voltage sources, read data from various sensors,
and create a terminal interface or a GUI. With a well designed
specification, you could probably apply your knowledge of loops and
control structures to some API and provide a software solution that met
requirements.</p>
</div>
<div class="paragraph">
<p>But, how would you know that it worked? Sure, you could run a series of
tests, but how many tests would it take for you to be convinced that it
worked perfectly? What if your grade was dependent on it working without
a single error? Or your job? Or your life?</p>
</div>
<div class="paragraph">
<p>You have probably already faced the stress of trying to get a program to
work as well as possible for the sake of your grade. It is not such a
far cry to imagine your job being on the line if you make a mistake as a
professional programmer. But, what about your life? Perhaps you will
never put your life in the hands of code you write, but odds are that
you have already put your life in the hands of someone else&#8217;s code.
Software controls airplanes, automobiles, medical equipment, and
countless other applications where a bug in the code could actually
result in loss of human life.</p>
</div>
<div class="paragraph">
<p>Sadly, there have been cases when such bugs have surfaced with deadly
consequences. One of the most famous examples of the dangers of badly
written software is the Therac-25. The Therac-25 was a machine designed
to deliver therapeutic radiation for medical purposes. Between 1985 and
1987, use of the Therac-25 caused at least six incidents of massive
radiation overdoses, leading to at least three deaths.</p>
</div>
<div class="paragraph">
<p>Like most failures of this scope, there was more than a single cause
behind the Therac-25 tragedies. For one thing, the machines did give an
error code. However, the user manual did not explain the error code, and
the technicians were not trained to deal with the errors. Even when
patients complained about pain caused by the machine, the technicians
and even the manufacturers of the Therac-25 were confident that the
machine was operating correctly because neither of the previous models,
the Therac-6 and the Therac-20, had suffered any problems.
Overconfidence has played a significant role in many of the worst
systems failures, including the devastating Chernobyl disaster.</p>
</div>
<div class="paragraph">
<p>Ignoring the human errors, a number of software errors were also
responsible for the Therac-25 overdoses. The overdoses occurred when
technicians made incorrect keystrokes giving confusing instructions to
the Therac-25 about which mode of operation it should be in. In this
situation, the machine would operate with a high-power beam but without
the beam spreader that was necessary for its safe operation. The
designers ignored the possibility that this series of keystrokes would
happen. Also, a race condition was involved in this bug since it
depended on one task that set up the equipment and another that received
input from the technician. This race condition was never caught because
only technicians with long practice could work fast enough to cause the
bug. Finally, a counter was incremented for use as a flag variable, but
arithmetic overflow occasionally caused this flag to have the wrong
value.</p>
</div>
<div class="paragraph">
<p>In the remaining half of this chapter, we will discuss a number of
testing methodologies and design strategies to minimize errors in
software.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_design_implementation_and_testing">16.6. Concepts: Design, implementation, and testing</h3>
<div class="paragraph">
<p>Unfortunately, there is no foolproof way to design software. There are
many researchers who work to design new languages and new development
tools that limit certain kinds of mistakes, but it is impossible to
design a language as powerful as C or Java which will also prevent all
software bugs. A consequence of the halting problem, a fundamental
concept in the theory of computation, is that there is no way to design
a test that will detect all potential infinite loops (or infinite
recursion) for all programs.</p>
</div>
<div class="paragraph">
<p>With careful design, implementation, and testing, most errors can
reduced almost to nothingness. In the following subsections, we will
discuss these three aspects of programming and how you can apply them to
writing better programs.</p>
</div>
<div class="sect3">
<h4 id="_design">16.6.1. Design</h4>
<div class="paragraph">
<p>We have remarked in the past that good design pays off ten-fold in
implementation, and that payoff continues to increase by factors of ten
as you move on to testing and eventually deployment.</p>
</div>
<div class="paragraph">
<p>One of the first design decisions you may have to make is choice of
language. Some languages are better designed for certain tasks than
others. For example, languages like Ada have been carefully designed to
minimize programming mistakes such as mis-matched <code>else</code> blocks. Many
functional languages like ML are designed so that memory errors such as
a <code>NullPointerException</code> are impossible. Even Java has taken clear steps
to avoid some of the errors possible in C and other languages that allow
pointer arithmetic, such as bus errors. However, many other factors such
as portability, compatibility, and speed will affect your language
decision.</p>
</div>
<div class="paragraph">
<p>If you are working in industry, you may be given a specification from
your client or your supervisors. As you design the software needed to
meet the specification, you may use UML diagrams to map out the classes
and interactions you plan to implement in your program.</p>
</div>
<div class="paragraph">
<p>There are many questions you may ask yourself as you design your
solution. Will your solution be compatible with the system and future
changes made in the system? Is it easy to add features to your solution?
Does your solution deal gracefully with mistakes in user input or
external hardware and software failures? Is your code easy to maintain,
particularly by future programmers who were not involved in its initial
development. Are the components of the system modular? Can they be
worked on, tested, and upgraded independently? Are the components of
your system designed well enough to be reused for other applications?
Are the elements of your system secure from malicious attacks? Finally,
is it easy for the user to work with your software?</p>
</div>
<div class="paragraph">
<p>Each one of these questions is related to a separate sub-field in
software engineering. It may be impossible to address them all
completely, but different applications will have different priorities.
One method for OO software engineering uses <em>design patterns</em>. The idea
behind design patterns is that most classes share some common design
principles with a large category of classes. By naming and recognizing
each category, you can apply the same rules to designing new classes
from a category you are already familiar with. Each category is called a
design pattern. Java uses design patterns extensively in its API.
Describing design patterns in greater depth is beyond the scope of this
book, but you may want to consult the Gang of Four&#8217;s excellent book
<em>Design Patterns</em>.</p>
</div>
<div class="paragraph">
<p>Another important idea in design is <em>design by contract</em>. Although this
is also a rich, complex area of software engineering, the idea can be
applied to methods in a straightforward way. For each method, you have a
formal explanation of what its input should be, what its output should
be, and what else can be changed in the process. For some languages and
some segments of code, it is possible to prove that a given method does
exactly what it is supposed to do. Nevertheless, Donald Knuth, a giant
in computer science, is famous for having said, "Beware of bugs in the
above code; I have only proved it correct, not tried it."</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation">16.6.2. Implementation</h4>
<div class="paragraph">
<p>When the time comes to actually implement your design, there are a
number of other techniques you can use to minimize errors in this phase.
One interesting technique is <em>pair programming</em>, in which two
programmers sit at a single computer and work together. Ideally, one
programmer is thinking about the immediate problems posed by the next
few lines of code while the other is thinking about the larger context
of the program. Two sets of eyes is always beneficial when looking at
something as detailed and confusing as a computer program.</p>
</div>
<div class="paragraph">
<p>In keeping with the theme of having more than one set of eyes looking at
a program, it is generally recognized that it is useful to have the
individuals who test the software be independent from those who develop
it. By keeping the testers separate, they are not infected by the
assumptions and biases that the developers have made while writing the
software. Some communication between the two groups is necessary, but
there is a lot of value in black box testing, which we will explain in
the next subsection.</p>
</div>
<div class="paragraph">
<p>Another piece of general advice is to rely on standard libraries as much
as possible. Reinventing your own libraries is partly a waste of time
and partly dangerous because your own libraries have not undergone as
much testing as the standard ones. Likewise, it makes your code less
portable. Some expert developers may need to write special libraries for
speed or memory efficiency, but they are the exception, not the rule.</p>
</div>
<div class="paragraph">
<p>There are a number of Java specific implementation guidelines. People
have written entire books about good software engineering in Java, and
so we will only give a few obvious pointers.</p>
</div>
<div class="paragraph">
<p>Although it is tempting to do so when working under time pressure, never
write empty exception handlers. Doing so swallows exceptions blindly,
giving the user no idea what the errors in his or her program are. By
the same token, always make your exception handlers as narrow as
possible. Simply putting a <code>catch( Exception e )</code> at the end of any
<code>try</code>-block has one of two possible outcomes: In one case your handler
is vague and the user is informed that a general error of some kind has
occurred. In the other your handler is more precise than it has a right
to be. You might have assumed that a file I/O error was most likely to
occur and always report that failure. Instead, an
<code>ArrayOutOfBoundsException</code> could happen and be mistakenly reported as a
file I/O problem.</p>
</div>
<div class="paragraph">
<p>You should test the input to any public methods you write and throw a
pre-determined exception if the input is invalid. Never use assertions
to test input to public methods. In fact, you should never depend on
assertions to catch errors since they must be turned on in the JVM to
have effect. Assertions are great for debugging code before it is
released but have little or no value in the field.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing">16.6.3. Testing</h4>
<div class="paragraph">
<p>Once you have designed and implemented your program (or perhaps even
during the process of implementation), you should test it to see if it
behaves as expected and required. The most common form of software
testing done by students is a form of a <em>smoke test</em>. A smoke test is a
basic test of functionality. Such a test should simply run through the
major features of a program and verify that they seem to work under
ordinary circumstances. Often a student will barely finish the program
before the deadline and be unable to perform anything but the most basic
tests.</p>
</div>
<div class="paragraph">
<p>Smoke tests are useful because it is pointless to test the finer details
of a system that is clearly broken, but the software engineering
industry uses many other kinds of testing to ensure that a given piece
of software meets its specification. We will briefly cover three broad
areas of testing: black box testing, white box testing, and regression
testing.</p>
</div>
<div class="sect4">
<h5 id="_black_box_testing">Black-box testing</h5>
<div class="paragraph">
<p>Black box testing assumes that the tester knows nothing about the
internal mechanisms of the software he or she is testing. The software
is viewed as a "black box" that only has inputs and outputs. The tester
chooses some subset of the possible inputs and tests to see if the
output matches the specification.</p>
</div>
<div class="paragraph">
<p>For simple programs with very little input, it may be possible to test
<strong>all</strong> possible input values, but doing so is impractical for most
programs. A short list of techniques for determining the appropriate set
of input values for black box testing follows.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Equivalence Partitioning</dt>
<dd>
<p>The idea behind equivalence partitioning is that large ranges of data
may be functionally equivalent from the point of view of causing
errors. If a tester can run a test for one element from a range of
data, then the entire range can be tested quickly. To perform this
kind of testing, the tester must partition data into ranges that
function differently. The partition created is usually not really a
partition in a mathematical sense as the sub-domains are overlapping.
This is one reason why equilvalence partitioning is also referred to
as <em>subdomain</em> testing.<br>
For example, a program controlling the temperature of the water in an
aquarium may have legal input ranges between 32F and 212F. However, if
the program warms the water when it is below 75F and cools it when it
is above 90F, then values below 0, values from 0 to 74, values from 75
to 90, values from 91 to 212, and values above 212 all constitute
different partitions.</p>
</dd>
<dt class="hdlist1">Boundary Value Analysis</dt>
<dd>
<p>Once inputs have been partitioned into equivalent ranges, testers can
focus on those values which are near the boundary of those ranges. For
example, an input containing a person&#8217;s age may be allowed to range
between 0 and 150. The values -1, 0, 1, 149, 150, and 151 are good
candidates for input from the perspective of boundary value analysis.
As with equivalence partitioning, boundary value analysis is useful
not only for the boundaries between valid and invalid data but also
for the boundaries between any input ranges with different program
behavior such as the boundaries separating the five ranges of values
for the aquarium thermostat program described above.</p>
</dd>
<dt class="hdlist1">All-Pairs Testing</dt>
<dd>
<p>Most software bugs are triggered by a single piece of input. Some
harder to discover bug require two separate piece of input to have
specific values at the same time before they manifest. With each
increase in the number of different inputs that must each have
specific values at the same time to cause a bug, the bug becomes
increasingly difficult to track down but also increasingly unlikely to
exist. It may be possible to test all possible values for a given
input but impossible to test all possible values for all inputs at the
same time. All-pairs testing is a compromise between these two
extremes that tests all possible pairs of inputs.</p>
</dd>
<dt class="hdlist1">Fuzz Testing</dt>
<dd>
<p>The concept behind fuzz testing is to use large amounts of invalid,
unlikely, or random data as input to a program. Although this kind of
testing is used only to test the reliability and robustness of a
program receiving unexpected input, it has a number of advantages. One
significant advantage of fuzz testing is that it is quick and easy to
design test cases. Another is that it makes no assumptions about the
program behavior, catching errors that might never occur to a human
being.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_white_box_testing">White-box testing</h5>
<div class="paragraph">
<p>The philosophy of white box is the opposite of black box testing. When
using white box testing techniques, the tester has access to the program
internals. The tester should employ techniques to test every possible
path that execution can take through the code. Traversing a particular
path of execution through a program is called <em>exercising</em> that path.</p>
</div>
<div class="paragraph">
<p>In order to exercise every possible path, it is necessary to force each
conditional statement to be true and false on some path. Some
combinations of true and false may be impossible, but, ignoring this
fact, a program with \(n\) independent conditionals would
require \(2^n\) runs to test them all. Because of the large
number of possible execution paths, white box testing generally tries to
maximize coverage over metrics that are not quite so demanding.</p>
</div>
<div class="paragraph">
<p>Method coverage is the percentage of methods that are called by test
cases at least once. Ideally, this number is 100%. Statement coverage is
the percentage of statements that are executed by test cases. Again,
this number should be as close to 100% as possible. Branch coverage is
the percentage of conditionals that have been executed on both their
true and false branches. Getting total coverage here is difficult, but
good testing can come close.</p>
</div>
<div class="paragraph">
<p>As with black box testing, equivalence partitioning and boundary value
methods can be used to reduce the total number of test cases. Also, it
is important to test those parts of your programs reached only in error
conditions in addition to normal operation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_regression_testing">Regression testing</h5>
<div class="paragraph">
<p>Regression testing is a form of testing that is not often necessary for
student code because they are small projects. The motivating idea behind
this kind of testing is that, in the act of fixing a bug or adding a
feature, existing code can be broken. Thus, even after a system has been
thoroughly tested, small changes or additions require the entire system
to be retested. As the size of a program grows, the chance of unintended
consequences increases, along with the value of performing regression
testing.</p>
</div>
<div class="paragraph">
<p>Regression testing can incorporate both black and white box testing.
Doing regression testing could simply mean running all the existing
tests over again. At the very minimum, each time a test uncovers a bug,
that test should be added to the test suite used after each build of the
program. The use of regression testing also implies that regular testing
is being done on your code. Regular testing gives developers the
opportunity to track changes in other aspects of their program such as
memory usage, run time, and other non-functional issues.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_java_testing_tools">16.7. Syntax: Java testing tools</h3>
<div class="paragraph">
<p>There is an open-source tool for testing Java called JUnit testing.
There are other testing tools for Java, and there are a wide array of
tools for testing software in virtually any language. We cover JUnit
here because it is widely accepted as a standard Java testing tool and
because it is open-source. First, we&#8217;ll explain how to use JUnit, and
then we&#8217;ll discuss some of the tools available to help test concurrent
software.</p>
</div>
<div class="sect3">
<h4 id="_junit_testing">16.7.1. JUnit testing</h4>
<div class="paragraph">
<p>JUnit testing is used for unit testing Java. Unit testing is the process
testing of separate software components that will eventually work
together. By testing them individually, debugging can be done before
interactions between different components make it more difficult to find
the underlying bug. After unit testing comes integration testing to test
how the components work together. Finally, system testing is the testing
of the complete, integrated system against its specifications.</p>
</div>
<div class="sect4">
<h5 id="_annotations">Annotations</h5>
<div class="paragraph">
<p>Our coverage of JUnit testing is based on JUnit 4. This version of JUnit
simplifies the syntax of creating JUnit tests, but it also relies on
<em>annotations</em>. Annotations are additional information written into Java
code that affects how the compiler or run-time system treats the code.
They are like comments, but they can affect code execution or
compilation, though usually indirectly. Applying an annotation to a
method is called <em>decorating</em>. A class, a method, a variable, a package,
or even an individual method parameter can be decorated.</p>
</div>
<div class="paragraph">
<p>Three annotations are built into the language: <code>@Deprecated</code>,
<code>@Override</code>, and <code>@SuppressWarnings</code>. If a method is decorated with
<code>@Deprecated</code>, it is deprecated and included only for backwards
compatibility. The compiler will give a warning if you call deprecated
code such as the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Deprecated</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">oldMethod</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Many methods in the extensive Java API are deprecated, like
<code>Thread.suspend()</code> due to its inherent deadlock risk. As of Java 5 when
annotations were introduced, these methods were all decorated with
<code>@Deprecated</code>. The <code>@Override</code> annotation marks a method that is
overriding superclass method, causing a compiler error if the method is
not correctly overriding some superclass method. The <code>@SuppressWarnings</code>
annotation allows certain warning messages to be suppressed, like using
deprecated code if you really have to.</p>
</div>
</div>
<div class="sect4">
<h5 id="_basic_junit_syntax">Basic JUnit syntax</h5>
<div class="paragraph">
<p>First of all, JUnit is not a part of the standard Java API. To use it,
you should download the latest jar file from <a href="http://www.junit.org" class="bare">http://www.junit.org</a> and
add the path to that jar file to your class path. To access the JUnit
facilities in your code, you need the following import.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">import</span> <span class="tok-nn">org.junit.*</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you need to set up a testing class just like you would any other
class. The key difference is that each method in the testing class is
designed to test some functionality of a code component. For example,
let&#8217;s imagine that we want to test certain functionality of the Java
<code>Math</code> library such as the <code>ceil()</code>, <code>pow()</code>, and <code>sin()</code> methods.</p>
</div>
<div class="paragraph">
<p>To do so, we create a class called <code>MathTest</code> with three methods inside
of it called <code>ceil()</code>, <code>pow()</code>, and <code>sin()</code>. We will use each method to
test the functionality of the three methods that, respectively, have the
same names. There is no requirement to name the methods any particular
way. Tests in JUnit do not have to test single method calls. They could
test any functional aspect of an object or class. Nevertheless, for
documentation reasons it is wise to give the test methods names that
reflect what is being tested.</p>
</div>
<div class="paragraph">
<p>So, where do annotations come in? The header for the <code>ceil()</code> method
would be as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">ceil</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The only thing necessary to use a method in a JUnit test is to annotate
it with <code>@Test</code>. It is also necessary to make any function used for
testing <code>public</code> with a <code>void</code> return type and no parameters. Otherwise,
the JUnit framework will crash when you try to run the tests. Each
method with a <code>@Test</code> annotation is run once by JUnit, but JUnit cannot
supply any arguments to them. They should be self-contained tests
without any outside input.</p>
</div>
<div class="paragraph">
<p>The exception to this rule is that you can perform some set up for the
tests and then some clean up afterwards. Any method decorated with
<code>@Before</code> will be run before <strong>every</strong> test, and any method decorated with
<code>@After</code> will be run after <strong>every</strong> test. If you have some set up or
clean up that is expensive to run, you can use the annotations
<code>@BeforeClass</code> or <code>@AfterClass</code> to decorate a static method that is run
once before or after all the tests.</p>
</div>
<div class="paragraph">
<p>So far we have talked about the major aspects of writing a JUnit test
class except for the actual test. How does the JUnit test report a
success or a failure to the tester? As you would expect in Java, we use
the exception handling mechanism to indicate failures. If the test
method returns normally, the test is considered a success. If an
unhandled exception or error is thrown by the method, the test is
considered a failure. One of the most common ways of implementing this
is by using a form of assertions.</p>
</div>
<div class="paragraph">
<p>Of course, you could simply add an <code>assert</code> into the test code, then
enable assertions while running the test, but this approach means that
your tests could all incorrectly pass if you forget to enable
assertions. Instead, use the following import.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">import static</span> <span class="tok-nn">org.junit.Assert.*</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this static import, you will have access to many static methods
that provide useful assertion functionality. The simplest of these is
<code>assertTrue()</code>, which is essentially equivalent to an <code>assert</code> without
requiring assertions to be enabled. For example, we could code the body
of the <code>ceil()</code> test method as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">ceil</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">assertTrue</span><span class="tok-o">(</span> <span class="tok-mi">4</span> <span class="tok-o">==</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">ceil</span><span class="tok-o">(</span><span class="tok-mf">3.1</span><span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another useful method is <code>assertEquals()</code> (and its close cousin
<code>assertArrayEquals()</code>) which takes two parameters and throws an
<code>AssertionError</code> if the two are not equal. There are overloaded versions
of this method for <code>long</code> and <code>Object</code> types. Note that the preferred
<code>assertEquals()</code> method for the <code>double</code> type takes three parameters,
including an epsilon threshold in case the values don&#8217;t match exactly.</p>
</div>
<div class="exampleblock">
<div class="title">Example 138. JUnit math testing</div>
<div class="content">
<div class="paragraph">
<p>Using these methods, we can finally write a complete (though very
simple) implementation of <code>MathTest.java</code>.</p>
</div>
<div id="MathTestProgram" class="listingblock">
<div class="title">Program 71. Simple testing suite.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">org.junit.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import static</span> <span class="tok-nn">org.junit.Assert.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MathTest</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span> <span class="tok-n">sqrt2</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>  <span class="tok-nd">@BeforeClass</span>
<span class="lineno"> 8 </span>  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-n">sqrt2</span> <span class="tok-o">=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">);}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>  <span class="tok-nd">@Test</span>
<span class="lineno">11 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">ceil</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>    <span class="tok-n">assertTrue</span><span class="tok-o">(</span> <span class="tok-mi">4</span> <span class="tok-o">==</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">ceil</span><span class="tok-o">(</span><span class="tok-mf">3.1</span><span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>  <span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>  <span class="tok-nd">@Test</span>
<span class="lineno">16 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">pow</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">pow</span><span class="tok-o">(</span> <span class="tok-n">sqrt2</span><span class="tok-o">,</span> <span class="tok-mi">2</span> <span class="tok-o">),</span> <span class="tok-mf">0.000001</span> <span class="tok-o">);</span>
<span class="lineno">18 </span>  <span class="tok-o">}</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span>  <span class="tok-nd">@Test</span>
<span class="lineno">21 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">sin</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">22 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-n">sqrt2</span><span class="tok-o">/</span><span class="tok-mf">2.0</span><span class="tok-o">,</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sin</span><span class="tok-o">(</span><span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">PI</span> <span class="tok-o">/</span> <span class="tok-mf">4.0</span><span class="tok-o">),</span> <span class="tok-mf">0.000001</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>  <span class="tok-o">}</span>
<span class="lineno">24 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>setUp()</code> method is extremely trivial here, and no clean
up is needed. JUnit has many other powerful features that allow you to
run suites of tests or repeated tests with specific parameterized
values, but we are only going to introduce one more feature here. In an
ideal world, you are actually developing tests as you develop code.
Sometimes, in fact, you might have completed a test for a specific
feature before you have finished implementing it. Or, perhaps a feature
in your program is broken at the moment, but you want to continue
running tests on the rest of the features.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In these cases and others, it is useful to turn off a particular test
temporarily. To do this, you add the annotation <code>@Ignore</code> before the
<code>@Test</code> annotation. In parentheses after the <code>@Ignore</code> annotation, you
should ideally put in parentheses a <code>String</code> giving the reason why the
test is being ignored.</p>
</div>
</div>
<div class="sect4">
<h5 id="_running_junit">Running JUnit</h5>
<div class="paragraph">
<p>Once you have created your JUnit test classes, you will want to run
them. There are tools built into IDE&#8217;s like Eclipse to make this easier,
but the command line is always an option. As we said before, you need to
include the JUnit jar file in your classpath. You can either do this
permanently, by adding it to a <code>CLASSPATH</code> environment variable in a way
dependent on your OS, or for a particular run of a Java tool. Assuming
that you haven&#8217;t added the jar file to your classpath permanently, let&#8217;s
say that you are using JUnit 4.5 from a jar file called <code>junit-4.5.jar</code>
that can be found in <code>C:\Utilities\Java\JUnit\</code>. To compile <code>MathTest</code>,
you would type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>javac -classpath .;C:\Utilities\Java\JUnit\junit-4.5.jar MathTest.java</pre>
</div>
</div>
<div class="paragraph">
<p>To actually run the code, you still need to include <code>junit-4.5.jar</code> in
your classpath, but you also need to invoke the test runner called
<code>org.junit.runner.JUnitCore</code> as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>java -classpath .;C:\Utilities\Java\JUnit\junit-4.5.jar
    org.junit.runner.JUnitCore MathTest</pre>
</div>
</div>
<div class="paragraph">
<p>If you had multiple test classes, you could just list them all after
<code>org.junit.runner.JUnitCore</code> and all the methods marked <code>@Test</code> in them
would be run. Note that methods without an <code>@Test</code> decoration will not
be run as tests, but there is no rule against having them. In this way,
you can use un-decorated methods as helper methods for your test
methods.</p>
</div>
<div class="paragraph">
<p>When you run JUnit tests, you should see the version number of JUnit
used, a dot printed out for each test, the amount of time taken, and
then something like <code>OK (3 tests)</code> if all of your tests ran without an
error. If there is an error, it will list each error, probably with a
long stack trace showing the propagation of the exception.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_testing_tools">16.8. Concurrency: Testing tools</h3>
<div class="paragraph">
<p>In this section, we describe some tools that exist specifically to help
you catch those bugs that are present as a direct result of concurrency.
You have probably noticed that this section is quite short, and that
shortness reflects the shortage of good tools available. The design of
concurrent debugging and testing tools is still an open research topic.
As always, the nondeterminism of concurrency makes bugs difficult to pin
down. You could run a JUnit test 1,000,000 times and never see a
peculiar race condition bug. From a brute force perspective, we could
try to test all possible interleavings of thread execution, but this
approach is not practical for large programs because the number of
interleavings grows exponentially. Nevertheless, some research has
focused on attacking the problem from this direction.</p>
</div>
<div class="sect3">
<h4 id="_contest">16.8.1. ConTest</h4>
<div class="paragraph">
<p>One tool that uses this idea is ConTest from IBM. The way the JVM
normally works makes some interleavings more likely than others. If the
correct output is very likely and the incorrect is very unlikely, it is
easy for you to believe that your program works correctly. ConTest is a
tool that <em>instruments</em> class files after they have been compiled by
Java. When it instruments these files, it adds extra method calls into
concurrent code designed to introduce some randomness into the system.
By introducing <code>sleep()</code> and <code>yield()</code> methods in random places, the JVM
can be forced into producing interleavings that would otherwise be
unusual. The designers of ConTest have used heuristics so that ConTest
adds this randomness in &#8220;smart&#8221; locations designed to maximize unusual
interleavings and catch bugs.</p>
</div>
<div class="paragraph">
<p>ConTest is not a panacea. Although it can reveal bugs that are very
rare, it still must be combined with strong testing methodologies so
that those bugs can be caught when they appear. Another difficulty with
using ConTest is that it cannot tell you where the problem happened or
when it is likely to happen under normal circumstances. You are still
dependent on your test design to reveal the source of the problem.
Finally, ConTest cannot guarantee every possible ordering. Very rare
bugs may not manifest even after thousands of runs with ConTest
instrumented code. For more information about ConTest, visit
<code><a href="http://www.ibm.com/developerworks/java/library/j-contest.html" class="bare">http://www.ibm.com/developerworks/java/library/j-contest.html</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_concutest">16.8.2. Concutest</h4>
<div class="paragraph">
<p>We hope we have convinced you of the value of using JUnit testing to
unit test your programs. Of course, JUnit has several limitations when
it comes to concurrent programs. JUnit uses exceptions to report failed
test cases. Unfortunately, JUnit only reports exceptions from the main
thread, not from any child threads that may be spawned. ConcJUnit allows
exceptions thrown by child threads to be reported and also forces all
child threads to join with the main thread.</p>
</div>
<div class="paragraph">
<p>In this way, it will be clear if any errors happened while a child
thread was being executed, either causing an exception to be thrown or
causing a child thread to fail to rejoin the main thread.</p>
</div>
<div class="paragraph">
<p>ConcJUnit is part of a larger suite of tools called <strong>Concutest</strong>
maintained at<br>
<a href="http://www.cs.rice.edu/~mgricken/research/concutest/" class="bare">http://www.cs.rice.edu/~mgricken/research/concutest/</a>. Concutest includes
Thread Checker, a tool that allows programmers to use annotations to
test thread invariants. The Concutest project is also developing a
Schedule-Based Execution environment to allow programmers to test
programs using specific sets of concurrent interleavings.</p>
</div>
</div>
<div class="sect3">
<h4 id="_intel_tools">16.8.3. Intel tools</h4>
<div class="paragraph">
<p>There are many other industry tools for debugging and optimizing
threaded programs. Intel produces software such as the Intel Thread
Checker to find concurrent errors as well as the Intel Vtune Performance
Analyzer and Intel Thread Profiler to help tune threaded programs. These
products from Intel, like many concurrency tools, are focused on C/C++
and Fortran platforms. Historically, concurrency has been centered in
the high performance and scientific computing markets. Java, in
contrast, has been perceived as a slow language, more suited for desktop
applications. As the role of concurrency continues to evolve, so will
the tools to help programmers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_testing_a_class">16.9. Examples: Testing a class</h3>
<div class="paragraph">
<p>The larger the system, the more critical testing becomes. We do not have
the space to give or explain a complex testing example, but we can give
you another example of JUnit testing.</p>
</div>
<div class="exampleblock">
<div class="title">Example 139. A broken class</div>
<div class="content">
<div class="paragraph">
<p>We are going to rely on an example from physics and create a
<code>PointCharge</code> class that has a certain charge and a specific location in
3D space. We are also going to introduce some errors into the class.
Because the class is so simple, the errors should be obvious.
Nevertheless, we have picked errors that are reasonable to make.</p>
</div>
<div id="PointChargeProgram" class="listingblock">
<div class="title">Program 72. Physics class with errors.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PointCharge</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">charge</span><span class="tok-o">;</span>  <span class="tok-c1">// C</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">;</span>       <span class="tok-c1">// m</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">y</span><span class="tok-o">;</span>       <span class="tok-c1">// m</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">z</span><span class="tok-o">;</span>       <span class="tok-c1">// m</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">K</span> <span class="tok-o">=</span> <span class="tok-mf">8.9875517873681764e9</span><span class="tok-o">;</span> <span class="tok-c1">//N m^2 C^-2</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-nf">PointCharge</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">charge</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">charge</span> <span class="tok-o">=</span> <span class="tok-n">charge</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">x</span> <span class="tok-o">=</span> <span class="tok-n">x</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">y</span> <span class="tok-o">=</span> <span class="tok-n">y</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">z</span> <span class="tok-o">=</span> <span class="tok-n">y</span><span class="tok-o">;</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getCharge</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">charge</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">distance</span><span class="tok-o">(</span> <span class="tok-n">PointCharge</span> <span class="tok-n">p</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>		<span class="tok-k">return</span> <span class="tok-n">distance</span><span class="tok-o">(</span> <span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">x</span><span class="tok-o">,</span> <span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">y</span><span class="tok-o">,</span> <span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">z</span> <span class="tok-o">);</span>
<span class="lineno">19 </span>	<span class="tok-o">}</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>	<span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-nf">distance</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">22 </span>		<span class="tok-kt">double</span> <span class="tok-n">deltaX</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">x</span> <span class="tok-o">-</span> <span class="tok-n">x</span><span class="tok-o">;</span>
<span class="lineno">23 </span>		<span class="tok-kt">double</span> <span class="tok-n">deltaY</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">y</span> <span class="tok-o">-</span> <span class="tok-n">y</span><span class="tok-o">;</span>
<span class="lineno">24 </span>		<span class="tok-kt">double</span> <span class="tok-n">deltaZ</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">z</span> <span class="tok-o">-</span> <span class="tok-n">z</span><span class="tok-o">;</span>
<span class="lineno">25 </span>		<span class="tok-k">return</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span> <span class="tok-n">deltaX</span><span class="tok-o">*</span><span class="tok-n">deltaX</span> <span class="tok-o">+</span> <span class="tok-n">deltaY</span><span class="tok-o">*</span><span class="tok-n">deltaY</span> <span class="tok-o">+</span> <span class="tok-n">deltaZ</span><span class="tok-o">*</span><span class="tok-n">deltaZ</span> <span class="tok-o">);</span>
<span class="lineno">26 </span>	<span class="tok-o">}</span>
<span class="lineno">27 </span>
<span class="lineno">28 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">scalarForce</span><span class="tok-o">(</span> <span class="tok-n">PointCharge</span> <span class="tok-n">p</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">29 </span>		<span class="tok-kt">double</span> <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">distance</span><span class="tok-o">(</span> <span class="tok-n">p</span> <span class="tok-o">);</span>
<span class="lineno">30 </span>		<span class="tok-k">return</span> <span class="tok-n">K</span><span class="tok-o">*</span><span class="tok-n">charge</span><span class="tok-o">*</span><span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">charge</span><span class="tok-o">/</span><span class="tok-n">r</span><span class="tok-o">*</span><span class="tok-n">r</span><span class="tok-o">;</span>
<span class="lineno">31 </span>	<span class="tok-o">}</span>
<span class="lineno">32 </span>
<span class="lineno">33 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">fieldMagnitude</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">34 </span>		<span class="tok-kt">double</span> <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">distance</span><span class="tok-o">(</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-n">z</span> <span class="tok-o">);</span>
<span class="lineno">35 </span>		<span class="tok-k">return</span> <span class="tok-n">charge</span><span class="tok-o">/(</span><span class="tok-n">r</span><span class="tok-o">*</span><span class="tok-n">r</span><span class="tok-o">);</span>
<span class="lineno">36 </span>	<span class="tok-o">}</span>
<span class="lineno">37 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PointCharge</code> class has the expected constructor and then a method
to determine distance to another <code>PointCharge</code>. This method in turn
relies on a private helper method that can compute distance to an
arbitrary \(x\), \(y\), and \(z\)
location. Finally, the &#8220;important&#8221; work done by the class are in
determining the scalar force between two charges and the magnitude of
the electric field due to the charge at some location. Recall from
physics that the force \(F\) between two charges
\(q_1\) and \(q_2\) is
\(k_\mathrm{e} \frac{q_1q_2}{r^2}\) where
\(k_\mathrm{e}\) is the proportionality constant
\(8.9875517873681764 \times 10^9 \ \mathrm{N  \cdot m^2 \cdot C^{-2}}\)
and \(r\) is the distance between the charges. Likewise the
electric field \(E\) at a given location due to a charge
\(q\) is \(k_\mathrm{e} \frac{q}{r^2}\).</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 140. Testing the distance methods</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s come up with a test for the <code>distance()</code> methods first. We&#8217;re
going to need some other `PointCharge`s. Let&#8217;s make 4 altogether: one at
the origin and three one meter along each positive axis. We can create
these charges in a set up method. While we&#8217;re at it, we&#8217;ll give them a
variety of positive and negative charges.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Before</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">charge1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PointCharge</span><span class="tok-o">(</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span> <span class="tok-o">);</span>
    <span class="tok-n">charge2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PointCharge</span><span class="tok-o">(</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span> <span class="tok-o">);</span>
    <span class="tok-n">charge3</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PointCharge</span><span class="tok-o">(</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span> <span class="tok-o">);</span>
    <span class="tok-n">charge4</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PointCharge</span><span class="tok-o">(</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To test the <code>distance()</code> method thoroughly, we will check the distance
from <code>charge1</code> to all the other charges as well as <code>charge2</code> to
<code>charge3</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">distance</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mf">1.0</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">charge2</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mf">1.0</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">charge3</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mf">1.0</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">charge4</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-mf">2.0</span><span class="tok-o">),</span> <span class="tok-n">charge2</span><span class="tok-o">.</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">charge3</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The distances between <code>charge1</code> and the other three should be 1, and the
distance between <code>charge2</code> and <code>charge3</code> should be about
\(\sqrt{2}\). Yet, when we run this test with JUnit, the test
fails. We get:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>java.lang.AssertionError: expected:&lt;1.0&gt; but was:&lt;1.4142135623730951&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>for the second assertion in the method. But why? If we comb through the
<code>distance()</code> methods in <code>PointCharge</code>, they all look correct. The
problem must be deeper. <code>PointCharge</code> does not have accessor methods for
its location, and so we can&#8217;t test those. Checking the constructor, we
find the culprit: <code>this.z = y;</code>, a simple cut and paste error.</p>
</div>
<div class="paragraph">
<p>With the <code>distance()</code> methods working, we can test other things. We are
going to run a similar test for <code>scalarForce()</code> generated by plugging in
appropriate values into the equation for \(F\).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">scalarForce</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">PointCharge</span><span class="tok-o">.</span><span class="tok-na">K</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">scalarForce</span><span class="tok-o">(</span><span class="tok-n">charge2</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-o">-</span><span class="tok-n">PointCharge</span><span class="tok-o">.</span><span class="tok-na">K</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">scalarForce</span><span class="tok-o">(</span><span class="tok-n">charge3</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mf">0.0</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">scalarForce</span><span class="tok-o">(</span><span class="tok-n">charge4</span><span class="tok-o">),</span> <span class="tok-mf">0.000001</span> <span class="tok-o">);</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-o">-</span><span class="tok-n">PointCharge</span><span class="tok-o">.</span><span class="tok-na">K</span><span class="tok-o">,</span> <span class="tok-n">charge2</span><span class="tok-o">.</span><span class="tok-na">scalarForce</span><span class="tok-o">(</span><span class="tok-n">charge3</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run this test with JUnit, the last assertion fails. We get the
following output.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>java.lang.AssertionError: expected:&lt;-8.987551787368176E9&gt;
    but was:&lt;-1.797510357473635E10&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>A close inspection reveals that the actual value is about twice the
expected value. Where does this extra factor of 2 come from? Scanning
the code for <code>scalarForce()</code>, we find <code>return K*charge*p.charge/r*r;</code></p>
</div>
<div class="paragraph">
<p>We forgot parentheses and messed up our equation. What we really wanted
was <code>return K*charge*p.charge/(r*r);</code></p>
</div>
<div class="paragraph">
<p>The most striking thing about this example is that three test cases
passed! Perhaps that means that we were choosing values that were too
simple, but it also illustrates the importance of serious testing.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 141. Testing the field magnitude method</div>
<div class="content">
<div class="paragraph">
<p>Finally, let&#8217;s test the value of the <code>fieldMagnitude()</code> method. For
simplicity, we&#8217;ll test the field at the locations of <code>charge1</code>,
<code>charge3</code>, and <code>charge4</code> with respect to <code>charge2</code>.</p>
</div>
<div class="paragraph">
<p>This time the first assertion fails. We get the following output.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>java.lang.AssertionError: expected:&lt;1.797510357473635E10&gt; but was:&lt;2.0&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>2.0</code> seems like a very strange result when we were expecting a value
with an order of magnitude 10 times larger. Perhaps the constant was
omitted? Yes, our version of <code>fieldMagnitude()</code> left off a factor of
<code>K</code>. Once we fix that, our code finally produces the <code>OK (3 tests)</code> we
have been waiting to see from JUnit. Why didn&#8217;t we fail the assertions
after the first one? Because of the exception handling mechanism, each
JUnit test method stops once a failure has happened.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Here is the fully corrected version of <code>PointCharge</code> renamed
<code>FixedPointCharge</code>.</p>
</div>
<div id="FixedPointChargeProgram" class="listingblock">
<div class="title">Program 73. Corrected version of <code>PointCharge</code>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FixedPointCharge</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>  <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">charge</span><span class="tok-o">;</span>  <span class="tok-c1">// C</span>
<span class="lineno"> 3 </span>  <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">;</span>       <span class="tok-c1">// m</span>
<span class="lineno"> 4 </span>  <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">y</span><span class="tok-o">;</span>       <span class="tok-c1">// m</span>
<span class="lineno"> 5 </span>  <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-n">z</span><span class="tok-o">;</span>       <span class="tok-c1">// m</span>
<span class="lineno"> 6 </span>  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">K</span> <span class="tok-o">=</span> <span class="tok-mf">8.9875517873681764e9</span><span class="tok-o">;</span> <span class="tok-c1">//N m^2 C^-2</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>  <span class="tok-kd">public</span> <span class="tok-nf">FixedPointCharge</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">charge</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">charge</span> <span class="tok-o">=</span> <span class="tok-n">charge</span><span class="tok-o">;</span>
<span class="lineno">10 </span>    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">x</span> <span class="tok-o">=</span> <span class="tok-n">x</span><span class="tok-o">;</span>
<span class="lineno">11 </span>    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">y</span> <span class="tok-o">=</span> <span class="tok-n">y</span><span class="tok-o">;</span>
<span class="lineno">12 </span>    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">z</span> <span class="tok-o">=</span> <span class="tok-n">z</span><span class="tok-o">;</span>
<span class="lineno">13 </span>  <span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>  <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getCharge</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">charge</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>  <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">distance</span><span class="tok-o">(</span> <span class="tok-n">FixedPointCharge</span> <span class="tok-n">p</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>    <span class="tok-k">return</span> <span class="tok-n">distance</span><span class="tok-o">(</span> <span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">x</span><span class="tok-o">,</span> <span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">y</span><span class="tok-o">,</span> <span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">z</span> <span class="tok-o">);</span>
<span class="lineno">19 </span>  <span class="tok-o">}</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>  <span class="tok-kd">private</span> <span class="tok-kt">double</span> <span class="tok-nf">distance</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">22 </span>    <span class="tok-kt">double</span> <span class="tok-n">deltaX</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">x</span> <span class="tok-o">-</span> <span class="tok-n">x</span><span class="tok-o">;</span>
<span class="lineno">23 </span>    <span class="tok-kt">double</span> <span class="tok-n">deltaY</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">y</span> <span class="tok-o">-</span> <span class="tok-n">y</span><span class="tok-o">;</span>
<span class="lineno">24 </span>    <span class="tok-kt">double</span> <span class="tok-n">deltaZ</span> <span class="tok-o">=</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">z</span> <span class="tok-o">-</span> <span class="tok-n">z</span><span class="tok-o">;</span>
<span class="lineno">25 </span>    <span class="tok-k">return</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span> <span class="tok-n">deltaX</span><span class="tok-o">*</span><span class="tok-n">deltaX</span> <span class="tok-o">+</span> <span class="tok-n">deltaY</span><span class="tok-o">*</span><span class="tok-n">deltaY</span> <span class="tok-o">+</span> <span class="tok-n">deltaZ</span><span class="tok-o">*</span><span class="tok-n">deltaZ</span> <span class="tok-o">);</span>
<span class="lineno">26 </span>  <span class="tok-o">}</span>
<span class="lineno">27 </span>
<span class="lineno">28 </span>  <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">scalarForce</span><span class="tok-o">(</span> <span class="tok-n">PointCharge</span> <span class="tok-n">p</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">29 </span>    <span class="tok-kt">double</span> <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">distance</span><span class="tok-o">(</span> <span class="tok-n">p</span> <span class="tok-o">);</span>
<span class="lineno">30 </span>    <span class="tok-k">return</span> <span class="tok-n">K</span><span class="tok-o">*</span><span class="tok-n">charge</span><span class="tok-o">*</span><span class="tok-n">p</span><span class="tok-o">.</span><span class="tok-na">charge</span><span class="tok-o">/(</span><span class="tok-n">r</span><span class="tok-o">*</span><span class="tok-n">r</span><span class="tok-o">);</span>
<span class="lineno">31 </span>  <span class="tok-o">}</span>
<span class="lineno">32 </span>
<span class="lineno">33 </span>  <span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">fieldMagnitude</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">z</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">34 </span>    <span class="tok-kt">double</span> <span class="tok-n">r</span> <span class="tok-o">=</span> <span class="tok-n">distance</span><span class="tok-o">(</span> <span class="tok-n">x</span><span class="tok-o">,</span> <span class="tok-n">y</span><span class="tok-o">,</span> <span class="tok-n">z</span> <span class="tok-o">);</span>
<span class="lineno">35 </span>    <span class="tok-k">return</span> <span class="tok-n">K</span><span class="tok-o">*</span><span class="tok-n">charge</span><span class="tok-o">/(</span><span class="tok-n">r</span><span class="tok-o">*</span><span class="tok-n">r</span><span class="tok-o">);</span>
<span class="lineno">36 </span>  <span class="tok-o">}</span>
<span class="lineno">37 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And, for easy readability, here is the full JUnit test class
<code>TestPointCharge</code>. Note that you will have to change the name
<code>PointCharge</code> to <code>FixedPointCharge</code> if you want to test the corrected
class.</p>
</div>
<div id="TestPointChargeProgram" class="listingblock">
<div class="title">Program 74. Class for testing <code>PointCharge</code>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">org.junit.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import static</span> <span class="tok-nn">org.junit.Assert.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestPointCharge</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>  <span class="tok-kd">private</span> <span class="tok-n">PointCharge</span> <span class="tok-n">charge1</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>  <span class="tok-kd">private</span> <span class="tok-n">PointCharge</span> <span class="tok-n">charge2</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>  <span class="tok-kd">private</span> <span class="tok-n">PointCharge</span> <span class="tok-n">charge3</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>  <span class="tok-kd">private</span> <span class="tok-n">PointCharge</span> <span class="tok-n">charge4</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>  <span class="tok-nd">@Before</span>
<span class="lineno">11 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>    <span class="tok-n">charge1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PointCharge</span><span class="tok-o">(</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>    <span class="tok-n">charge2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PointCharge</span><span class="tok-o">(</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span> <span class="tok-o">);</span>
<span class="lineno">14 </span>    <span class="tok-n">charge3</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PointCharge</span><span class="tok-o">(</span> <span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span> <span class="tok-o">);</span>
<span class="lineno">15 </span>    <span class="tok-n">charge4</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PointCharge</span><span class="tok-o">(</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span> <span class="tok-o">);</span>
<span class="lineno">16 </span>  <span class="tok-o">}</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>  <span class="tok-nd">@Test</span>
<span class="lineno">19 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">distance</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mf">1.0</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">charge2</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">21 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mf">1.0</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">charge3</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">22 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mf">1.0</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">charge4</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-mf">2.0</span><span class="tok-o">),</span> <span class="tok-n">charge2</span><span class="tok-o">.</span><span class="tok-na">distance</span><span class="tok-o">(</span><span class="tok-n">charge3</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">24 </span>  <span class="tok-o">}</span>
<span class="lineno">25 </span>
<span class="lineno">26 </span>  <span class="tok-nd">@Test</span>
<span class="lineno">27 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">scalarForce</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">28 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">PointCharge</span><span class="tok-o">.</span><span class="tok-na">K</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">scalarForce</span><span class="tok-o">(</span><span class="tok-n">charge2</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">29 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-o">-</span><span class="tok-n">PointCharge</span><span class="tok-o">.</span><span class="tok-na">K</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">scalarForce</span><span class="tok-o">(</span><span class="tok-n">charge3</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">30 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mf">0.0</span><span class="tok-o">,</span> <span class="tok-n">charge1</span><span class="tok-o">.</span><span class="tok-na">scalarForce</span><span class="tok-o">(</span><span class="tok-n">charge4</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">31 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-kt">double</span><span class="tok-o">)-</span><span class="tok-n">PointCharge</span><span class="tok-o">.</span><span class="tok-na">K</span><span class="tok-o">,</span> <span class="tok-o">(</span><span class="tok-kt">double</span><span class="tok-o">)</span><span class="tok-n">charge2</span><span class="tok-o">.</span><span class="tok-na">scalarForce</span><span class="tok-o">(</span><span class="tok-n">charge3</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">32 </span>  <span class="tok-o">}</span>
<span class="lineno">33 </span>
<span class="lineno">34 </span>  <span class="tok-nd">@Test</span>
<span class="lineno">35 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">fieldMagnitude</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">36 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-mi">2</span><span class="tok-o">*</span><span class="tok-n">PointCharge</span><span class="tok-o">.</span><span class="tok-na">K</span><span class="tok-o">,</span> <span class="tok-n">charge2</span><span class="tok-o">.</span><span class="tok-na">fieldMagnitude</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">37 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-n">PointCharge</span><span class="tok-o">.</span><span class="tok-na">K</span><span class="tok-o">,</span> <span class="tok-n">charge2</span><span class="tok-o">.</span><span class="tok-na">fieldMagnitude</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">38 </span>    <span class="tok-n">assertEquals</span><span class="tok-o">(</span> <span class="tok-n">PointCharge</span><span class="tok-o">.</span><span class="tok-na">K</span><span class="tok-o">,</span> <span class="tok-n">charge2</span><span class="tok-o">.</span><span class="tok-na">fieldMagnitude</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">),</span> <span class="tok-mf">0.001</span> <span class="tok-o">);</span>
<span class="lineno">39 </span>  <span class="tok-o">}</span>
<span class="lineno">40 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_16">16.10. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise16.1"></a> What is the purpose of the <code>assert</code> keyword in Java? What steps must
be taken for it to be active?</p>
</li>
<li>
<p><a id="exercise16.2"></a> What is the value of <code>j</code> after the following statements are
executed?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">j</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">;</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">);</span>
    <span class="tok-n">j</span> <span class="tok-o">+=</span> <span class="tok-n">i</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming the programmer made an error, what category of programming
error does it fall under?</p>
</div>
</li>
<li>
<p><a id="exercise16.3"></a> The following loop is intended to print out all possible <code>byte</code>
values. What is the conceptual error made in the following loop? How
many times will it execute?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">byte</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">value</span> <span class="tok-o">&lt;</span> <span class="tok-mi">256</span><span class="tok-o">;</span> <span class="tok-o">++</span><span class="tok-n">value</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Byte: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">value</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise16.4"></a> What are all the possible run-time errors that could occur in this
method that reverses a section of an array?</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">reverse</span><span class="tok-o">(</span> <span class="tok-n">Object</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">start</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">end</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">Object</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
    <span class="tok-n">end</span><span class="tok-o">--;</span>  <span class="tok-c1">//up to but not including end</span>
    <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">start</span> <span class="tok-o">&lt;</span> <span class="tok-n">end</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">start</span><span class="tok-o">];</span>
        <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">start</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">end</span><span class="tok-o">];</span>
        <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">end</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
        <span class="tok-n">start</span><span class="tok-o">++;</span>
        <span class="tok-n">end</span><span class="tok-o">--;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What checks could be added to catch these errors?</p>
</div>
</li>
<li>
<p><a id="exercise16.5"></a> Consider the following definition of a stack that holds <code>int</code>
values.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">IntegerStack</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Node</span> <span class="tok-o">{</span>
        <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">data</span><span class="tok-o">;</span>
        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
        <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">data</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
        <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
        <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">pop</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">top</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">data</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">empty</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">head</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What exceptions could be thrown when using this class? Where could they
be thrown?</p>
</div>
</li>
<li>
<p><a id="exercise16.6"></a> This question sometimes comes up in job interviews. Imagine that you
have a simple singly linked list such as the one described in
<a href="#_dynamic_data_structures">Chapter 18</a>. What if there is a loop in
the list such that the last element in the list points to an earlier
element in the list? For this reason, a simple traversal of the list
will go on forever. How could you detect such a problem during program
execution?</p>
</li>
<li>
<p><a id="exercise16.7"></a> What is the difference between black box testing and white box
testing? What kinds of bugs are more likely to be caught by black box
testing? By white box testing?</p>
</li>
<li>
<p><a id="exercise16.8"></a> The Microsoft Zune is a portable media player in competition with
the Apple iPod. The first generation Zune 30 received negative publicity
because many of them froze on December 31, 2008 due to a leap year bug.
It is possible to find segments of the source code that caused this
problem on the Internet. Essentially, the clock code for the Zune
behaved correctly on any day of the year numbered 365 or lower.
Likewise, when the day was greater than 366, it would correctly move to
the next year and reset the day counter. When day was exactly 366,
however, the Zune became stuck in an infinite loop. What kind of testing
should Microsoft have done to prevent this bug?</p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise16.9"></a> Apply JUnit testing to the last major assignment you did in class.
What bugs did you uncover?</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise16.10"></a> James Gosling&#8217;s original specification for Java contained
assertions, but they were not included until Java 1.4. One of the
concerns about an assertion mechanism is the additional time required to
process the assertions. Time a program of at least moderate length
before adding <code>assert</code> statements to its methods. If you use <code>assert</code>
statements to check method input and output thoroughly, you should see a
slight decrease in performance when assertions are enabled. When
disabled, you should see almost none. How great is the performance hit?</p>
</li>
<li>
<p><a id="exercise16.11"></a> Take another look at your last programming assignment. Calculate the
number of branches based on <code>if</code> and <code>switch</code> statements and compute 2
raised to that power. Time your program executing once under normal
circumstances. Multiply that time by the number of different
possibilities you would need to exercise every possible combination of
branches in your program. How long would it take?</p>
</li>
<li>
<p><a id="exercise16.12"></a> Take a concurrent program you have written that relies on explicit
synchronization mechanisms for correctness. Remove all synchronization
tools and run the code many times, testing for race conditions. Then,
instrument the code with ConTest and run it many more times. Do you see
increased variety in output with ConTest? Was it easier to find race
conditions?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_polymorphism">17. Polymorphism</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>&#8230;&#8203;how strange it is to be anything at all.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Neutral Milk Hotel
</div>
</div>
<div class="sect2">
<h3 id="_problem_banking_account_with_a_vengeance">17.1. Problem: Banking account with a vengeance</h3>
<div class="paragraph">
<p>In <a href="#_synchronization">Chapter 14</a>, we introduced the
<code>SynchronizedAccount</code> class that guarantees that checking the balance,
making deposits, and making withdrawals will all be safe even in a
multi-threaded environment. Unfortunately, <code>SynchronizedAccount</code> gives
very few of the options a full bank account should have. The problem we
present to you now is to create an entire line of bank accounts which
all inherit from <code>SynchronizedAccount</code>. Because of inheritance, all
accounts will at least have <code>getBalance()</code>, <code>deposit()</code>, and
<code>withdraw()</code> methods.</p>
</div>
<div class="paragraph">
<p>You must create three new account classes. The constructor for each
class must take a <code>String</code> which gives the name of the person opening
the account and <code>double</code> which gives the starting balance of the
account. The first of these classes is <code>CheckingAccount</code>. The rules for
the checking account implemented by this class are simply that the
customer is charged $10 every month that the account is open. The second
class is <code>DirectDepositAccount</code>. This account is very similar to the
basic checking account except that an additional method
<code>directDeposit()</code> has been added. On its own, <code>directDeposit()</code> appears
to operate like <code>deposit()</code>; however, if a direct deposit has been made
in the last month, no service fee will be charged to the account.</p>
</div>
<div class="paragraph">
<p>The <code>SavingsAccount</code> class operates somewhat differently. In addition to
a name and a starting balance, the constructor for a <code>SavingsAccount</code>
takes a <code>double</code> which gives the annual interest rate the account earns.
Each month the balance is checked. If the balance of the account is
greater than $0, the account earns interest corresponding to
\(\frac{1}{12}\) of the annual rate. However, if the balance
is below $1000, a $25 service fee is charged each month, regardless of
how low the balance becomes.</p>
</div>
<div class="paragraph">
<p>In <a href="#_inheritance">Chapter 11</a> you were exposed to concepts in
inheritance. We are now returning to these concepts and exploring them
further. In the first place, concurrency is on the table now, and you
must be careful to keep your derived classes thread-safe. In the second,
we will discuss the full breadth of inheritance. The tools we discuss
are intended to allow you to solve this extended bank account problem
and indeed many other problems with as little code as possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_polymorphism">17.2. Concepts: Polymorphism</h3>
<div class="paragraph">
<p>Perhaps the most important use for inheritance is code reuse. When you
can successfully reuse existing code, you are not just saving the time
of writing new code: You are also leveraging the quality and correctness
of the existing code. For example, when you create your own class which
extends <code>Thread</code>, you are confident that all the thread mechanisms work
properly.</p>
</div>
<div class="paragraph">
<p>You can reuse code by taking a class that does something you like, say
the <code>Racecar</code> class, and enhance it in some way, perhaps so that it
becomes the <code>TurboRacecar</code> class. If you use the <code>TurboRacecar</code> class on
its own, your code reuse is through simple inheritance. If you use
<code>TurboRacecar</code> objects with a <code>RaceTrack</code> class, which was written to
take <code>Racecar</code> objects as input, you have entered the realm of
<em>polymorphism</em>. Polymorphism means that the same method can be used on
different types of objects without being rewritten. In Java,
polymorphism works by allowing the programmer to use a derived class in
any place where a base class could have been used.</p>
</div>
<div class="sect3">
<h4 id="_the_is_a_relationship">17.2.1. The is-a relationship</h4>
<div class="paragraph">
<p>Consider the two following class definitions:</p>
</div>
<div id="RacecarProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Racecar</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getTopSpeed</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-mf">200.0</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getHorsepower</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-mi">700</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-n">speed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="TurboRacecarProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TurboRacecar</span> <span class="tok-kd">extends</span> <span class="tok-n">Racecar</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getHorsepower</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-mi">1100</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">3 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, imagine that a <code>RaceTrack</code> has an <code>addCar(Racecar car)</code> method
which adds a <code>Racecar</code> to the list of cars on the track. When the cars
begin racing, the <code>RaceTrack</code> object will query the cars to see how much
horsepower they have. A <code>Racecar</code> object will return 700 when
<code>getHorsepower()</code> is called, but a <code>TurboRacecar</code> will return 1100.</p>
</div>
<div class="paragraph">
<p>Even through the <code>TurboRacecar</code> does not have an explicit
<code>getTopSpeed()</code> method, it inherits one from <code>Racecar</code>. Like all derived
classes in Java, <code>TurboRacecar</code> has all the methods and fields that
<code>Racecar</code> does. This relationship is called an <em>is-a</em> relationship
because every <code>TurboRacecar</code> is a <code>Racecar</code> in the sense that you can
use a <code>TurboRacecar</code> whenever a <code>Racecar</code> is required.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dynamic_binding">17.2.2. Dynamic binding</h4>
<div class="paragraph">
<p>There is a little bit of magic that makes polymorphism work. When you
compile your code, the <code>RaceTrack</code> doesn&#8217;t know which <code>getHorsePower()</code>
method will eventually get called. Only at run time does it query the
object in question and, if it is a <code>TurboRacecar</code>, use the overridden
method that returns 1100. This feature of Java is called <em>dynamic
binding</em>. Not every object oriented programming language supports
dynamic binding. C++ actually allows the programmer to specify whether
or not a method is dynamically bound.</p>
</div>
<div class="paragraph">
<p>Only methods are dynamically bound in Java. Fields are <em>statically
bound</em>. Consider the following re-definitions of <code>Racecar</code> and
<code>TurboRacecar</code>.</p>
</div>
<div id="StaticRacecarProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">StaticRacecar</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">TOP_SPEED</span> <span class="tok-o">=</span> <span class="tok-mf">200.0</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">HORSEPOWER</span> <span class="tok-o">=</span> <span class="tok-mi">700</span><span class="tok-o">;</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-n">speed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="StaticTurboRacecarProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">StaticTurboRacecar</span> <span class="tok-kd">extends</span> <span class="tok-n">StaticRacecar</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">HORSEPOWER</span> <span class="tok-o">=</span> <span class="tok-mi">1100</span><span class="tok-o">;</span>
<span class="lineno">3 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Assume that <code>RaceTrack</code> contains a method which prints out the
horsepower of a <code>StaticRacecar</code> like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">printHorsepower</span><span class="tok-o">(</span> <span class="tok-n">StaticRacecar</span> <span class="tok-n">car</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-n">car</span><span class="tok-o">.</span><span class="tok-na">HORSEPOWER</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if you pass an object of type <code>StaticTurboRacecar</code>, the value 700
will be printed out every time. In Java, all fields, whether normal,
<code>static</code>, or <code>final</code> are statically bound.</p>
</div>
</div>
<div class="sect3">
<h4 id="_general_vs_specific">17.2.3. General vs. specific</h4>
<div class="paragraph">
<p>Another way to look at inheritance is as a statement of a specialization
and generalization. A <code>TurboRacecar</code> is a specific kind of <code>Racecar</code>
while a <code>Racecar</code> is a general category that <code>TurboRacecar</code> belongs to.</p>
</div>
<div class="paragraph">
<p>The rules of Java say that you can always use a more specific version of
a class than you need but never a more general one. You can use a
<code>TurboRacecar</code> any time you need a <code>Racecar</code> but not the reverse. A
square will do the job of a rectangle, but a rectangle will not always
be suitable when a square is needed.</p>
</div>
<div class="paragraph">
<p>Consider the following two classes:</p>
</div>
<div id="VehicleProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Vehicle</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">travel</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">destination</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Traveling to &quot;</span> <span class="tok-o">+</span> <span class="tok-n">destination</span> <span class="tok-o">+</span> <span class="tok-s">&quot;!&quot;</span><span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="RocketShipProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RocketShip</span> <span class="tok-kd">extends</span> <span class="tok-n">Vehicle</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">blastOff</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;FOOOOM!&quot;</span><span class="tok-o">);</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a method that requires a <code>RocketShip</code> but only uses its
<code>travel()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">takeVacation</span><span class="tok-o">(</span> <span class="tok-n">RocketShip</span> <span class="tok-n">ship</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">destination</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">ship</span><span class="tok-o">.</span><span class="tok-na">travel</span><span class="tok-o">(</span> <span class="tok-n">destination</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It seems as though we should be able to pass any <code>Vehicle</code> to the
<code>takeVacation()</code> method because the only method in <code>ship</code> used by
<code>takeVacation()</code> is the <code>travel()</code> method. However, the programmer
specified that the parameter should be a <code>RocketShip</code>, and Java plays it
safe. Just because it looks like there won&#8217;t be a problem, Java isn&#8217;t
going to take any chances on passing an overly general <code>Vehicle</code> when a
<code>RocketShip</code> is required. If Java took chances, a problem could arise if
the <code>takeVacation()</code> method was overridden by a method that did call
<code>ship.blastOff()</code>.</p>
</div>
<div class="paragraph">
<p>In summary, you can pass a <code>RocketShip</code> to a method which takes a
<code>Vehicle</code> or store a <code>RocketShip</code> in an array of <code>Vehicles</code>, but not the
reverse. Java usually gives a compile time error if you try to put
something too general into a location that is too specific. There are,
however, some situations which are so tricky that Java doesn&#8217;t catch the
error until runtime. Arrays, specifically, can cause problems. Examine
the following code snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Vehicle</span><span class="tok-o">[]</span> <span class="tok-n">transportation</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RocketShip</span><span class="tok-o">[</span><span class="tok-mi">100</span><span class="tok-o">];</span>
<span class="tok-n">transportation</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Vehicle</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the first line, we are using a <code>Vehicle</code> array reference to store an
array of 100 <code>RocketShip`s. But, in the second line, we try to store a
`Vehicle</code> into an array that is really a <code>RocketShip</code> array, even though
it looks to the compiler like a <code>Vehicle</code> array. Doing so will compile
but throw an <code>ArrayStoreException</code> at runtime.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_inheritance_tools_in_java">17.3. Syntax: Inheritance tools in Java</h3>
<div class="paragraph">
<p>So far, we have described polymorphism in Java with a conceptual focus.
In our previous examples, the only language tool needed to use
polymorphism was the <code>extends</code> keyword which you are well familiar with
by now. There are a number of other tools designed to help you structure
class hierarchies and enforce design decisions.</p>
</div>
<div class="sect3">
<h4 id="_abstract_classes_and_methods">17.3.1. Abstract classes and methods</h4>
<div class="paragraph">
<p>One such tool is abstract classes. An abstract class is one which can
never be instantiated. In order to use an abstract class, it is
necessary to derive a class from it. To create an abstract class, you
just need to add the <code>abstract</code> keyword to its definition, as in the
following example.</p>
</div>
<div id="UselessProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Useless</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">variable</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Useless</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">input</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">variable</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-o">}</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">variable</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class is useless for a number of reasons. For one thing, there&#8217;s no
way to find out the value of <code>variable</code> except by printing it out.
Furthermore, there&#8217;s no way to change the value of <code>variable</code> after the
object has been created. Finally, since an abstract class cannot be
instantiated, the following code snippet will not compile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Useless</span> <span class="tok-n">thing</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Useless</span><span class="tok-o">(</span> <span class="tok-mi">14</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, we must create a new class that extends <code>Useless</code>.</p>
</div>
<div id="UsefulProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Useful</span> <span class="tok-kd">extends</span> <span class="tok-n">Useless</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getVariable</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">variable</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setVariable</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-n">variable</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">6 </span>	<span class="tok-o">}</span>
<span class="lineno">7 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, we can instantiate an object of type <code>Useful</code> and use it for
something.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Useless</span> <span class="tok-n">item</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Useful</span><span class="tok-o">(</span> <span class="tok-mi">14</span> <span class="tok-o">);</span>
<span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, in accordance with the rules of Java, we can store a more
specific object of type <code>Useful</code> into more general reference of type
<code>Useless</code>. Even though Java knows that the object it points to will
never actually be a <code>Useless</code> object, it is perfectly legal to have a
<code>Useless</code> reference. You can use abstract classes in this way to provide
a base class with some fundamental fields and methods that all other
classes in a particular hierarchy need. By using the keyword <code>abstract</code>,
you are marking the class as template for other classes instead of a
class that will be used directly.</p>
</div>
<div class="paragraph">
<p>Methods can be abstract as well. If you have an abstract class, you can
create a method header which describes a method that all non-abstract
children classes must implement, as show below.</p>
</div>
<div id="SequenceProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Sequence</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-n">number</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">protected</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">CONSTANT</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Sequence</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">number</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">constant</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">number</span> <span class="tok-o">=</span> <span class="tok-n">number</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>		<span class="tok-n">CONSTANT</span> <span class="tok-o">=</span> <span class="tok-n">constant</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">int</span> <span class="tok-nf">getNextValue</span><span class="tok-o">();</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This abstract class is supposed to be a template for classes which can
produce some sequence of numbers. Note that there is no body for the
<code>getNextValue()</code> method. It simply ends with a semicolon. Every
non-abstract derived class must implement a <code>getNextValue()</code> method to
produce the next number in the sequence. For example, we could implement
an arithmetic or a geometric sequence as follows.</p>
</div>
<div id="ArithmeticSequenceProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ArithmeticSequence</span> <span class="tok-kd">extends</span> <span class="tok-n">Sequence</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">int</span> <span class="tok-nf">getNextValue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-n">number</span> <span class="tok-o">+=</span> <span class="tok-n">CONSTANT</span><span class="tok-o">;</span>
<span class="lineno">4 </span>		<span class="tok-k">return</span> <span class="tok-n">number</span><span class="tok-o">;</span>
<span class="lineno">5 </span>	<span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="GeometricSequenceProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">GeometricSequence</span> <span class="tok-kd">extends</span> <span class="tok-n">Sequence</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">int</span> <span class="tok-nf">getNextValue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-n">number</span> <span class="tok-o">*=</span> <span class="tok-n">CONSTANT</span><span class="tok-o">;</span>
<span class="lineno">4 </span>		<span class="tok-k">return</span> <span class="tok-n">number</span><span class="tok-o">;</span>
<span class="lineno">5 </span>	<span class="tok-o">}</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Sequence</code> class does not specify <strong>how</strong> the sequence of numbers
should be generated, but any derived class must implement the
<code>getNextValue()</code> method in order to compile. By using an abstract class,
we don&#8217;t have to create a base class which generates a meaningless
sequence of numbers just for the sake of establishing the
<code>getNextValue()</code> method.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a more involved example of an abstract class that gives a first
step toward solving the bank account with a vengeance problem posed at
the beginning of the chapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Calendar</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step is to import the <code>Calendar</code> class for some date stuff we
are going to use later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">BankAccount</span> <span class="tok-kd">extends</span> <span class="tok-n">SynchronizedAccount</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">private</span> <span class="tok-n">Calendar</span> <span class="tok-n">lastAccess</span><span class="tok-o">;</span>
<span class="lineno">4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">monthsPassed</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We extend <code>SynchronizedAccount</code> and declare the new class to be
abstract. In this example, we do not use any abstract methods, but,
since each bank account has unique characteristics, we don&#8217;t want people
to be able to create a generic <code>BankAccount</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-nf">BankAccount</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">balance</span> <span class="tok-o">)</span>
<span class="lineno"> 2 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-n">changeBalance</span><span class="tok-o">(</span> <span class="tok-n">balance</span> <span class="tok-o">);</span>
<span class="lineno"> 5 </span>		<span class="tok-n">lastAccess</span> <span class="tok-o">=</span> <span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>	<span class="tok-o">}</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">protected</span> <span class="tok-n">Calendar</span> <span class="tok-nf">getLastAccess</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">lastAccess</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">int</span> <span class="tok-nf">getMonthsPassed</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">monthsPassed</span><span class="tok-o">;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor and the accessors should be what you expect to see. Note
that calling the static method <code>Calendar.getInstance()</code> is the correct
way to get a <code>Calendar</code> object with the current date and time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-nf">getBalance</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-n">update</span><span class="tok-o">();</span>
<span class="lineno"> 3 </span>		<span class="tok-k">return</span> <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">getBalance</span><span class="tok-o">();</span>
<span class="lineno"> 4 </span>	<span class="tok-o">}</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kt">void</span> <span class="tok-nf">deposit</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">amount</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-n">update</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">deposit</span><span class="tok-o">(</span> <span class="tok-n">amount</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kt">boolean</span> <span class="tok-nf">withdraw</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">amount</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>		<span class="tok-n">update</span><span class="tok-o">();</span>
<span class="lineno">15 </span>		<span class="tok-k">return</span> <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">withdraw</span><span class="tok-o">(</span><span class="tok-n">amount</span><span class="tok-o">);</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then come the balance checking and changing methods. Each simply calls
the parent methods after calling an <code>update()</code> method we discuss below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">protected</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">update</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-n">Calendar</span> <span class="tok-n">current</span> <span class="tok-o">=</span> <span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">();</span>
<span class="lineno"> 3 </span>		<span class="tok-kt">int</span> <span class="tok-n">months</span> <span class="tok-o">=</span> <span class="tok-mi">12</span><span class="tok-o">*(</span><span class="tok-n">current</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">YEAR</span><span class="tok-o">)</span> <span class="tok-o">-</span>
<span class="lineno"> 4 </span>		<span class="tok-n">getLastAccess</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">YEAR</span><span class="tok-o">))</span> <span class="tok-o">+</span>
<span class="lineno"> 5 </span>		<span class="tok-o">(</span><span class="tok-n">current</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">MONTH</span><span class="tok-o">)</span> <span class="tok-o">-</span>
<span class="lineno"> 6 </span>		<span class="tok-n">getLastAccess</span><span class="tok-o">().</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">MONTH</span><span class="tok-o">));</span>
<span class="lineno"> 7 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">months</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>				<span class="tok-n">lastAccess</span> <span class="tok-o">=</span> <span class="tok-n">current</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>				<span class="tok-n">monthsPassed</span> <span class="tok-o">=</span> <span class="tok-n">months</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-o">}</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span>
<span class="lineno">12 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Other than adding <code>String</code> for a name associated with the account, the
<code>update()</code> method is the other major addition made in <code>BankAccount</code>.
Each time <code>update()</code> is called, the number of months since the last
access is stored in the field <code>monthsPast</code> and the timestamp of the last
access is stored in <code>lastAccess</code>. We didn&#8217;t need these time features
before, but issues like earning interest or paying monthly service
charges will make them necessary. This method is synchronized so that
the two fields associated with the last access are updated atomically.</p>
</div>
</div>
<div class="sect3">
<h4 id="_final_classes_and_methods">17.3.2. Final classes and methods</h4>
<div class="paragraph">
<p>If you look at the previous example carefully, you will notice that the
methods <code>getBalance()</code>, <code>deposit()</code>, and <code>withdraw()</code> were each declared
with the keyword <code>final</code>. You have seen this keyword used to declare
constants before. When applied to methods, <code>final</code> is philosophically
similar (and almost the opposite of <code>abstract</code>). A method which is
declared <code>final</code> cannot be overridden by child classes. If you are
designing a class hierarchy and you want to lock a method into doing a
specific thing and never changing, this is the way to do it.</p>
</div>
<div class="paragraph">
<p>Like <code>abstract</code>, the keyword <code>final</code> can be applied to a class as well.
If you want to prevent a class from being extended further, apply the
<code>final</code> keyword to its definition. You may not find yourself using this
feature of Java very often. It is primarily useful in situations where a
large body of code has been designed to make use of a specific class.
The designers of that specific class want to keep it exactly the way it
is and prevent anything unexpected from happening.</p>
</div>
<div class="paragraph">
<p>The most common example of a <code>final</code> class is the <code>String</code> class.
Consider the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SuperString</span> <span class="tok-kd">extends</span> <span class="tok-n">String</span> <span class="tok-o">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will give a compiler error. <code>String</code> is perfect the way it is
(or so the Java designers have decided). There is no reason to restrict
your code arbitrarily, but use of the <code>final</code> keyword for classes,
methods, and especially to specify constants allows the compiler to do
some performance optimizations that would otherwise be impossible.</p>
</div>
</div>
<div class="sect3">
<h4 id="_casting">17.3.3. Casting</h4>
<div class="paragraph">
<p>If we shift the focus back to polymorphism, we have to admit that we
have avoided one of the messier issues. It&#8217;s true that polymorphism
gives us lots of power. For example, we can make a <code>Vehicle</code> array and
store subclasses of <code>Vehicle</code> inside, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Vehicle</span><span class="tok-o">[]</span> <span class="tok-n">vehicles</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Vehicle</span><span class="tok-o">[</span><span class="tok-mi">5</span><span class="tok-o">];</span>
<span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Skateboard</span><span class="tok-o">();</span>
<span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RocketShip</span><span class="tok-o">();</span>
<span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SteamBoat</span><span class="tok-o">();</span>
<span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-mi">3</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Car</span><span class="tok-o">();</span>
<span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-mi">4</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Skateboard</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This process could be infinitely more complex. We could be reading data
out of a file and dynamically creating different kinds of <code>Vehicle</code>
objects. But, the final product of an array of <code>Vehicle</code> objects is the
important thing. Now, we can run through the array with a loop and have
the code magically work for each kind of <code>Vehicle</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">vehicles</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
    <span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">travel</span><span class="tok-o">(</span> <span class="tok-s">&quot;Prague&quot;</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each <code>Vehicle</code> will travel to Prague as it should. The only trouble is
that we have hidden some information. We know that <code>vehicles[1]</code> is a
<code>RocketShip</code>, but we can&#8217;t treat it like one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">].</span><span class="tok-na">blastOff</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will not compile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">RocketShip</span> <span class="tok-n">ship</span> <span class="tok-o">=</span> <span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will not compile either. In both cases, we must use an
explicit cast to tell the compiler that the object really <strong>is</strong> a
<code>RocketShip</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">RocketShip</span> <span class="tok-n">ship</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">RocketShip</span><span class="tok-o">)</span><span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">];</span>
<span class="tok-o">((</span><span class="tok-n">RocketShip</span><span class="tok-o">)</span><span class="tok-n">vehicles</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]).</span><span class="tok-na">blastOff</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both lines of code will work. The compiler is always conservative. It
never makes guesses about the type of something. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Vehicle</span> <span class="tok-n">ship</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RocketShip</span><span class="tok-o">();</span>
<span class="tok-n">ship</span><span class="tok-o">.</span><span class="tok-na">blastOff</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though <code>ship</code> <strong>must</strong> be a <code>RocketShip</code>, Java does not assume that.
The compiler uses the reference type <code>Vehicle</code> to do the check and will
refuse to compile. Casting allows us to use our human intellect to
overcome the shortsightedness of the compiler. Human intellect is
unfortunately flawed. What happens if you cast improperly?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Vehicle</span> <span class="tok-n">vehicle</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Skateboard</span><span class="tok-o">();</span>
<span class="tok-n">RocketShip</span> <span class="tok-n">ship</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">RocketShip</span><span class="tok-o">)</span><span class="tok-n">vehicle</span><span class="tok-o">;</span>
<span class="tok-n">ship</span><span class="tok-o">.</span><span class="tok-na">blastOff</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we are trying to cast a <code>Skateboard</code> into a
<code>RocketShip</code>. At compile time, no errors will be found. Because we use
explicit casting, the compiler assumes that we, powerful human beings
that we are, know what we are doing. The error will happen at runtime
while executing the second line. Java will try to cast <code>vehicle</code> into a
<code>RocketShip</code>, fail, and throw a <code>ClassCastException</code>.</p>
</div>
<div class="paragraph">
<p>Java provides some additional tools to make casting easier. One of these
is the <code>instanceof</code> keyword which can be used to test if an object is an
instance of a particular class (or one of its derived classes). For
example, we can make an object execute a special command if we know that
the object is capable of it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">visitDenver</span><span class="tok-o">(</span> <span class="tok-n">Vehicle</span> <span class="tok-n">vehicle</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">vehicle</span> <span class="tok-k">instanceof</span> <span class="tok-n">RocketShip</span> <span class="tok-o">)</span>
        <span class="tok-o">((</span><span class="tok-n">RocketShip</span><span class="tok-o">)</span><span class="tok-n">vehicle</span><span class="tok-o">).</span><span class="tok-na">blastOff</span><span class="tok-o">();</span>
    <span class="tok-n">vehicle</span><span class="tok-o">.</span><span class="tok-na">travel</span><span class="tok-o">(</span> <span class="tok-s">&quot;Denver&quot;</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even inside the <code>if</code> statement where it must be the case that <code>vehicle</code>
is a <code>RocketShip</code>, we still must perform an explicit cast. Sometimes
<code>instanceof</code> is not precise enough. If you must be sure that the object
in question is a specific class and not just one of its subclasses, you
can use the <code>getClass()</code> method on any object and compare it to the
static class object. Using this tool, we can rewrite the former example
to be more specific.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">visitDenver</span><span class="tok-o">(</span> <span class="tok-n">Vehicle</span> <span class="tok-n">vehicle</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">vehicle</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">()</span> <span class="tok-o">==</span>  <span class="tok-n">RocketShip</span><span class="tok-o">.</span><span class="tok-na">class</span> <span class="tok-o">)</span>
        <span class="tok-o">((</span><span class="tok-n">RocketShip</span><span class="tok-o">)</span><span class="tok-n">vehicle</span><span class="tok-o">).</span><span class="tok-na">blastOff</span><span class="tok-o">();</span>
    <span class="tok-n">vehicle</span><span class="tok-o">.</span><span class="tok-na">travel</span><span class="tok-o">(</span> <span class="tok-s">&quot;Denver&quot;</span> <span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of the code will only call <code>blastOff()</code> for objects of
class <code>RocketShip</code> and not for objects of a subclass like
<code>FusionPoweredRocketShip</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="subsection:Inheritance_and_exceptions">17.3.4. Inheritance and exceptions</h4>
<div class="paragraph">
<p>Beyond `ClassCastException`s, there are a few other issues that come up
when combining exceptions with inheritance. As you already know, an
exception handler for a parent class will work for a child class. As
such, when using multiple exception handlers, it is necessary to order
them from most specific to most general in terms of class hierarchy.</p>
</div>
<div class="paragraph">
<p>However, there is another subtle rule that is necessary to keep
polymorphism functioning smoothly. Let&#8217;s consider a <code>Fruit</code> class with
an <code>eat()</code> method that throws an <code>UnripeFruitException</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Fruit</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">eat</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">UnripeFruitException</span> <span class="tok-o">{</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Almost any fruit can be unripe, and it is unpleasant to try to eat an
unripe fruit. But, there are other things that can go wrong when eating
fruit. Consider the <code>Plum</code> class derived from <code>Fruit</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Plum</span> <span class="tok-kd">extends</span> <span class="tok-n">Fruit</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">eat</span><span class="tok-o">()</span> <span class="tok-kd">throws</span>
        <span class="tok-n">UnripeFruitException</span><span class="tok-o">,</span> <span class="tok-n">ChokingOnPitException</span> <span class="tok-o">{</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>Plum</code> class, the <code>eat()</code> method has been overridden to tackle
the special ways that eating a plum is different from eating fruit in
general. When eating a plum, you can make a mistake and try to swallow
the pit, throwing, it seems, a <code>ChokingOnPitException</code>. This scenario
seems natural, but it is not allowed in Java.</p>
</div>
<div class="paragraph">
<p>The principle behind polymorphism is that a more specialized version of
something can be used in place of a more general version. Indeed, if you
use a <code>Plum</code> in place of a <code>Fruit</code>, calling the <code>eat()</code> method is no
problem. The problem happens if a <code>ChokingOnPitException</code> is thrown.
Now, code which was designed for <code>Fruit</code> objects knows nothing about a
<code>ChokingOnPitException</code>, so there is no way for such code to catch the
exception and deal with the situation.</p>
</div>
<div class="paragraph">
<p>There is nothing wrong with throwing exceptions on overridden methods.
The rule is that the overriding method must throw a subset (not a proper
subset, so it could be all of the original exceptions) of the exceptions
that the overridden method throws. This rule is actually a concept
called Hoare&#8217;s rule of consequence that pops up several places in
programming languages. Essentially, if you start with something that
works, tighten the requirements on the input (use a <code>Plum</code> instead of
any <code>Fruit</code>), loosen the requirements on the output (throw fewer
exceptions than were originally thrown), it will still work.</p>
</div>
<div class="exampleblock">
<div class="title">Example 142. More human than human</div>
<div class="content">
<div class="paragraph">
<p>Now we have a few additional examples in a somewhat larger class
hierarchy.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/17-polymorphism/images/animals.svg" alt="animals" width="75%">
</div>
<div class="title">Figure 71. Animal class hierarchy.</div>
</div>
<div id="AnimalProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Animal</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">alive</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">happy</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kd">final</span> <span class="tok-kt">boolean</span> <span class="tok-n">warmblooded</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Animal</span><span class="tok-o">(</span> <span class="tok-kt">boolean</span> <span class="tok-n">warmblooded</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">warmblooded</span> <span class="tok-o">=</span> <span class="tok-n">warmblooded</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isHappy</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">happy</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setHappy</span><span class="tok-o">(</span> <span class="tok-kt">boolean</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">happy</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isAlive</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">alive</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">die</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-n">alive</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">17 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We begin with the abstract <code>Animal</code> class. This class gives a base
definition for animals which includes whether the animal is alive,
whether the animal is happy, and whether it is warmblooded (declared
<code>final</code> because an animal can&#8217;t switch between warmblooded and
coldblooded).</p>
</div>
<div id="MammalProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kd">class</span> <span class="tok-nc">Mammal</span> <span class="tok-kd">extends</span> <span class="tok-n">Animal</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">boolean</span> <span class="tok-n">MALE</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">boolean</span> <span class="tok-n">FEMALE</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kd">final</span> <span class="tok-kt">boolean</span> <span class="tok-n">gender</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Mammal</span><span class="tok-o">(</span> <span class="tok-kt">boolean</span> <span class="tok-n">gender</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">gender</span> <span class="tok-o">=</span> <span class="tok-n">gender</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>	<span class="tok-o">}</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-nf">getGender</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">gender</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>	<span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">String</span> <span class="tok-nf">makeSound</span><span class="tok-o">();</span>
<span class="lineno">14 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We then extend <code>Animal</code> into <code>Mammal</code>. All mammals are warmblooded,
which is reflected in the constructor call to the base class. In
addition, it is assumed that all mammals make some sound. Mammals also
have well-defined genders, declared <code>final</code> because it cannot change
once it has been set. Like <code>Animal</code>, <code>Mammal</code> is an abstract class, and
any non-abstract subclass of <code>Mammal</code> must implement <code>makeSound()</code>.</p>
</div>
<div id="PlatypusProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Platypus</span> <span class="tok-kd">extends</span> <span class="tok-n">Mammal</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Platypus</span><span class="tok-o">(</span> <span class="tok-kt">boolean</span> <span class="tok-n">gender</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">gender</span> <span class="tok-o">);</span>
<span class="lineno"> 4 </span>	<span class="tok-o">}</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">makeSound</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-k">return</span> <span class="tok-s">&quot;Quack!&quot;</span>
<span class="lineno"> 8 </span>	<span class="tok-o">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-n">Egg</span> <span class="tok-nf">layEgg</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">getGender</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">FEMALE</span> <span class="tok-o">)</span>
<span class="lineno">12 </span>			<span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">Egg</span><span class="tok-o">();</span>
<span class="lineno">13 </span>		<span class="tok-k">else</span>
<span class="lineno">14 </span>			<span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">15 </span>	<span class="tok-o">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">poison</span><span class="tok-o">(</span> <span class="tok-n">Animal</span> <span class="tok-n">victim</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">getGender</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">MALE</span> <span class="tok-o">)</span>
<span class="lineno">19 </span>			<span class="tok-n">victim</span><span class="tok-o">.</span><span class="tok-na">setHappy</span><span class="tok-o">(</span> <span class="tok-kc">false</span> <span class="tok-o">);</span>
<span class="lineno">20 </span>	<span class="tok-o">}</span>
<span class="lineno">21 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Platypus</code> class extends <code>Mammal</code> and adds the unusual things that a
platypus can do: laying eggs (if female) and poisoning other animals (if
male).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Human</span> <span class="tok-kd">extends</span> <span class="tok-n">Mammal</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Human</span><span class="tok-o">(</span> <span class="tok-kt">boolean</span> <span class="tok-n">gender</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">happy</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">gender</span> <span class="tok-o">);</span>
<span class="lineno"> 4 </span>		<span class="tok-n">setHappy</span><span class="tok-o">(</span> <span class="tok-n">happy</span> <span class="tok-o">);</span>
<span class="lineno"> 5 </span>	<span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">makeSound</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-k">return</span> <span class="tok-s">&quot;Hello, world.&quot;</span>
<span class="lineno"> 9 </span>	<span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Human</code> class also extends <code>Mammal</code>. Depending on the problem being
solved, this class might warrant a great deal more specialization. Right
now the main addition is taking happiness as an argument to the
constructor. Unfortunately, the default human state is not necessarily
happiness.</p>
</div>
<div id="DavidBowieProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kd">class</span> <span class="tok-nc">DavidBowie</span> <span class="tok-kd">extends</span> <span class="tok-n">Human</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">DavidBowie</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">MALE</span><span class="tok-o">,</span> <span class="tok-kc">true</span> <span class="tok-o">);</span>
<span class="lineno"> 4 </span>	<span class="tok-o">}</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">makeSound</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-k">return</span> <span class="tok-s">&quot;I always had a repulsive need to be &quot;</span> <span class="tok-o">+</span>
<span class="lineno"> 8 </span>		<span class="tok-s">&quot;something more than human.&quot;</span>
<span class="lineno"> 9 </span>	<span class="tok-o">}</span>
<span class="lineno">10 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the <code>DavidBowie</code> class extends <code>Human</code> and is declared a final
class because it really is impossible to add anything to David Bowie.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>You will notice that our examples have stretched fairly long in this
chapter. It is difficult to give strong motivation for some aspects of
inheritance and polymorphism without a large class hierarchy. These
tools are designed to help organize large bodies of code and should
become more useful as the size of the problem you are working on grows.
One of the best examples of the success of inheritance is the Java API
itself. The standard Java library is very large and depends on
inheritance a great deal.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_banking_account_with_a_vengeance">17.4. Solution: Banking account with a vengeance</h3>
<div class="paragraph">
<p>Now we return to the specific problem given at the beginning of the
chapter and give its solution. We have already given you the
<code>BankAccount</code> abstract class which provides a lot of structure.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/17-polymorphism/images/accounts.svg" alt="accounts" width="75%">
</div>
<div class="title">Figure 72. Bank account class hierarchy.</div>
</div>
<div id="CheckingAccountProgram" class="listingblock">
<div class="title">Program 75. Subclass of <code>BankAccount</code> that models a normal checking account.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CheckingAccount</span> <span class="tok-kd">extends</span> <span class="tok-n">BankAccount</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">FEE</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-nf">CheckingAccount</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">balance</span> <span class="tok-o">)</span>
<span class="lineno"> 5 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">balance</span> <span class="tok-o">);</span>
<span class="lineno"> 7 </span>	<span class="tok-o">}</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">protected</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">update</span><span class="tok-o">()</span>
<span class="lineno">10 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">();</span>
<span class="lineno">12 </span>		<span class="tok-n">changeBalance</span><span class="tok-o">(</span> <span class="tok-o">-</span><span class="tok-n">getFee</span><span class="tok-o">()*</span><span class="tok-n">getMonthsPassed</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">double</span> <span class="tok-nf">getFee</span><span class="tok-o">()</span> <span class="tok-o">{</span>	<span class="tok-k">return</span> <span class="tok-n">FEE</span><span class="tok-o">;</span>	<span class="tok-o">}</span>
<span class="lineno">16 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most basic account is the <code>CheckingAccount</code>. As you recall from the
<code>BankingAccount</code> class, the <code>getBalance()</code>, <code>deposit()</code>, and
<code>withdraw()</code> methods are all declared <code>final</code>. At first it seems as if
there is no way to change these methods to add the $10 service charge.
However, each of those methods calls the <code>update()</code> method first to take
care of any bookkeeping. By overriding the <code>update()</code> method, we can
easily add the service charge. The new <code>update()</code> method calls the
parent <code>update()</code> to calculate the passage of time, then it changes the
balance based on the number of months that have passed.</p>
</div>
<div class="paragraph">
<p>The system we have adopted may seem unusual at first. Any time the
balance is checked, deposited to, or withdrawn from, we call <code>update()</code>.
By updating the account to reflect any months which may have passed
before continuing on, we do not have to write code which periodically
updates each bank account. Each bank account is only updated if needed.</p>
</div>
<div class="paragraph">
<p>We were careful to mark <code>update()</code> as <code>synchronized</code>. Although the
chance of an error happening is small, we make the update of the
internal <code>Calendar</code> and the application of any fee atomic, just to be
safe.</p>
</div>
<div class="paragraph">
<p>Note that we do not use the constant <code>FEE</code> directly in <code>update()</code>.
Instead, we call the <code>getFee()</code> method. The reason for this decision is
due to the next class.</p>
</div>
<div id="DirectDepositAccountProgram" class="listingblock">
<div class="title">Program 76. Subclass of <code>CheckingAccount</code> that models the behavior of accounts with direct deposits.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Calendar</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DirectDepositAccount</span> <span class="tok-kd">extends</span> <span class="tok-n">CheckingAccount</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">protected</span> <span class="tok-n">Calendar</span> <span class="tok-n">lastDirectDeposit</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-nf">DirectDepositAccount</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">balance</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">balance</span> <span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-n">lastDirectDeposit</span> <span class="tok-o">=</span> <span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>	<span class="tok-o">}</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getFee</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>		<span class="tok-n">Calendar</span> <span class="tok-n">current</span> <span class="tok-o">=</span> <span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">();</span>
<span class="lineno">13 </span>		<span class="tok-kt">int</span> <span class="tok-n">months</span> <span class="tok-o">=</span> <span class="tok-mi">12</span><span class="tok-o">*(</span><span class="tok-n">current</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">YEAR</span><span class="tok-o">)</span> <span class="tok-o">-</span>
<span class="lineno">14 </span>		<span class="tok-n">lastDirectDeposit</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">YEAR</span><span class="tok-o">))</span> <span class="tok-o">+</span>
<span class="lineno">15 </span>		<span class="tok-o">(</span><span class="tok-n">current</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">MONTH</span><span class="tok-o">)</span> <span class="tok-o">-</span>
<span class="lineno">16 </span>		<span class="tok-n">lastDirectDeposit</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">MONTH</span><span class="tok-o">));</span>
<span class="lineno">17 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">months</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
<span class="lineno">18 </span>			<span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">19 </span>		<span class="tok-k">else</span>
<span class="lineno">20 </span>			<span class="tok-k">return</span> <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">getFee</span><span class="tok-o">();</span>
<span class="lineno">21 </span>	<span class="tok-o">}</span>
<span class="lineno">22 </span>
<span class="lineno">23 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">directDeposit</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">amount</span> <span class="tok-o">)</span>
<span class="lineno">24 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno">25 </span>		<span class="tok-n">deposit</span><span class="tok-o">(</span> <span class="tok-n">amount</span> <span class="tok-o">);</span>
<span class="lineno">26 </span>		<span class="tok-n">lastDirectDeposit</span> <span class="tok-o">=</span> <span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">();</span>
<span class="lineno">27 </span>	<span class="tok-o">}</span>
<span class="lineno">28 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DirectDepositAccount</code> class extends the <code>CheckingAccount</code> class.
Note that the <code>update()</code> method hasn&#8217;t been overridden. We have added
another <code>Calendar</code> object to keep track of the last time a direct
deposit was made. Then, we do override the <code>getFee()</code> method. If there
has been a recent direct deposit, the fee is nothing, otherwise, it
returns the fee from the <code>CheckingAccount</code>. Because of dynamic binding,
the <code>update()</code> method defined in <code>CheckingAccount</code> will call this
overridden <code>getFee()</code> method for <code>DirectDepositAccount</code> objects.</p>
</div>
<div id="SavingsAccountProgram" class="listingblock">
<div class="title">Program 77. Subclass of <code>BankAccount</code> that models the behavior of a savings account.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SavingsAccount</span> <span class="tok-kd">extends</span> <span class="tok-n">BankAccount</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">MINIMUM</span> <span class="tok-o">=</span> <span class="tok-mi">1000</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">FEE</span> <span class="tok-o">=</span> <span class="tok-mi">25</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">protected</span> <span class="tok-kd">final</span> <span class="tok-kt">double</span> <span class="tok-n">RATE</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-nf">SavingsAccount</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">balance</span><span class="tok-o">,</span> <span class="tok-kt">double</span> <span class="tok-n">rate</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-kd">super</span><span class="tok-o">(</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">balance</span> <span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-n">RATE</span> <span class="tok-o">=</span> <span class="tok-n">rate</span><span class="tok-o">;</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">double</span> <span class="tok-nf">getFee</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">FEE</span><span class="tok-o">;</span>	<span class="tok-o">}</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>	<span class="tok-kd">protected</span> <span class="tok-kt">double</span> <span class="tok-nf">getMinimum</span><span class="tok-o">()</span> <span class="tok-o">{</span>	<span class="tok-k">return</span> <span class="tok-n">MINIMUM</span><span class="tok-o">;</span>	<span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>	<span class="tok-kd">protected</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">update</span><span class="tok-o">()</span>
<span class="lineno">17 </span>		<span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">update</span><span class="tok-o">();</span>
<span class="lineno">19 </span>		<span class="tok-kt">int</span> <span class="tok-n">months</span> <span class="tok-o">=</span> <span class="tok-n">getMonthsPassed</span><span class="tok-o">();</span>
<span class="lineno">20 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">months</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">21 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">getBalance</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">22 </span>				<span class="tok-n">changeBalance</span><span class="tok-o">(</span> <span class="tok-n">getBalance</span><span class="tok-o">()</span> <span class="tok-o">*</span> <span class="tok-o">(</span><span class="tok-mi">1</span> <span class="tok-o">+</span> <span class="tok-n">RATE</span><span class="tok-o">/</span><span class="tok-mi">12</span><span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">getBalance</span><span class="tok-o">()</span> <span class="tok-o">&lt;</span> <span class="tok-n">getMinimum</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">24 </span>				<span class="tok-n">changeBalance</span><span class="tok-o">(</span> <span class="tok-o">-</span><span class="tok-n">getFee</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">25 </span>		<span class="tok-o">}</span>
<span class="lineno">26 </span>	<span class="tok-o">}</span>
<span class="lineno">27 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There should be few surprises in the last class, <code>SavingsAccount</code>. The
biggest difference is that, in the <code>update()</code> method, we use a loop to
update the balance because the account could be gaining interest and
also incurring fees. The interaction of the two operations may give a
different result than applying each in a block for the backlog of
months.</p>
</div>
<div class="paragraph">
<p>This set of classes may not resemble the way a real, commercial-grade
banking application works. Nevertheless, with inheritance and
polymorphism we were able to create bank accounts which do some
complicated tasks with a relatively small amount of code. At the same
time, we preserved thread safety so that these accounts can be used in
concurrent environments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_atomic_libraries">17.5. Concurrency: Atomic libraries</h3>
<div class="paragraph">
<p>This chapter has discussed using polymorphism to reuse code. To solve
the Bank Account with a Vengeance problem from the beginning of the
chapter, we explored the process of extending several bank account
classes to add additional features while working hard to maintain thread
safety.</p>
</div>
<div class="paragraph">
<p>Code can be reused by extending classes with child classes or by using
instances of existing classes as fields. There is no single solution
that is best for every case. As in the bank account examples, it can be
difficult to know when to apply the <code>synchronized</code> keyword to methods.</p>
</div>
<div class="paragraph">
<p>To lessen the load on the programmer, the Java API provides a library of
atomic primitives in the<br>
<code>java.util.concurrent.atomic</code> package. These are classes with certain
operations that are guaranteed to execute atomically. For example, the
<code>AtomicInteger</code> class encapsulates the functionality of an <code>int</code>
variable with atomic accesses. One of its methods is
<code>incrementAndGet()</code>, which will atomically increment its internal value
by 1 and return the result. Recall from
<a href="#RaceConditionProgram">Program 51</a> that even an operation as simple as
<code>++</code> is not atomic. If many different threads try to increment a single
variable, some of those increments can get lost, causing the final value
to be less than it should be.</p>
</div>
<div class="exampleblock">
<div class="title">Example 143. AtomicInteger</div>
<div class="content">
<div class="paragraph">
<p>We can use the <code>AtomicInteger</code> class to rewrite
<a href="#RaceConditionProgram">Program 51</a> so that no race condition occurs.</p>
</div>
<div id="NoRaceConditionProgram" class="listingblock">
<div class="title">Program 78. Demonstrates the use of <code>AtomicInteger</code>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.concurrent.atomic.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">NoRaceCondition</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">AtomicInteger</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AtomicInteger</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">THREADS</span> <span class="tok-o">=</span> <span class="tok-mi">4</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">COUNT</span> <span class="tok-o">=</span> <span class="tok-mi">1000000</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>		<span class="tok-n">NoRaceCondition</span><span class="tok-o">[]</span> <span class="tok-n">threads</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">NoRaceCondition</span><span class="tok-o">[</span><span class="tok-n">THREADS</span><span class="tok-o">];</span>
<span class="lineno">10 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">NoRaceCondition</span><span class="tok-o">();</span>
<span class="lineno">12 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span>
<span class="lineno">14 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">16 </span>				<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">17 </span>		<span class="tok-o">}</span>
<span class="lineno">18 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">19 </span>			<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">20 </span>		<span class="tok-o">}</span>
<span class="lineno">21 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Counter:\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">counter</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">22 </span>	<span class="tok-o">}</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">25 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">COUNT</span> <span class="tok-o">/</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">26 </span>			<span class="tok-n">counter</span><span class="tok-o">.</span><span class="tok-na">incrementAndGet</span><span class="tok-o">();</span>
<span class="lineno">27 </span>	<span class="tok-o">}</span>
<span class="lineno">28 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This program is identical to <a href="#RaceConditionProgram">Program 51</a>, except
that the type of <code>counter</code> has been changed from <code>int</code> to
<code>AtomicInteger</code> (and an appropriate <code>import</code> has been added).
Consequently, the <code>++</code> operation was changed to an <code>incrementAndGet()</code>
method call, and a <code>get()</code> method call was needed to get the final
value. If you run this program, the final answer should always be
1000000, no matter what.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise17.9">Exercise 17.9</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>java.util.concurrent.atomic</code> package includes <code>AtomicBoolean</code> and
<code>AtomicLong</code> as well as <code>AtomicInteger</code>. Likewise, the
<code>AtomicIntegerArray</code> and <code>AtomicLongArray</code> classes are included to
perform atomic array accesses. For general purposes, the
<code>AtomicReference&lt;V&gt;</code> class provides an atomic way to store a reference
to any object. (The <code>&lt;V&gt;</code> is a generic type parameter, which will be
discussed in <a href="#_dynamic_data_structures">Chapter 18</a>.)</p>
</div>
<div class="paragraph">
<p>Although you could use the <code>synchronized</code> keyword to create each one of
these classes yourself, the result would not be as efficient. The atomic
classes use a special <em>lock-free</em> mechanism. Unlike using the
<code>synchronized</code> keyword which forces a thread to acquire a lock on a
specific object, lock-free mechanisms are built on a <em>compare-and-swap</em>
(CAS) hardware instruction. Thus, incrementing and the handful of other
ways to update an atomic variable execute in one step because of special
instructions on the CPU. Since there is no waiting to acquire a lock or
fighting over which thread has the lock, the operation is very fast.
Many high performance concurrent applications depends on CAS
implementations.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise17.11">Exercise 17.11</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_17">17.6. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise17.1"></a> Consider the following two classes:</p>
<div id="SaleProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Sale</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-n">discount</span> <span class="tok-o">=</span> <span class="tok-mf">0.25</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getDiscount</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-k">return</span> <span class="tok-n">discount</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-o">}</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setDiscount</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>		<span class="tok-n">discount</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div id="BlowoutProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Blowout</span> <span class="tok-kd">extends</span> <span class="tok-n">Sale</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-n">discount</span> <span class="tok-o">=</span> <span class="tok-mf">0.5</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kt">double</span> <span class="tok-nf">getDiscount</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-k">return</span> <span class="tok-n">discount</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-o">}</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setDiscount</span><span class="tok-o">(</span> <span class="tok-kt">double</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>		<span class="tok-n">discount</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the following snippet of code, what is the output?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Sale</span> <span class="tok-n">sale</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Blowout</span><span class="tok-o">();</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">sale</span><span class="tok-o">.</span><span class="tok-na">discount</span> <span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">sale</span><span class="tok-o">.</span><span class="tok-na">getDiscount</span> <span class="tok-o">);</span>
<span class="tok-n">Blowout</span> <span class="tok-n">blowout</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Blowout</span><span class="tok-o">)</span><span class="tok-n">sale</span><span class="tok-o">;</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">blowout</span><span class="tok-o">.</span><span class="tok-na">discount</span> <span class="tok-o">);</span>
<span class="tok-n">sale</span><span class="tok-o">.</span><span class="tok-na">setDiscount</span><span class="tok-o">(</span> <span class="tok-mf">0.75</span> <span class="tok-o">);</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">sale</span><span class="tok-o">.</span><span class="tok-na">discount</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise17.2"></a> What are the differences and similarities between abstract classes
and interfaces?</p>
</li>
<li>
<p><a id="exercise17.3"></a> Assume that the <code>Corn</code>, <code>Carrot</code>, and <code>Potato</code> classes are all
derived from <code>Vegetable</code>. Both <code>Carrot</code> and <code>Potato</code> classes have a
<code>peel()</code> method, but <code>Corn</code> does not. Examine the following code and
identify which line will cause an error and why.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Vegetable</span><span class="tok-o">[]</span> <span class="tok-n">vegetables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Vegetable</span><span class="tok-o">[</span><span class="tok-mi">30</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">vegetables</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">+=</span> <span class="tok-mi">3</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">vegetables</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Corn</span><span class="tok-o">();</span>
    <span class="tok-n">vegetables</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Carrot</span><span class="tok-o">();</span>
    <span class="tok-n">vegetables</span><span class="tok-o">[</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Potato</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-kt">int</span> <span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-n">vegetables</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="tok-n">Potato</span> <span class="tok-n">potato</span><span class="tok-o">;</span>
<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">index</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">potato</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Potato</span><span class="tok-o">)</span><span class="tok-n">vegetable</span><span class="tok-o">[</span><span class="tok-n">index</span><span class="tok-o">];</span>
    <span class="tok-n">potato</span><span class="tok-o">.</span><span class="tok-na">peel</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise17.4"></a> How many different meanings of the keyword <code>final</code> are there in
Java, and what does each mean?</p>
</li>
<li>
<p><a id="exercise17.5"></a>  Assume that <code>Quicksand</code> is a subclass of <code>Danger</code>.</p>
<div class="paragraph">
<p>What is the output of the following code?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Quicksand</span> <span class="tok-n">quicksand</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Quicksand</span><span class="tok-o">();</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">quicksand</span> <span class="tok-k">instanceof</span> <span class="tok-n">Danger</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">printf</span><span class="tok-o">(</span> <span class="tok-s">&quot;Run for your lives!&quot;</span> <span class="tok-o">);</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">quicksand</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">Danger</span><span class="tok-o">.</span><span class="tok-na">class</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">printf</span><span class="tok-o">(</span> <span class="tok-s">&quot;Run even faster!&quot;</span> <span class="tok-o">);</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">quicksand</span> <span class="tok-k">instanceof</span> <span class="tok-n">Quicksand</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">printf</span><span class="tok-o">(</span> <span class="tok-s">&quot;The more you struggle,&quot;</span> <span class="tok-o">+</span>
    <span class="tok-s">&quot; the faster you&#39;ll sink!&quot;</span> <span class="tok-o">);</span>
<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">quicksand</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">Quicksand</span><span class="tok-o">.</span><span class="tok-na">class</span> <span class="tok-o">)</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">printf</span><span class="tok-o">(</span> <span class="tok-s">&quot;You&#39;ll need to find a vine to escape!&quot;</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise17.6"></a> Implement a program to assess income tax on normal employees,
students, and international students using a class hierarchy. Normal
employees pay a 6.2% social security tax and a 1.45% Medicare tax every
year, but neither kind of student pays these taxes. All three groups pay
normal income tax according to the following table.</p>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Marginal Tax Rate</th>
<th class="tableblock halign-center valign-top">Income Bracket</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$0 - $7,825</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$7,826 -$31,850</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">25%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$31,851 -$77,100</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$77,101- $160,850</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">33%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$160,851- $349,700</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">35%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">$349,701+</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Tax is assessed at a given rate for every dollar in the range. For
example, if someone makes $10,000, she pays 10% tax on the first $7,825
of her income and 15% on the remaining $2,175. The exception is
international students whose country has a treaty with the U.S. so that
they do not have to pay tax on the first $50,000 of income.</p>
</div>
</li>
<li>
<p><a id="exercise17.7"></a> Refer to the sort given in <a href="#_solution_sort_it_out">Section 10.5</a> as the
solution to the Sort It Out problem. Add another <code>boolean</code> to the
parameters of the sort which specifies whether the sort is ascending or
descending. Make the needed changes throughout the code to add this
functionality.</p>
</li>
<li>
<p><a id="exercise17.8"></a> Again refer to the sort from
<a href="#_solution_sort_it_out">Section 10.5</a>. The goal now is to parallelize the
sort. Change the sort to work with <code>int</code> values then write some code
which will generate an array of random <code>int</code> values. Design your code so
that you can spawn \(n\) threads. Partition the single array
into \(n\) arrays and map one partition to each thread. Use
your bubble sort implementation to sort each partition. Finally, merge
the arrays back together, in sorted order, into one final array. For
now, just use one thread (ideally the main thread) to do the merge.</p>
<div class="paragraph">
<p>The merge operation is a simple idea, but it is easy to make mistakes in
implementation. The idea is to have three indexes, one for each of the
two arrays you are merging and one for the result array. Always take the
smaller (or larger, if sorting in descending order) index value from the
two arrays and put it in the result. Then increment the index from the
array you took the data from as well as the index of the result array.
Make sure that you are careful not to go beyond the end of the arrays
which are being merged.</p>
</div>
</li>
<li>
<p><a id="exercise17.9"></a> Re-implement the original
<code>SynchronizedAccount</code> class from <a href="#bankAccountExample">Example 107</a> using
atomic classes. For simplicity, you can change the <code>balance</code> type from
<code>double</code> to <code>AtomicInteger</code> since there is no <code>AtomicDouble</code> class. How
much has this simplified the implementation? Is the <code>readers</code> field
still necessary? Why or why not?</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise17.10"></a> Once you have implemented the sort in parallel from
<a href="#exercise17.8">Exercise 17.8</a>, time it against the
sequential version. Try 2, 4, and 8 different threads, particularly if
you have 8 cores. Be sure to create one random array and use the same
array for both the parallel and sequential versions. Try array sizes of
1,000, 100,000, and 1,000,000. Did the performance increase as much as you
expect?</p>
</li>
<li>
<p><a id="exercise17.11"></a> Take <a href="#NoRaceConditionProgram">Program 78</a>
and increase <code>COUNT</code> to <code>100000000</code>. Run it several times and time how
long it takes to run to completion.</p>
<div class="paragraph">
<p>Then, take <a href="#RaceConditionProgram">Program 51</a> and increase its <code>COUNT</code> to
<code>100000000</code> as well. Change the body of the <code>for</code> loop inside the
<code>run()</code> method so that <code>count++;</code> is inside of a <code>synchronized</code> block
that uses <code>RaceCondition.class</code> as the lock. (The choice of
<code>RaceCondition.class</code> is arbitrary, but it is an object that all the
threads can see.) In this way, the increment will occur atomically,
since only the thread that has acquired the <code>RaceCondition.class</code> lock
will be able to do the operation. Now, run this modified program several
times and time it.</p>
</div>
<div class="paragraph">
<p>How different are the running times? They may be similar, depending on
the implementation of locks and CAS on your OS and hardware platform.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamic_data_structures">18. Dynamic Data Structures</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Algorithms + Data Structures = Programs</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Niklaus Wirth
</div>
</div>
<div class="sect2">
<h3 id="_problem_infix_conversion">18.1. Problem: Infix conversion</h3>
<div class="paragraph">
<p>If a math teacher writes the expression 1 + 7 × 8 -
6 × (4 + 5) ÷ 3 on the blackboard and asks a group of 10-year-old children to solve it, different children may give different answers.
The difficulty is that the children may not understand the order of
operations. Modern graphing calculators and many computer programs can,
of course, evaluate such expressions correctly, but how do they do it?
You intuitively grasp order of operations (left to right, multiplication
and division take higher precedence than addition and subtraction), but
encoding that intuition into a computer program takes effort.</p>
</div>
<div class="paragraph">
<p>One way a computer scientist might approach this problem is to turn the
mathematical expression from one that&#8217;s difficult to evaluate to one
that&#8217;s easy. The normal style of writing mathematical expressions is
called <em>infix notation</em>, because the operators are written in between
the operands they are used on. A much easier notation for automatic
evaluation is called <em>postfix notation</em>, because an operator is placed
after the operands it works on. The following table gives
a few examples of expressions written in both infix and postfix
notation.</p>
</div>
<table class="tableblock frame-all grid-all center">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Infix</th>
<th class="tableblock halign-left valign-top">Postfix</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3 + 7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3 7 +</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4 * 2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4 2 *</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 + 9 * 2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 9 2 * +</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(1 + 9) * 2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 9 + 2 *</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Although infix notation is probably more familiar to you, postfix
notation has the benefit of exactly specifying the order of operations
without using any precedence rules and without needing parentheses to
clarify. To understand how to compute an expression in postfix notation,
we rely on the idea of a stack, which we first introduces in
<a href="#_classes">Chapter 9</a> and examine in much greater depth here.</p>
</div>
<div class="paragraph">
<p>Recall that a stack has three operations: <em>push</em>, <em>pop</em>, and <em>top</em>. It
works like a stack of physical objects. The push operation places an
object on the top, the pop operation removes an item from the top, and
the top operation tells you what is at the top of the stack.</p>
</div>
<div class="paragraph">
<p>Using a stack, the postfix evaluation rules are easy. Scan the
expression from left to right, if you see an operand (a number, in our
case), put it on the stack. If you see an operator, pop the last two
operands off the stack and use the operator on them. Then, push the
result back on the stack. When you run out of input, the value at the
top of the stack is your answer.</p>
</div>
<div class="paragraph">
<p>For example, with <code>1 9 2 * +</code>, all three operands are pushed onto the
stack. Then, the <code>*</code> is read, and so <code>2</code> and <code>9</code> is popped off the stack
and multiplied. The result <code>18</code> is pushed back on the stack. Then, the
<code>+</code> is read, and <code>18</code> and <code>1</code> is popped off the stack and summed,
resulting in <code>19</code>, which is pushed back on the stack and is the final
answer.</p>
</div>
<div class="paragraph">
<p>Our problem, however, is not to evaluate an expression in postfix
notation but to convert an expression in infix notation to postfix
notation. Again, the concept of a stack is useful. To do the conversion,
we initialize a stack and scan through the input in infix notation. As
we scan through the input, we do one of four things depending on which
of the four possible inputs we see:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Operand</dt>
<dd>
<p>Simply copy the operand to the postfix output.</p>
</dd>
<dt class="hdlist1">Operator</dt>
<dd>
<p>If the stack is empty, push the operator onto the stack. If the stack
is not empty and the operator at the top of the stack has the same or
greater precedence than our new operator, put the top operator into
our postfix output and pop the stack. Continue this process as long as
the top operator has the same or greater precedence compared to our
new operator and the stack is not empty. Finally, push the new
operator onto the stack.</p>
</dd>
<dt class="hdlist1">Left Parenthesis</dt>
<dd>
<p>Push the left parenthesis onto the stack.</p>
</dd>
<dt class="hdlist1">Right Parenthesis</dt>
<dd>
<p>Pop everything off the stack and add it to the output until you find a
left parenthesis in the stack. Then pop the left parenthesis.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Precedence comes from order of operations: <code>*</code> and <code>/</code> have high
precedence and <code>+</code> and <code>-</code> have low precedence. When you encounter it on
the stack, treat <code>(</code> as if it has even lower precedence than <code>+</code> and
<code>-</code>. A right parenthesis should never appear on the stack.</p>
</div>
<div class="paragraph">
<p>Following this algorithm, we are able to write a program that converts
infix notation to postfix notation. We further restrict our problem to
the case when the only operands are positive integers in the range
[0, 9]. Since each is a single character, parsing the
input is much easier. The same ideas for postfix conversion holds no
matter how the input is formatted, but parsing arbitrarily formatted
numbers is a difficult problem in its own right. This restriction also
makes spaces unnecessary.</p>
</div>
<div class="paragraph">
<p>To solve the infix conversion problem, we need to create a stack data
structure whose elements are terms from an infix expression, where a
term is an operator, operand, or a parenthesis. We created a stack to
solve the nesting expression problem in <a href="#_problem_nested_expressions">Section 9.1</a>, but we explore stacks in this chapter as one of many
different kinds of dynamic data structure.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_dynamic_data_structures">18.2. Concepts: Dynamic data structures</h3>
<div class="paragraph">
<p>By now you have seen several ways to organize data in your programs. For
example, you have used arrays to store a sequence of values and class
definitions to store (and operate on) collections of related values.
These data structures have the property that they are <em>static</em> in size:
Once allocated, they do not grow as the program runs. If you allocate an
array to store 100 integers, you&#8217;ll get an error if you try to store 101
integers into it.</p>
</div>
<div class="paragraph">
<p>In this chapter, we examine <em>dynamic</em> data structures: As more data is
read or processed, these data structures grow and shrink in memory to
store what is needed. The stack used to solve the nesting expressions
problem from <a href="#_classes">Chapter 9</a> is not actually a dynamic data
structure since it is defined with a fixed maximum size. In this
chapter, we implement a true stack as well as many other kinds of
dynamic data structures.</p>
</div>
<div class="sect3">
<h4 id="_dynamic_arrays">18.2.1. Dynamic arrays</h4>
<div class="paragraph">
<p>There are two broad classes of dynamic data structures we examine here.
The first kind are based on arrays that grow and shrink. Dynamic arrays
allow for fast access to individual elements in the data structure. One
drawback of dynamic arrays is that the array that stores that data has a
fixed amount of space. When too many elements are added, a new array has
to be reallocated and all the original elements copied over.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/18-dynamic-data-structures/images/dynamicinsertion.svg" alt="dynamicinsertion" width="80%">
</div>
<div class="title">Figure 73. Insertion into full dynamic array requiring reallocation. Even if the array wasn&#8217;t full, all values after <code>14</code> would need to be moved back to insert <code>17</code> in order.</div>
</div>
<div class="paragraph">
<p>Another drawback of dynamic arrays is that they are poorly suited for
insertion or deletion of elements in the middle of the array. When an
element is inserted, each element after it must be moved back one
position. Likewise, when an element is deleted, all of the elements
after it must be moved forward one position. Thus, insertions and
deletions at the end of a dynamic array are usually efficient, but
insertions and deletions in the middle are very time consuming.</p>
</div>
</div>
<div class="sect3">
<h4 id="_linked_lists">18.2.2. Linked lists</h4>
<div class="paragraph">
<p>The second kind of dynamic data structure is based on objects that link
to (or reference) other objects. The simplest form of such a data type
is a <em>linked list</em>. A linked list is a data structure made up of a
sequence of objects. Each object contains some data value (such as a
<code>String</code>) and a <em>link</em> to the next object in the sequence.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/18-dynamic-data-structures/images/linkedlist.svg" alt="linkedlist" width="100%">
</div>
<div class="title">Figure 74. Visualization of a linked list.</div>
</div>
<div class="paragraph">
<p>Linked lists are flexible because they have no preset size. Whenever a
new element is needed, it can be created and linked into the list.
Unfortunately, they can be slow if you need to access arbitrary elements
in the list. The only way to reach an element in the list is to walk
from element to element until you find what you&#8217;re looking for. If the
element is at the beginning (or the end) of the list, this process can
be quick. If the element is in the middle, there is no fast way to get
there.</p>
</div>
<div class="paragraph">
<p>Linked lists work well when inserting new elements at arbitrary
locations in the list. Unlike arrays, they are not implemented as a
contiguous block of memory. Linking a new element into the middle of the
list automatically creates the correct relationship among elements, and
there is no need to move all the elements after an insertion.</p>
</div>
<div class="paragraph">
<p>Among their downsides is the memory overhead of linked lists. Because a
new object must be allocated for each element in the list, which must
include a reference to the next element. Consequently, using a linked
list to solve a problem usually take more memory than an equivalent
dynamic array solution.</p>
</div>
<div class="paragraph">
<p>It turns out that either dynamic arrays or linked lists can be used to
create an efficient solution to the infix conversion problem defined at
the beginning of the chapter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_abstract_data_types">18.2.3. Abstract data types</h4>
<div class="paragraph">
<p>The fact that dynamic arrays and linked lists can be used to solve
similar problems points out that we may often be more interested in the
<strong>capabilities</strong> of a data structure rather than its implementation.</p>
</div>
<div class="paragraph">
<p>An <em>abstract data type</em> (ADT) is a set of operations that can be applied
to a set of data values with well-defined results that are independent
of any particular implementation. In other words, it is a list of things
that a data type can do (or have done to it).</p>
</div>
<div class="paragraph">
<p>A stack is a great example of an ADT. A stack needs to be able to push a
value, pop a value, and tell us what value is on top. The internal
workings of the stack are irrelevant (as long as they are efficient). It
is possible to use either a dynamic array or a linked list to implement
a stack ADT. A queue is another ADT we discuss in
<a href="#_syntax_abstract_data_types_adt">Section 18.4</a>, but there are many other
useful ADTs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_dynamic_arrays_and_linked_lists">18.3. Syntax: Dynamic arrays and linked lists</h3>
<div class="sect3">
<h4 id="_dynamic_arrays_2">18.3.1. Dynamic arrays</h4>
<div class="paragraph">
<p>Suppose you are faced with the problem of reading a list of names from a
file, sorting them into alphabetical order, and printing them out. You
have already looked at simple sorting algorithms to handle the sorting
part, or you could use the Java <code>Arrays.sort()</code> method. In previous
problems when you needed to use an array for storing items, you knew in
advance how many (or a maximum of how many) items you would need to
store. In this new problem, the number of names in the input file is
unspecified, so you must allow an arbitrary number to be handled.</p>
</div>
<div class="paragraph">
<p>One approach is to make a guess at how many names are in the input file
and allocate an array of that size. If your guess is too small, and you
don&#8217;t check array accesses, you&#8217;ll cause an exception once you have
filled the array and try to store the next name into the index one past
the last. If your guess is too large, you could be wasting a significant
amount of storage space.</p>
</div>
<div class="paragraph">
<p>Our first solution to the problem of dealing with dynamic or unknown
amounts of data is to watch our array accesses and expand the array as
necessary during processing. (It is also possible to contract an array
once you determine that the array has more space than needed.)</p>
</div>
<div class="sect4">
<h5 id="_a_simple_solution">A simple solution</h5>
<div class="paragraph">
<p><a href="#ReadIntoFixedArrayProgram">Program 79</a> allocates an array of 10 strings
and reads a list of names from standard input until it reaches the end
of the file, storing each name in successive array locations. If the
number of names in the input is larger than the size of the array, it
generates an exception.</p>
</div>
<div class="paragraph">
<p>Since programs that generate uncaught exceptions are, in general, a bad
idea, our first change to this program should be either to catch the
exception or check the index before storing the name in the array. In
either case, we would then take some action that is more user friendly
than generating an exception, perhaps simply printing an explanatory
message before exiting.</p>
</div>
<div id="ReadIntoFixedArrayProgram" class="listingblock">
<div class="title">Program 79. Reads names into an array, sort, and print. If there are more than 10 lines in the input, an exception is generated.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Arrays</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ReadIntoFixedArray</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">names</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">];</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>			<span class="tok-n">names</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">++]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>		<span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">sort</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">n</span><span class="tok-o">);</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">16 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]);</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our second change is to take a recovery action that allows the program
to proceed. What went wrong? We made a guess of the input size,
allocated an array of that size, but our guess was too small. We could
start over again (modify the code to initially allocate a larger array,
recompile, and re-run the program), but that option may not be available
to us if the program has been distributed to users around the world.
Instead, we fix the problem on the fly by allocating a larger array,
copying the old array into the new array, and continuing.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise18.3">Exercise 18.3</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#ReadAndGrowArrayProgram">Program 80</a> begins like the previous program by
allocating a fixed array. However, it now catches the
<code>ArrayOutOfBoundsException</code> at line <a href="#exceptionRAGA">[exceptionRAGA]</a> if it tries to
store too many names into the array. The <code>catch</code> clause allocates a new
array, twice the size of the original (current) array, copies the
existing array into it, and replaces the reference to the current array
with a reference to the new array.</p>
</div>
<div id="ReadAndGrowArrayProgram" class="listingblock">
<div class="title">Program 80. Reads names into an array, enlarging the array as necessary.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Arrays</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ReadAndGrowArray</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">names</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">];</span><span class="tok-cm">/*@\label{lineNames}@*/</span>
<span class="lineno"> 7 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>		<span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">())</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>			<span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno">13 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>				<span class="tok-n">names</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno">15 </span>			<span class="tok-o">}</span>
<span class="lineno">16 </span>			<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">ArrayIndexOutOfBoundsException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{exceptionRAGA}@*/</span>
<span class="lineno">17 </span>				<span class="tok-n">names</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">copyOfRange</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span><span class="tok-cm">/*@\label{lineCopy}@*/</span>
<span class="lineno">18 </span>							<span class="tok-n">names</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">*</span><span class="tok-mi">2</span><span class="tok-o">);</span>
<span class="lineno">19 </span>				<span class="tok-n">names</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno">20 </span>			<span class="tok-o">}</span>
<span class="lineno">21 </span>			<span class="tok-n">n</span><span class="tok-o">++;</span>
<span class="lineno">22 </span>		<span class="tok-o">}</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>		<span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">sort</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">n</span><span class="tok-o">);</span>
<span class="lineno">25 </span>
<span class="lineno">26 </span>		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
<span class="lineno">27 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]);</span>
<span class="lineno">28 </span>	<span class="tok-o">}</span>
<span class="lineno">29 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it was necessary to refactor the code in
<a href="#ReadIntoFixedArrayProgram">Program 79</a> slightly: Add the <code>name</code> variable
to hold the temporary result of reading the input line, and move the
counter increment to outside the <code>try</code>-<code>catch</code> block.</p>
</div>
<div class="paragraph">
<p>Can this new, improved program still fail? Yes, but only for <strong>very
large</strong> input, in the case when the Java virtual machine runs out of
memory when doubling the size of the array.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise18.4">Exercise 18.4</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A potentially more serious problem is the way we set <code>names</code> to point at
a new array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-n">names</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">copyOfRange</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">names</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">*</span><span class="tok-mi">2</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This line works because we know the only variable that references the
array is <code>names</code>. If other variables referenced that array, they would
continue to reference the old, smaller, and now out-of-date version of
the <code>names</code> array. <a href="#figure-dynamicproblems">Figure 75</a> gives an example of
this problem.</p>
</div>
<div id="figure-dynamicproblems" class="imageblock">
<div class="content">
<img src="chapters/18-dynamic-data-structures/images/dynamicproblems.svg" alt="dynamicproblems" width="100%">
</div>
<div class="title">Figure 75. A poorly designed dynamic array implementation. (a) Both <code>array1</code> and <code>array2</code> begin pointing at the same array. (b) A new array has been allocated, and <code>42</code> has been added to it. <code>array1</code> has been updated to point at the new array, but <code>array2</code> still points at the original.</div>
</div>
</div>
<div class="sect4">
<h5 id="_a_more_complete_solution">A more complete solution</h5>
<div class="paragraph">
<p>The problem of updating variables that reference the dynamic array is a
serious issue in large programs. It may not be enough to allocate a
larger array and assign the new reference to only one variable. There
may be hundreds of variables (or objects) that reference the original
array.</p>
</div>
<div class="paragraph">
<p>A solution to this problem is to create a new class whose objects
contain the array as a private field. References to the array are then
mediated, as usual, via accessor methods, which always refers to the
same version of the array. <a href="#DynamicArrayProgram">Program 81</a> is a simple
implementation of a dynamic array class. This class maintains an
internal array of <code>String</code> objects, which it extends whenever a call to
<code>set()</code> tries to write a new element just past the end of the array.</p>
</div>
<div id="DynamicArrayProgram" class="listingblock">
<div class="title">Program 81. Class to manage a dynamic array. This array grows by doubling when more space is needed.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Arrays</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DynamicArray</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">private</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">strings</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">];</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>    <span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">set</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">string</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">==</span> <span class="tok-n">strings</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">)</span>
<span class="lineno"> 8 </span>            <span class="tok-n">strings</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">copyOfRange</span><span class="tok-o">(</span><span class="tok-n">strings</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span>
<span class="lineno"> 9 </span>                                         <span class="tok-n">strings</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">*</span><span class="tok-mi">2</span><span class="tok-o">);</span>
<span class="lineno">10 </span>        <span class="tok-n">strings</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">string</span><span class="tok-o">;</span>
<span class="lineno">11 </span>    <span class="tok-o">}</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">get</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>        <span class="tok-k">return</span> <span class="tok-n">strings</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
<span class="lineno">15 </span>    <span class="tok-o">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>    <span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">sort</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">first</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">last</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>        <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">sort</span><span class="tok-o">(</span><span class="tok-n">strings</span><span class="tok-o">,</span> <span class="tok-n">first</span><span class="tok-o">,</span> <span class="tok-n">last</span><span class="tok-o">);</span>
<span class="lineno">19 </span>    <span class="tok-o">}</span>
<span class="lineno">20 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>set()</code> and <code>sort()</code> methods are both <code>synchronized</code> in
case this class is used by multiple threads simultaneously.
<a href="#exercise18.12">Exercise 18.12</a> explores the need to
synchronize these methods in the presence of multiple threads.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise18.9">Exercise 18.9</a><br>
<a href="#exercise18.12">Exercise 18.12</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#UseDynamicArrayProgram">Program 82</a> illustrates how to modify and extend
<a href="#ReadIntoFixedArrayProgram">Program 79</a> to use this new class. Since the
array grows automatically, there is no need for the original program to
check for out-of-bounds exceptions. Of course, the array expansion only
works if the reference occurs exactly at the index corresponding to one
beyond the end of the array. Other out-of-bound references generate an
exception.</p>
</div>
<div id="UseDynamicArrayProgram" class="listingblock">
<div class="title">Program 82. Uses the <code>DynamicArray</code> class to store input read from a file.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UseDynamicArray</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>        <span class="tok-n">DynamicArray</span> <span class="tok-n">names</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DynamicArray</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>        <span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>        <span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>        <span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">10 </span>        <span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">())</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>            <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno">12 </span>            <span class="tok-n">names</span><span class="tok-o">.</span><span class="tok-na">set</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-n">name</span><span class="tok-o">);</span>
<span class="lineno">13 </span>            <span class="tok-n">n</span><span class="tok-o">++;</span>
<span class="lineno">14 </span>        <span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>        <span class="tok-n">names</span><span class="tok-o">.</span><span class="tok-na">sort</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">n</span><span class="tok-o">);</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>        <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">n</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
<span class="lineno">19 </span>            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">));</span>
<span class="lineno">20 </span>    <span class="tok-o">}</span>
<span class="lineno">21 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <code>names</code> is no longer an array, but rather an object of class
<code>DynamicArray</code>, we can no longer use braces (<code>[]</code>) to access elements,
but must use accessor methods <code>set()</code> and <code>get()</code>. Also, <code>Arrays.sort()</code>
cannot sort this object, so we need to provide a <code>sort()</code> method in the
class itself to sort the private array on demand.</p>
</div>
<div class="paragraph">
<p>This implementation, like most implementations of dynamic arrays, has
potentially serious performance penalties. If the initial array is too
small, compared to the final size, then it will have been doubled and
the elements copied multiple times, resulting in slower execution. After
a resize, the array is only half full, resulting in wasted space. Even
on average, the array will only be three-quarters full.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise18.5">Exercise 18.5</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_linked_lists_2">18.3.2. Linked lists</h4>
<div class="paragraph">
<p>As we&#8217;ve seen, while dynamic arrays can grow to accommodate a large
number of items, the performance penalties of repeated copying and the
space wasted by unoccupied array elements can negatively affect program
behavior. In this section, we introduce the <em>linked list</em>, an
alternative data structure that can efficiently grow to accommodate a
large number of objects. As we shall see, this efficient growth comes at
the expense of limitations on how the structure can be accessed.</p>
</div>
<div class="paragraph">
<p>Consider again the problem of reading an arbitrary number of names from
an input file and storing them. Since we don&#8217;t know in advance how many
names there are, it may not be efficient to pre-allocate or dynamically
grow an array to store them. Imagine, instead, that we could write each
name on a small index card, and then link the index cards together to
keep track of them, much like the cars of a railroad train are linked by
the coupling from one to the next.</p>
</div>
<div class="sect4">
<h5 id="_constructing_a_linked_list">Constructing a linked list</h5>
<div class="paragraph">
<p>In Java, a linked list is usually implemented as a class that provides
methods to interact with a sequence of objects. The objects in the list
are implemented as a private static nested class. A private static
nested class behaves like a normal class but can only be created and
accessed by the class surrounding it. In this way, the internal
representation of the list is hidden and protected from outside
modification. The nested class has two fields, one containing the data
to be stored and the other containing a link or reference to the next
object, or <em>node</em>, in the list. Since they are only accessed by the
outer class, it is reasonable to make these fields public. If you need a
refresher on static nested classes, refer to <a href="#_advanced_nested_classes">Section 9.5</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LinkedList</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

 <span class="tok-c1">//methods for interacting with the list</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the type <code>next</code> is the same as the class it&#8217;s inside of! This
apparent circular reference works because the variable only <strong>references</strong>
an object, but the object is not actually contained within the variable.
In fact, the value of the link may be <code>null</code>, indicating that there are
no additional nodes in the list.</p>
</div>
<div class="paragraph">
<p>In the railroad metaphor, the node is a train car (with its freight as
the value), and the link to the next node is the coupling to the next
car.</p>
</div>
<div class="paragraph">
<p>The definition of <code>LinkedList</code> given above is a good start, but it needs
a <code>head</code> reference that keeps track of the first node in the list.
Initially, this value is <code>null</code>. We also need an <code>add()</code> method so that
we can add nodes to the list. Without checking through the entire list,
it is useful to know how many nodes are in it. We can create a <code>size</code>
field that we increment whenever we add a node, as well as an accessor
to read its value. Finally, we can create a <code>fillArray()</code> method that
fills an array with the values in the list.</p>
</div>
<div id="LinkedListProgram" class="listingblock">
<div class="title">Program 83. Basic implementation of a linked list class to hold <code>String</code> objects.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LinkedList</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">size</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>    	<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">12 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">13 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">14 </span>    	<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">15 </span>    	<span class="tok-n">size</span><span class="tok-o">++;</span>
<span class="lineno">16 </span>    <span class="tok-o">}</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">size</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">19 </span>    	<span class="tok-k">return</span> <span class="tok-n">size</span><span class="tok-o">;</span>
<span class="lineno">20 </span>    <span class="tok-o">}</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">fillArray</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>    	<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">24 </span>    	<span class="tok-kt">int</span> <span class="tok-n">position</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">25 </span>    	<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">temp</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">26 </span>    		<span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">position</span><span class="tok-o">++]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">27 </span>    		<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">28 </span>    	<span class="tok-o">}</span>
<span class="lineno">29 </span>    <span class="tok-o">}</span>
<span class="lineno">30 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#UseLinkedListProgram">Program 84</a> is a re-implementation of the
name-reading program using class <code>LinkedList</code>. Note that no array needs
to be pre-allocated. Instead, we capture all the lines of input into a
linked list called <code>list</code>.</p>
</div>
<div id="UseLinkedListProgram" class="listingblock">
<div class="title">Program 84. Uses the <code>LinkedList</code> class to store input read from a file.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Arrays</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UseLinkedList</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">LinkedList</span> <span class="tok-n">list</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">LinkedList</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>		<span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">())</span>
<span class="lineno">10 </span>			<span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">());</span><span class="tok-cm">/*@\label{lineReadNew}@*/</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>		<span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">names</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">getSize</span><span class="tok-o">()];</span>
<span class="lineno">13 </span>		<span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">fillArray</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">);</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>		<span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">sort</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">);</span><span class="tok-cm">/*@\label{lineSort}@*/</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">names</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
<span class="lineno">18 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]);</span>
<span class="lineno">19 </span>	<span class="tok-o">}</span>
<span class="lineno">20 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each time we read a new line from the file, the <code>LinkedList</code> class
internally creates a new <code>Node</code> with the input line as its <code>value</code>. It
also sets its <code>next</code> reference to the <strong>current</strong> <code>head</code> so that the rest
of the list (which could be empty if <code>head</code> is <code>null</code>) comes after the
new <code>Node</code>. We then update the <code>head</code> field to reference the new <code>Node</code>.
Thus, each new line read from the file is stored at the <strong>beginning</strong> of
the linked list. The last node in the list, which contains the first
<code>String</code> read in, has a <code>next</code> value of <code>null</code>. <a href="#figure-linked_list_classes">Figure 76</a> shows a visualization of the contents of this
implementation of a linked list. An &#8220;X&#8221; is used in place of an arrow
that points to <code>null</code>.</p>
</div>
<div id="figure-linked_list_classes" class="imageblock">
<div class="content">
<img src="chapters/18-dynamic-data-structures/images/linkedlistclasses.svg" alt="linkedlistclasses" width="100%">
</div>
<div class="title">Figure 76. Visualization of linked list implementation with classes.</div>
</div>
<div class="paragraph">
<p>Since we also increment the <code>size</code> field inside of <code>LinkedList</code> on each
add, we know how many <code>String</code> objects it contains. Thus, the
<code>toString()</code> method knows how large of an array to allocate. It then
visits every node in the linked list, storing its <code>value</code> into the
array. In <code>UseLinkedList</code>, we sort the returned array as before and then
print it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_appending_to_the_end_of_a_linked_list">Appending to the end of a linked list</h5>
<div class="paragraph">
<p>The <code>LinkedList</code> class maintains a field named <code>head</code> that references
the first node in the linked list. As we saw, that element was actually
the <strong>last</strong> or <strong>most recent</strong> <code>String</code> read from input. This <code>head</code>
element was followed by the next most recent <code>String</code>, followed by the
next most recent <code>String</code>, and so on. The last node contained the first
<code>String</code> read from input and had a <code>null</code> <code>next</code> field.</p>
</div>
<div class="paragraph">
<p>If we want the linked list to be ordered in the natural way, with <code>head</code>
pointing to the first element read from the file and the last element on
the list (the one with <code>next</code> pointing to <code>null</code>) containing the
<code>String</code> most recently read, we can maintain a second field that
references the <em>tail</em> of the list.</p>
</div>
<div class="paragraph">
<p><a href="#LinkedListWithTailProgram">Program 85</a> adds a <em>tail pointer</em> called
<code>tail</code> to the <code>LinkedList</code> class. Note that we have changed the <code>add()</code>
method to the <code>addFirst()</code> method, and we have also added an <code>addLast()</code>
method to make it easy to append elements to the end of a linked list.
Note that the <code>addFirst()</code> method has been updated to change the <code>tail</code>
pointer, but only if the list is empty (<code>head</code> is <code>null</code>). After all,
adding to the front of a list only changes <code>tail</code> if the front is <strong>also</strong>
the back. In the <code>addLast()</code> method, adding a value to an empty list
also sets both the <code>head</code> and <code>tail</code> to point at a node containing that
value. Once the list has a node in it, subsequent calls to <code>addLast()</code>
creates a new <code>Node</code>, points the <code>next</code> field of the old <code>tail</code> at it,
and changes the <code>tail</code> field so that it also points at it.</p>
</div>
<div id="LinkedListWithTailProgram" class="listingblock">
<div class="title">Program 85. We can append to the end of a linked list by using an additional variable, <code>tail</code>, to reference the last element (tail) of the list.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LinkedListWithTail</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">size</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">addFirst</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>    	<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">13 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">14 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">15 </span>    	<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">16 </span>    	<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">tail</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span>
<span class="lineno">17 </span>    		<span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">18 </span>    	<span class="tok-n">size</span><span class="tok-o">++;</span>
<span class="lineno">19 </span>    <span class="tok-o">}</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">addLast</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">22 </span>    	<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">23 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">24 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">25 </span>    	<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">tail</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span>
<span class="lineno">26 </span>    		<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">27 </span>    	<span class="tok-k">else</span>
<span class="lineno">28 </span>    		<span class="tok-n">tail</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">29 </span>    	<span class="tok-n">size</span><span class="tok-o">++;</span>
<span class="lineno">30 </span>    <span class="tok-o">}</span>
<span class="lineno">31 </span>
<span class="lineno">32 </span>    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getSize</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">33 </span>    	<span class="tok-k">return</span> <span class="tok-n">size</span><span class="tok-o">;</span>
<span class="lineno">34 </span>    <span class="tok-o">}</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">fillArray</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">37 </span>    	<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">38 </span>    	<span class="tok-kt">int</span> <span class="tok-n">position</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">39 </span>    	<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">temp</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">40 </span>    		<span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">position</span><span class="tok-o">++]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">41 </span>    		<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">42 </span>    	<span class="tok-o">}</span>
<span class="lineno">43 </span>    <span class="tok-o">}</span>
<span class="lineno">44 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_inserting_into_a_linked_list">Inserting into a linked list</h5>
<div class="paragraph">
<p>In the running example for this chapter, we are interested in printing a
sorted list of <code>String</code> objects read from input. Thus far we have
captured the lines into a linked list of elements, dumped these elements
into an array of the right size, and then sorted the array. An
alternative solution is to insert the elements into the linked list at
the right point in the first place.</p>
</div>
<div class="paragraph">
<p><a href="#SortedLinkedListProgram">Program 86</a> is a version of a linked list that
inserts elements into the linked list in sorted order. The only
significant difference between it and the previous implementations of a
linked list is its <code>add()</code> method. This method walks down the linked
list, starting at <code>head</code>, until it either walks off the end of the list
or finds an element before which the new <code>String</code> should go. There are
special cases that must be handled to make this process work correctly.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Empty list</dt>
<dd>
<p>The first time an item is inserted into a linked list, the <code>head</code> and
<code>tail</code> fields must be set to reference this new node. The <code>next</code> field
of the new node is <code>null</code>.</p>
</dd>
<dt class="hdlist1">Insert at beginning</dt>
<dd>
<p>If a node is inserted at the beginning of the list, the <code>head</code> must be
updated to point to this new node. The <code>next</code> field of the new node is
set to the old value of <code>head</code>.</p>
</dd>
<dt class="hdlist1">Insert in middle</dt>
<dd>
<p>To insert a node in the middle of a linked list, it is typically
necessary to maintain two variables to reference the <code>current</code> and
<code>previous</code> nodes while walking down the list. Once the proper
insertion point is found (between the <code>previous</code> and <code>current</code> nodes),
the <code>next</code> field for the <code>previous</code> node is adjusted to reference the
new node, and <code>next</code> field for the new node is set to <code>current</code>.</p>
</dd>
<dt class="hdlist1">Insert at end</dt>
<dd>
<p>If the insertion is taking place at the end of the list, <code>current</code> is
<code>null</code>, and the new node has a <code>next</code> field of <code>null</code>. However, the
<code>tail</code> field must be updated to reference the new node.</p>
</dd>
</dl>
</div>
<div id="SortedLinkedListProgram" class="listingblock">
<div class="title">Program 86. Linked list class in which calling the <code>add()</code> method inserts each value in sorted order.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SortedLinkedList</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">size</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">add</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>    	<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">13 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">14 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>    	<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">head</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span>
<span class="lineno">17 </span>    		<span class="tok-c1">//empty list</span>
<span class="lineno">18 </span>    		<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">19 </span>    	<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">compareTo</span><span class="tok-o">(</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">)</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>    		<span class="tok-c1">//insert at beginning</span>
<span class="lineno">21 </span>    		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">22 </span>    		<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">23 </span>    	<span class="tok-o">}</span>
<span class="lineno">24 </span>    	<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">25 </span>    		<span class="tok-c1">//insert at middle or end</span>
<span class="lineno">26 </span>    		<span class="tok-n">Node</span> <span class="tok-n">previous</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">27 </span>    		<span class="tok-n">Node</span> <span class="tok-n">current</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">28 </span>
<span class="lineno">29 </span>    		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">current</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">&amp;&amp;</span>
<span class="lineno">30 </span>    			<span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">compareTo</span><span class="tok-o">(</span> <span class="tok-n">current</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">)</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>    			<span class="tok-n">previous</span> <span class="tok-o">=</span> <span class="tok-n">current</span><span class="tok-o">;</span>
<span class="lineno">32 </span>    			<span class="tok-n">current</span> <span class="tok-o">=</span> <span class="tok-n">current</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">33 </span>    		<span class="tok-o">}</span>
<span class="lineno">34 </span>
<span class="lineno">35 </span>    		<span class="tok-n">previous</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">36 </span>    		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">current</span><span class="tok-o">;</span>
<span class="lineno">37 </span>
<span class="lineno">38 </span>    		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">current</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-c1">//insert at end of list</span>
<span class="lineno">39 </span>    			<span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">40 </span>    	<span class="tok-o">}</span>
<span class="lineno">41 </span>    	<span class="tok-n">size</span><span class="tok-o">++;</span>
<span class="lineno">42 </span>    <span class="tok-o">}</span>
<span class="lineno">43 </span>
<span class="lineno">44 </span>    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">size</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">45 </span>    	<span class="tok-k">return</span> <span class="tok-n">size</span><span class="tok-o">;</span>
<span class="lineno">46 </span>    <span class="tok-o">}</span>
<span class="lineno">47 </span>
<span class="lineno">48 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">fillArray</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">49 </span>    	<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">50 </span>    	<span class="tok-kt">int</span> <span class="tok-n">position</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">51 </span>    	<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">temp</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">52 </span>    		<span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">position</span><span class="tok-o">++]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">53 </span>    		<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">54 </span>    	<span class="tok-o">}</span>
<span class="lineno">55 </span>    <span class="tok-o">}</span>
<span class="lineno">56 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_abstract_data_types_adt">18.4. Syntax: Abstract data types (ADT)</h3>
<div class="paragraph">
<p>We&#8217;ve seen two examples so far of dynamic data structures: dynamic
arrays and linked lists. A great deal of complexity can go on inside
these data structures, but code that uses these data structures does not
need to be aware of the details of the internal implementation. Ideally,
user programs could use any data structure that provided the needed set
of operations.</p>
</div>
<div class="paragraph">
<p>Our dynamic array and linked list classes were simple examples of
abstract data types (ADT). We continue to design data structures that
hide the details of their implementation inside a class. The user of
each class is aware of the operations (public methods) that can be
performed on objects of the class, but not on the techniques used to
implement those operations. Defining an ADT without regard to an
implementation keeps users of the ADT from becoming dependent on details
of any particular implementation. It gives maximum freedom to the
programmer to choose (and change) the implementation as appropriate for
the overall system design.</p>
</div>
<div class="paragraph">
<p>We generalize a data structure by observing which operations are applied
to it. Then, we create an abstraction that formalizes these
observations. The idea is to cleanly separate the use and behavior of
the data structure from the way in which it is implemented.</p>
</div>
<div class="paragraph">
<p>Interfaces are the obvious tool for defining the behavior of a class in
Java without specifying its implementation. When defining an ADT in
Java, the set of operations becomes the set of methods given by the
interface. Then, any class that implements the ADT must implement the
interface that defines that ADT.</p>
</div>
<div class="paragraph">
<p>In subsequent sections we look at two fundamental abstract data types,
<em>stacks</em> and <em>queues</em>, and sample classes that implement them.</p>
</div>
<div class="sect3">
<h4 id="_stacks">18.4.1. Stacks</h4>
<div class="paragraph">
<p>We have already used stacks to solve problems in
<a href="#_classes">Chapter 9</a>. Recall that a stack data structure behaves
like a stack of books on your desk. When you place a book on the stack
it covers the books that are already there. When you take a book off the
stack, you remove the book most recently placed there, exposing the one
beneath it.</p>
</div>
<div class="paragraph">
<p>You can find a simple implementation of a stack in the solution to the
infix conversion problem in <a href="#_solution_infix_conversion">Section 18.6</a>, but
we now examine the stack more deeply as an archetypal ADT. A stack&#8217;s
restricted set of operations (pushing and popping) is adequate for many
tasks and can be implemented in a number of different ways, some more
efficient than others.</p>
</div>
<div class="paragraph">
<p>The acronym FILO (first in, last out) is sometimes used to describe a
stack. The last item that has been pushed onto the stack is the first
item to be popped off the stack. In the next section, we&#8217;ll study the
<em>queue</em>, which is a FIFO (first in, first out) data structure.</p>
</div>
</div>
<div class="sect3">
<h4 id="_abstract_data_type_operations_on_a_stack">18.4.2. Abstract Data Type: Operations on a stack</h4>
<div class="paragraph">
<p>There are two essential operations on a stack abstract data type
(corresponding to placing a book on the pile and removing it): <code>push()</code>
and <code>pop()</code>. We also define two additional operations, <code>top()</code> and
<code>isEmpty()</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>push(x)</code>:</strong> Push value <code>x</code> onto the stack.</p>
</li>
<li>
<p><strong><code>pop()</code>:</strong> Pop the value on the top of the stack, and return its
value.</p>
</li>
<li>
<p><strong><code>top()</code>:</strong> Return the value on the top of the stack, but do not pop it
off.</p>
</li>
<li>
<p><strong><code>isEmpty()</code>:</strong> Return <code>true</code> if the stack is empty, <code>false</code> otherwise.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because a stack is an abstract data type, we are not specifically
concerned with <strong>how</strong> these operations are implemented, merely that they
are. Thus, we can specify an interface called <code>Stack</code> that requires
these four methods.</p>
</div>
<div id="StackProgram" class="listingblock">
<div class="title">Program 87. Interface specifying the stack ADT.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Stack</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="lineno">3 </span>	<span class="tok-n">String</span> <span class="tok-nf">pop</span><span class="tok-o">();</span>
<span class="lineno">4 </span>	<span class="tok-n">String</span> <span class="tok-nf">top</span><span class="tok-o">();</span>
<span class="lineno">5 </span>	<span class="tok-kt">boolean</span> <span class="tok-nf">isEmpty</span><span class="tok-o">();</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_linked_list_implementation">Linked list implementation</h5>
<div class="paragraph">
<p>All the operations defined by the stack ADT (and interface) are
implemented as methods in the class <code>LinkedListStack</code>, shown in
<a href="#LinkedListStackProgram">Program 88</a>.</p>
</div>
<div id="LinkedListStackProgram" class="listingblock">
<div class="title">Program 88. Class to implement a stack ADT using a linked list.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LinkedListStack</span> <span class="tok-kd">implements</span> <span class="tok-n">Stack</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">11 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">pop</span><span class="tok-o">()</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{linePop}@*/</span>
<span class="lineno">17 </span>		<span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">18 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">isEmpty</span><span class="tok-o">())</span>
<span class="lineno">19 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Can&#39;t pop empty stack!&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">21 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">22 </span>			<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">23 </span>		<span class="tok-o">}</span>
<span class="lineno">24 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">25 </span>	<span class="tok-o">}</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">top</span><span class="tok-o">()</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{lineTop}@*/</span>
<span class="lineno">28 </span>		<span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">29 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">isEmpty</span><span class="tok-o">())</span>
<span class="lineno">30 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;No top on an empty stack!&quot;</span><span class="tok-o">);</span>
<span class="lineno">31 </span>		<span class="tok-k">else</span>
<span class="lineno">32 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">33 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">34 </span>	<span class="tok-o">}</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">37 </span>		<span class="tok-k">return</span> <span class="tok-n">head</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">38 </span>	<span class="tok-o">}</span>
<span class="lineno">39 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>head</code> field is used to maintain a reference to the linked list that
defines the stack. It is initialized to <code>null</code>.</p>
</div>
<div class="paragraph">
<p>The method <code>push()</code> must create a new node for the linked list and push
it onto the front of the list. It does so by creating a new <code>Node</code>,
setting its <code>value</code> field to the incoming <code>value</code>, and pointing its
<code>next</code> pointer to the beginning of the list, stored by <code>head</code>. Since
<code>temp</code> is now the new top of the stack, <code>head</code> is made to point at it.</p>
</div>
<div class="paragraph">
<p>The <code>pop()</code> method needs to return the <code>value</code> of the <code>head</code> node and
remove that node from the linked list. It does this by replacing the
<code>head</code> node with the node pointed at by the <code>next</code> link in <code>head</code>. The
<code>pop()</code> method from the simpler stack used in the solution to the nested
expressions problem in <a href="#_solution_nested_expressions">Section 9.6</a> merely
removed the top and did not return the value. Most real-world stack
implementations of <code>pop()</code> <strong>do</strong> return this value, giving programmers
more flexibility.</p>
</div>
<div class="paragraph">
<p>Note that both <code>pop()</code> and <code>top()</code> print an error message if the stack
is empty. Other more elaborate error handling is possible, for example,
by throwing an exception.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dynamic_array_implementation">Dynamic array implementation</h5>
<div class="paragraph">
<p>Like the dynamic array example of <a href="#UseDynamicArrayProgram">Program 82</a>,
<a href="#DynamicArrayStackProgram">Program 89</a> implements a stack of <code>String</code>
values using a dynamic array data structure.</p>
</div>
<div id="DynamicArrayStackProgram" class="listingblock">
<div class="title">Program 89. Illustrates a stack ADT partially implemented using a dynamic array.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Arrays</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DynamicArrayStack</span> <span class="tok-kd">implements</span> <span class="tok-n">Stack</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">strings</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-mi">10</span><span class="tok-o">];</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">size</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">string</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">size</span> <span class="tok-o">==</span> <span class="tok-n">strings</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>			<span class="tok-n">doubleArray</span><span class="tok-o">();</span>
<span class="lineno">10 </span>		<span class="tok-n">strings</span><span class="tok-o">[</span><span class="tok-n">size</span><span class="tok-o">++]</span> <span class="tok-o">=</span> <span class="tok-n">string</span><span class="tok-o">;</span>
<span class="lineno">11 </span>	<span class="tok-o">}</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">pop</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>		<span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">15 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">size</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span>
<span class="lineno">16 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Can&#39;t pop empty stack!&quot;</span><span class="tok-o">);</span>
<span class="lineno">17 </span>		<span class="tok-k">else</span>
<span class="lineno">18 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">strings</span><span class="tok-o">[--</span><span class="tok-n">size</span><span class="tok-o">];</span>
<span class="lineno">19 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">20 </span>	<span class="tok-o">}</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span>	<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">doubleArray</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>		<span class="tok-n">strings</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">copyOfRange</span><span class="tok-o">(</span><span class="tok-n">strings</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">strings</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">*</span><span class="tok-mi">2</span><span class="tok-o">);</span>
<span class="lineno">24 </span>	<span class="tok-o">}</span>
<span class="lineno">25 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This stack implementation using a dynamic array omits the <code>top()</code> and
<code>isEmpty()</code> methods (causing a compiler error in
<a href="#DynamicArrayStackProgram">Program 89</a> until the <code>Stack</code> interface is
properly implemented).</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise18.7">Exercise 18.7</a></p>
</div>
</div>
</div>
<div id="postfixComputationExample" class="exampleblock">
<div class="title">Example 144. Postfix computation</div>
<div class="content">
<div class="paragraph">
<p>At the beginning of the chapter, we introduced the problem of converting
an expression from infix to postfix notation. In
<a href="#_solution_infix_conversion">Section 18.6</a>, we give the solution to this
problem, but without a program that can evaluate a postfix expression,
the conversion tool is not very useful.</p>
</div>
<div class="paragraph">
<p>Here we give a simple postfix evaluator. Recall the algorithm: Scan the
input expression from left to right, if you see a number, put it on the
stack. If you see an operator, pop the last two operands off the stack
and use the operator on them. Then, push the result back on the stack.
When you run out of input, the value at the top of the stack is your
answer.</p>
</div>
<div class="paragraph">
<p>Like the infix to postfix converter, we restrict our input to positive
integers of a single digit. To make this program simpler, we introduce
two new classes that are also useful in our infix to postfix converter.
The first is <code>Term</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Term</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">;</span>
    <span class="tok-kd">public</span> <span class="tok-nf">Term</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class allows us to hold an <code>int</code> value. Although its structure is
simple, we update the definition of <code>Term</code> later in the solution to the
infix to postfix conversion problem. By doing so, we can keep exactly
the same definition for <code>TermStack</code> given next.</p>
</div>
<div id="TermStackProgram" class="listingblock">
<div class="title">Program 90. Class to manage a stack of <code>Term</code> objects.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TermStack</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">Term</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span> <span class="tok-n">Term</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">11 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>	<span class="tok-kd">public</span> <span class="tok-n">Term</span> <span class="tok-nf">pop</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>		<span class="tok-n">Term</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">18 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">isEmpty</span><span class="tok-o">())</span>
<span class="lineno">19 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Can&#39;t pop empty stack!&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">21 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">22 </span>			<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">23 </span>		<span class="tok-o">}</span>
<span class="lineno">24 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">25 </span>	<span class="tok-o">}</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span>	<span class="tok-kd">public</span> <span class="tok-n">Term</span> <span class="tok-nf">top</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">28 </span>		<span class="tok-n">Term</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">29 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">isEmpty</span><span class="tok-o">())</span>
<span class="lineno">30 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;No top on an empty stack!&quot;</span><span class="tok-o">);</span>
<span class="lineno">31 </span>		<span class="tok-k">else</span>
<span class="lineno">32 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">33 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">34 </span>	<span class="tok-o">}</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">37 </span>		<span class="tok-k">return</span> <span class="tok-n">head</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">38 </span>	<span class="tok-o">}</span>
<span class="lineno">39 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This class gives a linked list implementation of a stack. In fact, it is
virtually identical to <a href="#LinkedListStackProgram">Program 88</a> with the
substitution of <code>Term</code> for <code>String</code>.</p>
</div>
<div id="PostfixCalculatorProgram" class="listingblock">
<div class="title">Program 91. Evaluates a postfix expression.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PostfixCalculator</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">String</span> <span class="tok-n">expression</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>		<span class="tok-n">TermStack</span> <span class="tok-n">stack</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TermStack</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">expression</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>			<span class="tok-kt">char</span> <span class="tok-n">term</span> <span class="tok-o">=</span> <span class="tok-n">expression</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno">10 </span>			<span class="tok-k">if</span><span class="tok-o">(</span>  <span class="tok-n">term</span> <span class="tok-o">&gt;=</span> <span class="tok-sc">&#39;0&#39;</span><span class="tok-o">&amp;&amp;</span> <span class="tok-n">term</span> <span class="tok-o">&lt;=</span> <span class="tok-sc">&#39;9&#39;</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>				<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">Term</span><span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-kt">int</span><span class="tok-o">)(</span><span class="tok-n">term</span> <span class="tok-o">-</span> <span class="tok-sc">&#39;0&#39;</span><span class="tok-o">))</span> <span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>				<span class="tok-kt">int</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">();</span>
<span class="lineno">14 </span>				<span class="tok-kt">int</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">();</span>
<span class="lineno">15 </span>				<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">term</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>					<span class="tok-k">case</span> <span class="tok-sc">&#39;+&#39;</span><span class="tok-o">:</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">Term</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">+</span> <span class="tok-n">b</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno">17 </span>						<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">18 </span>					<span class="tok-k">case</span> <span class="tok-sc">&#39;-&#39;</span><span class="tok-o">:</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">Term</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">-</span> <span class="tok-n">b</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno">19 </span>						<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">20 </span>					<span class="tok-k">case</span> <span class="tok-sc">&#39;*&#39;</span><span class="tok-o">:</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">Term</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">*</span> <span class="tok-n">b</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno">21 </span>						<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">22 </span>					<span class="tok-k">case</span> <span class="tok-sc">&#39;/&#39;</span><span class="tok-o">:</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">Term</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">/</span> <span class="tok-n">b</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>						<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">24 </span>				<span class="tok-o">}</span>
<span class="lineno">25 </span>			<span class="tok-o">}</span>
<span class="lineno">26 </span>		<span class="tok-o">}</span>
<span class="lineno">27 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The answer is: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">28 </span>				<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">().</span><span class="tok-na">getValue</span><span class="tok-o">());</span>
<span class="lineno">29 </span>	<span class="tok-o">}</span>
<span class="lineno">30 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With our utility classes in place, the code for the postfix evaluator is
short. Our <code>main()</code> method reads in the expression from the user and
creates a <code>TermStack</code> called <code>stack</code>. Then, it iterates through the
expression with a <code>for</code> loop. For each number we find, we supply it as
an argument to the constructor of a new <code>Term</code> object, which we push
onto <code>stack</code>.</p>
</div>
<div class="paragraph">
<p>For each operator, we pop two items off <code>stack</code> and apply the operator
to them. We create a new <code>Term</code> from the result and push this value onto
<code>stack</code>. Finally, after all input is exhausted, we print the value on
the top of <code>stack</code>. To test it properly, you have to supply expressions
in postfix form. Also, remember that these operations are all integer
operations without fractional parts. Be careful to avoid division by
zero!.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_queues">18.4.3. Queues</h4>
<div class="paragraph">
<p>A <em>queue</em> data structure is similar to a stack data structure, except
that when getting an item from a queue, the item that has been in the
queue longest is the one retrieved. A queue data structure models an
ordinary queue or line of people. The first person into the queue or
line at a bank, for example, is the first one to receive service. Late
comers are served in the order in which they arrive.</p>
</div>
<div class="paragraph">
<p>A queue is sometimes called a FIFO (first in, first out) data structure
due to this property. To distinguish the operations on a queue from
those on a stack, we use the terms enqueue and dequeue instead of push
and pop.</p>
</div>
</div>
<div class="sect3">
<h4 id="_abstract_data_type_operations_on_a_queue">18.4.4. Abstract Data Type: Operations on a queue</h4>
<div class="paragraph">
<p>Four typical operations on a queue data structure are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>enqueue(x)</code>:</strong> Put value <code>x</code> onto the end of the queue.</p>
</li>
<li>
<p><strong><code>dequeue()</code>:</strong> Remove and return the value at the front of the queue,
that is, the value that has been on the queue the longest.</p>
</li>
<li>
<p><strong><code>front()</code>:</strong> Return (but do not remove) the value at the front of the
queue.</p>
</li>
<li>
<p><strong><code>isEmpty()</code>:</strong> Return <code>true</code> if the queue is empty, <code>false</code> otherwise.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As with stacks, we can specify an interface called <code>Queue</code> that requires
these four methods.</p>
</div>
<div id="QueueProgram" class="listingblock">
<div class="title">Program 92. Interface specifying the queue ADT.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Queue</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kt">void</span> <span class="tok-nf">enqueue</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="lineno">3 </span>	<span class="tok-n">String</span> <span class="tok-nf">dequeue</span><span class="tok-o">();</span>
<span class="lineno">4 </span>	<span class="tok-n">String</span> <span class="tok-nf">front</span><span class="tok-o">();</span>
<span class="lineno">5 </span>	<span class="tok-kt">boolean</span> <span class="tok-nf">isEmpty</span><span class="tok-o">();</span>
<span class="lineno">6 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_linked_list_implementation_2">Linked list implementation</h5>
<div class="paragraph">
<p><a href="#LinkedListQueueProgram">Program 93</a> shows an implementation of the queue
ADT operations using a linked list. Because we need to keep track of
nodes at both ends of the linked list, we maintain <code>head</code> and <code>tail</code>
variables to reference these nodes. The <code>enqueue()</code> and <code>dequeue()</code>
methods manipulate these variables to manage the queue as values are put
onto it and removed from it.</p>
</div>
<div id="LinkedListQueueProgram" class="listingblock">
<div class="title">Program 93. Illustrates a queue ADT implemented using a linked list.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LinkedListQueue</span> <span class="tok-kd">implements</span> <span class="tok-n">Queue</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">enqueue</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{linePutQueue}@*/</span>
<span class="lineno">11 </span>		<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">12 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">16 </span>			<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span> <span class="tok-cm">/*@\label{lineNewLLN}@*/</span>
<span class="lineno">17 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>			<span class="tok-n">tail</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">19 </span>			<span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">20 </span>		<span class="tok-o">}</span>
<span class="lineno">21 </span>	<span class="tok-o">}</span>
<span class="lineno">22 </span>
<span class="lineno">23 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">dequeue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">24 </span>		<span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">25 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">26 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Can&#39;t dequeue an empty queue!&quot;</span><span class="tok-o">);</span>
<span class="lineno">27 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">28 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">29 </span>			<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">30 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">head</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span>
<span class="lineno">31 </span>				<span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">32 </span>		<span class="tok-o">}</span>
<span class="lineno">33 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">34 </span>	<span class="tok-o">}</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">front</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">37 </span>		<span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">38 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">39 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;No front on an empty queue!&quot;</span><span class="tok-o">);</span>
<span class="lineno">40 </span>		<span class="tok-k">else</span>
<span class="lineno">41 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">42 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">43 </span>	<span class="tok-o">}</span>
<span class="lineno">44 </span>
<span class="lineno">45 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">46 </span>		<span class="tok-k">return</span> <span class="tok-n">head</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">47 </span>	<span class="tok-o">}</span>
<span class="lineno">48 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the implemention of the <code>LinkedListQueue</code> class is very
similar to the implementation of the <code>LinkedListWithTail</code> class. The
<code>enqueue()</code> method in the former is almost identical to the <code>addLast()</code>
method in the latter.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_generic_data_structures">18.5. Advanced: Generic data structures</h3>
<div class="paragraph">
<p>Most of the dynamic data structures we have seen in this chapter store
values of type <code>String</code>. We explore dynamic arrays of <code>String</code> values,
linked lists of <code>String</code> objects, queues of <code>String</code> objects, and stacks
of <code>String</code> objects. In <a href="#postfixComputationExample">Example 144</a>, we
create the stack class <code>TermStack</code> to hold <code>Term</code> objects, but
<code>TermStack</code> is identical to the existing <code>LinkedListStack</code> class with
the substitution of <code>Term</code> for <code>String</code>.</p>
</div>
<div class="paragraph">
<p>What if you wanted to store values of some other type in these data
structures? What if you wanted a stack of <code>int</code> values or a queue of
<code>Thread</code> objects? You might think that you need to create a distinct but
similar implementation of each ADT for each type, as we do in
<a href="#postfixComputationExample">Example 144</a>.</p>
</div>
<div class="paragraph">
<p>One possible solution is to take advantage of the fact that a variable
of type <code>Object</code> can hold a reference to a value of any reference type
(since all classes are subtypes of <code>Object</code>). If we create data
structures using <code>Object</code> as the underlying type, we can store values of
any type in the data structure. For example,
<a href="#ObjectStackProgram">Program 94</a> is an implementation of a stack ADT with
an underlying data type of <code>Object</code>.</p>
</div>
<div id="ObjectStackProgram" class="listingblock">
<div class="title">Program 94. Class that implements a stack of <code>Object</code> references.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ObjectStack</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">push</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">11 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">12 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>	<span class="tok-kd">public</span> <span class="tok-n">Object</span> <span class="tok-nf">pop</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>		<span class="tok-n">Object</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">18 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">isEmpty</span><span class="tok-o">())</span>
<span class="lineno">19 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Can&#39;t pop empty stack!&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">21 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">22 </span>			<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">23 </span>		<span class="tok-o">}</span>
<span class="lineno">24 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">25 </span>	<span class="tok-o">}</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span>	<span class="tok-kd">public</span> <span class="tok-n">Object</span> <span class="tok-nf">top</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">28 </span>		<span class="tok-n">Object</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">29 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">isEmpty</span><span class="tok-o">())</span>
<span class="lineno">30 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Can&#39;t get top of empty stack!&quot;</span><span class="tok-o">);</span>
<span class="lineno">31 </span>		<span class="tok-k">else</span>
<span class="lineno">32 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">33 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">34 </span>	<span class="tok-o">}</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">37 </span>		<span class="tok-k">return</span> <span class="tok-n">head</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">38 </span>	<span class="tok-o">}</span>
<span class="lineno">39 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that a stack of <code>Object</code> references is an example of a
<em>heterogeneous data structure</em>. It is possible to put objects of
different types onto the same stack. While there are situations in which
this technique is useful, in most cases a <em>homogeneous data structure</em>
(where all values are of the same type) is all that is needed.
Homogeneous data structures allow type checking to occur at compile
time, thus helping to avoid run-time errors.</p>
</div>
<div class="paragraph">
<p>Using a stack of <code>Object</code> references is generally more cumbersome, since
you must cast values returned from <code>pop()</code> or <code>top()</code> to the appropriate
data type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-n">ObjectStack</span> <span class="tok-n">stack</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectStack</span><span class="tok-o">();</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-s">&quot;hello&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">String</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span><span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Without the cast to <code>(String)</code>, the compiler gives an error:
<code>Type mismatch: cannot convert from Object to String</code>.</p>
</div>
<div class="paragraph">
<p>Casting the returning value from a heterogeneous data structure
essentially forces type checking to move from compile-time to run-time.
Instead of having the Java compiler verify the type correctness of
operations, we force the Java virtual machine to do the check.</p>
</div>
<div class="sect3">
<h4 id="_generics_in_java">18.5.1. Generics in Java</h4>
<div class="paragraph">
<p>Java provides a general facility to create classes that implement the
same basic ADT but with a different underlying data type. This mechanism
preserves the advantages of compile-time type checking and eliminates
the need for run-time casting. A <em>generic class</em> is a class that gives a
template for creating classes in which a placeholder for the underlying
data type can be filled in when a specific instance of that class is
created. In the case of <a href="#postfixComputationExample">Example 144</a>, we need
a stack that can hold <code>Term</code> objects instead of <code>String</code> objects, and a
generic class allows us to create a stack of any reference type.</p>
</div>
<div class="paragraph">
<p>The generics facility in Java only supports underlying data types that
are reference types (such as <code>String</code> and user-defined types), not
primitive types (such as <code>int</code> or <code>boolean</code>). However, we can use
wrapper classes to hold primitives types. Thus, a generic stack of <code>int</code>
values needs to be implemented as a stack of <code>Integer</code> objects.
Fortunately, Java automatically converts between <code>int</code> and <code>Integer</code> in
most cases.</p>
</div>
<div class="paragraph">
<p>Defining a simple generic class in Java is done by appending a <em>type
parameter</em> within angle brackets (<code>&lt;&gt;</code>) to the end of the class name
being defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">GenericClass</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
    <span class="tok-o">...</span>
    <span class="tok-n">T</span> <span class="tok-nf">transform</span> <span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>
    <span class="tok-o">...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code defines a new generic class (think class template)
<code>GenericClass</code> with underlying type <code>T</code>. It includes a method
<code>transform()</code> that takes a value of type <code>T</code> and transforms it (in some
unspecified way) to another value of type <code>T</code>.</p>
</div>
<div class="paragraph">
<p>To use a generic class properly, you must create instances of it
specifying the underlying type. In actual fact, the compiler fills in
the appropriate type at compile time. The compiler must make sure that
all the operations are valid with the supplied type substituted for the
type parameter (<code>T</code> in this example).</p>
</div>
<div class="paragraph">
<p>For example, to create and use an instance of <code>GenericClass</code> with
underlying type <code>String</code>, you would type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">GenericClass</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">genericString</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">GenericClass</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;();</span>
<span class="tok-n">String</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-n">generic</span><span class="tok-o">.</span><span class="tok-na">transform</span><span class="tok-o">(</span><span class="tok-s">&quot;hello&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because this use of the <code>GenericClass</code> class is defined for underlying
type <code>String</code>, no casting is necessary to assign the result of the
<code>transform()</code> method to the <code>String</code> variable <code>s</code>.</p>
</div>
<div class="paragraph">
<p>To create and use an instance of <code>GenericClass</code> with underlying type
<code>Integer</code>, you would type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">GenericClass</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;</span> <span class="tok-n">genericInteger</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">GenericClass</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;();</span>
<span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">generic</span><span class="tok-o">.</span><span class="tok-na">transform</span><span class="tok-o">(</span><span class="tok-mi">27</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The same definition of <code>GenericClass</code> is used in both instances with
different underlying data types <strong>and</strong> the compiler is able to verify at
compile time that the uses are type safe.</p>
</div>
<div class="paragraph">
<p>If you omit the underlying type when declaring a generic variable or
creating an instance of a generic type, the compiler uses <code>Object</code> as
the underlying type. This use, called a <em>raw type</em>, is essentially like
not using generics at all. There is no compile-time type checking, and
references must be cast as needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">GenericClass</span> <span class="tok-n">genericRaw</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">GenericClass</span><span class="tok-o">();</span> <span class="tok-c1">// raw type</span>
<span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">)</span> <span class="tok-n">genericRaw</span><span class="tok-o">.</span><span class="tok-na">transform</span><span class="tok-o">(</span><span class="tok-mi">27</span><span class="tok-o">);</span> <span class="tok-c1">// cast needed</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next two examples illustrate defining generic classes in Java.</p>
</div>
<div class="exampleblock">
<div class="title">Example 145. Defining a generic linked list</div>
<div class="content">
<div class="paragraph">
<p><a href="#GenericLinkedListProgram">Program 95</a> defines a generic version of the
<code>LinkedList</code> class shown earlier. Note that it is necessary to include
the type parameter <code>T</code> on the outer class as well as the nested class
<code>Node</code>.</p>
</div>
<div id="GenericLinkedListProgram" class="listingblock">
<div class="title">Program 95. Class that implements a generic linked list.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">GenericLinkedList</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">T</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">size</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>    	<span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;();</span>
<span class="lineno">12 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">13 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">14 </span>    	<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">15 </span>    	<span class="tok-n">size</span><span class="tok-o">++;</span>
<span class="lineno">16 </span>    <span class="tok-o">}</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">size</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">19 </span>    	<span class="tok-k">return</span> <span class="tok-n">size</span><span class="tok-o">;</span>
<span class="lineno">20 </span>    <span class="tok-o">}</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">fillArray</span><span class="tok-o">(</span><span class="tok-n">T</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>    	<span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">24 </span>    	<span class="tok-kt">int</span> <span class="tok-n">position</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">25 </span>    	<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">temp</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">26 </span>    		<span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">position</span><span class="tok-o">++]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">27 </span>    		<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">28 </span>    	<span class="tok-o">}</span>
<span class="lineno">29 </span>    <span class="tok-o">}</span>
<span class="lineno">30 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using generics can be very easy, but there are some oddities. In
particular, there are problems instantiating arrays with generic types.
The <code>fillArray()</code> method works because it never creates the array, only
fills it.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_a_generic_class">18.5.2. Using a Generic Class</h4>
<div class="paragraph">
<p>Creating an instance of a generic class is similar to creating an
instance of a regular class, except that (to avoid warnings) you must
specify the missing type (or types) used to parameterize the generic
class. For example, if you want to create an instance of the
<code>GenericClass&lt;T&gt;</code> class, you must specify the type <code>T</code>, for example
<code>new GenericClass&lt;String&gt;()</code>.</p>
</div>
<div class="paragraph">
<p><a href="#UseGenericLinkedListProgram">Program 96</a> uses the generic class
<code>GenericLinkedList</code> parameterized by <code>String</code> to re-implement
<a href="#UseLinkedListProgram">Program 84</a>.</p>
</div>
<div id="UseGenericLinkedListProgram" class="listingblock">
<div class="title">Program 96. Uses the generic class <code>GenericLinkedList</code> to create and use a linked list of Strings.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Arrays</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UseGenericLinkedList</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>        <span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>        <span class="tok-n">GenericLinkedList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">list</span> <span class="tok-o">=</span>
<span class="lineno"> 8 </span>        	<span class="tok-k">new</span> <span class="tok-n">GenericLinkedList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;();</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>        <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>            <span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>		<span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">names</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[</span><span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">getSize</span><span class="tok-o">()];</span>
<span class="lineno">14 </span>		<span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">fillArray</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">);</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>        <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">sort</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">);</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>        <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">names</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
<span class="lineno">19 </span>            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">names</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]);</span>
<span class="lineno">20 </span>    <span class="tok-o">}</span>
<span class="lineno">21 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_java_libraries">18.5.3. Using Java Libraries</h4>
<div class="paragraph">
<p>Many of the Java library classes use generics to make them more general
purpose. The <code>java.util</code> package includes many classes to implement
stacks, queues, dynamic arrays, sets, and other useful data structures.
These classes are parameterized so that they can be created with
different underlying types. We illustrate three examples here: <code>Vector</code>,
<code>ArrayList</code>, and <code>HashMap</code>. Note that there is also a <code>LinkedList</code>
class, which is a great deal more powerful than the <code>LinkedList</code> class
defined in this chapter. Any class that implements the <code>Iterable</code>
interface can be used in the for-each loops described in
<a href="#subsection:The_for-each_loop">Section 6.9.1</a>. The <code>ArrayDeque</code>, <code>ArrayList</code>,
<code>HashSet</code>, <code>TreeSet</code>, and <code>Vector</code>, classes all implement <code>Iterable</code>. In
our examples, a <code>Vector</code> object and a <code>Set</code> (returned by the
<code>entrySet()</code> method of a <code>HashMap</code>) are used as targest of for-each
loops.</p>
</div>
<div class="exampleblock">
<div class="title">Example 146. Vectors</div>
<div class="content">
<div class="paragraph">
<p>A <code>Vector</code> (<code>java.util.Vector</code>) implements an array of objects that can
grow at run time. The array is automatically extended whenever an
attempt is made to store an item exactly one location beyond the last
element. Unlike a linked list, <code>Vector</code> elements can be efficiently
accessed in any order (by specifying the index, just like an ordinary
array). Elements can be inserted into the middle of the <code>Vector</code>,
causing following elements to be pushed back to later indexes. Arbitrary
elements can also be deleted from the <code>Vector</code> using the <code>remove()</code>
method.</p>
</div>
<div class="paragraph">
<p><a href="#VectorExampleProgram">Program 97</a> illustrates a use of the <code>Vector</code>
class. The program creates an empty <code>Vector</code> and generates random
integers between 1 and 10, appending them to the end of the vector,
until their sum is at least 100. Then, it prints the integers and their
sum (including how many were generated).</p>
</div>
<div id="VectorExampleProgram" class="listingblock">
<div class="title">Program 97. Illustrates the use of the Vector class.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Random</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Vector</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">VectorExample</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>		<span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;</span> <span class="tok-n">vector</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Vector</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;();</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>		<span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-k">while</span> <span class="tok-o">(</span><span class="tok-n">sum</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>			<span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">13 </span>			<span class="tok-n">vector</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">);</span>  <span class="tok-c1">// append n to end of vector</span>
<span class="lineno">14 </span>			<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">n</span><span class="tok-o">;</span>
<span class="lineno">15 </span>		<span class="tok-o">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">n</span> <span class="tok-o">:</span> <span class="tok-n">vector</span> <span class="tok-o">)</span>
<span class="lineno">18 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;%3d\n&quot;</span><span class="tok-o">,</span> <span class="tok-n">n</span><span class="tok-o">);</span>
<span class="lineno">19 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;---&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;%3d (%d values)\n&quot;</span><span class="tok-o">,</span> <span class="tok-n">sum</span><span class="tok-o">,</span> <span class="tok-n">vector</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
<span class="lineno">21 </span>	<span class="tok-o">}</span>
<span class="lineno">22 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Output from a typical run of <a href="#VectorExampleProgram">Program 97</a> is shown
below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  9
  9
  8
  7
  7
  4
  7
  6
  8
  7
  9
  4
  9
 10
---
104 (14 values)</pre>
</div>
</div>
</div>
</div>
<div id="mapsExample" class="exampleblock">
<div class="title">Example 147. Maps</div>
<div class="content">
<div class="paragraph">
<p>The <code>HashMap</code>(<code>java.util.HashMap</code>) is a very useful, general-purpose
data structure that maintains a dictionary of entries. A dictionary
associates unique keys with values. You can think of it as <em>mapping</em> a
<em>key</em> to a <em>value</em>. In the Java <code>HashMap</code> class, keys and values can be
arbitrary Java classes.</p>
</div>
<div class="paragraph">
<p><a href="#HashMapExampleProgram">Program 98</a> reads a sequence of lines containing
names and ages (for simplicity, the name is one word and the age is a
simple integer). It stores these (name, age) pairs in a
<code>HashMap&lt;String,Integer&gt;</code> data structure. Once all the input is read
(<code>in.hasNext()</code> returns <code>false</code>), the program prints all the keys
(names), then all the values (ages), and finally it prints the names and
ages of each person in the input file.</p>
</div>
<div id="HashMapExampleProgram" class="listingblock">
<div class="title">Program 98. Illustrates using a <code>HashMap</code> dictionary to store a set of names and ages.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.HashMap</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Map</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HashMapExample</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span><span class="tok-n">Integer</span><span class="tok-o">&gt;</span> <span class="tok-n">map</span> <span class="tok-o">=</span>
<span class="lineno"> 8 </span>			<span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span><span class="tok-n">Integer</span><span class="tok-o">&gt;();</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNext</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>			<span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">();</span>
<span class="lineno">13 </span>			<span class="tok-kt">int</span> <span class="tok-n">age</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno">14 </span>			<span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">age</span><span class="tok-o">);</span>
<span class="lineno">15 </span>		<span class="tok-o">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-s">&quot;Keys\n&quot;</span><span class="tok-o">);</span>
<span class="lineno">18 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">:</span> <span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">keySet</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">19 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">name</span><span class="tok-o">);</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Values&quot;</span><span class="tok-o">);</span>
<span class="lineno">22 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">age</span> <span class="tok-o">:</span> <span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">values</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">23 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">+</span> <span class="tok-n">age</span><span class="tok-o">);</span>
<span class="lineno">24 </span>
<span class="lineno">25 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-n">Map</span><span class="tok-o">.</span><span class="tok-na">Entry</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Integer</span><span class="tok-o">&gt;</span> <span class="tok-n">entry</span> <span class="tok-o">:</span> <span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">entrySet</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">26 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span><span class="tok-n">entry</span><span class="tok-o">.</span><span class="tok-na">getKey</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; -&gt; &quot;</span> <span class="tok-o">+</span>
<span class="lineno">27 </span>							  <span class="tok-n">entry</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">());</span>
<span class="lineno">28 </span>		<span class="tok-o">}</span>
<span class="lineno">29 </span>	<span class="tok-o">}</span>
<span class="lineno">30 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Shown below is the output for a simple input file.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Keys
    kathy
    martha
    fred
    henway
    michael
    henry
    john
    margarette
    edward
    tim
    hamcost
Values
    60
    22
    15
    1
    21
    31
    23
    57
    12
    57
    2
kathy -&gt; 60
martha -&gt; 22
fred -&gt; 15
henway -&gt; 1
michael -&gt; 21
henry -&gt; 31
john -&gt; 23
margarette -&gt; 57
edward -&gt; 12
tim -&gt; 57
hamcost -&gt; 2</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_infix_conversion">18.6. Solution: Infix conversion</h3>
<div class="paragraph">
<p>Here we give our solution to the infix conversion problem from the
beginning of the chapter. As in <a href="#postfixComputationExample">Example 144</a>,
we use a stack of <code>Term</code> objects to solve the problem. However, we
expand the <code>Term</code> class to hold both operands and operators. We only add
methods and fields to the earlier definition, taking nothing away. In
this way, we should be able to use the <code>Term</code> class for both infix to
postfix conversion and postfix calculation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Term</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">3 </span>	<span class="tok-kd">private</span> <span class="tok-kt">char</span> <span class="tok-n">operator</span><span class="tok-o">;</span>
<span class="lineno">4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">isOperator</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have augmented the earlier <code>Term</code> class by adding two more
fields, a <code>char</code> called <code>operator</code> to hold an operator and a <code>boolean</code>
called <code>isOperator</code> to keep track of whether or not our <code>Term</code> object
holds an operator or an operand.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Term</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">value</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">3 </span>		<span class="tok-n">isOperator</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">4 </span>	<span class="tok-o">}</span>
<span class="lineno">5 </span>
<span class="lineno">6 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Term</span><span class="tok-o">(</span> <span class="tok-kt">char</span> <span class="tok-n">operator</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">7 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">operator</span> <span class="tok-o">=</span> <span class="tok-n">operator</span><span class="tok-o">;</span>
<span class="lineno">8 </span>		<span class="tok-n">isOperator</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">9 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We now have two constructors. The first one takes an <code>int</code> value and
stores it into <code>value</code>, setting <code>isOperator</code> to <code>false</code> to indicate that
the <code>Term</code> object must be an operand. The second constructor takes a
<code>char</code> value and stores it into <code>operator</code>, setting <code>isOperator</code> to
<code>true</code> to indicate that the <code>Term</code> object must be an operator (such as
<code>+</code>, <code>-</code>,<code>*</code>, or <code>/</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span>	<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-kt">char</span> <span class="tok-nf">getOperator</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">operator</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">3 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isOperator</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">isOperator</span><span class="tok-o">;</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These three accessors give back the operand value, the operator
character, and whether or not the object is an operator, respectively.
This solution is not necessarily the most elegant from an OOP
perspective. The code that uses a <code>Term</code> object needs to chose the
<code>getValue()</code> method or the <code>getOperator()</code> method depending on whether
the <code>Term</code> is an operator or not. This design opens up the possibility
that some code will call the wrong accessor method and get a useless
default value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">greaterOrEqual</span><span class="tok-o">(</span><span class="tok-n">Term</span> <span class="tok-n">term</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">isOperator</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno"> 3 </span>			<span class="tok-k">switch</span><span class="tok-o">(</span> <span class="tok-n">operator</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;*&#39;</span><span class="tok-o">:</span>
<span class="lineno"> 5 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;/&#39;</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;+&#39;</span><span class="tok-o">:</span>
<span class="lineno"> 7 </span>				<span class="tok-k">case</span> <span class="tok-sc">&#39;-&#39;</span><span class="tok-o">:</span>
<span class="lineno"> 8 </span>				<span class="tok-k">return</span> <span class="tok-o">(</span><span class="tok-n">term</span><span class="tok-o">.</span><span class="tok-na">operator</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;*&#39;</span> <span class="tok-o">&amp;&amp;</span>
<span class="lineno"> 9 </span>						<span class="tok-n">term</span><span class="tok-o">.</span><span class="tok-na">operator</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;/&#39;</span><span class="tok-o">);</span>
<span class="lineno">10 </span>				<span class="tok-k">default</span><span class="tok-o">:</span> <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">11 </span>			<span class="tok-o">}</span>
<span class="lineno">12 </span>		<span class="tok-k">else</span>
<span class="lineno">13 </span>			<span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span>
<span class="lineno">15 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most complicated addition to the <code>Term</code> class is the
<code>greaterOrEqual()</code> method, which takes in another <code>Term</code> object. This
method compares the operator of the <code>Term</code> object being called with the
one that is being passed in as a parameter. Because this method is in
the <code>Term</code> class, it can access the <code>private</code> variables of the <code>term</code>
parameter. This method returns <code>true</code> if the operator of the called
object has a greater or equal precedence compared to the operator of the
parameter object. The meat of the method is the <code>switch</code> statement that
establishes the high precedence of <code>*</code> and <code>/</code>, the medium precedence of
<code>+</code> and <code>-</code>, and the low precedence of anything else, namely the left
parenthesis <code>(</code>.</p>
</div>
<div class="paragraph">
<p>With this updated <code>Term</code> class, we can create <code>Term</code> objects that hold
either an operator or an operand and allow the precedence of operators
to be compared. We use exactly the same <code>TermStack</code> class from
<a href="#postfixComputationExample">Example 144</a> for our stack. All that remains
is the client code that parses the input.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">InfixToPostfix</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">5 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno">6 </span>		<span class="tok-n">String</span> <span class="tok-n">expression</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno">7 </span>		<span class="tok-n">TermStack</span> <span class="tok-n">stack</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TermStack</span><span class="tok-o">(</span><span class="tok-n">expression</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">());</span>
<span class="lineno">8 </span>		<span class="tok-n">String</span> <span class="tok-n">postfix</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="lineno">9 </span>		<span class="tok-kt">char</span> <span class="tok-n">term</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main()</code> method of this class reads in the input expression and
creates a <code>TermStack</code> called <code>stack</code> with a maximum size of the length
of the expression. We also declare a <code>String</code> called <code>postfix</code> to hold
the output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">expression</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>			<span class="tok-n">term</span> <span class="tok-o">=</span> <span class="tok-n">expression</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno"> 3 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">term</span> <span class="tok-o">&gt;=</span> <span class="tok-sc">&#39;0&#39;</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">term</span> <span class="tok-o">&lt;=</span> <span class="tok-sc">&#39;9&#39;</span> <span class="tok-o">)</span>
<span class="lineno"> 4 </span>				<span class="tok-n">postfix</span> <span class="tok-o">+=</span> <span class="tok-n">term</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">term</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;(&#39;</span> <span class="tok-o">)</span>
<span class="lineno"> 6 </span>					<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">Term</span><span class="tok-o">(</span> <span class="tok-n">term</span> <span class="tok-o">));</span>
<span class="lineno"> 7 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">term</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;)&#39;</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>				<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">().</span><span class="tok-na">getOperator</span><span class="tok-o">()</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39;(&#39;</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>					<span class="tok-n">postfix</span> <span class="tok-o">+=</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">().</span><span class="tok-na">getOperator</span><span class="tok-o">();</span>
<span class="lineno">10 </span>					<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
<span class="lineno">11 </span>				<span class="tok-o">}</span>
<span class="lineno">12 </span>				<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span> <span class="tok-c1">//pop off the &#39;(&#39;</span>
<span class="lineno">13 </span>			<span class="tok-o">}</span>
<span class="lineno">14 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">term</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;*&#39;</span> <span class="tok-o">||</span> <span class="tok-n">term</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;/&#39;</span> <span class="tok-o">||</span>
<span class="lineno">15 </span>				 <span class="tok-n">term</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;+&#39;</span> <span class="tok-o">||</span> <span class="tok-n">term</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;-&#39;</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>				<span class="tok-n">Term</span> <span class="tok-n">operator</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Term</span><span class="tok-o">(</span> <span class="tok-n">term</span> <span class="tok-o">);</span>
<span class="lineno">17 </span>				<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">&amp;&amp;</span>
<span class="lineno">18 </span>					<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">().</span><span class="tok-na">greaterOrEqual</span><span class="tok-o">(</span> <span class="tok-n">operator</span> <span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">19 </span>					<span class="tok-n">postfix</span> <span class="tok-o">+=</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">().</span><span class="tok-na">getOperator</span><span class="tok-o">();</span>
<span class="lineno">20 </span>					<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
<span class="lineno">21 </span>				<span class="tok-o">}</span>
<span class="lineno">22 </span>				<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span> <span class="tok-n">operator</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>			<span class="tok-o">}</span>
<span class="lineno">24 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>for</code> loop runs through each <code>char</code> in the input expression and
applies the four rules given in the description of the infix conversion
problem. If a term is an operand, it is added to the output. If a term
is a left parenthesis, it is pushed onto the stack. If a term is a right
parenthesis, all the terms on the stack are popped off and added to the
output until a left parenthesis is reached. If a term is a normal
operator, the top of the stack is repeatedly popped and added to output
as long as it has a precedence greater than or equal to the new
operator. The complexity of doing this precedence comparison is now
tucked away inside of the <code>Term</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>			<span class="tok-n">postfix</span> <span class="tok-o">+=</span> <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">().</span><span class="tok-na">getOperator</span><span class="tok-o">();</span>
<span class="lineno">3 </span>			<span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
<span class="lineno">4 </span>		<span class="tok-o">}</span>
<span class="lineno">5 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">postfix</span><span class="tok-o">);</span>
<span class="lineno">6 </span>	<span class="tok-o">}</span>
<span class="lineno">7 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the input has all been consumed, we pop all the elements off the
stack and add them to the output. Finally, we print the output. The
output to this program could be used as the input to the postfix
evaluator program from <a href="#postfixComputationExample">Example 144</a>. A more
complex program that did both the conversion and the calculation might
want to store everything in <code>Term</code> objects instead of outputting a
<code>String</code> and then recreating <code>Term</code> objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_linked_lists_and_thread_safety">18.7. Concurrency: Linked lists and thread safety</h3>
<div class="paragraph">
<p>The implementations of stacks and queues in the previous sections are
<strong>not</strong> thread-safe. If multiple threads use a stack or queue object
simultaneously, the <code>head</code> or <code>tail</code> pointers can become inconsistent or
be updated incorrectly, potentially causing the stack or queue to lose
elements. As you have seen, multiple threads operating on the same data
can produce unexpected results.</p>
</div>
<div class="paragraph">
<p><a href="#UseLinkedListQueueProgram">Program 99</a> is a simple multi-threaded
program to test (and break!) the thread safety of the queue
implementation in <a href="#LinkedListQueueProgram">Program 93</a>. <a href="#UseLinkedListQueueProgram">Program 99</a>)creates a queue and stores a reference
to it in a static (class) variable <code>queue</code>. It then creates and starts
10 threads. During the adding phase (indicated by <code>adding</code> being
<code>true</code>), each thread adds its thread ID number to the queue and prints
it to standard output. Then, the program joins the threads until each
has finished. The program then ends the adding phase (by setting the
boolean variable <code>adding</code> to <code>false</code>) and starts 10 more threads. These
threads each read one value from the queue and print it to standard
output.</p>
</div>
<div id="UseLinkedListQueueProgram" class="listingblock">
<div class="title">Program 99. Tests the queue implementation, including its thread safety.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UseLinkedListQueue</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">THREADS</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">LinkedListQueue</span> <span class="tok-n">queue</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">LinkedListQueue</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{lineQueueRef}@*/</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-n">adding</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-n">Thread</span><span class="tok-o">[]</span> <span class="tok-n">threads</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Thread</span><span class="tok-o">[</span><span class="tok-n">THREADS</span><span class="tok-o">];</span>
<span class="lineno"> 8 </span>		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">UseLinkedListQueue</span><span class="tok-o">();</span>
<span class="lineno">10 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">start</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{lineStart10a}@*/</span>
<span class="lineno">11 </span>		<span class="tok-o">}</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
<span class="lineno">14 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">join</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-cm">/*@\label{lineJoin}@*/</span>
<span class="lineno">15 </span>			<span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>		<span class="tok-n">adding</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span>		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">UseLinkedListQueue</span><span class="tok-o">();</span>
<span class="lineno">21 </span>			<span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">start</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{lineStart10b}@*/</span>
<span class="lineno">22 </span>		<span class="tok-o">}</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">THREADS</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
<span class="lineno">25 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">threads</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">].</span><span class="tok-na">join</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">26 </span>			<span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">27 </span>
<span class="lineno">28 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">queue</span><span class="tok-o">.</span><span class="tok-na">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">29 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Left in queue: ID = &quot;</span> <span class="tok-o">+</span>
<span class="lineno">30 </span>					<span class="tok-n">queue</span><span class="tok-o">.</span><span class="tok-na">dequeue</span><span class="tok-o">());</span>
<span class="lineno">31 </span>	<span class="tok-o">}</span>
<span class="lineno">32 </span>
<span class="lineno">33 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">34 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">adding</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">35 </span>			<span class="tok-kt">long</span> <span class="tok-n">ID</span> <span class="tok-o">=</span> <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">currentThread</span><span class="tok-o">().</span><span class="tok-na">getId</span><span class="tok-o">();</span>
<span class="lineno">36 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Thread ID added to queue: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">37 </span>					<span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">currentThread</span><span class="tok-o">().</span><span class="tok-na">getId</span><span class="tok-o">());</span>
<span class="lineno">38 </span>			<span class="tok-n">queue</span><span class="tok-o">.</span><span class="tok-na">enqueue</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">.</span><span class="tok-na">valueOf</span><span class="tok-o">(</span><span class="tok-n">ID</span><span class="tok-o">));</span>
<span class="lineno">39 </span>		<span class="tok-o">}</span>
<span class="lineno">40 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">41 </span>			<span class="tok-n">String</span> <span class="tok-n">ID</span> <span class="tok-o">=</span> <span class="tok-n">queue</span><span class="tok-o">.</span><span class="tok-na">dequeue</span><span class="tok-o">();</span>
<span class="lineno">42 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Thread ID removed from queue: &quot;</span>
<span class="lineno">43 </span>					<span class="tok-o">+</span> <span class="tok-n">ID</span><span class="tok-o">);</span>
<span class="lineno">44 </span>		<span class="tok-o">}</span>
<span class="lineno">45 </span>	<span class="tok-o">}</span>
<span class="lineno">46 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Without appropriate synchronization, the program may not correctly link
all values into the queue nor remove them at the end. A typical
error-prone output run is shown here:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Thread ID added to queue: 9
Thread ID added to queue: 14
Thread ID added to queue: 13
Thread ID added to queue: 12
Thread ID added to queue: 11
Thread ID added to queue: 10
Thread ID added to queue: 18
Thread ID added to queue: 17
Thread ID added to queue: 16
Thread ID added to queue: 15
Thread ID removed from queue: 14
Thread ID removed from queue: 11
Thread ID removed from queue: 12
Thread ID removed from queue: 16
Thread ID removed from queue: 17
Thread ID removed from queue: 18
Thread ID removed from queue: 10
Can't dequeue an empty queue!
Can't dequeue an empty queue!
Thread ID removed from queue: 15
Thread ID removed from queue: null
Thread ID removed from queue: null</pre>
</div>
</div>
<div class="paragraph">
<p>How does this implementation fail? Consider the situation in which two
threads are attempting to put a value in the queue simultaneously (see
line <a href="#linePutQueue">[linePutQueue]</a> in <a href="#LinkedListQueueProgram">Program 93</a>). Suppose
the first thread tests the queue and finds it empty (<code>isEmpty()</code> returns
<code>true</code>) but is then interrupted. If a second thread gets control it will
also see that the queue is empty then sets the <code>head</code> and <code>tail</code>
variables to the new <code>Node</code> object <code>temp</code> at line <a href="#lineNewLLN">[lineNewLLN]</a> and
return. The first thread will eventually wake up, still thinking that
the queue is empty, and also set the <code>head</code> and <code>tail</code> variables to its
own new <code>Node</code> <code>temp</code>. But these assignments overwrite the assignments
just done by the previous thread! The initial node that was in the queue
is now lost.</p>
</div>
<div class="paragraph">
<p>This problem can be fixed by ensuring that once one thread starts
examining and modifying queue variables, no other thread can access the
same variables until the first one is finished. As shown in
<a href="#_synchronization">Chapter 14</a>, this mutual exclusion can be
achieved by using the <code>synchronized</code> keyword on methods that need to
have exclusive access to object variables. In this queue implementation,
we need to synchronize access by threads that are using either the
<code>enqueue()</code> or <code>dequeue()</code> methods, since both methods access and
manipulate variables in the object. Although it is not called in this
program, the <code>front()</code> method should also be synchronized so that a
<code>null</code> <code>head</code> is not accessed accidentally. The <code>isEmpty()</code> method does
not need to be synchronized since the only methods that call it that can
do any harm are already synchronized. Outside code that calls
<code>isEmpty()</code> might get the wrong value if another thread modifies the
contents of the queue, but there is no guarantee that other threads will
not modify the state of the queue at any point after the <code>isEmpty()</code>
method is called anyway.</p>
</div>
<div id="LinkedListQueueTSProgram" class="listingblock">
<div class="title">Program 100. Synchronized version of the queue class that allows thread-safe use.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LinkedListQueueTS</span> <span class="tok-kd">implements</span> <span class="tok-n">Queue</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">enqueue</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>		<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">12 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">13 </span>		<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">16 </span>			<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">17 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>			<span class="tok-n">tail</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">19 </span>			<span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">20 </span>		<span class="tok-o">}</span>
<span class="lineno">21 </span>	<span class="tok-o">}</span>
<span class="lineno">22 </span>
<span class="lineno">23 </span>	<span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-n">String</span> <span class="tok-nf">dequeue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">24 </span>		<span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">25 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">26 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Can&#39;t dequeue an empty queue!&quot;</span><span class="tok-o">);</span>
<span class="lineno">27 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">28 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">29 </span>			<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">30 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">head</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span>
<span class="lineno">31 </span>				<span class="tok-n">tail</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">32 </span>		<span class="tok-o">}</span>
<span class="lineno">33 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">34 </span>	<span class="tok-o">}</span>
<span class="lineno">35 </span>
<span class="lineno">36 </span>	<span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-n">String</span> <span class="tok-nf">front</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">37 </span>		<span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">38 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">39 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;No front on an empty queue!&quot;</span><span class="tok-o">);</span>
<span class="lineno">40 </span>		<span class="tok-k">else</span>
<span class="lineno">41 </span>			<span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">;</span>
<span class="lineno">42 </span>		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">43 </span>	<span class="tok-o">}</span>
<span class="lineno">44 </span>
<span class="lineno">45 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isEmpty</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">46 </span>		<span class="tok-k">return</span> <span class="tok-n">head</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">47 </span>	<span class="tok-o">}</span>
<span class="lineno">48 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With both <code>enqueue()</code> and <code>dequeue()</code> methods synchronized as in
<a href="#LinkedListQueueTSProgram">Program 100</a>, a typical output generated by the
program is shown below.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Thread ID added to queue: 9
Thread ID added to queue: 14
Thread ID added to queue: 12
Thread ID added to queue: 13
Thread ID added to queue: 10
Thread ID added to queue: 11
Thread ID added to queue: 18
Thread ID added to queue: 17
Thread ID added to queue: 16
Thread ID added to queue: 15
Thread ID removed from queue: 9
Thread ID removed from queue: 18
Thread ID removed from queue: 13
Thread ID removed from queue: 17
Thread ID removed from queue: 15
Thread ID removed from queue: 16
Thread ID removed from queue: 14
Thread ID removed from queue: 12
Thread ID removed from queue: 10
Thread ID removed from queue: 11</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_thread_safe_libraries">18.8. Concurrency: Thread-safe libraries</h3>
<div class="paragraph">
<p>As we mentioned in <a href="#_concurrency_objects">Section 9.7</a>, some libraries are
thread-safe and some are not. The Java Collections Framework (JCF) is a
very useful library, but it is also a library that requires thread
safety to be at the forefront of your mind.</p>
</div>
<div class="paragraph">
<p>The JCF defines the <code>Collection</code> interface and the <code>Map</code> interface. The
<code>Collection</code> interface, which any collection of objects should
implement, has subinterfaces <code>Set</code>, <code>List</code>, and <code>Queue</code> which define the
basic operations in Java that are needed to implement a set, list, or
queue of items. The <code>Map</code> interface gives the basic operations for a
dictionary, a collection of key-value pairs, one implementation of which
is the <code>HashMap</code> from <a href="#mapsExample">Example 147</a>.</p>
</div>
<div class="paragraph">
<p>As we mentioned in <a href="#_interfaces">Chapter 10</a>, an interface cannot
mark a method with the <code>synchronized</code> keyword. Consequently, the JCF can
make no guarantee about the thread safety of a container based on which
interface it implements. The programmer must read the documentation
carefully in order to know if a container is thread-safe and react
accordingly.</p>
</div>
<div class="exampleblock">
<div class="title">Example 148. ArrayList</div>
<div class="content">
<div class="paragraph">
<p>An <code>ArrayList</code> is like a <code>Vector</code>, with essentially the same interface
but lacks synchronization. That is, if two threads attempt to insert or
remove an element from the same <code>ArrayList</code> at the same time, the
<code>ArrayList</code> internal state may become corrupt or the results may be
incorrect.</p>
</div>
<div class="paragraph">
<p><a href="#ArrayListExampleProgram">Program 101</a> is an example of synchronizing
updates to the <code>ArrayList</code> class with multiple threads. The program
creates an <code>ArrayList</code> and places a reference to it in the static class
variable <code>list</code>. It then creates and starts two threads. Each thread
repeats a loop 10 times, appending a <code>String</code> to the <code>ArrayList</code> on each
iteration. To increase the likelihood of concurrent update attempts, the
thread sleeps for a millisecond on each iteration. To prevent concurrent
updates from actually happening, each thread synchronizes on the common
(shared) class variable <code>list</code> at line <a href="#aleSync">[aleSync]</a>.</p>
</div>
<div id="ArrayListExampleProgram" class="listingblock">
<div class="title">Program 101. Example of thread-safe use of an <code>ArrayList</code>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.ArrayList</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ArrayListExample</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">list</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-n">Thread</span> <span class="tok-n">t1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayListExample</span><span class="tok-o">();</span>
<span class="lineno"> 8 </span>		<span class="tok-n">Thread</span> <span class="tok-n">t2</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayListExample</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>		<span class="tok-n">list</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;();</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>		<span class="tok-n">t1</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">13 </span>		<span class="tok-n">t2</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>			<span class="tok-n">t1</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">17 </span>			<span class="tok-n">t2</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">18 </span>		<span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span>		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">s</span> <span class="tok-o">:</span> <span class="tok-n">list</span><span class="tok-o">)</span>
<span class="lineno">21 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">s</span><span class="tok-o">);</span>
<span class="lineno">22 </span>	<span class="tok-o">}</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">25 </span>		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
<span class="lineno">26 </span>			<span class="tok-kd">synchronized</span> <span class="tok-o">(</span><span class="tok-n">list</span><span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{aleSync}@*/</span>
<span class="lineno">27 </span>				<span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot;: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno">28 </span>			<span class="tok-o">}</span>
<span class="lineno">29 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">Thread</span><span class="tok-o">.</span><span class="tok-na">sleep</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">);</span>	<span class="tok-o">}</span>
<span class="lineno">30 </span>			<span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">InterruptedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>				<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">32 </span>			<span class="tok-o">}</span>
<span class="lineno">33 </span>		<span class="tok-o">}</span>
<span class="lineno">34 </span>	<span class="tok-o">}</span>
<span class="lineno">35 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Without</strong> the <code>synchronized</code> keyword, a typical run, shown below,
includes a <code>null</code> reference in the output, indicating that the internal
<code>ArrayList</code> data structure was not updated correctly.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Thread-1: 0
Thread-0: 0
Thread-1: 1
Thread-0: 1
Thread-1: 2
Thread-0: 2
Thread-0: 3
Thread-1: 3
Thread-1: 4
Thread-0: 4
null
Thread-0: 5
Thread-1: 6
Thread-0: 6
Thread-1: 7
Thread-0: 7
Thread-1: 8
Thread-0: 8
Thread-0: 9
Thread-1: 9</pre>
</div>
</div>
<div class="paragraph">
<p><strong>With</strong> the <code>synchronized</code> keyword, each run includes exactly the same
number of entries from each thread, although the threads do not always
alternate in strict lock-step.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Thread-0: 0
Thread-1: 0
Thread-0: 1
Thread-1: 1
Thread-1: 2
Thread-0: 2
Thread-1: 3
Thread-0: 3
Thread-1: 4
Thread-0: 4
Thread-0: 5
Thread-1: 5
Thread-1: 6
Thread-0: 6
Thread-1: 7
Thread-0: 7
Thread-1: 8
Thread-0: 8
Thread-1: 9
Thread-0: 9</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_18">18.9. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise18.1"></a> Explain the difference between static data structures and dynamic
data structures.</p>
</li>
<li>
<p><a id="exercise18.2"></a> In which situations is it better to use a dynamic array? In which
situations is it better to use a linked list? Explain why in each case.</p>
</li>
<li>
<p><a id="exercise18.3"></a> On which line in
<a href="#ReadIntoFixedArrayProgram">Program 79</a> is an exception generated?</p>
</li>
<li>
<p><a id="exercise18.4"></a> In
<a href="#ReadAndGrowArrayProgram">Program 80</a>, is it possible to post-increment
<code>n</code> inside the <code>try</code> clause rather than at the bottom of the <code>while</code>
loop?</p>
</li>
<li>
<p><a id="exercise18.5"></a> Explain why the <code>names</code> array in
<a href="#UseDynamicArrayProgram">Program 82</a> is, on average, only three-quarters
full.</p>
</li>
<li>
<p><a id="exercise18.6"></a> Based on the stack implementation in
<a href="#LinkedListStackProgram">Program 88</a>, draw a picture of the linked list
structure after each of the following statements.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-n">LinkedListStack</span> <span class="tok-n">stack</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">LinkedListStack</span><span class="tok-o">();</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-s">&quot;hello&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-s">&quot;goodbye&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-s">&quot;there&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-s">&quot;cruel&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">pop</span><span class="tok-o">();</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">push</span><span class="tok-o">(</span><span class="tok-s">&quot;world&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise18.7"></a> Implement the methods <code>top()</code> and
<code>isEmpty()</code> for the dynamic array implementation of the stack in
<a href="#DynamicArrayStackProgram">Program 89</a>.</p>
</li>
<li>
<p><a id="exercise18.8"></a> Based on queue implementation in
<a href="#LinkedListQueueProgram">Program 93</a>, draw a picture of the linked list
structure after each of the following statements.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-n">LinkedListStack</span> <span class="tok-n">queue</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">LinkedListStack</span><span class="tok-o">();</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">enqueue</span><span class="tok-o">(</span><span class="tok-s">&quot;hello&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">enqueue</span><span class="tok-o">(</span><span class="tok-s">&quot;there&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">enqueue</span><span class="tok-o">(</span><span class="tok-s">&quot;world&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">dequeue</span><span class="tok-o">();</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">enqueue</span><span class="tok-o">(</span><span class="tok-s">&quot;cruel&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">dequeue</span><span class="tok-o">();</span>
    <span class="tok-n">stack</span><span class="tok-o">.</span><span class="tok-na">enqueue</span><span class="tok-o">(</span><span class="tok-s">&quot;goodbye&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise18.9"></a> Implement a version of
<code>DynamicArray</code> that shrinks the size of its internal storage array to
half its size when only one quarter of its capacity is being used. This
design can save significant amounts of space if a large number of items
are added to the dynamic array at once and then removed.</p>
</li>
<li>
<p><a id="exercise18.10"></a> Consider <a href="#LinkedListWithTailProgram">Program 85</a> which defines the
<code>LinkedListWithTail</code> class for storing a linked list of <code>String</code> values.
Add a <code>public reverse()</code> method to the class which reverses the order of
the nodes in the linked list. The key idea is make a new linked list
that holds the head of the list. Then, remove the head from the original
linked list. Put the next node <strong>in front</strong> of the head in the new linked
list and remove it from the old. Continue the process until there is
nothing left in the original list. Be sure to reset the <code>head</code> and
<code>tail</code> references correctly after the reversal.</p>
</li>
<li>
<p><a id="exercise18.11"></a> In <a href="#_linked_lists">Section 18.2.2</a>, we use two kinds of linked
lists to store data, but copy all of that data back into an array before
sorting it. We use third linked list class (<code>SortedLinkedList</code>) to
insert data and maintain a sorted order. However, it is possible to add
data in non-sorted order to a linked list and then sort it afterwards.
Add a <code>sort()</code> method to the <code>LinkedListWithTail</code> class that performs a
bubble sort on the nodes inside.</p>
<div class="paragraph">
<p>The algorithm for a bubble sort is described in <a href="#_problem_sort_it_out">Section 10.1</a>. The idea is to make repeated passes through a list, swapping
two adjacent items if they are out of order. You keep making passes over
the list until no adjacent items are out of order. For a this <code>sort()</code>
method, you will need to use the <code>compareTo()</code> method to compare the
<code>String</code> values in the linked list nodes. Also, it may be necessary to
have special cases that update the <code>head</code> and <code>tail</code> pointers if those
nodes are swapped with other nodes. Note that bubble sort is not the
fastest way to sort a linked list. We introduce a faster approach in
<a href="#_recursion">Chapter 19</a>.</p>
</div>
</li>
<li>
<p><a id="exercise18.12"></a> Create JUnit test cases to
verify that the <code>synchronized</code> keywords are needed on the <code>set()</code> and
<code>sort()</code> methods of the <code>DynamicArray</code> example
(<a href="#DynamicArrayProgram">Program 81</a>). To test the <code>set()</code> method, you can
create one thread that repeatedly sets, gets, and tests a changing value
at a fixed location (e.g., 0) and another thread that continuously
appends to the array (causing it to grow by copy and replace, thus
occasionally overwriting the value at the fixed location). To test the
<code>sort()</code> method, create two threads that sort the same large random
array at the same time. Check to see if the array is, in fact, actually
sorted after the threads have exited. For both tests, you may need to
repeat the operations a number of times to trigger the race condition.</p>
</li>
<li>
<p><a id="exercise18.13"></a> To make an infix calculator that can handle floating point values or
even just integers with more than one digit, you need to make a pass
over the input, parsing the sequence of characters into terms. When an
expression is in infix notation, the order of terms is an operand
followed by an operator, repeated over and over, and finishing on an
operand. There are two exceptions: Whenever you are expecting an
operand, you might get a left parenthesis, but, after the parenthesis,
you continue to look for an operand. Whenever you are expecting an
operator, you might get a right parenthesis, but, after that
parenthesis, you continue to look for an operator.</p>
<div class="paragraph">
<p>Using this first pass over input to separate terms as well as the
<code>parseDouble()</code> method from <a href="#parsingANumberExample">Example 80</a> to
compute the equivalent <code>double</code> values of operands, rewrite the solution
from <a href="#_solution_infix_conversion">Section 18.6</a> to convert your terms into
postfix ordering and then calculate the answer.</p>
</div>
</li>
<li>
<p><a id="exercise18.14"></a> Re-implement the solution to the infix conversion problem given in
<a href="#_solution_infix_conversion">Section 18.6</a> so that it uses <code>GenericStack</code>
with a type parameter of <code>Term</code> instead of <code>TermStack</code>.</p>
</li>
<li>
<p><a id="exercise18.15"></a> Interfaces can also be generic. Consider the following generic
version of <code>Queue</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Queue</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
    <span class="tok-kt">void</span> <span class="tok-nf">enqueue</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">value</span><span class="tok-o">);</span>
    <span class="tok-n">T</span> <span class="tok-nf">dequeue</span><span class="tok-o">();</span>
    <span class="tok-n">T</span> <span class="tok-nf">front</span><span class="tok-o">();</span>
    <span class="tok-kt">boolean</span> <span class="tok-nf">isEmpty</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Re-implement <code>LinkedListQueue</code> so that it is generic with type parameter
<code>T</code> and implements interface <code>Queue&lt;T&gt;</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recursion">19. Recursion</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In order to understand recursion, you must first understand recursion.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Anonymous
</div>
</div>
<div class="sect2">
<h3 id="_problem_maze_of_doom">19.1. Problem: Maze of doom</h3>
<div class="paragraph">
<p>The evil mastermind from <a href="#_concurrent_programming">Chapter 13</a> has
returned with a new attempt at world domination. Since he now knows that
you can use concurrency to crack his security code, this time he has
hidden his deadly virus in a secret location protected by a complex maze
of walls and passageways. Fortunately, you&#8217;ve been able to get a copy of
the maze floor plan, but now you must write a program to find a path
through the maze so you can steal the deadly virus before the evil
mastermind releases it on the world.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="chapters/19-recursion/images/maze.svg" alt="maze" width="50%">
</div>
<div class="title">Figure 77. Example of a maze to solve.</div>
</div>
<div class="paragraph">
<p>Finding a path through a maze involves systematically exploring twists
and turns, keeping track of where you&#8217;ve been, backtracking out of dead
ends, and producing a resulting path once you make it through. You
already have the basic tools necessary to solve this problem. You can,
for example, represent the maze with a two-dimensional array of
characters, where a plus ( <code>'+'</code> ) represents a wall and a space ( <code>' '</code> )
represents a passageway. You could create a path through the maze by
replacing a contiguous (vertical and horizontal but not diagonal)
sequence of <code>' '</code> characters by <code>'*'</code> characters, that lead from the
starting square to the final square where the deadly virus is located.</p>
</div>
<div class="paragraph">
<p>The difficulty is dead ends or, worse, loops. How do you keep track of
which paths you&#8217;ve tried that didn&#8217;t work? While you could use
additional data structures to store this additional information,
<em>recursion</em> is a solution technique that makes solving problems like
this one surprisingly straightforward.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_recursive_problem_solving">19.2. Concepts: Recursive problem solving</h3>
<div class="paragraph">
<p>The idea that we use to solve this maze problem is called recursion.
Imagine that you are in a maze and have the choice to go right, left, or
straight. No matter which of the three paths you take, you will probably
be confronted by more choices of going right, left, or straight. You
need to explore them all systematically. The process of systematically
exploring the right path is similar to the process of systematically
exploring the left path. The choice at this moment between left, right,
and straight is in fact part of the same systematic process that you
want to follow when you are in the left, right, or straight branches of
the maze.</p>
</div>
<div class="paragraph">
<p>Solutions that can be described in terms of themselves are recursive.
But what is recursion? How can describing something in terms of itself
be useful? Since recursion sounds circular, how can it be applied to
problem solving in Java? How does the computer keep track of these
self-references? The following subsections address precisely these
questions.</p>
</div>
<div class="sect3">
<h4 id="subsection:What_is_recursion">19.2.1. What is recursion?</h4>
<div class="paragraph">
<p>In the context of computer science and mathematics, recursion means
describing some repetitive process in terms of itself. Many complex
things can be described elegantly using recursion.</p>
</div>
<div class="paragraph">
<p>Consider the question, &#8220;How old are you now?&#8221; If you were 27, you
could answer, &#8220;I am one year older than I was last year.&#8221; If then
asked, &#8220;Well, how old were you last year?&#8221; Again, you could answer,
&#8220;I was one year older than I was the year before.&#8221; Assuming that the
person who wanted to wanted to know your age was very patient, you could
repeat this answer over and over, explaining that each year you have
been one year older than the previous year. However, after asking you 27
times about your age on the previous year, you would run out of years of
life and be forced to answer, &#8220;Zero years old.&#8221;</p>
</div>
<div class="paragraph">
<p>This absurd dialog shows an important feature of useful recursive
definitions: They have at least one <em>base case</em> and at least one
<em>recursive case</em>. The base case is the part of the definition that is
not described in terms of itself. It is a concrete answer. Without the
base case, the process would never end, and the definition would be
meaningless. The recursive case is the part of the definition that is
defined in terms of itself. Without the recursive case, the definition
could only describe a finite set of things.</p>
</div>
<div class="paragraph">
<p>In the example above, the base case is the age of zero years old. You
have no age before that. The recursive case is any age greater than zero
years old. We can use mathematical notation to describe your age in a
given year. Here \(age(year)\) is a function that gives the
age you were during year \(year\).</p>
</div>
<div class="paragraph">
<p>\(age(year) =
\begin{cases} 0 &amp; \text{if you were born in $year$} &amp; \text{(Base Case)}
\\
  1 + age(year-1) &amp; \text{if you were born before $year$} &amp; \text{(Recursive Case)}
\end{cases}\)</p>
</div>
<div class="paragraph">
<p>To be meaningful, recursive cases should be defined in terms of simpler
or smaller values. In English, it is equally correct to say that you are
now a year younger than you&#8217;ll be next year. Unfortunately, the age that
you&#8217;ll be next year is not any closer to a base case, making that
recursion useless.</p>
</div>
<div id="recursiveTreeFigure" class="imageblock">
<div class="content">
<img src="chapters/19-recursion/images/trees.svg" alt="trees" width="100%">
</div>
<div class="title">Figure 78. Recursive refinement generating a tree-like image.</div>
</div>
<div class="paragraph">
<p>A recursive definition of your age suggests that recursion is all around
us. It takes some work to write it down in formal notation, but
self-similarity is a constant theme in art and nature. The branching of
a trunk of a tree is similar to the branching of its limbs, which is
similar to the branching of its branches, which in turn is similar to
the branching of its twigs. In fact, we borrow the idea of the branching
of a tree to define a recursive data structure in
<a href="#_syntax_recursive_data_structures">Section 19.4</a>. <a href="#recursiveTreeFigure">Figure 78</a>
starts with a simple Y-shaped branching. By successively replacing the
branches with the previous shape, a tree is generated recursively.
<em>Fractals</em> are images generated by similar recursive techniques.
Although many real trees exhibit recursive tendencies, they do not
follow rules consistently or rigidly.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recursive_definitions">19.2.2. Recursive definitions</h4>
<div class="paragraph">
<p>Although recursion has many fascinating applications, certain forms of
recursion are more useful for solving problems. As with many aspects of
programming, there is a strong connection to mathematical principles.</p>
</div>
<div class="paragraph">
<p>In mathematics, a <em>recursive definition</em> is one that is defined in terms
of itself. It is common to define functions and sequences (and also
sets) recursively. Functions (such as \(f(n)\)) are usually
defined in relation to the same function with a smaller input (such as
\(f(n - 1)\)). Sequences (such as \(s_n\)) are
usually defined in relation to earlier elements in the sequence (such as
\(s_{n - 1}\)).</p>
</div>
<div id="multiplicationDefinedRecursivelyExample" class="exampleblock">
<div class="title">Example 149. Multiplication defined recursively</div>
<div class="content">
<div class="paragraph">
<p>Even very common functions can be defined recursively. Consider the
multiplication \(x \times y\). This multiplication means
repeatedly adding the \(x\) a total of \(y\) times.
If \(y\) is a positive integer, we can describe this
multiplication with the following recursive definition. Note the base
case and recursive case.</p>
</div>
<div class="paragraph">
<p>\(x \times y =
\begin{cases} x &amp; \text{if  $y = 1$} &amp; \text{(Base Case)}
\\
x + \left(x \times (y - 1)\right) &amp; \text{if $y &gt; 1$} &amp; \text{(Recursive Case)}
\end{cases}\)</p>
</div>
<div class="paragraph">
<p>Multiplication seems like such a basic operation that there would be no
need to have such a definition. Yet mathematicians often use multiple
equivalent definitions to prove results. Furthermore, this elementary
definition provides intuition for creating more complex definitions.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise19.1">Exercise 19.1</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 150. Factorial defined recursively</div>
<div class="content">
<div class="paragraph">
<p>Another mathematical function with a natural recursive definition is the
factorial function, often written \(n!\). The factorial
function is used heavily in probability and counting. The value of
\(n! = n
\cdot(n - 1)\cdot(n - 2) \ldots 3 \cdot 2 \cdot 1\). Mathematicians
like recursive definitions because they are able to describe functions
and sequences precisely without using ellipses (\(\ldots\)).</p>
</div>
<div class="paragraph">
<p>\(n! =
\begin{cases} 1 &amp; \text{if  $n = 0$} &amp; \text{(Base Case)}
\\
n \cdot (n-1)! &amp; \text{if $n&gt;0$} &amp; \text{(Recursive Case)}
\end{cases}\)</p>
</div>
<div class="paragraph">
<p>Note that the base case gives \(1\) as the answer when
\(n = 0\). By convention \(0! = 1\). Thus, this
definition correctly gives \(0! = 1\),
\(1! = 1\cdot 0!
= 1\), \(2! = 2\cdot 1! = 2\),
\(3! = 3\cdot 2! = 6\), and so on.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 151. Fibonacci defined recursively</div>
<div class="content">
<div class="paragraph">
<p>The Fibonacci sequence is an infinite sequence of integers starting with
1, 1, 2, 3, 5, 8, 13, 21, \(\ldots\). Each term after the two
initial 1s is the sum of the previous two terms in the sequence.
Fibonacci has many interesting properties and crops up in surprisingly
diverse areas of mathematics. It was originally used to model the growth
of rabbit populations.</p>
</div>
<div class="paragraph">
<p>The Fibonacci sequence also has a natural recursive mathematical
definition. Indeed, you may have noticed that we described each term as
the sum of the two previous terms. We can formally define the
\(n\)<sup>th</sup> Fibonacci number \(F_n\) as follows,
starting with \(n=0\). \(F_n=
\begin{cases} 1 &amp; \text{if  $n=0$ or  $n = 1$} &amp; \text{(Base
Cases)}
\\
F_{n-1}+F_{n-2} &amp; \text{if $n&gt;1$} &amp; \text{(Recursive Case)}
\end{cases}\)</p>
</div>
<div class="paragraph">
<p>Since the \(F_n\) depends on the two previous terms, it is
necessary to have two base cases. The Fibonacci sequence is a special
kind of Lucas sequence. Other Lucas sequences specify different values
for the two base cases (and sometimes coefficients to multiply the
previous terms by).</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_iteration_vs_recursion">19.2.3. Iteration vs. recursion</h4>
<div class="paragraph">
<p>These mathematical definitions are interesting, but what is their
relationship to Java code? So far, we have considered algorithms that
are iterative in nature: processing is performed as a sequence of
operations on elements of a sequential data structure. We sum the
elements of an array by iterating through them from first to last. We
multiply two matrices by using nested <code>for</code> loops to sequence through
the matrix contents in the proper order. Similarly, one method may make
a sequence of one or more calls to other methods. We&#8217;re confident that
such computations terminate because we start at the beginning and work
to the end of a finite structure. But what if the structure is not a
simple linear or multidimensional array? The path we&#8217;re trying to find
through the maze is of unknown length and may not take a &#8220;straight
line&#8221; through the array.</p>
</div>
<div class="paragraph">
<p>A method may call other methods to complete its operation. For example,
a method that sorts a list of <code>String</code> values calls another method to do
pairwise comparison of the values in the list. A method that calls
<strong>itself</strong>, either directly or indirectly, is called a <em>recursive</em> method.</p>
</div>
<div class="paragraph">
<p>A recursive method may seem like a circular argument that never ends. In
fact, a recursive method only calls itself under certain circumstances.
Other times, it does not. A recursive method has the same two parts that
a mathematical recursive definition has.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Base case</dt>
<dd>
<p>The operation being computed is done without any recursive calls.</p>
</dd>
<dt class="hdlist1">Recursive case</dt>
<dd>
<p>The operation is broken down into smaller pieces, one or more of which
results in a recursive call to the method itself.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Each time a method calls itself recursively, it does so on a smaller
problem. Eventually it reaches a base case, and the recursion
terminates.</p>
</div>
<div class="paragraph">
<p>A recursive method is useful when a problem can be broken down into
smaller subproblems where each subproblem has the same structure as the
original, complete problem. These subproblems can be solved by recursive
calls and the results of those calls assembled to create a larger
solution.</p>
</div>
<div class="paragraph">
<p>Recursive methods are often surprisingly small given their complexity.
Each recursive call only makes a single step forward in the process of
solving the problem. In fact, it can appear that the problem is never
solved. The code has something like a &#8220;leap of faith&#8221; inside of it.
Assuming that you can solve a smaller subproblem, how do you put the
solutions together to solve the full problem? This assumption is the
leap of faith, but it works out as long as the subproblems get broken
down into smaller and smaller pieces that eventually reach a base case.</p>
</div>
<div class="paragraph">
<p>From a theoretical standpoint, any problem that can be solved
iteratively can be solved recursively, and vice versa. Iteration and
recursion are equivalent in computational power. Sometimes it is more
efficient or more elegant to use one approach or the other, and some
languages are designed to work better with a given approach.</p>
</div>
</div>
<div class="sect3">
<h4 id="_call_stack">19.2.4. Call stack</h4>
<div class="paragraph">
<p>Many programmers who are new to recursion feel uncomfortable about the
syntax. How can a method call itself? What does that even mean?</p>
</div>
<div class="paragraph">
<p>Recursion in Java is grounded in the idea of a call stack. We discuss
the stack abstract data type in <a href="#_dynamic_data_structures">Chapter 18</a>. A similar structure is used to control the flow of control
of a program as it calls methods.</p>
</div>
<div class="paragraph">
<p>Recall that a stack is a first in, last out (FILO) data structure. Each
time a method is called, its local variables are put on the call stack.
As the method executes, a pointer to the current operation it is
executing is kept on the call stack as well. This collection of local
variables and execution details for a method call is called the <em>stack
frame</em> or <em>activation record</em>. When another method is called, it pushes
its own stack frame onto the call stack as well, and its caller
remembers what it was executing before the call. When a method returns,
it pops its stack frame (the variables and state associated with its
execution) off the call stack.</p>
</div>
<div class="paragraph">
<p>A recursive method is called in exactly the same way. It puts another
copy of its stack frame on the call stack. Each call of the method has
its own stack frame and operates independently. There is no way to
access the variables from one call to the next, other than by passing in
parameters or returning values.</p>
</div>
<div class="paragraph">
<p><a href="#figure-recursive_calls">Figure 79</a> shows the stack frames being pushed
onto the call stack as the <code>main()</code> method calls the <code>factorial()</code>
method, starting with the argument <code>4</code>. The <code>factorial()</code> method
recursively calls itself with successively smaller values.</p>
</div>
<div id="figure-recursive_calls" class="imageblock">
<div class="content">
<img src="chapters/19-recursion/images/recursivecalls.svg" alt="recursivecalls" width="100%">
</div>
<div class="title">Figure 79. Successive recursive method calls getting added to the call stack.</div>
</div>
<div class="paragraph">
<p><a href="#figure-recursive_returns">Figure 80</a> shows the stack frames popping off
the call stack as each call to <code>factorial()</code> returns. As the answers are
returned, they are incorporated into the answer that is generated and
returned to the next caller in the sequence until the final answer <code>24</code>
(\(4!\)) is returned to <code>main()</code>.</p>
</div>
<div id="figure-recursive_returns" class="imageblock">
<div class="content">
<img src="chapters/19-recursion/images/recursivereturns.svg" alt="recursivereturns" width="100%">
</div>
<div class="title">Figure 80. Recursive methods returning results to their callers.</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_recursive_methods">19.3. Syntax: Recursive methods</h3>
<div class="paragraph">
<p>Unlike many <strong>Syntax</strong> sections in other chapters, there is no new Java
syntax to introduce here. Any method that calls itself, directly or
indirectly, is a recursive method. Recursive methods are simply methods
like any others, called in the normal way.</p>
</div>
<div class="paragraph">
<p>The real difficulty in learning to program recursively lies in breaking
out of the way you are used to thinking about program control flow. All
that you have learned about solving problems with iteration in previous
chapters may make it harder for you to embrace recursion.</p>
</div>
<div class="paragraph">
<p>Iteration views the whole problem at once and tries to sequence all the
pieces of the solution in some organized way. Recursion is only
concerned with the current step in the solution. If the current step is
one in which the answer is clear, you&#8217;re in a base case. Otherwise, the
solution takes one step toward the answer and then makes the leap of
faith, allowing the recursion to take care of the rest. Programmers who
are new to recursion are often tempted to do too much in each recursive
call. Don&#8217;t rush it!</p>
</div>
<div class="paragraph">
<p>The use of recursion in languages like Java owes much to the development
of <em>functional programming</em>. In many functional languages (such as
Scheme), there are no loops, and <strong>only</strong> recursion is allowed. In a
number of these languages, there is no assignment either. Each variable
has one value for its entire lifetime, and that value comes as a
parameter from whatever method called the current method.</p>
</div>
<div class="paragraph">
<p>It may seem odd to you, but this approach is a good one to follow when
writing recursive methods. Try <strong>not</strong> to assign variables inside your
methods. See if the work done in each method can be passed on as an
argument to the next method rather than changing the state inside the
current method. In that way, each recursive method is a frozen snapshot
of some part of the process of solving the problem. Of course, this
guideline is only a suggestion. Many practical recursive methods need to
assign variables internally, but a surprisingly large number do not.</p>
</div>
<div class="paragraph">
<p>Because the data inside these methods is tied so closely to the input
parameters and the return values given back to the caller, these methods
are often made <code>static</code>. Ideally, recursive methods do not change the
state of fields or class variables. Again, sometimes changing external
state is necessary, but recursive methods are meant to take in only
their input parameters and give back only return values. Recursive code
that reads and writes variables inside of objects or classes can be
difficult to understand and debug, since it depends on outside data.</p>
</div>
<div class="paragraph">
<p>With this information as background, we focus on examples for the rest
of this section. Because recursion is a new way of thinking, approach
these examples with an open mind. Many students have the experience that
recursion makes no sense until they see the right example. Then, the way
it works suddenly &#8220;clicks.&#8221; Do not be discouraged if recursion seems
difficult at first.</p>
</div>
<div class="paragraph">
<p>In this section, we work through examples of factorial computation,
Fibonacci numbers, the classic Tower of Hanoi problem, exponentiation.
These problems are mathematical in nature because the mathematical
recursion is easy to model in code. The next section applies recursion
to processing data structures.</p>
</div>
<div class="exampleblock">
<div class="title">Example 152. Factorial implemented recursively</div>
<div class="content">
<div class="paragraph">
<p>In our first example of a recursive implementation, we return to the
factorial function. Recall the recursive definition that describes the
function.</p>
</div>
<div class="paragraph">
<p>\(n! =
\begin{cases} 1 &amp; \text{if $n = 0$} &amp; \text{(Base Case)}
\\
n \cdot (n-1)! &amp; \text{if $n&gt;0$} &amp; \text{(Recursive Case)}
\end{cases}\)</p>
</div>
<div class="paragraph">
<p>By translating this mathematical definition almost directly into Java,
we can generate a method that computes the factorial function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">long</span> <span class="tok-nf">factorial</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">n</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span>     <span class="tok-c1">//base case</span>
            <span class="tok-k">return</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
        <span class="tok-k">else</span>            <span class="tok-c1">//recursive case</span>
            <span class="tok-k">return</span> <span class="tok-n">n</span> <span class="tok-o">*</span> <span class="tok-n">factorial</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">);</span>
    <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the base case and recursive case are exactly the same as in the
recursive definition. The return type of the method is <code>long</code> because
factorial grows so quickly that only the first few values are small
enough to fit inside of an <code>int</code>.</p>
</div>
</div>
</div>
<div id="fibonacciImplementedRecursivelyExample" class="exampleblock">
<div class="title">Example 153. Fibonacci implemented recursively</div>
<div class="content">
<div class="paragraph">
<p>Let us return to the recursive definition of Fibonacci.</p>
</div>
<div class="paragraph">
<p>\(F_n=
\begin{cases} 1 &amp; \text{if  $n=0$ or $n = 1$} &amp; \text{(Base
Cases)}
\\
F_{n-1}+F_{n-2} &amp; \text{if  $n&gt;1$} &amp; \text{(Recursive Case)}
\end{cases}\)</p>
</div>
<div class="paragraph">
<p>Like factorial, this definition translates naturally into a recursive
method in Java.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">fibonacci</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">n</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">||</span> <span class="tok-n">n</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>  <span class="tok-c1">//base cases</span>
        <span class="tok-k">return</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
    <span class="tok-k">else</span>                    <span class="tok-c1">//recursive case</span>
        <span class="tok-k">return</span> <span class="tok-n">fibonacci</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-n">fibonacci</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One significant problem with this example is performance. In this case,
the double recursion performs a great deal of redundant computation.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise19.3">Exercise 19.3</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>One technique for eliminating redundant computation in recursion is
called <em>memoization</em>. Whenever the value for a subproblem is computed,
we note down the result (like a memo). When we go to compute a value, we
first check to see if we have already found it.</p>
</div>
<div class="paragraph">
<p>To perform memoization for Fibonacci, we can pass an array of <code>int</code>
values of length <code>n + 1</code>. The values in this array all begin with a
value of <code>0</code>. When computing the Fibonacci value for a particular <code>n</code>,
we first check to see if its value is in the array. If not, we perform
the recursion and store the result in the array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">fibonacci</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">results</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">results</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">n</span> <span class="tok-o">==</span> <span class="tok-mi">0</span> <span class="tok-o">||</span> <span class="tok-n">n</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>
            <span class="tok-n">results</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
        <span class="tok-k">else</span>
            <span class="tok-n">results</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">fibonacci</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-n">fibonacci</span><span class="tok-o">(</span><span class="tok-n">n</span><span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">return</span> <span class="tok-n">results</span><span class="tok-o">[</span><span class="tok-n">n</span><span class="tok-o">];</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This change makes the computation of the \(n\)<sup>th</sup> Fibonacci
number much more efficient; however, even more efficient approaches are
described in the exercises.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise19.6">Exercise 19.6</a><br>
<a href="#exercise19.8">Exercise 19.8</a></p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 154. Tower of Hanoi</div>
<div class="content">
<div class="paragraph">
<p>The famous Tower of Hanoi puzzle is another example commonly used to
illustrate recursion. In this puzzle, there are three poles containing a
number of different sized disks. The puzzle begins with all disks
arranged in a tower on one pole in decreasing size, with the smallest
diameter disk on top and the largest on the bottom.
<a href="#figure-hanoi">Figure 81</a> shows an example of the puzzle. The goal is to
move all the disks from the initial pole to the final pole, with two
restrictions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>only one disk can be moved at a time</p>
</li>
<li>
<p>a larger disk can never be placed on top of a smaller disk</p>
</li>
</ol>
</div>
<div id="figure-hanoi" class="imageblock">
<div class="content">
<img src="chapters/19-recursion/images/hanoi.svg" alt="hanoi" width="100%">
</div>
<div class="title">Figure 81. Tower of Hanoi puzzle with 4 disks on the initial pole.</div>
</div>
<div class="paragraph">
<p>The extra pole is used as a holder for intermediate moves. The idea
behind the recursive solution follows.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Base Case</dt>
<dd>
<p>Moving one disk is easy. Just move it from the pole it&#8217;s on to the
destination pole.</p>
</dd>
<dt class="hdlist1">Recursive Case</dt>
<dd>
<p>In order to move \(n &gt; 1\) disks from one pole to another,
we can move \(n - 1\) disks to an intermediate pole, move
the \(n\)<sup>th</sup> disk to the destination pole, then move the
\(n - 1\) disks from the intermediate pole to the
destination pole.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Tower of Hanoi solution in Java translates this outline into code.</p>
</div>
<div id="TowerOfHanoiProgram" class="listingblock">
<div class="title">Program 102. Recursive solution to the Tower of Hanoi with four disks and poles named <code>'A'</code>, <code>'B'</code>, and <code>'C'</code>.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TowerOfHanoi</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-n">move</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">,</span> <span class="tok-sc">&#39;A&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;C&#39;</span><span class="tok-o">,</span> <span class="tok-sc">&#39;B&#39;</span><span class="tok-o">);</span>
<span class="lineno"> 4 </span>    <span class="tok-o">}</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">move</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-o">,</span> <span class="tok-kt">char</span> <span class="tok-n">fromPole</span><span class="tok-o">,</span> <span class="tok-kt">char</span> <span class="tok-n">toPole</span><span class="tok-o">,</span>
<span class="lineno"> 7 </span>    	<span class="tok-kt">char</span> <span class="tok-n">viaPole</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">n</span> <span class="tok-o">==</span> <span class="tok-mi">1</span><span class="tok-o">)</span>
<span class="lineno"> 9 </span>            <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">format</span><span class="tok-o">(</span>
<span class="lineno">10 </span>            	<span class="tok-s">&quot;Move disk from pole %c to pole %c.\n&quot;</span><span class="tok-o">,</span>
<span class="lineno">11 </span>            	<span class="tok-n">fromPole</span><span class="tok-o">,</span> <span class="tok-n">toPole</span><span class="tok-o">);</span>
<span class="lineno">12 </span>        <span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>            <span class="tok-n">move</span><span class="tok-o">(</span><span class="tok-n">n</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">fromPole</span><span class="tok-o">,</span> <span class="tok-n">viaPole</span><span class="tok-o">,</span> <span class="tok-n">toPole</span><span class="tok-o">);</span>
<span class="lineno">14 </span>            <span class="tok-n">move</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">fromPole</span><span class="tok-o">,</span> <span class="tok-n">toPole</span><span class="tok-o">,</span> <span class="tok-n">viaPole</span><span class="tok-o">);</span>
<span class="lineno">15 </span>            <span class="tok-n">move</span><span class="tok-o">(</span><span class="tok-n">n</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">viaPole</span><span class="tok-o">,</span> <span class="tok-n">toPole</span><span class="tok-o">,</span> <span class="tok-n">fromPole</span><span class="tok-o">);</span>
<span class="lineno">16 </span>        <span class="tok-o">}</span>
<span class="lineno">17 </span>    <span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A legend tells of monks that are solving the Tower of Hanoi puzzle with
64 disks. The legend predicts that the world will end when they finish.
Run the implementation above with different numbers of disks to see how
long the sequence of moves is. Try small numbers of disks, since large
numbers of disks takes a very long time.</p>
</div>
</div>
</div>
<div id="exponentiationExample" class="exampleblock">
<div class="title">Example 155. Exponentiation</div>
<div class="content">
<div class="paragraph">
<p>Both Fibonacci and the Tower of Hanoi have natural recursive structures.
In the case of Fibonacci, one way to implement its natural recursive
definition results in very wasteful computation. In the case of the
Tower of Hanoi, the <strong>only</strong> way to solve the problem takes an
excruciatingly long amount of time.</p>
</div>
<div class="paragraph">
<p>However, we can apply recursion to many practical problems and get
efficient solutions. Consider the problem of exponentiation, which looks
trivial: Given a rational number \(a\) and a positive integer
\(n\), find the value of \(a^n\).</p>
</div>
<div class="paragraph">
<p>It&#8217;s tempting to call <code>Math.pow(a, n)</code> or to use a short <code>for</code> loop to
compute this value, but what if neither tool existed in Java? A simple
recursive formulation can describe exponentiation.</p>
</div>
<div class="paragraph">
<p>\(a^n =
\begin{cases} a &amp; \text{if $n=1$} &amp; \text{(Base case)}
\\
a \cdot a^{n - 1} &amp; \text{if $n&gt;1$} &amp; \text{(Recursive case)}
\end{cases}\)</p>
</div>
<div class="paragraph">
<p>As with factorial and Fibonacci, directly converting the recursive
definition into Java syntax yields a method that computes the correct
value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span> <span class="tok-nf">power</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">n</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>    <span class="tok-c1">//base case</span>
        <span class="tok-k">return</span> <span class="tok-n">a</span><span class="tok-o">;</span>
    <span class="tok-k">else</span>            <span class="tok-c1">//recursive case</span>
        <span class="tok-k">return</span> <span class="tok-n">a</span><span class="tok-o">*</span><span class="tok-n">power</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">n</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Admittedly, this method only works for positive integer values of
\(n\). Ignoring that limitation, what can we say about its
efficiency? For any legal value of \(n\), the method is called
\(n\) times. If \(n\) has a small value, like 2 or
3, the process is quick. But if \(n\) is 1,000,000 or so, the
method might take a while to finish. Another problem is that stack size
is limited. On most systems, the JVM crashes with a <code>StackOverflowError</code>
if a method tries to call itself recursively a 1,000,000 times.</p>
</div>
<div class="paragraph">
<p>If we limit \(n\) to a power of 2, we can do something clever
that makes the method much more efficient with many fewer recursive
calls. Consider this alternative recursion definition of exponentiation.</p>
</div>
<div class="paragraph">
<p>\(a^n =
\begin{cases} a &amp; \text{if  $n=1$} &amp; \text{(Base Case)}
\\
\left(a^{\frac{n}{2}}\right)^2 &amp; \text{if  $n&gt;1$} &amp; \text{(Base Case)}
\end{cases}\)</p>
</div>
<div class="paragraph">
<p>Recalling basic rules of exponents,
\(a^n = \left(a^{\frac{n}{2}}\right)^2\), but what does that
buy us? If we structure our method correctly, we cut the size of
\(n\) in half at each recursive step instead of only reducing
\(n\) by 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">double</span> <span class="tok-nf">power</span><span class="tok-o">(</span><span class="tok-kt">double</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">n</span> <span class="tok-o">==</span> <span class="tok-mi">1</span> <span class="tok-o">)</span>    <span class="tok-c1">//base case</span>
        <span class="tok-k">return</span> <span class="tok-n">a</span><span class="tok-o">;</span>
    <span class="tok-k">else</span> <span class="tok-o">{</span>          <span class="tok-c1">//recursive case</span>
        <span class="tok-kt">double</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">power</span><span class="tok-o">(</span><span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">n</span><span class="tok-o">/</span><span class="tok-mi">2</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">temp</span><span class="tok-o">*</span><span class="tok-n">temp</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we only make the recursive call once and save it in <code>temp</code>. If
we made two recursive calls, we would no longer be more efficient than
the previous method. That version took \(n\) recursive calls.
How efficient is this version? The answer is the number of times you
have to cut \(n\) in half before you get 1. Let&#8217;s call that
value \(x\). Recall that \(n\) is a power of 2,
meaning that \(n = 2^k\) for some integer
\(k \geq 0\).</p>
</div>
<div class="paragraph">
<p>\(\begin{aligned}
\left(\frac{1}{2}\right)^x \cdot n &amp;= 1\\
2^x\left(\frac{1}{2}\right)^x \cdot n &amp;= 2^x\\
n &amp;= 2^x\\
2^k &amp;= 2^x\\
k &amp;= x\\
\log_2 n &amp;= x\\\end{aligned}\)</p>
</div>
<div class="paragraph">
<p>In other words, the number of times you have to divide \(n\)
in half to get 1 is the logarithm base 2 of \(n\), written
\(\log_2 n\). The logarithm function is the inverse of
exponentiation. It cuts any number down to size very quickly (just as
exponentiation blows up the value of a number very quickly). For
example, \(2^{20} = 1,048,576\). Thus,
\(\log_2 1,048,576 = 20\). The original version of <code>power()</code>
would have to make 1,048,576 calls to raise a number to that power. This
second version would only have to make 20 calls.</p>
</div>
<div class="paragraph">
<p>It is critical that \(n\) is a power of 2 (1, 2, 4, 8, …),
otherwise the process of repeatedly cutting \(n\) in half
loses some data due to integer division. The problem is that, at some
point in the recursion, the value of \(n\) is odd unless you
start with a power of 2. There is a way to extend this clever approach
to all values of \(n\), even and odd, but we leave it as an
exercise.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise19.7">Exercise 19.7</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Recursion offers elegant ways to compute mathematical functions like
those we have explored in this section. Recursion also offers powerful
ways to manipulate data structures. As we show in the next section,
recursive methods are especially well suited to use with recursive data
structures.</p>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_recursive_data_structures">19.4. Syntax: Recursive data structures</h3>
<div class="paragraph">
<p>Because recursion can be used to do anything that iteration can do, it
is clear that data structures can be processed recursively. For example,
the following recursive method reverses the contents of an array. It
keeps track of the position in the array it is swapping with the
<code>position</code> parameter. This method is initially called with a value of
<code>0</code> passed as an argument for <code>position</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">reverse</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">position</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">position</span> <span class="tok-o">&lt;</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">/</span><span class="tok-mi">2</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kt">int</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">position</span><span class="tok-o">];</span>
        <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">position</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-n">position</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">];</span>
        <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-n">position</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
        <span class="tok-n">reverse</span><span class="tok-o">(</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">position</span> <span class="tok-o">+</span> <span class="tok-mi">1</span> <span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that nothing is done in the base case for this recursive method.
The recursion swaps the first element of the array (at index <code>0</code>) with
the last (at index <code>array.length - 1</code>). Recursion continues until
<code>position</code> has reached half the length of <code>array</code>. If execution
continued past the halfway point, it would begin to swap elements that
had already been swapped.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise19.5">Exercise 19.5</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Although it is possible to reverse an array recursively, there is
usually no advantage in doing so. We introduced bubble sort and selection
sort in previous chapters, but neither of these algorithms is very fast.
Many of the best sorting algorithms are recursive, as in the following
example of merge sort.</p>
</div>
<div id="mergeSortExample" class="exampleblock">
<div class="title">Example 156. Merge sort</div>
<div class="content">
<div class="paragraph">
<p>Merge sort is an efficient sorting algorithm that is usually implemented
recursively. The idea of the sort is to break a list of items in half
and recursively merge sort each half. Then, these two sorted halves are
merged back together into the final sorted list. The base case of the
recursion is when there&#8217;s only a single item in the list, since a list
with only one thing in it is, by definition, sorted.</p>
</div>
<div class="paragraph">
<p>Here is a method that recursively sorts an <code>int</code> array using the merge
sort algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">mergeSort</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">&gt;</span> <span class="tok-mi">1</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">a</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">/</span> <span class="tok-mi">2</span><span class="tok-o">];</span>
        <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">b</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">-</span> <span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">];</span>
        <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-o">++</span><span class="tok-n">i</span> <span class="tok-o">)</span>
            <span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">];</span>
        <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-o">++</span><span class="tok-n">i</span> <span class="tok-o">)</span>
            <span class="tok-n">b</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">+</span> <span class="tok-n">i</span><span class="tok-o">];</span>
        <span class="tok-n">mergeSort</span><span class="tok-o">(</span> <span class="tok-n">a</span> <span class="tok-o">);</span>
        <span class="tok-n">mergeSort</span><span class="tok-o">(</span> <span class="tok-n">b</span> <span class="tok-o">);</span>
        <span class="tok-n">merge</span><span class="tok-o">(</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">b</span> <span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mergeSort()</code> method is quite short and appears to do very little.
It starts by creating arrays <code>a</code> and <code>b</code> and copying roughly half of the
elements in <code>array</code> into each. We make <code>a</code> half the size of <code>array</code>, but
we can&#8217;t do the same thing for <code>b</code> because an odd length for <code>array</code>
would leave us without enough space in <code>a</code> and <code>b</code> to hold everything
from <code>array</code>. Instead, we let <code>b</code> hold however much is leftover after
the elements for <code>a</code> have been accounted for.</p>
</div>
<div class="paragraph">
<p>Then, arrays <code>a</code> and <code>b</code> are recursively sorted. Finally, these two
sorted arrays are merged back into <code>array</code> in sorted order using a
helper method called <code>merge()</code>. This method is non-recursive and does
much of the real work in the algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">merge</span><span class="tok-o">(</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">array</span><span class="tok-o">,</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">b</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-n">aIndex</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-kt">int</span> <span class="tok-n">bIndex</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">array</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-o">++</span><span class="tok-n">i</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">bIndex</span> <span class="tok-o">&gt;=</span> <span class="tok-n">b</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">)</span>
            <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-n">aIndex</span><span class="tok-o">++];</span>
        <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">aIndex</span> <span class="tok-o">&gt;=</span> <span class="tok-n">a</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">)</span>
            <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">b</span><span class="tok-o">[</span><span class="tok-n">bIndex</span><span class="tok-o">++];</span>
        <span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-n">aIndex</span><span class="tok-o">]</span> <span class="tok-o">&lt;=</span> <span class="tok-n">b</span><span class="tok-o">[</span><span class="tok-n">bIndex</span><span class="tok-o">]</span> <span class="tok-o">)</span>
            <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">a</span><span class="tok-o">[</span><span class="tok-n">aIndex</span><span class="tok-o">++];</span>
        <span class="tok-k">else</span>
            <span class="tok-n">array</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">b</span><span class="tok-o">[</span><span class="tok-n">bIndex</span><span class="tok-o">++];</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>merge()</code> method loops through all the elements in <code>array</code>, filling
them in. We keep two indexes, <code>aIndex</code> and <code>bIndex</code>, that keep track of
our current positions in the <code>a</code> and <code>b</code> arrays, respectively. This
method assumes that <code>a</code> and <code>b</code> are sorted and that the sum of their
lengths is the length of <code>array</code>. We want to compare each element in <code>a</code>
and <code>b</code>, always taking the smaller and putting it into the next
available location in <code>array</code>. Since the next smallest item could be in
either <code>a</code> or <code>b</code>, we never know when we&#8217;ll run out of elements in
either array. That&#8217;s why the first two <code>if</code> statements in the <code>merge()</code>
method check to see if the <code>bIndex</code> or the <code>aIndex</code> is already past the
last element in its respective array. If so, the next element from the
other array is automatically used. By the time the third <code>if</code> statement
is reached, we are certain that both indexes are valid and can compare
the elements at those locations to see which is smaller.</p>
</div>
<div class="paragraph">
<p>Sorting lists using the merge sort algorithm seems more complicated than
using bubble sort or selection sort, but this additional complication
pays dividends. For large lists, merge sort performs much faster than
either of those sorts. In fact, it is comparable in speed to the best
general sorting algorithms that are possible.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise19.15">Exercise 19.15</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Although recursive sorting algorithms are useful for arrays, recursion
really shines when manipulating <em>recursive data structures</em>. A recursive
data structure is one that is defined in terms of itself. For example,
class <code>X</code> is recursive if there is a field inside <code>X</code> with type <code>X</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">X</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">a</span><span class="tok-o">,</span> <span class="tok-n">b</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">X</span> <span class="tok-n">x</span><span class="tok-o">;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The linked list examples from <a href="#_dynamic_data_structures">Chapter 18</a> are recursive data structures, since a linked list node is
defined in terms of itself. You may not have thought of the linked list
<code>Node</code> class as being recursive since it simply has a reference to
another <code>Node</code> inside it. However, this self-reference is the essence of
a recursive data structure.</p>
</div>
<div class="paragraph">
<p>Data structures are often defined recursively. We typically need to
represent an unbounded collection of data, but we always write bounded
programs to describe the data. A recursive data structure allows us to
bridge the gap between a compile-time, fixed length definition and a
run-time, unbounded collection of objects.</p>
</div>
<div class="paragraph">
<p>Recursive data structures have a base case to end the recursion.
Typically, the end of the recursion is indicated by a link with a <code>null</code>
value. For example, in the last node of a linked list, the link field is
<code>null</code>. Unsurprisingly, recursive methods are frequently used to
manipulate recursive data structures.</p>
</div>
<div id="recursiveLinkedListSizeExample" class="exampleblock">
<div class="title">Example 157. Recursive linked list size</div>
<div class="content">
<div class="paragraph">
<p>How would you get the size of a linked list? The implementation in
<a href="#LinkedListProgram">Program 83</a> keeps track of its size as it grows, but
what if it didn&#8217;t? A standard way to count the elements in the list
would be to start with a reference to the head of the list and a counter
with value zero. As long as the reference is not <code>null</code>, add one to the
counter and set the reference to the next element on the list.
<a href="#IterativeListSizeProgram">Program 103</a> counts the elements in this way.</p>
</div>
<div id="IterativeListSizeProgram" class="listingblock">
<div class="title">Program 103. Linked list implementation whose <code>size()</code> method counts its elements iteratively.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">IterativeListSize</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>    	<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">11 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">12 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">13 </span>    	<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">14 </span>    <span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">size</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>    	<span class="tok-n">Node</span> <span class="tok-n">current</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">18 </span>    	<span class="tok-kt">int</span> <span class="tok-n">counter</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">19 </span>    	<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">current</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>    		<span class="tok-n">current</span> <span class="tok-o">=</span> <span class="tok-n">current</span><span class="tok-o">.</span><span class="tok-na">next</span><span class="tok-o">;</span>
<span class="lineno">21 </span>    		<span class="tok-n">counter</span><span class="tok-o">++;</span>
<span class="lineno">22 </span>    	<span class="tok-o">}</span>
<span class="lineno">23 </span>    	<span class="tok-k">return</span> <span class="tok-n">counter</span><span class="tok-o">;</span>
<span class="lineno">24 </span>    <span class="tok-o">}</span>
<span class="lineno">25 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative way to count the number of elements in a linked list is
to use the natural recursion of the linked list itself. We can say that
the length of a linked list is 0 if the list is empty (the current link
is <code>null</code>), otherwise, it is one more than the size of the rest of the
list.</p>
</div>
<div class="paragraph">
<p><a href="#RecursiveListSizeProgram">Program 104</a> counts the elements in a linked
list using this recursive procedure. Note that there is a non-recursive
<code>size()</code> method that calls the recursive <code>size()</code> method. This
non-recursive method is called a <em>proxy method</em>. The recursive method
requires access to the internals of the data structure. The proxy method
calls the recursive method with the appropriate starting point (<code>head</code>),
while providing a public way to get the list&#8217;s size without exposing its
internals.</p>
</div>
<div id="RecursiveListSizeProgram" class="listingblock">
<div class="title">Program 104. Linked list implementation with a recursive <code>size()</code> method for counting its elements.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RecursiveListSize</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>        <span class="tok-kd">public</span> <span class="tok-n">Node</span> <span class="tok-n">next</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>    <span class="tok-o">}</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    <span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>    	<span class="tok-n">Node</span> <span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">11 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">12 </span>    	<span class="tok-n">temp</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">=</span> <span class="tok-n">head</span><span class="tok-o">;</span>
<span class="lineno">13 </span>    	<span class="tok-n">head</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">14 </span>    <span class="tok-o">}</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>    <span class="tok-c1">//proxy method</span>
<span class="lineno">17 </span>    <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">size</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">18 </span>    	<span class="tok-k">return</span> <span class="tok-n">size</span><span class="tok-o">(</span> <span class="tok-n">head</span> <span class="tok-o">);</span>
<span class="lineno">19 </span>    <span class="tok-o">}</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>    <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">size</span><span class="tok-o">(</span><span class="tok-n">Node</span> <span class="tok-n">list</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">22 </span>    	<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">list</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-c1">//base case</span>
<span class="lineno">23 </span>    		<span class="tok-k">return</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">24 </span>    	<span class="tok-c1">//recursive case</span>
<span class="lineno">25 </span>    	<span class="tok-k">return</span> <span class="tok-mi">1</span> <span class="tok-o">+</span> <span class="tok-n">size</span><span class="tok-o">(</span> <span class="tok-n">list</span><span class="tok-o">.</span><span class="tok-na">next</span> <span class="tok-o">);</span>
<span class="lineno">26 </span>    <span class="tok-o">}</span>
<span class="lineno">27 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise19.9">Exercise 19.9</a><br>
<a href="#exercise19.10">Exercise 19.10</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_trees">19.4.1. Trees</h4>
<div class="paragraph">
<p>A linked list models a linear, one-to-one relationship between its
elements. Each item in the list is linked to a maximum of one following
element. Another useful relationship to model is a hierarchical,
one-to-many relationship: parent to children, boss to employees,
directory to files, and so on. These relationships can be modeled using
a <em>tree</em> structure, which begins with a single <em>root</em>, and proceeds
through <em>branches</em>, to the <em>leaves</em>. Typically, the elements of a tree
are also called <em>nodes</em>, with three special cases:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Root node</dt>
<dd>
<p>The root of the tree has no parents.</p>
</dd>
<dt class="hdlist1">Leaf node</dt>
<dd>
<p>A leaf is at the edge of a tree and has no children.</p>
</dd>
<dt class="hdlist1">Interior node</dt>
<dd>
<p>An interior node has a parent and at least one child; it is neither
the root nor a leaf.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="#figure-tree_visualization">Figure 82</a> shows a visualization of a tree. In
nature, a tree has its root at the bottom and branches upward. Since the
root is the starting point for a tree data structure, it is almost
always drawn at the top.</p>
</div>
<div id="figure-tree_visualization" class="imageblock">
<div class="content">
<img src="chapters/19-recursion/images/treevisualization.svg" alt="treevisualization" width="100%">
</div>
<div class="title">Figure 82. Visualization of a tree. The root is shown in light red. The leaves are shown in blue. The interior nodes are show in light purple.</div>
</div>
<div class="paragraph">
<p>Abstractly, a tree is either empty (the base case) or contains
references to 0 or more other trees (the recursive case). Trees are very
useful for storing and retrieving sortable data efficiently. Some
applications include dictionaries, catalogs, ordered lists, and any
other sorted set of objects. For these purposes, we can define an
abstract data type that includes operations such as <code>add()</code> and
<code>find()</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise19.13">Exercise 19.13</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>A special case of a tree that is used frequently is a <em>binary tree</em>, in
which each node references at most two other trees.</p>
</div>
<div id="binarySearchTreeExample" class="exampleblock">
<div class="title">Example 158. Binary search tree</div>
<div class="content">
<div class="paragraph">
<p>A <em>binary search tree</em> is a binary tree with the following three
properties.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The value in the left child of the root is smaller than the value in
the root.</p>
</li>
<li>
<p>The value in the right child of the root is larger than the value in
the root.</p>
</li>
<li>
<p>Both the left and the right subtrees are binary search trees.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This recursive definition describes a tree that makes items with a
natural ordering easy to find. If you are looking for an item, you first
look at the root of the tree. If the item you want is in the root,
you&#8217;ve found it! If the item you want is smaller than the root, go left.
If the item you want is larger than the root, go right. If you ever run
out of tree (hit a <code>null</code>), the item is not in the tree.</p>
</div>
<div class="paragraph">
<p>This example is a simple binary tree that can stores a list of strings
and print them out in alphabetical order. <a href="#TreeProgram">Program 105</a> shows
the <code>Tree</code> class that defines the fields and two public methods, <code>add()</code>
and <code>print()</code> that operate on the tree. Each is a proxy method that
calls its private recursive version, which takes a reference to a <code>Node</code>
object. The <code>Node</code> static nested class contains three fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>value</code>: the <code>String</code> value stored at the node</p>
</li>
<li>
<p><code>left</code>: a link to the left subtree</p>
</li>
<li>
<p><code>right</code>: a link to the right subtree</p>
</li>
</ul>
</div>
<div id="TreeProgram" class="listingblock">
<div class="title">Program 105. Class that implements a simple binary search tree ADT for creating a sorted list of strings.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Tree</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-n">Node</span> <span class="tok-n">left</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Node</span> <span class="tok-n">right</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-o">}</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-c1">//proxy add</span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>		<span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">root</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Node</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">Node</span> <span class="tok-n">tree</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">tree</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>	<span class="tok-c1">//base case</span>
<span class="lineno">17 </span>			<span class="tok-n">tree</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">18 </span>			<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">19 </span>		<span class="tok-o">}</span>
<span class="lineno">20 </span>		<span class="tok-c1">//left recursive case</span>
<span class="lineno">21 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">compareTo</span><span class="tok-o">(</span><span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">)</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">22 </span>			<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>		<span class="tok-c1">//right recursive case</span>
<span class="lineno">24 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">compareTo</span><span class="tok-o">(</span><span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">)</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">25 </span>			<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">);</span>
<span class="lineno">26 </span>		<span class="tok-k">return</span> <span class="tok-n">tree</span><span class="tok-o">;</span>
<span class="lineno">27 </span>	<span class="tok-o">}</span>
<span class="lineno">28 </span>
<span class="lineno">29 </span>	<span class="tok-c1">//proxy print</span>
<span class="lineno">30 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>		<span class="tok-n">print</span><span class="tok-o">(</span> <span class="tok-n">root</span> <span class="tok-o">);</span>
<span class="lineno">32 </span>	<span class="tok-o">}</span>
<span class="lineno">33 </span>
<span class="lineno">34 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">(</span><span class="tok-n">Node</span> <span class="tok-n">tree</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">35 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">tree</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">36 </span>			<span class="tok-n">print</span><span class="tok-o">(</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">);</span>
<span class="lineno">37 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">);</span>
<span class="lineno">38 </span>			<span class="tok-n">print</span><span class="tok-o">(</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">);</span>
<span class="lineno">39 </span>		<span class="tok-o">}</span>
<span class="lineno">40 </span>	<span class="tok-o">}</span>
<span class="lineno">41 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#figure-tree_classes">Figure 83</a> shows a visualization of the contents of
this implementation of a binary search tree. As with a linked list, an
&#8220;X&#8221; is used in place of arrows that point to <code>null</code>.</p>
</div>
<div id="figure-tree_classes" class="imageblock text-center">
<div class="content">
<img src="chapters/19-recursion/images/treeclasses.svg" alt="treeclasses" width="75%">
</div>
<div class="title">Figure 83. Visualization of a tree implementation with classes.</div>
</div>
<div class="paragraph">
<p>The recursive <code>add()</code> method first checks to see if the current subtree
is empty (<code>null</code>). If so, it creates a new <code>Node</code> and puts <code>value</code>
inside it. If the current subtree is not <code>null</code>, it checks to see if
<code>value</code> is smaller or larger than the <code>value</code> at the root of the subtee.
If it is smaller, it recurses down the left subtree. If it is larger, it
recurses down the right subtree. If <code>value</code> is already in the root node,
it does nothing.</p>
</div>
<div class="paragraph">
<p>Remember that all parameters are pass by value in Java. Thus, assigning
a new <code>Node</code> to <code>tree</code> does not by itself change anything at higher
levels of the tree. What does change the links in the parent of the
current subtree is returning the <code>tree</code> pointer. If the recursive call
to <code>add()</code> was made with a left or a right subtree, the <code>left</code> or
<code>right</code> link, respectively, of the parent <code>Node</code> is assigned the return
value. If the call was made with <code>root</code>, the parent of the entire tree,
the non-recursive <code>add()</code> method sets its value when the recursive
<code>add()</code> returns.</p>
</div>
<div class="paragraph">
<p>The recursive <code>print()</code> method starts by walking down the left subtree.
Those values are all alphabetically less than the value of the current
node. When it finishes, it prints the current node value. Finally, it
walks the right subtree to print the values that alphabetically follow
the value in the current node. This path through the nodes of the tree
is called an <em>inorder traversal</em>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise19.11">Exercise 19.11</a><br>
<a href="#exercise19.12">Exercise 19.12</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>With the power of a binary search tree, it takes virtually no code at
all to store a list of <code>String</code> values and then print them out in sorted
order. <a href="#ReadAndSortStringsProgram">Program 106</a> gives an example of this
process using a <code>Tree</code> object for storage.</p>
</div>
<div id="ReadAndSortStringsProgram" class="listingblock">
<div class="title">Program 106. Reads <code>String</code> values, stores them in a binary search tree, and prints the results in sorted order.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ReadAndSortStrings</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Tree</span> <span class="tok-n">tree</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Tree</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>				<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>		<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">();</span>
<span class="lineno">12 </span>	<span class="tok-o">}</span>
<span class="lineno">13 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Binary search trees (and other trees, including heaps, tries, B-trees,
and more) are fundamental data structures that have been studied
heavily. Designing them to have efficient implementations that balance
the size of their left and right subtrees is an important topic that is
beyond the scope of this book.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_generic_dynamic_data_structures_and_recursion">19.4.2. Generic dynamic data structures and recursion</h4>
<div class="paragraph">
<p>Combining dynamic data structures and generics from the previous chapter
and recursion from this chapter gives us the full power of generic
dynamic data structures and recursive methods to process them.</p>
</div>
<div class="exampleblock">
<div class="title">Example 159. Binary search tree to hold integers</div>
<div class="content">
<div class="paragraph">
<p>Consider <a href="#IntegerTreeProgram">Program 107</a>, which implements a tree that
stores values of type <code>Integer</code>. Although it would be more efficient to
store <code>int</code> values, we use the <code>Integer</code> wrapper class to ease our
eventual transition into a parameterized generic type.</p>
</div>
<div id="IntegerTreeProgram" class="listingblock">
<div class="title">Program 107. Variant of <a href="#TreeProgram">Program 105</a> that stores`Integer` values instead of <code>String</code> values.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">IntegerTree</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-n">Integer</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-n">Node</span> <span class="tok-n">left</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Node</span> <span class="tok-n">right</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-o">}</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">private</span> <span class="tok-n">Node</span> <span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-c1">//proxy add</span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>		<span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">root</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Node</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">Integer</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">Node</span> <span class="tok-n">tree</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">tree</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>	<span class="tok-c1">//base case</span>
<span class="lineno">17 </span>			<span class="tok-n">tree</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">();</span>
<span class="lineno">18 </span>			<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">19 </span>		<span class="tok-o">}</span>
<span class="lineno">20 </span>		<span class="tok-c1">//left recursive case</span>
<span class="lineno">21 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">compareTo</span><span class="tok-o">(</span><span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">)</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">22 </span>			<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>		<span class="tok-c1">//right recursive case</span>
<span class="lineno">24 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">compareTo</span><span class="tok-o">(</span><span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">)</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">25 </span>			<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">);</span>
<span class="lineno">26 </span>		<span class="tok-k">return</span> <span class="tok-n">tree</span><span class="tok-o">;</span>
<span class="lineno">27 </span>	<span class="tok-o">}</span>
<span class="lineno">28 </span>
<span class="lineno">29 </span>	<span class="tok-c1">//proxy print</span>
<span class="lineno">30 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>		<span class="tok-n">print</span><span class="tok-o">(</span> <span class="tok-n">root</span> <span class="tok-o">);</span>
<span class="lineno">32 </span>	<span class="tok-o">}</span>
<span class="lineno">33 </span>
<span class="lineno">34 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">(</span><span class="tok-n">Node</span> <span class="tok-n">tree</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">35 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">tree</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">36 </span>			<span class="tok-n">print</span><span class="tok-o">(</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">);</span>
<span class="lineno">37 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">);</span>
<span class="lineno">38 </span>			<span class="tok-n">print</span><span class="tok-o">(</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">);</span>
<span class="lineno">39 </span>		<span class="tok-o">}</span>
<span class="lineno">40 </span>	<span class="tok-o">}</span>
<span class="lineno">41 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is a waste to create class <code>IntegerTree</code>, which is identical to
<code>Tree</code> except that the type <code>String</code> has been replaced by <code>Integer</code>. As
in <a href="#_dynamic_data_structures">Chapter 18</a>, we want our data
structures, recursive or otherwise, to hold any type. In this way, we
can reuse code.</p>
</div>
<div class="exampleblock">
<div class="title">Example 160. Defining a generic binary search tree</div>
<div class="content">
<div class="paragraph">
<p><a href="#GenericTreeProgram">Program 108</a> defines a generic version of the <code>Tree</code>
class. This example is complicated by the fact that we need to be able
to compare the value we want to store with the value in each <code>Node</code>
object. We can&#8217;t make a tree with any arbitrary type. Objects of the
type <strong>must</strong> have the ability to be compared to each other and ordered.
Thus, we use a <em>bounded type parameter</em> specifying that the type <code>T</code>
stored in each <code>Tree</code> must implement the <code>Comparable</code> interface. This
requirement complicates the generic syntax significantly but guarantees
that any type that cannot be compared with itself is rejected at
compile-time.</p>
</div>
<div id="GenericTreeProgram" class="listingblock">
<div class="title">Program 108. Class that implements a generic tree.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">GenericTree</span><span class="tok-o">&lt;</span><span class="tok-n">T</span> <span class="tok-kd">extends</span> <span class="tok-n">Comparable</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span> <span class="tok-kd">extends</span> <span class="tok-n">Comparable</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;{</span>
<span class="lineno"> 3 </span>		<span class="tok-n">T</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-n">Node</span> <span class="tok-n">left</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-n">Node</span> <span class="tok-n">right</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-o">}</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">private</span> <span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>	<span class="tok-c1">//proxy add</span>
<span class="lineno">11 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>		<span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">root</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>	<span class="tok-kd">private</span> <span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-nf">add</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">tree</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">tree</span> <span class="tok-o">==</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>	<span class="tok-c1">//base case</span>
<span class="lineno">17 </span>			<span class="tok-n">tree</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;();</span>
<span class="lineno">18 </span>			<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
<span class="lineno">19 </span>		<span class="tok-o">}</span>
<span class="lineno">20 </span>		<span class="tok-c1">//left recursive case</span>
<span class="lineno">21 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">compareTo</span><span class="tok-o">(</span><span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">)</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">22 </span>			<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>		<span class="tok-c1">//right recursive case</span>
<span class="lineno">24 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">compareTo</span><span class="tok-o">(</span><span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span><span class="tok-o">)</span> <span class="tok-o">&gt;</span> <span class="tok-mi">0</span> <span class="tok-o">)</span>
<span class="lineno">25 </span>			<span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">=</span> <span class="tok-n">add</span><span class="tok-o">(</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">);</span>
<span class="lineno">26 </span>		<span class="tok-k">return</span> <span class="tok-n">tree</span><span class="tok-o">;</span>
<span class="lineno">27 </span>	<span class="tok-o">}</span>
<span class="lineno">28 </span>
<span class="lineno">29 </span>	<span class="tok-c1">//proxy print</span>
<span class="lineno">30 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>		<span class="tok-n">print</span><span class="tok-o">(</span> <span class="tok-n">root</span> <span class="tok-o">);</span>
<span class="lineno">32 </span>	<span class="tok-o">}</span>
<span class="lineno">33 </span>
<span class="lineno">34 </span>	<span class="tok-kd">private</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">(</span><span class="tok-n">Node</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">tree</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">35 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">tree</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">36 </span>			<span class="tok-n">print</span><span class="tok-o">(</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">left</span> <span class="tok-o">);</span>
<span class="lineno">37 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">);</span>
<span class="lineno">38 </span>			<span class="tok-n">print</span><span class="tok-o">(</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">right</span> <span class="tok-o">);</span>
<span class="lineno">39 </span>		<span class="tok-o">}</span>
<span class="lineno">40 </span>	<span class="tok-o">}</span>
<span class="lineno">41 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First, note that the recursive methods are no longer <code>static</code>. The
generic syntax for keeping them <code>static</code> is unnecessarily complex. The
type specifier <code>T extends Comparable&lt;T&gt;</code> guarantees that type <code>T</code>
implements the interface <code>Comparable&lt;T&gt;</code>. The generic <code>Comparable</code>
interface defined in the Java API is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">Comparable</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
    <span class="tok-kt">int</span> <span class="tok-nf">compareTo</span><span class="tok-o">(</span><span class="tok-n">T</span> <span class="tok-n">object</span><span class="tok-o">);</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax for generics in Java with type bounds is complex, and we only
scratch the surface here. The good news is that these subtleties are
more important for people designing data structures and libraries and
come up infrequently for programmers who are only using the libraries.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 161. Using a generic class</div>
<div class="content">
<div class="paragraph">
<p><a href="#ReadAndSortGenericsProgram">Program 109</a> uses the generic tree class to
create two kinds of trees, a tree of <code>String</code> objects and a tree of
<code>Integer</code> objects. Java library implementations of binary search trees
are available as the <code>TreeSet</code> and <code>TreeMap</code> classes.</p>
</div>
<div id="ReadAndSortGenericsProgram" class="listingblock">
<div class="title">Program 109. Creates two trees with different underlying types.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Random</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ReadAndSortGenerics</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>		<span class="tok-n">GenericTree</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">stringTree</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">GenericTree</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;();</span>
<span class="lineno"> 9 </span>		<span class="tok-n">GenericTree</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;</span> <span class="tok-n">integerTree</span> <span class="tok-o">=</span>
<span class="lineno">10 </span>			<span class="tok-k">new</span> <span class="tok-n">GenericTree</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;();</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>		<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>			<span class="tok-n">stringTree</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">());</span>
<span class="lineno">14 </span>		<span class="tok-n">stringTree</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">();</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span>		<span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
<span class="lineno">17 </span>		<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++)</span>
<span class="lineno">18 </span>			<span class="tok-n">integerTree</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">());</span>
<span class="lineno">19 </span>		<span class="tok-n">integerTree</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">();</span>
<span class="lineno">20 </span>	<span class="tok-o">}</span>
<span class="lineno">21 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_maze_of_doom">19.5. Solution: Maze of doom</h3>
<div class="paragraph">
<p>Our algorithm for solving the maze follows the conventional
pencil-and-paper method: trial and error! We mark locations in the maze
with <code>'*'</code> as we explore them. If we come to a dead end, we unmark the
location (by replacing <code>'*'</code> with <code>' '</code>) and return to our previous
location to try a different direction.</p>
</div>
<div class="paragraph">
<p>Start at the beginning square of the maze, which must be a passageway.
Mark that location as part of the path by putting <code>'*'</code> in the cell.
Now, what can we do? There are, in general, four possible directions to
head: up, down, left, or right. If that direction doesn&#8217;t take you
outside the bounds of the array, then you find either a wall or a
passageway. If you have been walking through the maze, you may also find
a part of the current path (often the square you were on before the
current one).</p>
</div>
<div class="paragraph">
<p>Suppose from your current point in the maze you could send a scout ahead
in each of the four directions. If the direction did not take the scout
out of bounds, he would find either a wall, a part of the current path
(the path that led into that space), or an open passageway. If the scout
doesn&#8217;t find an open passageway, he reports back that that direction
doesn&#8217;t work.</p>
</div>
<div class="paragraph">
<p>On the other hand, if the scout finds an open passageway, what does he
do? Brace yourself! He does the exact same thing you just did: Sends out
scouts of his own in each of the four possible directions.</p>
</div>
<div class="paragraph">
<p>With careful, consistent coding, you and the scout follow the exact same
process. And the scout&#8217;s scouts. And so on. There is, in fact, only one
method and instead of calling a scout method to investigate each of the
squares in the four directions, you call yourself recursively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Scanner</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MazeSolver</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">char</span><span class="tok-o">[][]</span> <span class="tok-n">maze</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">rows</span><span class="tok-o">,</span> <span class="tok-n">columns</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-n">MazeSolver</span> <span class="tok-n">solver</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MazeSolver</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">solver</span><span class="tok-o">.</span><span class="tok-na">solve</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">)</span><span class="tok-cm">/*@\label{mazeRCall}@*/</span>
<span class="lineno">10 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;\nSolved!&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-k">else</span>
<span class="lineno">12 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;\nNot solvable!&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>		<span class="tok-n">solver</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">();</span><span class="tok-cm">/*@\label{mazeRPrint}@*/</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MazeSolver</code> class needs a two-dimensional array of <code>char</code> values to
store a representation of the maze. Likewise, it is convenient to store
the number of rows and columns in fields.</p>
</div>
<div class="paragraph">
<p>The <code>main()</code> method creates a new <code>MazeSolver</code> object and then calls its
<code>solve()</code> method with a starting location of <code>(0, 0)</code>. It prints an
appropriate message depending on whether or not the maze was solved.
Finally, it prints out the maze, which includes a path marked with <code>'*'</code>
symbols if the maze is solvable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-nf">MazeSolver</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>
<span class="lineno"> 3 </span>		<span class="tok-n">rows</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 4 </span>		<span class="tok-n">columns</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">();</span>
<span class="lineno"> 5 </span>		<span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>		<span class="tok-n">maze</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">char</span><span class="tok-o">[</span><span class="tok-n">rows</span><span class="tok-o">][</span><span class="tok-n">columns</span><span class="tok-o">];</span>
<span class="lineno"> 7 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">row</span> <span class="tok-o">&lt;</span> <span class="tok-n">rows</span><span class="tok-o">;</span> <span class="tok-n">row</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>			<span class="tok-n">String</span> <span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">line</span><span class="tok-o">);</span>
<span class="lineno">10 </span>			<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">column</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">column</span> <span class="tok-o">&lt;</span> <span class="tok-n">columns</span><span class="tok-o">;</span> <span class="tok-n">column</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>				<span class="tok-n">maze</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-na">charAt</span><span class="tok-o">(</span><span class="tok-n">column</span><span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-o">}</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor for <code>MazeSolver</code> creates a <code>Scanner</code>. It assumes that
the file describing the maze is redirected from standard input, although
it would be easy to modify the constructor to take a file name and read
from there instead. Next, it reads two integers and sets <code>rows</code> and
<code>columns</code> to those values. It allocates a two-dimensional array of
<code>char</code> values with <code>rows</code> rows and <code>columns</code> columns. Finally, it reads
through the file, storing each line of <code>char</code> values into this array. As
it reads, it prints out each line to the screen, showing the initial
(unsolved) maze.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">print</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">row</span> <span class="tok-o">&lt;</span> <span class="tok-n">rows</span><span class="tok-o">;</span> <span class="tok-n">row</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>			<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">column</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">column</span> <span class="tok-o">&lt;</span> <span class="tok-n">columns</span><span class="tok-o">;</span> <span class="tok-n">column</span><span class="tok-o">++)</span>
<span class="lineno">4 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-n">maze</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]);</span>
<span class="lineno">5 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">();</span>
<span class="lineno">6 </span>		<span class="tok-o">}</span>
<span class="lineno">7 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>print()</code> method is a utility method that prints out the maze. It
iterates through each row, printing out the values for the columns in
that row.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">solve</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">row</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">column</span> <span class="tok-o">)</span> <span class="tok-o">{</span><span class="tok-cm">/*@\label{mazeRBegin}@*/</span>
<span class="lineno"> 2 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">row</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">||</span> <span class="tok-n">column</span> <span class="tok-o">&lt;</span> <span class="tok-mi">0</span> <span class="tok-o">||</span> <span class="tok-n">row</span> <span class="tok-o">&gt;=</span> <span class="tok-n">rows</span> <span class="tok-o">||</span> <span class="tok-n">column</span> <span class="tok-o">&gt;=</span> <span class="tok-n">columns</span><span class="tok-o">)</span><span class="tok-cm">/*@\label{mazeROutside}@*/</span>
<span class="lineno"> 3 </span>			<span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">maze</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">==</span> <span class="tok-sc">&#39;E&#39;</span> <span class="tok-o">)</span><span class="tok-cm">/*@\label{mazeRDone}@*/</span>
<span class="lineno"> 5 </span>			<span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">maze</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">!=</span> <span class="tok-sc">&#39; &#39;</span><span class="tok-o">)</span><span class="tok-cm">/*@\label{mazeRBlocked}@*/</span>
<span class="lineno"> 7 </span>			<span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>			<span class="tok-n">maze</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;*&#39;</span><span class="tok-o">;</span>
<span class="lineno">10 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">solve</span><span class="tok-o">(</span><span class="tok-n">row</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">column</span><span class="tok-o">)</span> <span class="tok-o">||</span> <span class="tok-n">solve</span><span class="tok-o">(</span><span class="tok-n">row</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">column</span><span class="tok-o">)</span> <span class="tok-o">||</span><span class="tok-cm">/*@\label{mazeRRecursive}@*/</span>
<span class="lineno">11 </span>				<span class="tok-n">solve</span><span class="tok-o">(</span><span class="tok-n">row</span><span class="tok-o">,</span> <span class="tok-n">column</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">||</span> <span class="tok-n">solve</span><span class="tok-o">(</span><span class="tok-n">row</span><span class="tok-o">,</span> <span class="tok-n">column</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">12 </span>				<span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="lineno">13 </span>			<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>				<span class="tok-n">maze</span><span class="tok-o">[</span><span class="tok-n">row</span><span class="tok-o">][</span><span class="tok-n">column</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-sc">&#39; &#39;</span><span class="tok-o">;</span><span class="tok-cm">/*@\label{mazeRBlank}@*/</span>
<span class="lineno">15 </span>				<span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
<span class="lineno">16 </span>			<span class="tok-o">}</span>
<span class="lineno">17 </span>		<span class="tok-o">}</span>
<span class="lineno">18 </span>	<span class="tok-o">}</span>
<span class="lineno">19 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The heart of the solution is the recursive method <code>solve()</code>. The
<code>solve()</code> method takes two parameters, <code>row</code> and <code>column</code>, and tries to
find a solution to the maze starting at location <code>maze[row][column]</code>. It
assumes that the maze is filled with <code>'+'</code> for walls, <code>' '</code> for
passageways, and may include <code>'*'</code> characters at locations that are part
of the partially completed solution.</p>
</div>
<div class="paragraph">
<p>If <code>solve()</code> is able to find a solution from the current location, it
returns <code>true</code>, otherwise it returns <code>false</code>. There are three base cases
for the current location in the maze.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The current location is outside the maze. Return <code>false</code>.</p>
</li>
<li>
<p>The current location is the final location. We have a winner, return
<code>true</code>!</p>
</li>
<li>
<p>The current location is not a passage (either a wall or a location
in the current path that has already been marked). This call to <code>solve</code>
is not making progress toward the finish. Return <code>false</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If none of the base cases applies, then the current location, which must
contain a <code>' '</code> character, <strong>might</strong> be on a successful path, so <code>solve()</code>
gives it a try. The method tentatively marks the current position with
<code>'*'</code>. Then, it recursively tries to find a path from the current
location to each of the four neighboring cells
(line <a href="#mazeRRecursive">[mazeRRecursive]</a>). If any of those four neighbors returns
<code>true</code>, then <code>solve()</code> knows it has found a completed path and returns
<code>true</code> to its caller.</p>
</div>
<div class="paragraph">
<p>If none of the four neighbors was on a path to the destination, then the
current location is not on a path. The method unmarks the current
location (by storing a <code>' '</code>) and returns <code>false</code>. Presumably, its
caller figures out what to do next, perhaps calling a different one of
its neighbors or giving up and returning <code>false</code> to its caller.</p>
</div>
<div class="paragraph">
<p>The very first call to <code>solve()</code> from the <code>main()</code> method either returns
<code>true</code> if a complete path through the maze is found or <code>false</code> if no
path exists. Note that this solver has no guarantee of finding the
<strong>shortest</strong> path through the maze, but if there is at least one path to
the goal, it finds one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_futures">19.6. Concurrency: Futures</h3>
<div class="paragraph">
<p>This section does not deal explicitly with recursion, but it does deal
with concurrency and methods in an interesting way. When we call a
method in Java, a stack frame for the method is put on the stack, and
the thread of execution begins executing code inside the method. When it
is done, it returns a value (or not), and execution resumes in the
caller. But what if calling the method began executing an independent
thread, and the caller continued on without waiting for the method to
return?</p>
</div>
<div class="paragraph">
<p>This second situation should seem familiar, since it is very much what
happens when the <code>start()</code> method is called on a <code>Thread</code> object: the
<code>start()</code> method returns immediately to its caller, but an independent
thread of execution has begun executing the code in the <code>run()</code> method
of the <code>Thread</code>.</p>
</div>
<div class="paragraph">
<p>What if we only care about the value that is computed by the new thread
of execution? We can think of spawning the thread as an asynchronous
method call, a value that is computed <strong>at some point</strong> rather than one we
have to wait for. The name for such an asynchronous method call is a
<em>future</em>. In some languages, particularly functional languages, all
concurrency is expressed as a future. In Java, only a little bit of code
is needed to create threads that can behave like futures. However, the
idea of futures is pervasive enough that Java API tools were created to
make the process of creating them easy.</p>
</div>
<div class="paragraph">
<p>We introduce three interfaces and a factory method call that can allow
you to use futures in Java. This section is not a complete introduction
to futures, but these tools are enough to get you started with them.</p>
</div>
<div class="paragraph">
<p>The first interface is the <code>Future</code> interface, which allows you to store
a reference to the asynchronous computation while it is computing (and
before you ask for its value). The second interface is the <code>Callable</code>
interface, which is similar to the <code>Runnable</code> interface in that it
allows you to specify a class whose objects can be started as
independent threads. Both the <code>Future</code> interface and the <code>Callable</code> are
generic interfaces that require to specify a type. Remember that futures
are supposed to give back an answer, and that&#8217;s the type that you supply
as a parameter. For example, when creating a future that returns an
<code>int</code> value, you would create a class that implemented the
<code>Callable&lt;Integer&gt;</code> interface, requiring it to contain a method with the
signature <code>Integer call()</code>. Likewise, you would store a reference to the
future you create in a <code>Future&lt;Integer&gt;</code> reference.</p>
</div>
<div class="paragraph">
<p>And how do you create such a future? Usually, many futures are running
at once to leverage the power of multiple cores. What if you want to
create 100 futures but only have 8 cores? The process of creating
threads is expensive, and it might not be worthwhile to create 100
threads when only 8 are able to run concurrently. To deal with this
problem, the Java API provides classes that implement the
<code>ExecutorService</code> interface, which can maintain a fixed-size <em>pool</em> of
threads. When a thread finishes computing one future, it is
automatically assigned another. To create an object that can manage
threads this way, call the static factory method <code>newFixedThreadPool()</code>
on the <code>Executors</code> class with the size of the thread pool you want
create. For example, we can create an <code>ExecutorService</code> with a pool of 8
threads as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ExecutorService</span> <span class="tok-n">executor</span> <span class="tok-o">=</span> <span class="tok-n">Executors</span><span class="tok-o">.</span><span class="tok-na">newFixedThreadPool</span><span class="tok-o">(</span><span class="tok-mi">8</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have an <code>ExecutorService</code>, you can give it a <code>Callable</code> object
of a particular type (such as <code>Callable&lt;Integer&gt;</code>) as a parameter to its
<code>submit()</code> method, and it returns a <code>Future</code> object of a matching type
(such as <code>Future&lt;Integer&gt;</code>). Then, the future is running (or at least
scheduled to run). At any later point you can call the <code>get()</code> method on
the <code>Future</code> object, which returns the value of its computation. Like
calling <code>join()</code>, calling <code>get()</code> is a blocking call that may have to
wait for the future to finish executing.</p>
</div>
<div class="paragraph">
<p>All of this messy syntax becomes clearer in the following example, which
uses futures to compute the sum of the square roots of the first
100,000,000 integers concurrently.</p>
</div>
<div class="exampleblock">
<div class="title">Example 162. Futures to sum square roots</div>
<div class="content">
<div class="paragraph">
<p>To use futures to sum the square roots of integers, we first need a
worker class that implements <code>Callable</code>. Since the result of the sum of
square roots is a <code>double</code>, it must implement <code>Callable&lt;Double&gt;</code>. Recall
that primitive types such as <code>double</code> cannot be used as generic type
parameters, requiring us to use wrapper classes in those cases.</p>
</div>
<div id="RootSummerProgram" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.concurrent.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RootSummer</span> <span class="tok-kd">implements</span> <span class="tok-n">Callable</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">min</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">max</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-nf">RootSummer</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">min</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">max</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">min</span> <span class="tok-o">=</span> <span class="tok-n">min</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">max</span> <span class="tok-o">=</span> <span class="tok-n">max</span><span class="tok-o">;</span>
<span class="lineno">10 </span>	<span class="tok-o">}</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>	<span class="tok-kd">public</span> <span class="tok-n">Double</span> <span class="tok-nf">call</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>		<span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mf">0.0</span><span class="tok-o">;</span>
<span class="lineno">14 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">min</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">max</span><span class="tok-o">;</span> <span class="tok-o">++</span><span class="tok-n">i</span> <span class="tok-o">)</span>
<span class="lineno">15 </span>			<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">sqrt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">);</span>
<span class="lineno">16 </span>		<span class="tok-k">return</span> <span class="tok-n">sum</span><span class="tok-o">;</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span>
<span class="lineno">18 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>RootSummer</code> is a simple worker class that takes a <code>min</code> and a <code>max</code>
value in its constructor. Its <code>call()</code> method sums the square roots of
all the <code>int</code> values greater than or equal to <code>min</code> and less than <code>max</code>.
It imports <code>java.util.concurrent.*</code> to have access to the <code>Callable</code>
interface.</p>
</div>
<div class="paragraph">
<p>Of course, we need another class to create the <code>ExecutorService</code>, start
the futures running, and collect the results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.concurrent.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.ArrayList</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RootFutures</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">THREADS</span> <span class="tok-o">=</span> <span class="tok-mi">10</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">N</span> <span class="tok-o">=</span> <span class="tok-mi">100000000</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">int</span> <span class="tok-n">FUTURES</span> <span class="tok-o">=</span> <span class="tok-mi">1000</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">Future</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">futures</span> <span class="tok-o">=</span>
<span class="lineno">11 </span>			<span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">Future</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;&gt;(</span><span class="tok-n">FUTURES</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-n">ExecutorService</span> <span class="tok-n">executor</span> <span class="tok-o">=</span>
<span class="lineno">13 </span>			<span class="tok-n">Executors</span><span class="tok-o">.</span><span class="tok-na">newFixedThreadPool</span><span class="tok-o">(</span><span class="tok-n">THREADS</span><span class="tok-o">);</span>
<span class="lineno">14 </span>		<span class="tok-kt">int</span> <span class="tok-n">work</span> <span class="tok-o">=</span> <span class="tok-n">N</span> <span class="tok-o">/</span> <span class="tok-n">FUTURES</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first part of <code>RootFutures</code> is setup. The imports give us the
concurrency tools we need and a list to store our futures in. We have
three constants. <code>THREADS</code> specifies the number of threads to create.
<code>N</code> gives the number we are going up to. <code>FUTURES</code> is the total number
of futures we create, considerably larger than the number of threads
they share.</p>
</div>
<div class="paragraph">
<p>Inside the <code>main()</code> method, we create an <code>ArrayList</code> to hold the
futures. Since we know the number of futures ahead of time, an array
would be ideal. Unfortunately, quirks in the way Java handles generics
makes it illegal to create an array with a generic type. Instead, we
create an <code>ArrayList</code> with the size we&#8217;ll need pre-allocated. Next, we
create an <code>ExecutorService</code> with a thread pool of size <code>THREADS</code>.
Finally, we find the amount of work done by each future by dividing <code>N</code>
by <code>FUTURES</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Creating futures...&quot;</span><span class="tok-o">);</span>
<span class="lineno">2 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">FUTURES</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>			<span class="tok-n">Callable</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;</span> <span class="tok-n">summer</span> <span class="tok-o">=</span>
<span class="lineno">4 </span>				<span class="tok-k">new</span> <span class="tok-n">RootSummer</span><span class="tok-o">(</span> <span class="tok-mi">1</span> <span class="tok-o">+</span> <span class="tok-n">i</span><span class="tok-o">*</span><span class="tok-n">work</span><span class="tok-o">,</span> <span class="tok-mi">1</span> <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span><span class="tok-o">)*</span><span class="tok-n">work</span> <span class="tok-o">);</span>
<span class="lineno">5 </span>			<span class="tok-n">Future</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;</span> <span class="tok-n">future</span> <span class="tok-o">=</span> <span class="tok-n">executor</span><span class="tok-o">.</span><span class="tok-na">submit</span><span class="tok-o">(</span> <span class="tok-n">summer</span> <span class="tok-o">);</span>
<span class="lineno">6 </span>			<span class="tok-n">futures</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span> <span class="tok-n">future</span> <span class="tok-o">);</span>
<span class="lineno">7 </span>		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this section of code, we create each future and start it running.
First, we instantiate a <code>RootSummer</code> object with the appropriate bounds
for the work it&#8217;s going to compute. Then, we supply that object to the
<code>submit()</code> method on the <code>ExecutorService</code>, which returns a <code>Future</code>
object. We could have saved a line of code by storing this return value
directly into the list <code>futures</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Getting results from futures...&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 2 </span>		<span class="tok-kt">double</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-n">Future</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;</span> <span class="tok-n">future</span> <span class="tok-o">:</span> <span class="tok-n">futures</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>				<span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">future</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">();</span>
<span class="lineno"> 6 </span>			<span class="tok-o">}</span>
<span class="lineno"> 7 </span>			<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">InterruptedException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>				<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>			<span class="tok-o">}</span>
<span class="lineno">10 </span>			<span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">ExecutionException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>				<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
<span class="lineno">12 </span>			<span class="tok-o">}</span>
<span class="lineno">13 </span>		<span class="tok-o">}</span>
<span class="lineno">14 </span>		<span class="tok-n">executor</span><span class="tok-o">.</span><span class="tok-na">shutdown</span><span class="tok-o">();</span>
<span class="lineno">15 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;The sum of square roots is: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span><span class="tok-o">);</span>
<span class="lineno">16 </span>	<span class="tok-o">}</span>
<span class="lineno">17 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All that remains is to collect the values from each future. We iterate
through the list of futures with a for-each loop and add the return
value each future&#8217;s <code>get()</code> method to our running total <code>sum</code>. Because
<code>get()</code> is a blocking call, we have to catch an <code>InterruptedException</code>
in case we are interrupted while waiting for the future to respond.
However, we also have to catch an <code>ExecutionException</code> in case an
exception occurred during the execution of the future. This exception
handling mechanism is one of the big advantages of using futures:
Exceptions thrown by the future are propagated back to the thread that
gets the answer from the future. Normal threads simply die if they have
unhandled exceptions.</p>
</div>
<div class="paragraph">
<p>After all the values have been read and summed, we shut the
<code>ExecutorService</code> down. If we had wanted, we could have submitted
additional <code>Callable</code> objects to it to run more futures. Finally, we
print out the result.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_19">19.7. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise19.1"></a> <a href="#multiplicationDefinedRecursivelyExample">Example 149</a> gave a mathematical recursive definition for
\(x \times y\). Give a similar recursive definition for
\(x + y\). The structure is similar to the recursion to
determine your current age given in <a href="#subsection:What_is_recursion">Section 19.2.1</a>.</p>
</li>
<li>
<p><a id="exercise19.2"></a> In principle, every problem that can be solved with an iterative
solution can be solved with a recursive one (and vice versa). However,
the limited size of the call stack can present problems for recursive
solutions with very deep recursion. Why? Conversely, are there any
recursive solutions that are impossible to turn into iterative ones?</p>
</li>
<li>
<p><a id="exercise19.3"></a> Consider the first (non-memoized)
recursive version of the Fibonacci method given in
<a href="#fibonacciImplementedRecursivelyExample">Example 153</a>. How many times is
<code>fibonacci()</code> called with argument \(1\) to compute
<code>fibonacci(n)</code>? Instrument your program and count the number of calls
for \(n = 2, 3, 4 \ldots 20\).</p>
</li>
<li>
<p><a id="exercise19.4"></a> In the recursive <code>solve()</code> method in the <code>MazeSolver</code> program given
in <a href="#_solution_maze_of_doom">Section 19.5</a>, the current location in the maze
array is is set to a blank character (<code>' '</code>) after no solution had been
found. What value was in that location? How would the program behave if
the value was not changed?</p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise19.5"></a> <a href="#exercise8.11">Exercise 8.11</a>
from <a href="#_methods">Chapter 8</a> challenges you to write a method to
determine whether a <code>String</code> contains a palindrome. Recall that a
palindrome (if punctuation and spaces are ignored) can be described as a
<code>String</code> in which the first and last characters are equal, and all the
characters in between form a palindrome. Write a recursive method to
test if a <code>String</code> is a palindrome, using the following signature.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isPalindrome</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">text</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">start</span><span class="tok-o">,</span>
    <span class="tok-kt">int</span> <span class="tok-n">end</span> <span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this method, the <code>start</code> parameter is the index of the first
character you are examining, and the <code>end</code> parameter is the index
immediately after the last character you are examining. Thus, it would
initially be called with a <code>String</code>, <code>0</code>, and the length of the
<code>String</code>, as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">result</span> <span class="tok-o">=</span>
    <span class="tok-n">isPalindrome</span><span class="tok-o">(</span> <span class="tok-s">&quot;A man, a plan, a canal: Panama&quot;</span><span class="tok-o">,</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">30</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
</li>
<li>
<p><a id="exercise19.6"></a> The efficient implementation of
Fibonacci from <a href="#fibonacciImplementedRecursivelyExample">Example 153</a>
eliminates redundant computation through memoization, storing values in
an array as they are found. It is possible to carry along the
computations of the previous two Fibonacci numbers <strong>without</strong> the
overhead of storing an array. Consider the following method signature.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-nf">fibonacci</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">previous</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">current</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">n</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next recursive call to the <code>fibonacci()</code> method passes in <code>n - 1</code>
and suitably altered versions of <code>previous</code> and <code>current</code>. When <code>n</code>
reaches <code>0</code>, the <code>current</code> parameter holds the value of the Fibonacci
number you were originally looking for.</p>
</div>
<div class="paragraph">
<p>The method would be called as follows for any value of <code>n</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">fibonacci</span><span class="tok-o">(</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">n</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Complete the implementation of this recursive method.</p>
</div>
</li>
<li>
<p><a id="exercise19.7"></a> Write an implementation of
fast exponentiation that works for even and odd \(n\). This
implementation is exactly the same as the one given at the end of
<a href="#exponentiationExample">Example 155</a> except when \(n\) is odd.
Use the following recursive definition of exponentiation to guide your
implementation.</p>
<div class="paragraph">
<p>\(a^n =
\begin{cases} a &amp; \text{if  $n=1$} &amp; \text{(Base Case)}
\\
\left(a^{\frac{n}{2}}\right)^2 &amp; \text{if  $n&gt;1$ and even} &amp; \text{(Base Case)}
\\
a\cdot \left(a^{\frac{n - 1}{2}}\right)^2 &amp; \text{if  $n&gt;1$ and odd} &amp; \text{(Base Case)}
\end{cases}\)</p>
</div>
</li>
<li>
<p><a id="exercise19.8"></a> <a href="#fibonacciImplementedRecursivelyExample">Example 153</a> shows two implementations that can be used to
find the \(n\)<sup>th</sup> Fibonacci number. With a little bit of
math, it is possible to show that there is a closed-form equation that
gives the \(n\)<sup>th</sup> Fibonacci number \(F_n\) where
\(F_0 = F_1 = 1\).</p>
<div class="paragraph">
<p>\(F_n = \frac{\left(\frac{1 + \sqrt{5}}{2}\right)^{n+1}  -  \left(\frac{1 -
\sqrt{5}}{2}\right)^{n+1}}{\sqrt{5}}\)</p>
</div>
<div class="paragraph">
<p>Although this math is a bit ugly, you can plug numbers into this
equation and discover the value of \(F_n\) quickly, provided
that you have an efficient way to raise values to the
\(n\)<sup>th</sup> power. Use the recursive algorithm for fast
exponentation from <a href="#exercise19.7">Exercise 19.7</a> to
make an implementation that finds the \(n\)<sup>th</sup> Fibonacci
number <strong>very</strong> quickly.</p>
</div>
<div class="paragraph">
<p>Note that this approach uses real numbers (including
\(\sqrt{5}\)) that need to be represented as <code>double</code> values.
There are exact methods that use fast exponentiation of integer matrices
to do this computation without doing any floating-point arithmetic, but
we do not go into those details here.</p>
</div>
</li>
<li>
<p><a id="exercise19.9"></a> <a href="#recursiveLinkedListSizeExample">Example 157</a> shows a way to calculate the size of a linked list
recursively. Add a recursive method called <code>print()</code> to the
<code>RecursiveListSize</code> class that prints out the values in the linked list
recursively, on each line.</p>
</li>
<li>
<p><a id="exercise19.10"></a> Expand the previous exercise
to add another method called <code>reversePrint()</code> that prints out the values
in the linked list the <strong>opposite</strong> order that they appear. It should take
only a slight modification of the <code>print()</code> method you have already
written.</p>
</li>
<li>
<p><a id="exercise19.11"></a> Create a recursive <code>find()</code> method (and a
non-recursive proxy method to call it) for the <code>Tree</code> class given in
<a href="#TreeProgram">Program 105</a>. Its operation is similar to the <code>add()</code>
method. If the subtree it is examining is empty (<code>null</code>), it should
return <code>false</code>. If the value it is looking for is at the root of the
current subtree, it should return <code>true</code>. These are the two base cases.
If the value it is looking for comes earlier in the alphabet than the
value at the root of the current subtree, it should look in the left
subtree. If the value it is looking for comes later in the alphabet than
the value at the root of the current subtree, it should look in the
right subtree. These are the two recursive cases.</p>
</li>
<li>
<p><a id="exercise19.12"></a> The height of a binary tree is defined as
the longest path from the root to any leaf node. Thus, the height of a
tree with only a root node in it is 0. By convention, the height of an
empty tree is -1.</p>
<div class="paragraph">
<p>Create a recursive <code>getHeight()</code> method (and a non-recursive proxy
method to call it) for the <code>Tree</code> class given in
<a href="#TreeProgram">Program 105</a>. The base case is an empty tree (a <code>null</code>
pointer), which has a height of -1. For the recursive case of a
non-empty tree, its height is one more than the height of the larger of
its two subtrees.</p>
</div>
</li>
<li>
<p><a id="exercise19.13"></a> Create an <code>interface</code> that
describes a tree ADT. Modify the programs in <a href="#binarySearchTreeExample">Example 158</a> to use this <code>interface</code>.</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise19.14"></a> Write an iterative version of the factorial function and compare its
speed to the recursive version given in the text. Use the
<code>System.currentTimeMillis()</code> or<br>
<code>System.nanoTime()</code> methods before and after <code>for</code> loops that call the
factorial methods 1,000,000 times each for random values.</p>
</li>
<li>
<p><a id="exercise19.15"></a> Write a program that generates four arrays
of random <code>int</code> values with lengths 1,000, 10,000, 100,000, and
1,000,000. Make two additional copies of each array. Then, sort each of
three copies of the array with the selection sort algorithm given in
<a href="#selectionSortExample">Example 63</a>, the bubble sort algorithm given in
<a href="#_problem_sort_it_out">Section 10.1</a>, and the merge sort algorithm given in
<a href="#mergeSortExample">Example 156</a>, respectively. Use the
<code>System.currentTimeMillis()</code> or <code>System.nanoTime()</code> methods to time each
of the sorts. Note that both selection sort and bubble sort may take
quite a while to sort an array of 1,000,000 elements.</p>
<div class="paragraph">
<p>Run the program several times and find average values for each algorithm
on each array size. Plot those times on a graph. The times needed to run
selection sort and bubble sort should increase quadratically, but the
time to run merge sort should increase linearithmically. In other words,
an array length of \(n\) should take time proportional to
\(n^2\) (multiplied by some constant) for selection sort and
bubble sort, but it should take time proportional to
\(n \log n\) (multiplied by some constant) for merge sort. For
large arrays, the difference in time is significant.</p>
</div>
</li>
<li>
<p><a id="exercise19.16"></a> Investigate the performance of using recursion to compute Fibonacci
numbers. Implement the naive recursive solution, the memoization method,
and an iterative solution similar to the memoization method. Use the
<code>System.currentTimeMillis()</code> or <code>System.nanoTime()</code> methods to time the
computations for large values of <code>n</code>. (<strong>Warning:</strong> It may take a very
long time to compute the <code>n</code><sup>th</sup> Fibonacci number with the naive
recursive solution.)</p>
</li>
<li>
<p><a id="exercise19.17"></a> <a href="#exercise6.9">Exercise 6.9</a> from <a href="#_arrays">Chapter 6</a> explains how binary search can be used to search for a value in a sorted
array of values. The idea is to play a &#8220;high-low&#8221; game, first looking
at the middle value. If the value is the one you&#8217;re looking for, you&#8217;re
done. If it is too high, look in the lower half of the array. If it is
too low, look in the upper half of the array. Implement binary search
both iteratively and recursively. Populate an array with 100,000 <code>int</code>
values between 1 and 10,000,000 and sort it. Then, search for 1,000,000
random values generated betwee 1 and 10,000,000 using iterative binary
search and then recursive binary search. Use the
<code>System.currentTimeMillis()</code> or <code>System.nanoTime()</code> methods to time each
process. Was the iterative or recursive approach faster? By how much?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_file_i_o">20. File I/O</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Kira:</strong> What are those funny marks?<br>
<strong>Jen:</strong> This is all writing.<br>
<strong>Kira:</strong> What&#8217;s writing?<br>
<strong>Jen:</strong> Words that stay, my master said.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; The Dark Crystal
</div>
</div>
<div class="sect2">
<h3 id="_problem_a_picture_is_worth_1_000_bytes">20.1. Problem: A picture is worth 1,000 bytes</h3>
<div class="paragraph">
<p>If you are familiar with bitmap (bmp) files, you know that they can get
very large. People often use a technique called data compression to
reduce the size of large files for storage. There are many different
kinds of compression and many which are tailored to work well on images.
Your task is to write a program that will do a particular kind of
compression called run length encoding (RLE), which we will test on
bitmaps. The idea behind RLE is simple: Imagine a file as a stream of
bytes. As you look through the stream, replace repeating sequences of a
single byte with a count telling how many times it repeats followed by
the byte that repeats. Consider the following sequence.</p>
</div>
<div class="paragraph">
<p><code>215 7 7 7 7 7 7 7 7 7 123 94 94 94 71</code></p>
</div>
<div class="paragraph">
<p>Its RLE compressed version could be as follows.</p>
</div>
<div class="paragraph">
<p><code>1 215 9 7 1 123 3 94 1 71</code></p>
</div>
<div class="paragraph">
<p>Since there is no simple way to keep track of which numbers are counts
and which ones are actual bytes of data, we have to keep a count for
every byte, even unrepeated ones. In this example, we went down from 15
numbers to 10 numbers, a savings of a third. In the worst case, a file
that has no repetition at all would actually double in size after being
&#8220;compressed&#8221; with this kind of RLE. Nevertheless, RLE compression is
used in practice and performs very well in some situations.</p>
</div>
<div class="paragraph">
<p>Your job is to write a Java program that takes two arguments from the
command line. The first is either <code>-c</code> for compress or <code>-d</code> for
decompress. The second argument is the name of the file to be compressed
or decompressed. When compressing, append the suffix <code>.compress</code> to the
end of the file name. When decompressing, remove that suffix.</p>
</div>
<div class="paragraph">
<p>Executing <code>java BitmapCompression -c test.bmp</code> from the command line
should generate an RLE compressed file called <code>test.bmp.compress</code>.</p>
</div>
<div class="paragraph">
<p>Likewise, executing <code>java BitmapCompression -d test.bmp.compress</code> should
create an uncompressed file called <code>test.bmp</code>. Be sure to make a backup
of the original file (in this case <code>test.bmp</code>) because decompressing
will overwrite a file of the same name.</p>
</div>
<div class="paragraph">
<p>To perform the compression, go byte by byte through the file. For each
repeating sequence of a byte (which can be as short as a single byte
long), write the length of the sequence as a byte and then the byte
itself into the compressed file. If a repeating sequence is more than
127 bytes, you must break the sequence into more than one piece since
the largest value the <code>byte</code> data type can hold in Java is 127. (The
<code>byte</code> type in Java is always signed, giving a range of -128 to 127.)
Decompression simply reads the count then the byte value and writes the
appropriate number of copies of the byte value into the decompressed
file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_file_i_o">20.2. Concepts: File I/O</h3>
<div class="paragraph">
<p>Before you can begin to tackle the problem of compressing, or even
reading from and writing to, files, some background on files might be
useful. By now, you have had many experiences with files: editing Java
source files, compiling those files, and running them on a virtual
machine, at the very least. You have probably done some word processing,
looked at photos, listened to music, and watched videos, all on a
computer. Each of these activities centers on one or more files. In
order to reach these files, you probably had to look through some
directories, which are a special kind of file as well. But, what is a
file?</p>
</div>
<div class="sect3">
<h4 id="_non_volatile_storage">20.2.1. Non-volatile storage</h4>
<div class="paragraph">
<p>A computer program is like a living thing, always moving and restless.
The variables in a program are stored in RAM, which is volatile storage.
The data in volatile memory will only persist as long as there is
electricity powering it. But programs do not run constantly, and neither
do most computers. We need a place to store data between runs of a
particular program. Likewise, we need a place to store data when our
computer isn&#8217;t turned on. Both scenarios share a common solution:
secondary storage such as hard drives, flash drives, and optical media
like CD-ROMs and DVD-ROMs.</p>
</div>
<div class="paragraph">
<p>Files are not always stored in non-volatile memory. It is possible to
load entire files into RAM and keep them there for long periods of time.
Likewise, all input and output on Unix and Linux systems are viewed as
file operations. Nevertheless, the characteristics of non-volatile
memory are often associated with file I/O: slow access times and the
possibility of errors in the event of hardware problems.</p>
</div>
</div>
<div class="sect3">
<h4 id="_stream_model">20.2.2. Stream model</h4>
<div class="paragraph">
<p>While discussing RLE encoding, we described a file as a stream of bytes,
and that is a good definition for a file, especially in Java. Since Java
is platform independent, and different operating systems and hardware
will deal with the nitty gritty details of storing files in different
ways, we want to think about files as abstractly as possible. The idea
of a stream of bytes should make a connection with all the other input
and output you have done so far. For the most part, file I/O will be
similar and, in fact, can use some of the same classes.</p>
</div>
<div class="paragraph">
<p>Although reading and writing from the files will be very much like
reading from the keyboard and writing to the screen, there are a few
additional complications. For one thing, you must open a file before you
can read and write. Sometimes opening the file will fail: You could try
to open a file for reading which does not exist or try to open a file
for writing which you do not have permissions for. When reading data,
you might try to read past the end of the file or try to read an <code>int</code>
when the next item is a <code>String</code>. Unlike reading from the keyboard, you
cannot ask the user to try again if there is a mistake in input. To deal
with all these possible errors, exception handling will accompany many
different file I/O operations in Java.</p>
</div>
</div>
<div class="sect3">
<h4 id="_text_files_and_binary_files">20.2.3. Text files and binary files</h4>
<div class="paragraph">
<p>When talking about files, many people divide files into two categories:
<em>text files</em> and <em>binary files</em>. A text file can be read by humans. That
is, when you open a text file with a simple file reader, it will not be
filled by gibberish and nonsense characters. A Java source file is an
excellent example of a text file.</p>
</div>
<div class="paragraph">
<p>In contrast, a binary file is a file meant only to be read by a
computer. Instead of printing out characters meant to be read by a
human, the raw bytes of memory for specific pieces of data are written
to binary files. To clarify, if we wanted to write the number 2127480645
in a text file, the file would contain the following.</p>
</div>
<div class="paragraph">
<p><code>2127480645</code></p>
</div>
<div class="paragraph">
<p>However, if we wanted to write the same number in a binary file, the
file would contain the following.</p>
</div>
<div class="paragraph">
<p><code>~ÎÇE</code></p>
</div>
<div class="paragraph">
<p>If you recall, an <code>int</code> in Java uses four bytes of storage. There is a
system of encoding called the ASCII table which maps each of the 256
(0–255) numerical bytes to a character. The four characters given above
are the ASCII representation of the four bytes of the number 2127480645.</p>
</div>
<div class="paragraph">
<p>In some sense, the idea of a text file is artificial. All files are
binary in the sense that they are readable by a computer. You will take
different steps and create different objects depending on whether you
want to do file I/O in the text or binary paradigms, but the overall
process will be similar in either case.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_file_operations_in_java">20.3. Syntax: File operations in Java</h3>
<div class="sect3">
<h4 id="_the_code_file_code_class">20.3.1. The <code>File</code> class</h4>
<div class="paragraph">
<p>The most basic object for interacting with a file in Java are objects of
the <code>File</code> class. A <code>File</code> object allows you to interact with a file at
the operating system level. You can create new files, test to see if a
file is a directory, find out the size of a file, and so on. A number of
file I/O classes require a <code>File</code> object as a parameter. To use the
<code>File</code> class, import <code>java.io.File</code> or <code>java.io.*</code>.</p>
</div>
<div class="paragraph">
<p>To create a <code>File</code> object, you can call the <code>File</code> constructor with a
<code>String</code> specifying the name of the file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">File</span> <span class="tok-n">file</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-s">&quot;file.txt&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing so will create a virtual file object associated with the name
<code>file.txt</code> (which may not exist yet) in the working directory of the
Java program. In this case, the extension <code>.txt</code> doesn&#8217;t have any real
meaning. On many systems, the extension (like <code>.doc</code> or <code>.html</code>) is used
by the operating system to guess which application should open the file.
To Java, however, the extension is just part of the file name. A file
name passed to the constructor of a <code>File</code> object can have any number of
periods in it.</p>
</div>
<div class="paragraph">
<p>Creating a file is all well and good, but file systems are useful in
part because of their hierarchical structure. If we want to create a
file in a particular location, we specify the <em>path</em> in the <code>String</code>
before the name of the file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">File</span> <span class="tok-n">file</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-s">&quot;/homes/owilde/programs/file.txt&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the prefix <code>"/homes/owilde/programs/"</code> is the path and
<code>"file.txt"</code> is still the file name. Each slash (<code>'/'</code>) separates a
parent directory from the files or directories inside of it. This path
specifies that we start at the root, go into the <code>homes</code> directory, then
the <code>owilde</code> directory, and then the <code>programs</code> directory. Note that we
can also use a single period (<code>.</code>) in a path to refer to the current
working directory and two periods (<code>..</code>) to refer to a parent directory.</p>
</div>
<div class="paragraph">
<p>This is one of those sticky places where Java is trying to be platform
independent, but the platforms each have different needs. The example we
gave above is for a Unix or Linux system. In Windows, the way to specify
the path is slightly different. Creating a similar <code>File</code> object on
Windows system might be done as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">File</span> <span class="tok-n">file</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-s">&quot;C:\\My Documents\\programs\\file.txt&quot;</span><span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, the path specifies that we start in the <code>C</code> drive, go into the
<code>My Documents</code> directory and then the <code>programs</code> directory. Windows
systems use a backslash (<code>\</code>) to separate a parent directory from its
children. But, in Java, a backslash is not allowed to be by itself in a
string literal, and so each backslash must be escaped with another
backslash. To simplify things somewhat, Java allows Windows paths to be
separated with regular slashes as well, so we will use this style for
the rest of the book.</p>
</div>
<div class="paragraph">
<p>If we return to objects of class <code>File</code>, there are a number of things we
can do directly. A <code>File</code> object has methods that can test if a file
with the associated name and path exists, if it is readable, if it is
writable, and many other things. Because there are so many classes
associated with file I/O and each class has so many methods, now is a
good time to remind you of the usefulness of the Java API. If you visit
<a href="http://docs.oracle.com/javase/" class="bare">http://docs.oracle.com/javase/</a>, you can choose the edition of Java you
are using and get detailed documentation for all of the standard
library, including file I/O classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reading_and_writing_text_files">20.3.2. Reading and writing text files</h4>
<div class="paragraph">
<p>Once you have a <code>File</code> object, its true usefulness comes from combining
it with other classes. You are already familiar with the <code>Scanner</code>
class, and once you have a <code>File</code> object, reading from a text file is
the same as reading from the keyboard.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">file</span> <span class="tok-o">);</span>
    <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextInt</span><span class="tok-o">()</span> <span class="tok-o">)</span>
        <span class="tok-n">process</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">FileNotFoundException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;File &quot;</span> <span class="tok-o">+</span> <span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; not found!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">in</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that <code>file</code> is linked to a file which the program has read
access to, this block of code will extract <code>int</code> values from the file
and pass them to the <code>process()</code> method. If the file does not exist or
is not readable to the program, a <code>FileNotFoundException</code> will be thrown
and an error message printed. Creating a <code>Scanner</code> from a <code>File</code> object
instead of <code>System.in</code> can throw a checked exception, and so the <code>try</code>
and <code>catch</code> are needed before the program will compile. Note that you
will need to import <code>java.util.Scanner</code> or <code>java.util.*</code> just like any
other time you use the <code>Scanner</code> class.</p>
</div>
<div class="paragraph">
<p>And that&#8217;s all there is to it. After opening the file, using the
<code>Scanner</code> class will be almost the same as before. One difference is
that you should close the <code>Scanner</code> object (and by extension the file)
when you are done reading from it, as we do in the example. Closing
files is key to writing robust code. You&#8217;ll notice that we put
<code>in.close()</code> in a <code>finally</code> block. Using <code>finally</code> is a good habit for
file I/O. File operations could fail for any number of reasons, but you
will still need to close the file afterwards. We put in the <code>null</code> check
in case the file didn&#8217;t exist and the reference <code>in</code> never pointed to a
valid object. (We also begin by setting <code>in</code> to <code>null</code>. Otherwise, Java
complains that it might not have been initialized.)</p>
</div>
<div class="paragraph">
<p>Writing information to a file is similar to using <code>System.out</code>. First,
you need to create a <code>PrintWriter</code> object. Unlike <code>Scanner</code>, you cannot
create a <code>PrintWriter</code> object directly from a <code>File</code> object. Instead,
you have to create a <code>FileOutputStream</code> object first. If we want to
write a list of random numbers to the file we were reading from earlier,
we could do it as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PrintWriter</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span> <span class="tok-n">file</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
    <span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">FileNotFoundException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;File &quot;</span> <span class="tok-o">+</span> <span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; not found!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">out</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, once you have a <code>PrintWriter</code> object, the methods for outputting
data will be just like using <code>System.out</code>. In this case, we already had
an <code>File</code> object lying around. To save time, the <code>FileOutputStream</code>
constructor can take a path name instead of a <code>File</code> object. So, it
would be equivalent to create the <code>PrintWriter</code> from above by supplying
a path like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PrintWriter</span><span class="tok-o">(</span>
<span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span> <span class="tok-s">&quot;/homes/owilde/programs/file.txt&quot;</span> <span class="tok-o">)</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to import <code>java.io.*</code> in order to have access to the
<code>FileOutputStream</code> and <code>PrintWriter</code> classes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reading_and_writing_binary_files">20.3.3. Reading and writing binary files</h4>
<div class="paragraph">
<p>We covered text files first because the input and output is similar to
console I/O. When reading and writing text files, it&#8217;s easy to verify
that what you wanted to write was written and what you read was what was
in the file. Binary files, however, are more powerful. Data, as in the
example with the integer 2127480645, can often be stored more compactly.
Even better, Java provides facilities for easily dumping (and later
retrieving) primitive data types, objects, and even complex data
structures to binary files.</p>
</div>
<div class="paragraph">
<p>The first object you&#8217;ll need to read input from a binary file is a
<code>FileInputStream</code> object. As before, all you need is a <code>File</code> object to
create one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">File</span> <span class="tok-n">file</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span> <span class="tok-s">&quot;file.bin&quot;</span> <span class="tok-o">);</span>
<span class="tok-n">FileInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span> <span class="tok-n">file</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As it happens, <code>FileInputStream</code> also allows you to call its constructor
with a <code>String</code> specifying the file path and name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">FileInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span> <span class="tok-s">&quot;file.bin&quot;</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The bad news is that you can&#8217;t do much with a <code>FileInputStream</code> object.
Its methods allow you to read single bytes, either one at a time, or a
group of them into an array. The basic <code>read()</code> method returns the next
byte in the file, or a -1 if the end of the file has been reached.
Working at the low level of bytes, we can still write useful code like
the following method which prints the size of a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">printFileSize</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">fileName</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">FileInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
        <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span> <span class="tok-n">fileName</span> <span class="tok-o">);</span>
        <span class="tok-kt">int</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
        <span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">read</span><span class="tok-o">()</span> <span class="tok-o">!=</span> <span class="tok-o">-</span><span class="tok-mi">1</span> <span class="tok-o">)</span>
            <span class="tok-n">count</span><span class="tok-o">++;</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;File size: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">count</span> <span class="tok-o">+</span> <span class="tok-s">&quot; bytes&quot;</span> <span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;File access failed.&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
    <span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">try</span><span class="tok-o">{</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">){}</span> <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the extra <code>try</code>-<code>catch</code> block inside of the <code>finally</code>. Like the
other binary file I/O objects we will discuss in this chapter,
<code>FileInputStream</code> can throw a <code>IOException</code> when closing. Usually, you
will not need to deal with this exception, but you still must catch it.
By catching any <code>Exception</code>, we can save a little bit of code by
eliminating the <code>null</code> check. If <code>in</code> is <code>null</code> in this example, a
<code>NullPointerException</code> will be thrown and immediately caught, causing no
damage.</p>
</div>
<div class="paragraph">
<p>To output a number of bytes, you can create a <code>FileOutputStream</code> object.
Its <code>write()</code> methods are the mirror images of the <code>read()</code> methods in
<code>FileInputStream</code>. For output, what we really want is an object which
will chop up primitive data types and objects into their component bytes
and send those bytes to a <code>FileOutputStream</code>. Then, for input, we would
want an object which could read a sequence of bytes from a
<code>FileInputStream</code> and reassemble them into whatever kind of data they
are supposed to be.</p>
</div>
<div class="paragraph">
<p>These objects exist, and they belong to the <code>ObjectInputStream</code> and
<code>ObjectOutputStream</code> classes, respectively. To create an
<code>ObjectInputStream</code>, you supply a <code>FileInputStream</code> to its constructor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span>
    <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span> <span class="tok-s">&quot;baseball.bin&quot;</span> <span class="tok-o">)</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s assume that <code>baseball.bin</code> contains baseball statistics. The
first thing in the file is an <code>int</code> indicating the number of records it
contains. Then, for each record, it will list home runs, RBI, and
batting average, as an <code>int</code>, an <code>int</code>, and a <code>float</code>, respectively.
Assuming that we&#8217;ve opened the file correctly above, we can read these
statistics into three arrays with the following code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">int</span> <span class="tok-n">records</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readInt</span><span class="tok-o">();</span>
<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">homeRuns</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">records</span><span class="tok-o">];</span>
<span class="tok-kt">int</span><span class="tok-o">[]</span> <span class="tok-n">RBI</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">int</span><span class="tok-o">[</span><span class="tok-n">records</span><span class="tok-o">];</span>
<span class="tok-kt">float</span><span class="tok-o">[]</span> <span class="tok-n">battingAverage</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-kt">float</span><span class="tok-o">[</span><span class="tok-n">records</span><span class="tok-o">];</span>
<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">records</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">homeRuns</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readInt</span><span class="tok-o">();</span>
    <span class="tok-n">RBI</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readInt</span><span class="tok-o">();</span>
    <span class="tok-n">battingAverage</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readFloat</span><span class="tok-o">();</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, all of the code should be enclosed in a <code>try</code> block with
appropriate exception handling and <code>in.close()</code> in a <code>finally</code> block at
the end. If an <code>ObjectInputStream</code> object tries to read past the end of
a file, an <code>EOFException</code> exception will be thrown. Using an
<code>ObjectInputStream</code> object to read from a file also assumes that the
file was created with an <code>ObjectOutputStream</code> object. If you substitute
<code>write</code> for <code>read</code>, <code>ObjectOutputStream</code> methods are almost the same as
<code>ObjectInputStream</code> methods. Below is a companion piece of code which
assumes that <code>homeRuns</code>, <code>RBI</code>, and <code>battingAverage</code> are filled with
data and writes them to a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span>
        <span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span><span class="tok-s">&quot;baseball.bin&quot;</span><span class="tok-o">)</span> <span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeInt</span><span class="tok-o">(</span> <span class="tok-n">homeRuns</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">);</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">homeRuns</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeInt</span><span class="tok-o">(</span> <span class="tok-n">homeRuns</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">);</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeInt</span><span class="tok-o">(</span> <span class="tok-n">RBI</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">);</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeFloat</span><span class="tok-o">(</span> <span class="tok-n">battingAverage</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-s">&quot;File writing failed.&quot;</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">try</span><span class="tok-o">{</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">){}</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>ObjectInputStream</code> and <code>ObjectOutputStream</code> in this way is not
too difficult, but it seems cumbersome. The objects provide methods
which elegantly allow you to read and write a whole object at a time. To
do so, we need to define a new class.</p>
</div>
<div id="BaseballPlayerProgram" class="listingblock">
<div class="title">Program 110. Serializable BaseballPlayer class.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.io.Serializable</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BaseballPlayer</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">homeRuns</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">RBI</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-kt">float</span> <span class="tok-n">battingAverage</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span>	<span class="tok-kd">public</span> <span class="tok-nf">BaseballPlayer</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">homeRuns</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">RBI</span><span class="tok-o">,</span> <span class="tok-kt">float</span> <span class="tok-n">battingAverage</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">homeRuns</span> <span class="tok-o">=</span> <span class="tok-n">homeRuns</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">RBI</span> <span class="tok-o">=</span> <span class="tok-n">RBI</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">battingAverage</span> <span class="tok-o">=</span> <span class="tok-n">battingAverage</span><span class="tok-o">;</span>
<span class="lineno">12 </span>	<span class="tok-o">}</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getHomeRuns</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">homeRuns</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">15 </span>	<span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-nf">getRBI</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">RBI</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">16 </span>	<span class="tok-kd">public</span> <span class="tok-kt">float</span> <span class="tok-nf">getBattingAverage</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">battingAverage</span><span class="tok-o">;</span> <span class="tok-o">}</span>
<span class="lineno">17 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The new class <code>BaseballPlayer</code> encapsulates the three pieces of
information we want. Note that it also implements the interface
<code>Serializable</code>, but it doesn&#8217;t seem to implement any special methods to
conform to the interface. We&#8217;ll discuss this more after we show how
using this new class can simplify the file I/O. The input will change to
the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span>
        <span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span> <span class="tok-s">&quot;baseball.bin&quot;</span> <span class="tok-o">));</span>
    <span class="tok-kt">int</span> <span class="tok-n">records</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readInt</span><span class="tok-o">();</span>
    <span class="tok-n">BaseballPlayer</span><span class="tok-o">[]</span> <span class="tok-n">players</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BaseballPlayer</span><span class="tok-o">[</span><span class="tok-n">records</span><span class="tok-o">];</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">players</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">players</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">BaseballPlayer</span><span class="tok-o">)</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readObject</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-s">&quot;File reading failed.&quot;</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">try</span><span class="tok-o">{</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">){}</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will become what follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span>
        <span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span> <span class="tok-s">&quot;baseball.bin&quot;</span> <span class="tok-o">));</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeInt</span><span class="tok-o">(</span> <span class="tok-n">players</span><span class="tok-o">.</span><span class="tok-na">length</span> <span class="tok-o">);</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">players</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeObject</span><span class="tok-o">(</span> <span class="tok-n">players</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-s">&quot;File writing failed.&quot;</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">try</span><span class="tok-o">{</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">){}</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This process of outputting an entire object at a time is called
<em>serialization</em>. The <code>BaseballPlayer</code> class is very simple, but even
complex objects can be serialized, and Java takes care of almost
everything for you. The only magic needed is for the class which is
going to be serialized to implement <code>Serializable</code>. There are no methods
in <code>Serializable</code>. It is just a tag for a class which can be packed up
and stored. The catch is that, if there are any references to other
objects inside of the object being serialized, they must also be
serializable. Otherwise, a <code>NotSerializableException</code> will be thrown
when the JVM tries to serialize. Most things are serializable, including
the vast majority of the Java API.</p>
</div>
<div class="paragraph">
<p>However, objects which have some kind of special system dependent state,
like a <code>Thread</code> or a<br>
<code>FileInputStream</code> object cannot be serialized. If you need to serialize
a class with references to objects like these, add the <code>transient</code>
keyword to the declaration of each unserializable reference. That said,
these should be few and far between. For <code>BaseballPlayer</code>, adding
<code>implements Serializable</code> was all that was needed, and we can still get
more mileage out of it. Consider that an array can be treated liked an
<code>Object</code> and is also serializable. We can further simplify the input as
below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span>
        <span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span> <span class="tok-s">&quot;baseball.bin&quot;</span> <span class="tok-o">));</span>
    <span class="tok-n">BaseballPlayer</span><span class="tok-o">[]</span> <span class="tok-n">players</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">BaseballPlayer</span><span class="tok-o">[])</span><span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readObject</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-s">&quot;File reading failed.&quot;</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">try</span><span class="tok-o">{</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">){}</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the corresponding output code can be simplified as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">try</span> <span class="tok-o">{</span>
    <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span>
        <span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span> <span class="tok-s">&quot;baseball.bin&quot;</span> <span class="tok-o">));</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeObject</span><span class="tok-o">(</span> <span class="tok-n">players</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-s">&quot;File writing failed.&quot;</span> <span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">try</span><span class="tok-o">{</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">){}</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is worth noting that <code>DataInputStream</code> and <code>DataOutputStream</code> objects
can be used in place of <code>ObjectInputStream</code> and <code>ObjectOutputStream</code>
objects if you only need to read and write primitive data.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_file_examples">20.4. Examples: File examples</h3>
<div class="exampleblock">
<div class="title">Example 163. Directory listing</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s return to the <code>File</code> class and look at another example of how to
use it. It is often useful to know the contents of a directory. At the
Windows command prompt, this is usually done using the <code>dir</code> command; in
Linux and Unix, the <code>ls</code> command is generally used. In a few lines of
code, we can write a directory listing tool which lists all the files in
a directory, the dates each was last modified, and whether or not a file
is a directory.</p>
</div>
<div id="DirectoryProgram" class="listingblock">
<div class="title">Program 111. Directory listing tool.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.text.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Directory</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-n">File</span> <span class="tok-n">directory</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-s">&quot;.&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-n">File</span><span class="tok-o">[]</span> <span class="tok-n">files</span> <span class="tok-o">=</span> <span class="tok-n">directory</span><span class="tok-o">.</span><span class="tok-na">listFiles</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>		<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-n">File</span> <span class="tok-n">file</span> <span class="tok-o">:</span> <span class="tok-n">files</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-n">DateFormat</span><span class="tok-o">.</span><span class="tok-na">getDateInstance</span><span class="tok-o">().</span><span class="tok-na">format</span><span class="tok-o">(</span>
<span class="lineno">11 </span>				<span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span> <span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">lastModified</span><span class="tok-o">())</span> <span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot;\t&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">isDirectory</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno">13 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-s">&quot;directory&quot;</span> <span class="tok-o">);</span>
<span class="lineno">14 </span>			<span class="tok-k">else</span>
<span class="lineno">15 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span> <span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">);</span>
<span class="lineno">16 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-s">&quot;\t&quot;</span> <span class="tok-o">+</span>  <span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">17 </span>		<span class="tok-o">}</span>
<span class="lineno">18 </span>	<span class="tok-o">}</span>
<span class="lineno">19 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the code first creates a <code>File</code> object using <code>"."</code> to
specify the current working directory. The <code>listFiles()</code> method returns
an array of <code>File</code> objects which we then iterate over. We call
<code>lastModified()</code> on each file to get its date, <code>isDirectory()</code> to see if
it is a directory, and finally print the name given by <code>getName()</code>.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 164. Radiuses stored in a file</div>
<div class="content">
<div class="paragraph">
<p>Now, let&#8217;s look at a data processing application of files. Let&#8217;s assume
that there is a file called <code>radiuses.txt</code> which holds the radiuses of a
number of circles formatted as text, one on each line of the file. It&#8217;s
our job to read each radius, compute the area of the circle, and write
those areas to a file called <code>areas.txt</code>, using the formula
\(A = \pi r^2\).</p>
</div>
<div id="AreaFromRadiusTextProgram" class="listingblock">
<div class="title">Program 112. Reads a list of radiuses from a text file and output their areas to another file.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AreaFromRadiusText</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>		<span class="tok-n">File</span> <span class="tok-n">inFile</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span> <span class="tok-s">&quot;radiuses.txt&quot;</span> <span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">File</span> <span class="tok-n">outFile</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span> <span class="tok-s">&quot;areas.txt&quot;</span> <span class="tok-o">);</span>
<span class="lineno"> 8 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-kt">double</span> <span class="tok-n">radius</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>			<span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">inFile</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>			<span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PrintWriter</span><span class="tok-o">(</span> <span class="tok-n">outFile</span> <span class="tok-o">);</span>
<span class="lineno">14 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextDouble</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>				<span class="tok-n">radius</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextDouble</span><span class="tok-o">();</span>
<span class="lineno">16 </span>				<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">PI</span><span class="tok-o">*</span><span class="tok-n">radius</span><span class="tok-o">*</span><span class="tok-n">radius</span> <span class="tok-o">);</span>
<span class="lineno">17 </span>			<span class="tok-o">}</span>
<span class="lineno">18 </span>		<span class="tok-o">}</span>
<span class="lineno">19 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">21 </span>		<span class="tok-o">}</span>
<span class="lineno">22 </span>		<span class="tok-k">finally</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">in</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="lineno">24 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">out</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="lineno">25 </span>		<span class="tok-o">}</span>
<span class="lineno">26 </span>	<span class="tok-o">}</span>
<span class="lineno">27 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous class did all of its input and output with text files. We
will also implement this program to read from a binary file called
<code>radiuses.bin</code> and write to a binary file called <code>areas.bin</code>.</p>
</div>
<div id="AreaFromRadiusBinaryProgram" class="listingblock">
<div class="title">Program 113. Reads a list of radiuses from a binary file and output their areas to another file.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AreaFromRadiusBinary</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">File</span> <span class="tok-n">inFile</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span> <span class="tok-s">&quot;radiuses.bin&quot;</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>		<span class="tok-n">File</span> <span class="tok-n">outFile</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span> <span class="tok-s">&quot;areas.bin&quot;</span> <span class="tok-o">);</span>
<span class="lineno"> 7 </span>		<span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>		<span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>		<span class="tok-kt">double</span> <span class="tok-n">radius</span><span class="tok-o">;</span>
<span class="lineno">10 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>			<span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span>
<span class="lineno">12 </span>				<span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span> <span class="tok-n">inFile</span> <span class="tok-o">));</span>
<span class="lineno">13 </span>			<span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span>
<span class="lineno">14 </span>				<span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span> <span class="tok-n">outFile</span> <span class="tok-o">));</span>
<span class="lineno">15 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>				<span class="tok-n">radius</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readDouble</span><span class="tok-o">();</span>
<span class="lineno">17 </span>				<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeDouble</span><span class="tok-o">(</span>  <span class="tok-n">Math</span><span class="tok-o">.</span><span class="tok-na">PI</span><span class="tok-o">*</span><span class="tok-n">radius</span><span class="tok-o">*</span><span class="tok-n">radius</span> <span class="tok-o">);</span>
<span class="lineno">18 </span>			<span class="tok-o">}</span>
<span class="lineno">19 </span>		<span class="tok-o">}</span>
<span class="lineno">20 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">EOFException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">21 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">22 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">23 </span>		<span class="tok-o">}</span>
<span class="lineno">24 </span>		<span class="tok-k">finally</span> <span class="tok-o">{</span>
<span class="lineno">25 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">){}</span>
<span class="lineno">26 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">){}</span>
<span class="lineno">27 </span>		<span class="tok-o">}</span>
<span class="lineno">28 </span>	<span class="tok-o">}</span>
<span class="lineno">29 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There should be few surprises in this piece of code as only a few
changes have been made so that <code>ObjectInputStream</code> and
<code>ObjectOutputStream</code> objects could be used. You may notice that the
input <code>while</code> loop is an infinite loop. The easiest way to see if there
is any more data in a binary file is to keep reading until an
<code>EOFException</code> is thrown. As you can see, we do nothing to handle this
exception, because, in this case, it is just a signal to stop reading.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_a_picture_is_worth_1_000_bytes">20.5. Solution: A picture is worth 1,000 bytes</h3>
<div class="paragraph">
<p>Now we will give the solution to the problem posed at the beginning of
the chapter. First, let&#8217;s look at the class definition and <code>main()</code>
method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BitmapCompression</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>		<span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>			<span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span><span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]));</span>
<span class="lineno"> 8 </span>			<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;-c&quot;</span><span class="tok-o">))</span>
<span class="lineno"> 9 </span>				<span class="tok-n">compress</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">,</span> <span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>			<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;-d&quot;</span><span class="tok-o">))</span>
<span class="lineno">11 </span>				<span class="tok-n">decompress</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">,</span> <span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-o">}</span>
<span class="lineno">13 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Bad input: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">15 </span>		<span class="tok-o">}</span>
<span class="lineno">16 </span>		<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">try</span><span class="tok-o">{</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">){}</span> <span class="tok-o">}</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we open an <code>ObjectInputStream</code> based on the file named passed as
the second command line parameter. Then, we either compress or
decompress the file depending on which switch is passed as the first
command line parameter. The <code>catch</code> block will deal with the
<code>FileNotFoundException</code> or the <code>IOException</code> which could be thrown by
opening the file, as well as <code>ArrayIndexOutOfBoundsException</code> which
could be caused if there are not enough command line arguments. In
either case, the vague message <code>"Bad input: "</code> will be output with the
message from the exception. Commercial-grade code should give a more
specific error.</p>
</div>
<div class="paragraph">
<p>After the rest of the method, note the usual <code>finally</code> block where the
file is closed, including the inner <code>try</code>-<code>catch</code> blocks needed to
safely close binary files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">compress</span><span class="tok-o">(</span> <span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span><span class="tok-o">,</span>
<span class="lineno"> 2 </span>		<span class="tok-n">String</span> <span class="tok-n">file</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-kt">int</span> <span class="tok-n">temp</span><span class="tok-o">,</span> <span class="tok-n">current</span><span class="tok-o">,</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>			<span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span>
<span class="lineno"> 7 </span>				<span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span> <span class="tok-n">file</span> <span class="tok-o">+</span> <span class="tok-s">&quot;.compress&quot;</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno"> 8 </span>			<span class="tok-n">current</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">read</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">read</span><span class="tok-o">())</span> <span class="tok-o">!=</span> <span class="tok-o">-</span><span class="tok-mi">1</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>				<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">temp</span> <span class="tok-o">==</span> <span class="tok-n">current</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">count</span> <span class="tok-o">&lt;</span> <span class="tok-mi">127</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>					<span class="tok-n">count</span><span class="tok-o">++;</span>
<span class="lineno">12 </span>				<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">13 </span>					<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeByte</span><span class="tok-o">(</span> <span class="tok-n">count</span> <span class="tok-o">);</span>
<span class="lineno">14 </span>					<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeByte</span><span class="tok-o">(</span> <span class="tok-n">current</span> <span class="tok-o">);</span>
<span class="lineno">15 </span>					<span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">16 </span>					<span class="tok-n">current</span> <span class="tok-o">=</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno">17 </span>				<span class="tok-o">}</span>
<span class="lineno">18 </span>			<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span> <span class="tok-n">count</span> <span class="tok-o">);</span>
<span class="lineno">19 </span>			<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span> <span class="tok-n">current</span> <span class="tok-o">);</span>
<span class="lineno">20 </span>			<span class="tok-o">}</span>
<span class="lineno">21 </span>		<span class="tok-o">}</span>
<span class="lineno">22 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Compression failed: &quot;</span>
<span class="lineno">24 </span>				<span class="tok-o">+</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">25 </span>		<span class="tok-o">}</span>
<span class="lineno">26 </span>		<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">try</span> <span class="tok-o">{</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span><span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">){}</span> <span class="tok-o">}</span>
<span class="lineno">27 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>compress()</code> method we first open a new <code>ObjectOutputStream</code> for
a file named the same as the input file with <code>.compress</code> tacked on the
end. Then, we read in bytes of data from the input file. As long as we
keep seeing the same byte, we increment a counter. When we run into a
new byte (or when we reach the limit of 127 of the same consecutive
byte), we write the count and the byte we&#8217;ve been reading and move on.
When <code>in.read()</code> returns <code>-1</code>, we know that we&#8217;ve reached the end of the
file and output the last count and last byte value. The method finishes
with the usual <code>catch</code> and <code>finally</code> blocks needed to catch errors and
safely close the output file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">decompress</span><span class="tok-o">(</span> <span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span><span class="tok-o">,</span>
<span class="lineno"> 2 </span>		<span class="tok-n">String</span> <span class="tok-n">file</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-kt">int</span> <span class="tok-n">count</span><span class="tok-o">,</span> <span class="tok-n">temp</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>			<span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span>
<span class="lineno"> 7 </span>				<span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span> <span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span> <span class="tok-mi">0</span><span class="tok-o">,</span>
<span class="lineno"> 8 </span>					<span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">lastIndexOf</span><span class="tok-o">(</span><span class="tok-s">&quot;.compress&quot;</span><span class="tok-o">))</span> <span class="tok-o">));</span>
<span class="lineno"> 9 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">read</span><span class="tok-o">())</span> <span class="tok-o">!=</span> <span class="tok-o">-</span><span class="tok-mi">1</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>				<span class="tok-n">temp</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readByte</span><span class="tok-o">();</span>
<span class="lineno">11 </span>				<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">count</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
<span class="lineno">12 </span>					<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeByte</span><span class="tok-o">(</span> <span class="tok-n">temp</span> <span class="tok-o">);</span>
<span class="lineno">13 </span>			<span class="tok-o">}</span>
<span class="lineno">14 </span>		<span class="tok-o">}</span>
<span class="lineno">15 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Decompression failed: &quot;</span>
<span class="lineno">17 </span>				<span class="tok-o">+</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">18 </span>		<span class="tok-o">}</span>
<span class="lineno">19 </span>		<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">try</span><span class="tok-o">{</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span> <span class="tok-k">catch</span><span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">){}</span> <span class="tok-o">}</span>
<span class="lineno">20 </span>	<span class="tok-o">}</span>
<span class="lineno">21 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>decompress()</code> method is even simpler than <code>compress()</code>. It begins
by opening a new <code>ObjectOutputStream</code> for a file named the same as the
input file with a <code>.compress</code> extension stripped off. Then, it reads a
count, reads a byte value, and writes the byte value as many times as
the count specifies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_file_i_o">20.6. Concurrency: File I/O</h3>
<div class="paragraph">
<p>By now, you have seen threads behave in unpredictable ways because of
the way they are reading and writing to shared variables. Well, isn&#8217;t a
file a shared resource as well? What happens when two threads try to
access a file at the same time? If both threads are reading from the
file, everything should work fine. If the threads are both writing or
doing a combination of reading and writing, there can be problems.</p>
</div>
<div class="paragraph">
<p>As we mentioned in <a href="#_syntax_file_operations_in_java">Section 20.3</a>, file
operations are OS dependent. Although Java tries to give a uniform
interface, different system calls are happening at a low level.
Consequently, the results may be different as well.</p>
</div>
<div class="paragraph">
<p>Consider the following program that spawns two threads that both print a
series of numbers to a file called <code>concurrent.out</code>. The first thread
prints the even numbers between 0 and 9,999 while the second thread
prints the odd ones.</p>
</div>
<div id="ConcurrentFileAccessProgram" class="listingblock">
<div class="title">Program 114. Spawns threads that print odd and even numbers to a file concurrently.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ConcurrentFileAccess</span> <span class="tok-kd">implements</span> <span class="tok-n">Runnable</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">even</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">args</span><span class="tok-o">[])</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>		<span class="tok-n">Thread</span> <span class="tok-n">writer1</span> <span class="tok-o">=</span>
<span class="lineno"> 8 </span>			<span class="tok-k">new</span> <span class="tok-n">Thread</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">ConcurrentFileAccess</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno"> 9 </span>		<span class="tok-n">Thread</span> <span class="tok-n">writer2</span> <span class="tok-o">=</span>
<span class="lineno">10 </span>			<span class="tok-k">new</span> <span class="tok-n">Thread</span><span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">ConcurrentFileAccess</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno">11 </span>		<span class="tok-n">writer1</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">12 </span>		<span class="tok-n">writer2</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">13 </span>	<span class="tok-o">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>	<span class="tok-kd">public</span> <span class="tok-nf">ConcurrentFileAccess</span><span class="tok-o">(</span> <span class="tok-kt">boolean</span> <span class="tok-n">even</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">even</span> <span class="tok-o">=</span> <span class="tok-n">even</span><span class="tok-o">;</span>
<span class="lineno">17 </span>	<span class="tok-o">}</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>		<span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">21 </span>		<span class="tok-kt">int</span> <span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno">22 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">even</span> <span class="tok-o">)</span>
<span class="lineno">23 </span>			<span class="tok-n">start</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
<span class="lineno">24 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">25 </span>			<span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PrintWriter</span> <span class="tok-o">(</span>
<span class="lineno">26 </span>					<span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span> <span class="tok-o">(</span> <span class="tok-s">&quot;concurrent.out&quot;</span><span class="tok-o">,</span> <span class="tok-kc">true</span> <span class="tok-o">)</span> <span class="tok-o">);</span> <span class="tok-cm">/*@\label{open concurrent file}@*/</span>
<span class="lineno">27 </span>			<span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-n">start</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">10000</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">+=</span> <span class="tok-mi">2</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">28 </span>				<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">println</span> <span class="tok-o">(</span> <span class="tok-n">i</span> <span class="tok-o">);</span> <span class="tok-cm">/*@\label{output data concurrently}@*/</span>
<span class="lineno">29 </span>				<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">flush</span><span class="tok-o">();</span>
<span class="lineno">30 </span>			<span class="tok-o">}</span>
<span class="lineno">31 </span>
<span class="lineno">32 </span>		<span class="tok-o">}</span>
<span class="lineno">33 </span>		<span class="tok-k">catch</span> <span class="tok-o">(</span> <span class="tok-n">FileNotFoundException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">34 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;concurrent.out not found!&quot;</span><span class="tok-o">);</span>
<span class="lineno">35 </span>		<span class="tok-o">}</span>
<span class="lineno">36 </span>		<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">out</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span> <span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">37 </span>	<span class="tok-o">}</span>
<span class="lineno">38 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code in this program should have no surprises. The <code>main()</code> method
creates two <code>Thread</code> objects based on <code>ConcurrentFileAccess</code> objects,
each with a different value for its <code>even</code> field. Then, the <code>main()</code>
method starts the threads running. In each thread&#8217;s <code>run()</code> method, it
opens the file and starts printing out even or odd numbers, depending on
which thread it is. Afterwards, each thread closes the file and ends.</p>
</div>
<div class="paragraph">
<p>What do you expect the file <code>concurrent.out</code> to look like after the
program has completed? Run it several times, on Windows, Linux, and Mac
computers, if you can. Most likely, the file will contain either all the
even numbers from 0 to 9,998 or all the odd numbers from 1 to 9,999. If
you run the program enough times, you should be able to see both
possibilities.</p>
</div>
<div class="paragraph">
<p>Why are half the numbers getting lost? When you open a file for writing,
by default it erases everything that was already in the file. So, an
entire sequence of numbers is getting saved and then lost. We can change
this behavior by changing the line below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PrintWriter</span> <span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span><span class="tok-s">&quot;concurrent.out&quot;</span><span class="tok-o">)</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We replace it with the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PrintWriter</span> <span class="tok-o">(</span> <span class="tok-k">new</span> <span class="tok-n">FileOutputStream</span><span class="tok-o">(</span><span class="tok-s">&quot;concurrent.out&quot;</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">)</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This second <code>boolean</code> parameter to the <code>FileOutputStream</code> constructor
specifies that output will <em>append</em> to the file instead of overwriting
it.</p>
</div>
<div class="paragraph">
<p>After this change, what does the file look like when we run the program?
Since we are going to append to any preexisting file, make sure that you
delete <code>concurrent.out</code> before running the program again. The file may
look different on different systems. The file probably contains long
runs of numbers from each thread. In fact, it is quite possible to have
the complete output from one thread followed by the complete output from
the other.</p>
</div>
<div class="paragraph">
<p>For performance reasons, file operations are usually done in batches.
Instead of writing each number to the file as the thread produces it,
output is usually stored in a buffer which is written as a whole. If we
call <code>out.flush()</code> after line <a href="#output_data_concurrently">[output_data_concurrently]</a>, we can flush
the buffer to the file after each number is generated. Doing so will not
be as efficient, but it may give us some insight into how concurrent
writes on files work.</p>
</div>
<div class="paragraph">
<p>Using flushes, the output from the two threads should be thoroughly
intermixed. On a Windows machine, if you copy the data from the file and
sort it, you will probably see some numbers missing. This lost output is
similar to situations where updates to variables were lost because they
were overwritten by another thread. On the other hand, most Linux
systems have better concurrent file writing and will not lose any
numbers. (Even on Linux, it is possible for a number to be printed in
the middle of another number, but no digits should be lost.)</p>
</div>
<div class="paragraph">
<p>Under ideal circumstances, no two threads or processes should be writing
to the same file. However, this situation is sometimes unavoidable, as
with a database program that must support concurrent writes for the sake
of speed. If you need to enforce file locking, you can prevent threads
within your own program from accessing a file concurrently by using
normal Java synchronization tools. If you expect other programs to
interact with the same files that your program will use, Java provides a
<code>FileLock</code> class which allows the user to lock up portions of a file. As
with everything file-related, <code>FileLock</code> is dependent on the underlying
OS and may behave differently on different systems.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_20">20.7. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise20.1"></a> What is the difference between volatile and non-volatile memory?
Which is often associated with files and why?</p>
</li>
<li>
<p><a id="exercise20.1"></a> What is the difference between text and binary files? What are the
pros and cons of using each?</p>
</li>
<li>
<p><a id="exercise20.3"></a> Define compression ratio to be the size of the uncompressed data in
bytes divided by the size of the compressed data in bytes. What is the
theoretical maximum compression ratio you can get out of the RLE
encoding we used? What is the theoretical lowest compression ratio you
can get out of the RLE encoding we used?</p>
</li>
<li>
<p><a id="exercise20.4"></a> What is serialization in Java? What do you have to do to serialize
an object?</p>
</li>
<li>
<p><a id="exercise20.5"></a> What kinds of objects cannot be serialized?</p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise20.6"></a> Implement the RLE bitmap compression program using only
<code>FileInputStream</code> and <code>FileOutputStream</code> for file input and output.</p>
</li>
<li>
<p><a id="exercise20.7"></a> Re-implement the maze solving program from <a href="#_solution_maze_of_doom">Section 19.5</a> to ask the user for a file instead of reading from standard
input.</p>
</li>
<li>
<p><a id="exercise20.8"></a> An HTML file contains many tags such as <code>&lt;p&gt;</code>, which marks the
beginning of a paragraph, and <code>&lt;/p&gt;</code>, which marks the end of a
paragraph. A lesser known feature of HTML is that ampersand (<code>&amp;</code>) can
mark special HTML entities used to produce symbols on a web page. For
example, <code>&amp;pi;</code> is the entity for the Greek letter \(\pi\).
Because of these features of the language, raw text that is going to be
marked up in HTML should not contain less than signs (<code>&lt;</code>), greater than
signs (<code>&gt;</code>), or ampersands (<code>&amp;</code>).</p>
<div class="paragraph">
<p>Write a program that reads in an input text file specified by the user
and writes to an output text file also specified by the user. The output
file should be exactly the same as the input file except that every
occurrence of a less than sign should be replaced by <code>&amp;lt;</code>, every
occurrence of a greater than sign should be replaced by <code>&amp;gt;</code>, and
every occurrence of an ampersand should be replaced by <code>&amp;</code>.</p>
</div>
</li>
<li>
<p><a id="exercise20.9"></a> Write a program that prompts the user for an
input text file. Open the file and read each word from the file, where a
word is defined as any <code>String</code> made up only of upper and lower case
letters. You can use the <code>next()</code> method in the <code>Scanner</code> class to break
up text by whitespace, but your code will still need to examine the
input character by character, ending a word when any punctuation or
other characters are reached. Store each word (with a count of the
number of times you find it) in a binary search tree such as those
described in <a href="#binarySearchTreeExample">Example 158</a>. Then, traverse the
tree, printing all the words found (and the number of times found) to
the screen in alphabetical order.</p>
</li>
<li>
<p><a id="exercise20.10"></a> Expand the program from <a href="#exercise20.9">Exercise 20.9</a> so that it
also prompts for a second file containing a dictionary in the form of a
word list with one word on each line. Store the words from the
dictionary in another binary search tree. Then, for each word in the
larger document that you cannot find in the dictionary tree, add it to a
third binary search tree. Finally, print out the contents of this third
binary search tree to the screen, and you will have implemented a
rudimentary spell checker. You can test the quality of your
implementation by using a novel from Project Gutenberg
(<a href="http://www.gutenberg.org/" class="bare">http://www.gutenberg.org/</a>) and a dictionary file from an open source
spell checker or from a Scrabble word list.</p>
</li>
<li>
<p><a id="exercise20.11"></a> Files can become corrupted when they are transferred over a network.
It is common to make a <em>checksum</em>, a short code generated using the
entire contents of a file. The checksum can be generated before and
after file transmission. If both of the checksums match, there&#8217;s a good
chance that there were no transmission errors. Of course, there can be
problems sending checksums, but checksums are much smaller and therefore
less likely to be corrupted. Modern checksums are often generated using
cryptographic hash functions, which are more complex than we want to
deal with here. An older checksum algorithm works in the following way.
Although we use mathematical notation, the operations specified below
are integer modulus and integer division.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add up the values of all the bytes, storing this sum in a <code>long</code>
variable</p>
</li>
<li>
<p>Set \(sum = sum\mod 2^{32}\)</p>
</li>
<li>
<p>Let \(r = (sum\mod 2^{16}) + (sum \div 2^{16})\)</p>
</li>
<li>
<p>Let \(s = (r\mod 2^{16}) + (r \div 2^{16})\)</p>
</li>
<li>
<p>The final checksum is \(s\)</p>
<div class="paragraph">
<p>Remember that finding powers of 2 is easy with bitwise shifts. Write a
program that opens a file for binary reading using <code>FileInputStream</code> and
outputs the checksum described. On Linux systems, you can check the
operation of your program with the <code>sum</code> utility, using the <code>-s</code> option.
The following is an example of the command used on a file called
<code>wombat.dat</code>. The first number in the output below it, <code>6892</code>, is the
checksum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">sum</span> <span class="tok-o">-</span><span class="tok-n">s</span> <span class="tok-n">wombat</span><span class="tok-o">.</span><span class="tok-na">dat</span>
<span class="tok-mi">6892</span> <span class="tok-mi">213</span> <span class="tok-n">wombat</span><span class="tok-o">.</span><span class="tok-na">dat</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><a id="exercise20.12"></a> Write the RLE bitmap compression program in parallel so that a file
is evenly divided into as many pieces as you have threads, compressed,
and then each compressed portion is output in the correct order. Compare
the speed for 2, 4, and 8 threads to the sequential implementation. Are
any of the threaded versions faster? Why or why not? Run some
experiments to see how long it takes to read 1,000,000 bytes from a file
compared to the time it takes to compress 1,000,000 bytes which are
already stored in an array.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_communication">21. Network Communication</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Arguing with anonymous strangers on the Internet is a sucker&#8217;s game because they almost always
turn out to be&#8212;&#8203;or to be indistinguishable from&#8212;&#8203;self-righteous sixteen-year-olds possessing
infinite amounts of free time.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Neal Stephenson
</div>
</div>
<div class="sect2">
<h3 id="_problem_web_server">21.1. Problem: Web server</h3>
<div class="paragraph">
<p>It is no accident that the previous chapter about file I/O is followed
by this one about networking. At first glance, the two probably seem
unrelated. As it happens, both files and networks are used for input and
output, and the designers of Java were careful to create an API with a
similar interface for both.</p>
</div>
<div class="paragraph">
<p>In the next two sections, we discuss how this API works, but first we
introduce the problem: You need to create a web server application. The
term <em>server</em> is used to describe a computer on a network which other
computers, called <em>clients</em>, connect to in order to access some services
or resources. When you surf the Internet, your computer is a client
connecting to web servers all over the world. Writing a web server might
seem like a daunting task. The web browser you run on your client
computer (e.g. Chrome, Firefox, Internet Explorer, or Safari) is, in modern
times, a very complicated program, capable of playing sounds and movies,
browsing in multiple tabs, automatically encrypting and decrypting
secure information, and, at the very least, correctly displaying web
pages of every description.</p>
</div>
<div class="paragraph">
<p>In contrast, a web server application is much simpler. At its heart, a
web server application gets requests for files and sends those files
over the network. More advanced servers can execute code and dynamically
generate pages, and many web servers are multi-threaded to support heavy
traffic. The web server you are writing needs only to focus on getting
requests for files and sending those files back to the requester.</p>
</div>
<div class="sect3">
<h4 id="_http_requests">21.1.1. HTTP requests</h4>
<div class="paragraph">
<p>To receive requests, a web server uses something called <em>hypertext
transfer protocol (HTTP)</em>, which is just a way of specifying the format
of the requests. The only request we are interested in is the <code>GET</code>
request. All <code>GET</code> requests have the following format.<br>
<code>GET</code> <strong>path</strong> <code>HTTP/</code><strong>version</strong><br>
where <strong>path</strong> is the path of the file being requested and <strong>version</strong> is
the HTTP version number. A typical request might be as follows.<br>
<code>GET /images/banner.jpg HTTP/1.1</code><br>
You should also note that all HTTP commands end with <strong>two</strong> newline
characters (<code>'\\n'</code>). The extra blank line makes it easier to separate
the commands from other data being sent.</p>
</div>
</div>
<div class="sect3">
<h4 id="_http_responses">21.1.2. HTTP responses</h4>
<div class="paragraph">
<p>After your web server receives a <code>GET</code> message, it looks for the file
specified by the <strong>path</strong>. If the server finds the file, it sends the
following message.<br>
<code>HTTP/1.1 200 OK</code><br>
Again, note that this message is followed with two newline characters.
After this message is sent, the server sends the requested file, byte by
byte across the network. If the file cannot be found by the web server,
it sends an error message as follows.<br>
<code>HTTP/1.1 404 Not Found</code><br>
Of course, two newlines will be sent after this as well. After the error
message, servers will also typically send some default web page with an
explanation in HTML.</p>
</div>
<div class="paragraph">
<p>Now, we return to the more fundamental problem of how to communicate
over a network.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concepts_tcp_ip_communication">21.2. Concepts: TCP/IP communication</h3>
<div class="paragraph">
<p>We begin where nearly every discussion of computer networking begins,
with the Open Systems Interconnection Basic Reference Model (or OSI
model). As we mentioned before, the designers of Java wanted to make a
networking API which was very similar to the file system API. This
single API must be used for JVM&#8217;s running on Windows or on Mac OS or on
Linux or any other operating system. Even with the same operating
system, different computers have different hardware. Some computers have
wired connections to a router or gateway. Others are connected
wirelessly. And somehow, you have to figure out the address of the
computer you want to send messages to and deal with its network,
hardware, and software.</p>
</div>
<div class="paragraph">
<p>There are so many steps in the process that it seems hopelessly
complicated. To combat this problem, the OSI seven layer model was
developed. Each layer defines a specification for one aspect of the
communication path between two computers. As long as a particular layer
interacts smoothly with the one above it and below it, that layer could
take the form of many different hardware or software choices. Listing
them in order from the highest level (closest to the user) to the lowest
level (closest to the hardware), the layers are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Layer 7: Application Layer</p>
</li>
<li>
<p>Layer 6: Presentation Layer</p>
</li>
<li>
<p>Layer 5: Session Layer</p>
</li>
<li>
<p>Layer 4: Transport Layer</p>
</li>
<li>
<p>Layer 3: Network Layer</p>
</li>
<li>
<p>Layer 2: Data Link Layer</p>
</li>
<li>
<p>Layer 1: Physical Layer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application layer is where your code is. The Java networking API
calls that your code uses to send and receive data comprise the
application layer for your purposes. The only thing above this layer is
the user. Protocols like HTTP and FTP are the province of this layer.
All the other communication problems have been solved, and the key issue
is what to do with the data that is communicated.</p>
</div>
<div class="paragraph">
<p>The presentation layer changes one kind of message encoding to another.
This layer is not one people usually spend a lot of time worrying about,
but some kinds of encryption and compression can happen here.</p>
</div>
<div class="paragraph">
<p>The session layer allows for the creation of sessions when communicating
between computers. Sessions requiring authentication and permissions can
be dealt with here, but,in practice, this layer is not often used. One
notable exception is the Secure Sockets Layer (SSL), the technology most
commonly used to protect passwords and credit card numbers when you make
online purchases.</p>
</div>
<div class="paragraph">
<p>The transport layer is concerned with the making the lower level
communication of data more transparent to higher layers. This layer
typically breaks larger messages into smaller packets of data which can
be sent across the network. This layer can also provide reliability by
checking to see if these packets make it to their destinations and
resending them otherwise. The two most important protocols for this
layer are Transmission Control Protocol (TCP) and User Datagram Protocol
(UDP). TCP is more commonly used and provides communication that is
reliable and ensures that packets are delivered in order. TCP is used
for file transfers, e-mail, web browsing, and any number of other web
applications. UDP does not have guarantees about reliability or
ordering; however, UDP is faster. For this reason, UDP is used for
streaming media and online games.</p>
</div>
<div class="paragraph">
<p>The network layer is responsible for packet transmission from source to
destination. It is concerned with addressing schemes and routing. The
most well-known example of a network layer protocol is the Internet
Protocol (IP) used to make the Internet work.</p>
</div>
<div class="paragraph">
<p>If the network layer worries about sending of packets from source to
destination, the data link layer is responsible for the actual
transmission of packets between each link in the chain. Here hardware
becomes more important because there are so many different kinds of
networks. Examples of data link layers include Ethernet, token ring
networks, IEEE 802.11 wireless networks, and many more.</p>
</div>
<div class="paragraph">
<p>Finally, the lowest level is the physical layer. This layer defines the
actual physical specifications for sending raw information from one
place to another, over a wire or wirelessly. This layer is typically the
least interesting to programmers but is a key area for electrical
engineers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_syntax_networking_in_java">21.3. Syntax: Networking in Java</h3>
<div class="paragraph">
<p>The seven layer model might seem overwhelming, but there are only a few
key pieces that we&#8217;ll need on a regular basis. In fact, the system of
layers is designed to help people focus on the one or two layers
specified to their needs and ignore the rest.</p>
</div>
<div class="sect3">
<h4 id="_addresses">21.3.1. Addresses</h4>
<div class="paragraph">
<p>The first topic we touch on is the network layer. What we need from this
layer are addresses. A network address is much like a street address. It
gives the location on the network of a computer so that messages can be
sent there.</p>
</div>
<div class="paragraph">
<p>For most systems you use, such an address is be an <em>IP address</em>. There
are two current versions of IP addresses, IPv4 and IPv6. IPv6 is the way
of the future and provides a huge number of possible addresses. Not all
systems support IPv6, and the general public is not very aware of it.
Although it will one day be the standard, we use the more common IPv4
addresses here. An IPv4 address is typically written as four decimal
numbers separated by dots. Each of these four numbers is in the range 0
- 255. For example, <code>64.233.187.99</code> and <code>192.168.1.1</code> are IPv4
addresses.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sockets">21.3.2. Sockets</h4>
<div class="paragraph">
<p>The second topic we focus on is the transport layer. Here, you need to
make a choice between TCP or UDP for communication. In this book, we
only cover TCP communication because it is reliable and much more
commonly used than UDP. If you need to use UDP communication, the basics
are not too different from TCP, and there are many excellent resources
online.</p>
</div>
<div class="paragraph">
<p>To create a TCP connection, you typically need a server program and a
client program. The difference between the two is not necessarily big.
In fact, both the client and the server could be running on the same
computer. What distinguishes the server is that it sets up a <em>port</em> and
listens to it, waiting for a connection. Once the client makes a
connection, the two programs can send and receive data on an equal
footing.</p>
</div>
<div class="paragraph">
<p>We just mentioned the term port. As you know, an address is the location
of a computer in a network, but a single computer may be performing many
different kinds of network communications. For example, your computer
could be running a web browser, an instant message application, an
online game, and a number of other things. So that none of these
programs become confused and get each others' messages, each program
uses a separate port for communication. To the outside world, your
computer usually only has a single address but thousands of available
ports. Many of these ports are set aside for specific purposes. For
example, port 20 is for FTP, port 23 is for Telnet, and port 80 is for
HTTP (webpages).</p>
</div>
<div class="paragraph">
<p>When you write a server program, you will usually create a
<code>ServerSocket</code> object which is linked to a particular port. For example,
if you wanted to write a web server, you might create a <code>ServerSocket</code>
as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ServerSocket</span> <span class="tok-n">serverSocket</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ServerSocket</span><span class="tok-o">(</span> <span class="tok-mi">80</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the <code>ServerSocket</code> object has been created, the server will
typically listen to the socket and try to accept incoming connections.
When a connection is accepted, a new <code>Socket</code> object is created for that
connection. The purpose of the <code>ServerSocket</code> is just to set up this
<code>Socket</code>. The <code>ServerSocket</code> doesn&#8217;t do any real communication on its
own. This system may seem indirect, but it allows for greater
flexibility. For example, a server could have a thread just listening
for connections. When a connection is made, it could spawn a new thread
to do the communication. Commercial web servers often function in this
way. The code for a server to listen for a connection is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Socket</span> <span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-n">serverSocket</span><span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>accept()</code> method is a blocking method; thus, the server will wait
for a connection before doing anything else.</p>
</div>
<div class="paragraph">
<p>Now, if you want to write the client which connects to such a server,
you can create the <code>Socket</code> object directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Socket</span> <span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Socket</span><span class="tok-o">(</span> <span class="tok-s">&quot;64.233.187.99&quot;</span><span class="tok-o">,</span> <span class="tok-mi">80</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first parameter is a <code>String</code> specifying the address of the server,
either as an IP address as shown or as domain like <code>"google.com"</code>. The
second parameter is, of course, the port you want to connect on.</p>
</div>
</div>
<div class="sect3">
<h4 id="subsection:receiving_and_sending_data">21.3.3. Receiving and sending data</h4>
<div class="paragraph">
<p>From here on out, we no longer have to worry about the differences
between the client and server. Both programs have a <code>Socket</code> object that
can be used for communication.</p>
</div>
<div class="paragraph">
<p>In order to get input from a <code>Socket</code>, you first call its
<code>getInputStream()</code> method. You can use the <code>InputStream</code> returned to
create an object used for normal file input like in the first half of
the chapter. The considerations are similar. If you only need to receive
plain, human readable from the <code>Socket</code>, you can create a <code>Scanner</code>
object as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getInputStream</span><span class="tok-o">()</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Over the network, it will be much more common to send files and other
binary data. For that purpose you can create an <code>ObjectInputStream</code> or
<code>DataInput\-Stream</code> from the <code>Socket</code> in much the same way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span> <span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getInputStream</span><span class="tok-o">()</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It should be unsurprising that output is just as easy as input. Text
output can be accomplished by creating a <code>PrintWriter</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">PrintWriter</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PrintWriter</span><span class="tok-o">(</span> <span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getOutputStream</span><span class="tok-o">()</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Likewise, binary output can be accomplished by creating an
<code>ObjectOutputStream</code> or a <code>DataOutputStream</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span>
    <span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getOutputStream</span><span class="tok-o">()</span> <span class="tok-o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have these input and output objects, you use them in the same
way you would for file processing. There are a few minor differences to
keep in mind. In the first place, when reading data, you may not know
when more is coming. There is no explicit end of file. Also, it is
sometimes necessary to call a <code>flush()</code> method after doing a write.
Unlike writing to a disk, a socket may wait for a sizable chunk of data
to be accumulated before it gets sent across the network. Without a
<code>flush()</code>, the data you write may not be sent immediately.</p>
</div>
<div class="exampleblock">
<div class="title">Example 165. Simple client and server</div>
<div class="content">
<div class="paragraph">
<p>Here&#8217;s an example of a piece of server code which listens on port 4321
waits for a connection, then reads 100 <code>int</code> values in binary form from
the socket, and prints their sum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span><span class="tok-o">{</span>
    <span class="tok-n">ServerSocket</span> <span class="tok-n">serverSocket</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ServerSocket</span><span class="tok-o">(</span> <span class="tok-mi">4321</span> <span class="tok-o">);</span>
    <span class="tok-n">Socket</span> <span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-n">serverSocket</span><span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">();</span>
    <span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span><span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getInputStream</span><span class="tok-o">());</span>
    <span class="tok-kt">int</span> <span class="tok-n">sum</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">sum</span> <span class="tok-o">+=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readInt</span><span class="tok-o">();</span>
    <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Sum: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">sum</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">IOException</span> <span class="tok-n">e</span> <span class="tok-o">)</span>
<span class="tok-o">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, here&#8217;s a companion piece of client code which connects to port 4321
and sends 100 <code>int</code> values in binary form, specifically, the first 100
perfect squares.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span><span class="tok-o">{</span>
    <span class="tok-n">Socket</span> <span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Socket</span><span class="tok-o">(</span> <span class="tok-s">&quot;127.0.0.1&quot;</span><span class="tok-o">,</span> <span class="tok-mi">4321</span> <span class="tok-o">);</span>
    <span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span>
        <span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getOutputStream</span><span class="tok-o">());</span>
    <span class="tok-k">for</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;=</span> <span class="tok-mi">100</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++</span> <span class="tok-o">)</span>
        <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeInt</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">*</span><span class="tok-n">i</span><span class="tok-o">);</span>
    <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">IOException</span> <span class="tok-n">e</span> <span class="tok-o">)</span>
<span class="tok-o">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this client code connects to the IP address <code>127.0.0.1</code>. This
is a special loopback IP address. When you connect to this IP address,
it connects to the machine you are currently working on. In this way,
you can test your networking code without needing two separate
computers. To test this client and server code together, you you will
need to run two virtual machines. The simplest way to do this is open
two command line prompts and run the client from one and the server from
the other. Be sure that you start the server first so that the client
has something to connect to.</p>
</div>
</div>
</div>
<div id="chatClientAndServerExample" class="exampleblock">
<div class="title">Example 166. Chat client and server</div>
<div class="content">
<div class="paragraph">
<p>Now we look at a more complicated example of network communication which
should be familiar: a chat program. If you want to apply the GUI design
from <a href="#_constructing_graphical_user_interfaces">Chapter 15</a>, you can
make a windowed version of this chat program which looks more like chat
programs you are used to. For now, our chat program is be text only.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise21.9">Exercise 21.9</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>The functionality of the program is simple. Once connected to a single
other chat program, the user will enter his or her name, then enter
lines of text each followed by a newline. The program will insert the
user&#8217;s name at the beginning of each line of text and then send it
across the network to the other chat program, which will display it. We
encapsulate both client and server functionality in a class called
<code>Chat</code>.</p>
</div>
<div class="paragraph">
<p>The first step is the appropriate import statements and the <code>main()</code>
method, which creates a client or a server <code>Chat</code> object, depending on
command line parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.net.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Chat</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-n">Socket</span> <span class="tok-n">socket</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;-s&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno"> 9 </span>			<span class="tok-k">new</span> <span class="tok-n">Chat</span><span class="tok-o">(</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span> <span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno">10 </span>		<span class="tok-k">else</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;-c&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">11 </span>			<span class="tok-k">new</span> <span class="tok-n">Chat</span><span class="tok-o">(</span> <span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">],</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">parseInt</span><span class="tok-o">(</span> <span class="tok-n">args</span><span class="tok-o">[</span><span class="tok-mi">2</span><span class="tok-o">]</span> <span class="tok-o">)</span>  <span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-k">else</span>
<span class="lineno">13 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Invalid command line flag.&quot;</span><span class="tok-o">);</span>
<span class="lineno">14 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code given here calls the server version of the <code>Chat</code> constructor
if the argument <code>"-s"</code> is given and the client version of the <code>Chat</code>
constructor if the argument <code>"-c"</code> is given. For the server, only a port
is required, but the client also needs an IP address to connect to.</p>
</div>
<div class="paragraph">
<p>The server <code>Chat</code> constructor takes the port and listens for a
connection on it. After a connection, it calls the <code>runChat()</code> method to
perform the actual business of sending and receiving chats.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-c1">// Server</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Chat</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">port</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>			<span class="tok-n">ServerSocket</span> <span class="tok-n">serverSocket</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ServerSocket</span><span class="tok-o">(</span> <span class="tok-n">port</span> <span class="tok-o">);</span>
<span class="lineno">5 </span>			<span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-n">serverSocket</span><span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">();</span>
<span class="lineno">6 </span>			<span class="tok-n">runChat</span><span class="tok-o">();</span>
<span class="lineno">7 </span>		<span class="tok-o">}</span>
<span class="lineno">8 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">9 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The client constructor is similar but connects directly to the specified
IP address on the specified port.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-c1">// Client</span>
<span class="lineno">2 </span>	<span class="tok-kd">public</span> <span class="tok-nf">Chat</span><span class="tok-o">(</span> <span class="tok-n">String</span> <span class="tok-n">address</span><span class="tok-o">,</span> <span class="tok-kt">int</span> <span class="tok-n">port</span> <span class="tok-o">)</span>	<span class="tok-o">{</span>
<span class="lineno">3 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">4 </span>			<span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Socket</span><span class="tok-o">(</span> <span class="tok-n">address</span><span class="tok-o">,</span> <span class="tok-n">port</span> <span class="tok-o">);</span>
<span class="lineno">5 </span>			<span class="tok-n">runChat</span><span class="tok-o">();</span>
<span class="lineno">6 </span>		<span class="tok-o">}</span>
<span class="lineno">7 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">Exception</span> <span class="tok-n">e</span> <span class="tok-o">)</span>
<span class="lineno">8 </span>		<span class="tok-o">{}</span>
<span class="lineno">9 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the client and server are connected, they both run the <code>runChat()</code>
method, which creates a new <code>Sender</code> and a new <code>Receiver</code> to do the
sending and receiving. Note that both <code>start()</code> and <code>join()</code> are called
on the <code>Sender</code> and <code>Receiver</code> objects. These calls are needed because
both classes are subclasses of <code>Thread</code>. Sending messages is an
independent task concerned with reading input from the keyboard and then
sending it across the network. Receiving messages is also an independent
task, but it is concerned with reading input from the network and
printing it on the screen. Since both tasks are independent, it is
reasonable to allocate a separate thread to each.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">runChat</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">InterruptedException</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>		<span class="tok-n">Sender</span> <span class="tok-n">sender</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Sender</span><span class="tok-o">();</span>
<span class="lineno">3 </span>		<span class="tok-n">Receiver</span> <span class="tok-n">receiver</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Receiver</span><span class="tok-o">();</span>
<span class="lineno">4 </span>		<span class="tok-n">sender</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">5 </span>		<span class="tok-n">receiver</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">6 </span>		<span class="tok-n">sender</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">7 </span>		<span class="tok-n">receiver</span><span class="tok-o">.</span><span class="tok-na">join</span><span class="tok-o">();</span>
<span class="lineno">8 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is the private inner class <code>Sender</code>. In this case it is convenient
but not necessary to make <code>Sender</code> an inner class, especially since it
is so short. The only piece of data <code>Sender</code> shares with <code>Chat</code> is the
all important <code>socket</code> variable. The <code>Sender</code> begins by creating a
<code>PrintWriter</code> object from the <code>socket&#8217;s output stream. After reading a
name from the user, it waits for a line from the user. Each time a line
is ready, it is printed and flushed, with the user name inserted at the
beginning, through the `PrintWriter</code> connected to the <code>Socket&#8217;s output
stream. When the user types `quit</code>, the <code>Socket</code> will be closed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">private</span> <span class="tok-kd">class</span> <span class="tok-nc">Sender</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>				<span class="tok-n">PrintWriter</span> <span class="tok-n">netOut</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PrintWriter</span><span class="tok-o">(</span>
<span class="lineno"> 5 </span>					<span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getOutputStream</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno"> 6 </span>				<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span> <span class="tok-o">);</span>
<span class="lineno"> 7 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">print</span><span class="tok-o">(</span><span class="tok-s">&quot;Enter your name: &quot;</span><span class="tok-o">);</span>
<span class="lineno"> 8 </span>				<span class="tok-n">String</span> <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno"> 9 </span>				<span class="tok-n">String</span> <span class="tok-n">buffer</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">;</span>
<span class="lineno">10 </span>				<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">isClosed</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>					<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">12 </span>						<span class="tok-n">buffer</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno">13 </span>						<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">buffer</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;quit&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">14 </span>							<span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="lineno">15 </span>						<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>							<span class="tok-n">netOut</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">name</span> <span class="tok-o">+</span> <span class="tok-s">&quot;: &quot;</span>
<span class="lineno">17 </span>								<span class="tok-o">+</span> <span class="tok-n">buffer</span> <span class="tok-o">);</span>
<span class="lineno">18 </span>							<span class="tok-n">netOut</span><span class="tok-o">.</span><span class="tok-na">flush</span><span class="tok-o">();</span>
<span class="lineno">19 </span>						<span class="tok-o">}</span>
<span class="lineno">20 </span>					<span class="tok-o">}</span>
<span class="lineno">21 </span>				<span class="tok-o">}</span>
<span class="lineno">22 </span>			<span class="tok-o">}</span>
<span class="lineno">23 </span>			<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">IOException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">24 </span>		<span class="tok-o">}</span>
<span class="lineno">25 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>45-69, not available.*</p>
</div>
<div class="paragraph">
<p>Below is the private inner class <code>Receiver</code>, the counterpart of
<code>Sender</code>, as well as the last thing defined in the <code>Chat</code> class. The
<code>Receiver</code> class is even simpler than the <code>Sender</code> class. After creating
a <code>Scanner</code> object connected to the input stream of the <code>Socket</code>, it
waits for a line of text to arrive from the connection. Each time a line
arrives, it prints it to the screen. Here again, you can see that this
problem is solved with threads much more easily than without them. Both
the <code>in.hasNextLine()</code> method called by <code>Sender</code> and the
<code>netIn.hasNextLine()</code> method called by <code>Receiver</code> are blocking
functions. Because each might wait for input before continuing, they
cannot easily be combined in one thread of execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">private</span> <span class="tok-kd">class</span> <span class="tok-nc">Receiver</span> <span class="tok-kd">extends</span> <span class="tok-n">Thread</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>			<span class="tok-k">try</span><span class="tok-o">{</span>
<span class="lineno"> 4 </span>				<span class="tok-n">Scanner</span> <span class="tok-n">netIn</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span>
<span class="lineno"> 5 </span>					<span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getInputStream</span><span class="tok-o">())</span> <span class="tok-o">;</span>
<span class="lineno"> 6 </span>				<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">isClosed</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno"> 7 </span>					<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">netIn</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">()</span> <span class="tok-o">)</span>
<span class="lineno"> 8 </span>						<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span> <span class="tok-n">netIn</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno"> 9 </span>			<span class="tok-o">}</span>
<span class="lineno">10 </span>			<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">IOException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{}</span>
<span class="lineno">11 </span>		<span class="tok-o">}</span>
<span class="lineno">12 </span>	<span class="tok-o">}</span>
<span class="lineno">13 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Although the fundamentals are present in this example, a real chat
client should provide a buddy list, the opportunity to talk to more than
one other user at a time, real error-handling code in the
<code>catch</code>-blocks, and many other features. Some of these features are
easier to provide in a GUI.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In the next section, we give a solution for the Web Server problem.
Since only the server side is provided, some of the networking is
simpler, and there are no threads. However, the communication is done in
both binary and text mode.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_web_server">21.4. Solution: Web server</h3>
<div class="paragraph">
<p>Here is our solution to the Web Server problem. As usual, our solution
doesn&#8217;t provide all the error checking or features that a real web
server would, but it is entirely functional. When you compile and run
the code, it will start a web server on port 8080 (an alternative port
for HTTP) in the directory you run it from. Feel free to change those
settings in the <code>main()</code> method. When the server is running, you should
be able to open any web browser and go to <code><a href="http://127.0.0.1" class="bare">http://127.0.0.1</a></code>. If you put
some sample HTML files in the directory you run the server from, you
should be able to browse them.</p>
</div>
<div class="paragraph">
<p>As for our code, we start with the imports and constructor below. Note
that the server has fields for the port communication will take place
on, the root directory for the web page, and a <code>ServerSocket</code>. The
<code>main()</code> method does nothing but call the constructor using the current
directory as an argument and then start the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">import</span> <span class="tok-nn">java.io.*</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span><span class="tok-kn">import</span> <span class="tok-nn">java.net.*</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.*</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WebServer</span> <span class="tok-o">{</span>
<span class="lineno"> 5 </span>	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">port</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">webRoot</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span>	<span class="tok-kd">private</span> <span class="tok-n">ServerSocket</span> <span class="tok-n">serverSocket</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>	<span class="tok-kd">public</span> <span class="tok-nf">WebServer</span><span class="tok-o">(</span> <span class="tok-kt">int</span> <span class="tok-n">port</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">webRoot</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">port</span> <span class="tok-o">=</span> <span class="tok-n">port</span><span class="tok-o">;</span>
<span class="lineno">11 </span>		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">webRoot</span> <span class="tok-o">=</span> <span class="tok-n">webRoot</span><span class="tok-o">;</span>
<span class="lineno">12 </span>	<span class="tok-o">}</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>		<span class="tok-n">File</span> <span class="tok-n">currentDirectory</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-s">&quot;.&quot;</span><span class="tok-o">);</span>
<span class="lineno">16 </span>		<span class="tok-k">try</span><span class="tok-o">{</span>
<span class="lineno">17 </span>			<span class="tok-n">WebServer</span> <span class="tok-n">server</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">WebServer</span><span class="tok-o">(</span><span class="tok-mi">8080</span><span class="tok-o">,</span>
<span class="lineno">18 </span>				<span class="tok-n">currentDirectory</span><span class="tok-o">.</span><span class="tok-na">getCanonicalPath</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">19 </span>			<span class="tok-n">server</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
<span class="lineno">20 </span>		<span class="tok-o">}</span>
<span class="lineno">21 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">IOException</span> <span class="tok-n">e</span> <span class="tok-o">)</span>
<span class="lineno">22 </span>		<span class="tok-o">{}</span>
<span class="lineno">23 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is the <code>start()</code> method. This method contains the central loop of
the web server that waits for connections and loops forever. Once a
connection has been made, the server creates input and output objects
from the socket connection. Then, it tries to serve requests coming from
the socket input. Our web server ignores any request other than a <code>GET</code>
request and closes the connection after the first <code>GET</code>. When a <code>GET</code>
request is made, the server removes the <code>"HTTP"</code> at the beginning and
passes off the remaining path to the <code>serve()</code> method. Everything else
in the <code>start()</code> method is made up of the necessary exception handling
machinery.</p>
</div>
<div class="paragraph">
<p>Note that the <code>out</code> object is of type <code>ObjectOutputStream</code>, allowing us
to send binary data over the socket. However, the <code>in</code> variable is of
type <code>Scanner</code>, because HTTP requests are generally only text.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">start</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 2 </span>		<span class="tok-n">Socket</span> <span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 3 </span>		<span class="tok-n">Scanner</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span>		<span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span>		<span class="tok-n">String</span> <span class="tok-n">line</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>		<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno"> 7 </span>			<span class="tok-n">serverSocket</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ServerSocket</span><span class="tok-o">(</span> <span class="tok-n">port</span> <span class="tok-o">);</span>
<span class="lineno"> 8 </span>			<span class="tok-k">while</span><span class="tok-o">(</span> <span class="tok-kc">true</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>				<span class="tok-n">socket</span> <span class="tok-o">=</span> <span class="tok-n">serverSocket</span><span class="tok-o">.</span><span class="tok-na">accept</span><span class="tok-o">();</span>
<span class="lineno">10 </span>				<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>					<span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span> <span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getInputStream</span><span class="tok-o">())</span> <span class="tok-o">;</span>
<span class="lineno">12 </span>					<span class="tok-n">out</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectOutputStream</span><span class="tok-o">(</span>
<span class="lineno">13 </span>						<span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">getOutputStream</span><span class="tok-o">()</span> <span class="tok-o">);</span>
<span class="lineno">14 </span>					<span class="tok-k">while</span> <span class="tok-o">(</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">hasNextLine</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">15 </span>						<span class="tok-n">line</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
<span class="lineno">16 </span>						<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-na">startsWith</span><span class="tok-o">(</span><span class="tok-s">&quot;GET&quot;</span><span class="tok-o">)</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>							<span class="tok-n">String</span> <span class="tok-n">path</span> <span class="tok-o">=</span> <span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-na">substring</span><span class="tok-o">(</span><span class="tok-mi">4</span><span class="tok-o">,</span>
<span class="lineno">18 </span>								<span class="tok-n">line</span><span class="tok-o">.</span><span class="tok-na">lastIndexOf</span><span class="tok-o">(</span><span class="tok-s">&quot;HTTP&quot;</span><span class="tok-o">)).</span><span class="tok-na">trim</span><span class="tok-o">();</span>
<span class="lineno">19 </span>							<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span>
<span class="lineno">20 </span>								<span class="tok-s">&quot;Received request for: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">path</span><span class="tok-o">);</span>
<span class="lineno">21 </span>							<span class="tok-n">serve</span><span class="tok-o">(</span> <span class="tok-n">out</span><span class="tok-o">,</span> <span class="tok-n">getPath</span><span class="tok-o">(</span> <span class="tok-n">path</span> <span class="tok-o">)</span> <span class="tok-o">);</span>
<span class="lineno">22 </span>							<span class="tok-n">socket</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="lineno">23 </span>							<span class="tok-k">break</span><span class="tok-o">;</span>
<span class="lineno">24 </span>						<span class="tok-o">}</span>
<span class="lineno">25 </span>					<span class="tok-o">}</span>
<span class="lineno">26 </span>				<span class="tok-o">}</span>
<span class="lineno">27 </span>				<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">IOException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">28 </span>					<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Error: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">());</span>
<span class="lineno">29 </span>				<span class="tok-o">}</span>
<span class="lineno">30 </span>				<span class="tok-k">finally</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>					<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">in</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="lineno">32 </span>					<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">out</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span>
<span class="lineno">33 </span>				<span class="tok-o">}</span>
<span class="lineno">34 </span>			<span class="tok-o">}</span>
<span class="lineno">35 </span>		<span class="tok-o">}</span>
<span class="lineno">36 </span>		<span class="tok-k">catch</span><span class="tok-o">(</span> <span class="tok-n">IOException</span> <span class="tok-n">e</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">37 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Error: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">());</span>
<span class="lineno">38 </span>		<span class="tok-o">}</span>
<span class="lineno">39 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next is a short utility method which provides some amount of platform
independence. The <code>getPath()</code> method take in a <code>String</code> representation
of a path requested by a web browser and format it. This path should
always be given in the Unix or Linux style with slashes (<code>/</code>) separating
each directory. To function smoothly with other operating systems,
<code>getPath()</code> uses the class variable <code>File.separatorChar</code> which gives the
<code>char</code> used to separate directories on whichever platform the JVM is
currently running. In addition, <code>getPath()</code> adds <code>"index.html"</code> to the
end of the path if the path ends with a directory rather than a file
name. Real web servers try a list of many different files such as
<code>index.html</code>, <code>index.htm</code>, <code>index.php</code>, and so on, until a file is found
or the list runs out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno">1 </span>	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPath</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">2 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-sc">&#39;/&#39;</span> <span class="tok-o">!=</span> <span class="tok-n">File</span><span class="tok-o">.</span><span class="tok-na">separatorChar</span><span class="tok-o">)</span>
<span class="lineno">3 </span>			<span class="tok-n">path</span> <span class="tok-o">=</span> <span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-na">replace</span><span class="tok-o">(</span><span class="tok-sc">&#39;/&#39;</span><span class="tok-o">,</span> <span class="tok-n">File</span><span class="tok-o">.</span><span class="tok-na">separatorChar</span><span class="tok-o">);</span>
<span class="lineno">4 </span>		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-na">endsWith</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">File</span><span class="tok-o">.</span><span class="tok-na">separatorChar</span> <span class="tok-o">)</span> <span class="tok-o">)</span>
<span class="lineno">5 </span>			<span class="tok-k">return</span> <span class="tok-n">webRoot</span> <span class="tok-o">+</span> <span class="tok-n">path</span> <span class="tok-o">+</span> <span class="tok-s">&quot;index.html&quot;</span><span class="tok-o">;</span>
<span class="lineno">6 </span>		<span class="tok-k">else</span>
<span class="lineno">7 </span>			<span class="tok-k">return</span> <span class="tok-n">webRoot</span> <span class="tok-o">+</span> <span class="tok-n">path</span><span class="tok-o">;</span>
<span class="lineno">8 </span>	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The last method in the <code>WebServer</code> class takes in a path and sends the
corresponding file over the nextwork. The <code>serve()</code> method first tries
to find the specified file. If it fails, it sends an <code>HTTP 404</code> message
with a short explanatory piece of HTML. Anyone who surfs the Internet
should be familiar with 404 messages. On the other hand, if this method
finds the file, it sends the <code>HTTP 200</code> method indicating success and
then creates a new <code>ObjectInputStream</code> object to read the file in binary
format. In this case, it is necessary to read the file in binary. In
general, HTML files are simple text files which are human readable, but
the image files that web servers must often send such as GIF and JPEG
files are binary files which are filled with unprintable characters.
Because we need to send binary data, we were also careful to open an
<code>ObjectOutputStream</code> on the socket earlier.</p>
</div>
<div class="paragraph">
<p>Once the file is open, the <code>serve()</code> method simply reads it in, byte by
byte, and sends each byte out over the socket. After the file has been
sent, the method closes it and returns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span>	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">serve</span><span class="tok-o">(</span> <span class="tok-n">ObjectOutputStream</span> <span class="tok-n">out</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">path</span> <span class="tok-o">)</span>
<span class="lineno"> 2 </span>		<span class="tok-kd">throws</span> <span class="tok-n">IOException</span> <span class="tok-o">{</span>
<span class="lineno"> 3 </span>		<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Trying to serve &quot;</span> <span class="tok-o">+</span> <span class="tok-n">path</span><span class="tok-o">);</span>
<span class="lineno"> 4 </span>		<span class="tok-n">File</span> <span class="tok-n">file</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-n">path</span><span class="tok-o">);</span>
<span class="lineno"> 5 </span>		<span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-o">!</span><span class="tok-n">file</span><span class="tok-o">.</span><span class="tok-na">exists</span><span class="tok-o">()</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 6 </span>			<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeBytes</span><span class="tok-o">(</span><span class="tok-s">&quot;HTTP/1.1 404 Not Found\n\n&quot;</span><span class="tok-o">);</span>
<span class="lineno"> 7 </span>			<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeBytes</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;404 Not Found&quot;</span> <span class="tok-o">+</span>
<span class="lineno"> 8 </span>				<span class="tok-s">&quot;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Not Found&quot;</span> <span class="tok-o">+</span>
<span class="lineno"> 9 </span>				<span class="tok-s">&quot;&lt;/h1&gt;The requested URL &quot;</span> <span class="tok-o">+</span> <span class="tok-n">path</span> <span class="tok-o">+</span>
<span class="lineno">10 </span>				<span class="tok-s">&quot; was not found on this server.&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="tok-o">);</span>
<span class="lineno">11 </span>			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;File not found.&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>		<span class="tok-o">}</span>
<span class="lineno">13 </span>		<span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>			<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeBytes</span><span class="tok-o">(</span><span class="tok-s">&quot;HTTP/1.1 200 OK\n\n&quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>			<span class="tok-n">ObjectInputStream</span> <span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno">16 </span>			<span class="tok-k">try</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>				<span class="tok-n">in</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ObjectInputStream</span><span class="tok-o">(</span>
<span class="lineno">18 </span>					<span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span> <span class="tok-n">file</span> <span class="tok-o">));</span>
<span class="lineno">19 </span>				<span class="tok-kt">int</span> <span class="tok-n">data</span><span class="tok-o">;</span>
<span class="lineno">20 </span>				<span class="tok-k">while</span> <span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">readByte</span><span class="tok-o">())</span> <span class="tok-o">!=</span> <span class="tok-o">-</span><span class="tok-mi">1</span> <span class="tok-o">)</span>
<span class="lineno">21 </span>					<span class="tok-n">out</span><span class="tok-o">.</span><span class="tok-na">writeByte</span><span class="tok-o">(</span> <span class="tok-o">(</span><span class="tok-kt">byte</span><span class="tok-o">)</span><span class="tok-n">data</span> <span class="tok-o">);</span>
<span class="lineno">22 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Request succeeded.&quot;</span><span class="tok-o">);</span>
<span class="lineno">23 </span>			<span class="tok-o">}</span>
<span class="lineno">24 </span>			<span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">25 </span>				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Error sending file: &quot;</span> <span class="tok-o">+</span>
<span class="lineno">26 </span>					<span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">getMessage</span><span class="tok-o">());</span>
<span class="lineno">27 </span>			<span class="tok-o">}</span>
<span class="lineno">28 </span>			<span class="tok-k">finally</span> <span class="tok-o">{</span> <span class="tok-k">if</span><span class="tok-o">(</span> <span class="tok-n">in</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">)</span> <span class="tok-n">in</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">();</span> <span class="tok-o">}</span>
<span class="lineno">29 </span>		<span class="tok-o">}</span>
<span class="lineno">30 </span>	<span class="tok-o">}</span>
<span class="lineno">31 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because a web server is a real world application, we have to give the
usual caveat that this implementation is quite bare-bones. There are
other HTTP requests and many features, including error handling, that a
web server should do better. Feel free to extend the functionality.</p>
</div>
<div class="paragraph">
<p>Also, you might notice that there is no way to stop the web server. It
has an infinite loop which is only broken if there is an <code>IOException</code>
thrown. From a Windows, Linux, or Mac command prompt, you can usually
stop a running program by typing <code>Ctrl-C</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrency_networking">21.5. Concurrency: Networking</h3>
<div class="paragraph">
<p>Throughout this book, we have used concurrency primarily for the purpose
of speedup. For that kind of performance improvement, concurrency is
essentially icing on the cake. Unless you are performing massively
parallel computations such as code breaking or scientific computing,
concurrency will probably make your application run just a little faster
or a little smoother.</p>
</div>
<div class="paragraph">
<p>With network programming, the situation is different. Many networked
programs, including chat clients, web servers, and peer-to-peer file
sharing software, will simultaneously be connected to tens if not
hundreds of other computers at the same time. While there are
single-threaded strategies to handle these scenarios, it is natural to
handle them in a multi-threaded way.</p>
</div>
<div class="paragraph">
<p>A web server at Google, for example, may service thousands of requests
per second. If each request had to wait for the previous one to come to
completion, the server would become hopelessly bogged down. By using a
single thread to listen to requests and then spawn worker threads as
needed, the server can run more smoothly.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><a href="#exercise21.10">Exercise 21.10</a><br>
<a href="#exercise21.11">Exercise 21.11</a></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Even in <a href="#chatClientAndServerExample">Example 166</a>, it was convenient to
create two different threads, <code>Sender</code> and <code>Receiver</code>. We did not create
them for speedup but simply because they were doing two different jobs.
Since the <code>Sender</code> waits for the user to type a line and the <code>Receiver</code>
waits for a line of text to arrive over the network, it would be
difficult to write a single thread that could handle both jobs. Both
threads call the <code>hasNextLine()</code> method, which can block execution. A
single thread waiting to see if the user had entered more text could not
respond to text arriving over the network until the user hit enter.</p>
</div>
<div class="paragraph">
<p>We only touch briefly on networking in this book. As the Internet
evolves, standards and APIs evolve as well. Some libraries can create
and manage threads transparently, without the user worrying about the
details. In other cases, your program must explicitly use multiple
threads to solve the networking problem effectively.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercises_21">21.6. Exercises</h3>
<div class="paragraph">
<p><strong>Conceptual Problems</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a id="exercise21.1"></a> Why are there so many similarities between the network I/O and the
file I/O APIs in Java?</p>
</li>
<li>
<p><a id="exercise21.2"></a> Explain the difference between client and server computers in
network communication. Is it possible for a single computer to be both a
client and a server?</p>
</li>
<li>
<p><a id="exercise21.3"></a> Why is writing a web browser so much more complicated than writing a
web server?</p>
</li>
<li>
<p><a id="exercise21.4"></a> Name and briefly describe the seven layers of the OSI model.</p>
</li>
<li>
<p><a id="exercise21.5"></a> Modern computers often have many programs running that are all in
communication over a network. Since a computer often has only one IP
address that the outside world can send to, how are messages that arrive
at the computer connected to the right program?</p>
</li>
<li>
<p><a id="exercise21.6"></a> What are the most popular choices of protocols at the transport
layer of the OSI model? What are the advantages and disadvantages of
each?</p>
</li>
<li>
<p><a id="exercise21.7"></a> How many possible IP addresses are there in IPv4? IPv6 addresses are
often written as eight groups of four hexadecimal digits, totaling 32
hexadecimal digits. How many possible IP addresses are there in IPv6?</p>
<div class="paragraph">
<p><strong>Programming Practice</strong></p>
</div>
</li>
<li>
<p><a id="exercise21.8"></a> Recall the client and server from <a href="#subsection:receiving_and_sending_data">Section 21.3.3</a> that, respectively, send 100 <code>int</code> values and sum them.
Rewrite these fragments to send and receive the <code>int</code> values in text
rather than binary format.</p>
</li>
<li>
<p><a id="exercise21.9"></a> Add a GUI based on <code>JFrame</code> for the chat
program given in <a href="#chatClientAndServerExample">Example 166</a>. Use a
(non-editable) <code>JTextArea</code> to display the log of messages, including
user name. Provide a <code>JTextField</code> for entering messages, a <code>JButton</code> for
sending messages, and another <code>JButton</code> for closing the network
connections and ending the program.</p>
</li>
<li>
<p><a id="exercise21.10"></a> Study the web server
implementation from <a href="#_solution_web_server">Section 21.4</a>. Implement a similar
web server which is multi-threaded. Instead of serving each request with
the same thread that is listening for connections, spawn a new thread to
handle the request each time a connection is made.</p>
</li>
<li>
<p><a id="exercise21.11"></a> One of the weaknesses of the web
server from the previous exercise is that a new thread has to be created
for each connection. An alternative approach is to create a pool of
threads to handle requests. Then, when a new request arrives, an idle
thread is selected from the pool. Extend the solution to the previous
exercise to use a fixed pool of 10 worker threads.</p>
<div class="paragraph">
<p><strong>Experiments</strong></p>
</div>
</li>
<li>
<p><a id="exercise21.12"></a> Consider the multi-threaded implementation of a web server from
<a href="#exercise21.10">Exercise 21.10</a>. Can you design an
experiment to measure the average amount of time a client waits to
receive the requested file? How does this time change from the single
threaded to the multi-threaded version? If the file size is larger, is
the increase in the waiting time the same in both the single and
multi-threaded versions?</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-07-18 11:55:23 Eastern Daylight Time
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>